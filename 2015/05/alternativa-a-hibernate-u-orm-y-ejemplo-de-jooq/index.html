





<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="base" href="/blog-bitix/">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="picodotdev">
  <meta name="keywords" content="java, programacion, software, hardware, tapestry, software libre, gnu, linux, gnu/linux, unix, arch, arch linux, web, html, css, javascript, tutorial, guía, básico, avanzado, análisis, tecnología, juegos, productos">
  <meta name="description" content="Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N&#43;1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible. &hellip;">
  <meta name="theme-color" content="#FFFFFF"/>

  <title>Alternativa a Hibernate u ORM y ejemplo de jOOQ</title>

  <link rel="shortcut icon" href="/blog-bitix/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog-bitix/assets/apple-touch-icon-144-precomposed.png">
  <link rel="canonical" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/" hreflang="es">
  <link rel="alternate" type="application/rss&#43;xml" href="https://picodotdev.github.io/blog-bitix/index.xml" hreflang="es" title="Blog Bitix">
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/" hreflang="es" title="Alternativa a Hibernate u ORM y ejemplo de jOOQ">
  
  <link rel="amphtml" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/index-amp.html" hreflang="es" title="Alternativa a Hibernate u ORM y ejemplo de jOOQ">
  
  <link rel="humans" type="text/plain" href="/blog-bitix/humans.txt">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel="stylesheet">

  

  <!-- Social -->
<meta property="og:title" content="Alternativa a Hibernate u ORM y ejemplo de jOOQ">
<meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">
<meta property="og:image" content="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png">

<meta property="og:site_name" content="Blog Bitix">
<meta property="og:description" content="Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N&#43;1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible. &hellip;">
<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png">

<meta name="twitter:site" content="@picodotdev">
<meta name="twitter:title" content="Alternativa a Hibernate u ORM y ejemplo de jOOQ">
<meta name="twitter:description" content="Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N&#43;1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible. &hellip;">
<meta name="twitter:creator" content="@picodotdev">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/"
    },
    "headline": "Alternativa a Hibernate u ORM y ejemplo de jOOQ",
    "image": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png"
        
      },
    "datePublished": "2015-05-29T20:00:00+02:00",
    "dateModified": "2017-06-18T12:00:00+02:00",
    "inLanguage": "es",
    
    "wordCount": "2834",
    "license": "https://creativecommons.org/licenses/by-sa/4.0/",
    "author": {
        "@type": "Person",
        "name": "picodotdev",
        "description": "Ingeniero de software. I ♥ Java, GNU/Linux and libre software.",
        "url": "https://twitter.com/picodotdev/"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog Bitix",
        "logo": {
            "@type": "ImageObject",
            "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
        }
    },
    "description": "Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N&#43;1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible."
}
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Blog Bitix",
    "description": "Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.",
    "url": "https://picodotdev.github.io/blog-bitix/",
    "logo": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
    }
}
  </script>

  <!-- css -->
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" media="all">
  <!-- theme -->
  <link rel="preload" href="/blog-bitix/assets/css/syntax.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/main.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/cookieconsent.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/syntax.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/main.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/cookieconsent.min.css" media="all">

  <!-- javascript -->
  <link rel="preload" href="/blog-bitix/assets/js/require-config.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/libs/require.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/js/main.js" as="script">
  <script type="text/javascript" src="/blog-bitix/assets/js/require-config.js" defer></script>
  <script type="text/javascript" src="/blog-bitix/assets/libs/require.js" data-main="/blog-bitix/assets/js/main" defer></script>

  <script type="text/javascript">
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-12874075-4', 'picodotdev.github.io');
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  <script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" defer></script>
<script type="text/javascript" defer>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: 'ca-pub-3533636310991304',
    enable_page_level_ads: true
  });
</script>

  
  <script type="text/javascript" src="/blog-bitix/assets/js/app.js" defer></script>
</head>
<body>  
  <div class="container">
    <div class="row">
      <div class="col-12">
        





<header>
  <div class="row">
    <div class="col-12 col-lg-4"></div>
    <div class="col-12 col-lg-4">
      <span class="title"><a href="https://picodotdev.github.io/blog-bitix/">Blog Bitix</a></span>
      <div class="links">
        
          <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
        
        
          <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
        
        
          <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
        
        
        
      </div>
    </div>
    <div class="col-12 col-lg-4 text-center">
      <form name="query" class="form-inline search" onsubmit="return false;">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Buscar en Blog Bitix" aria-label="Buscar en Blog Bitix">
        </div>
      </form>
      <form name="search" action="https://duckduckgo.com/" method="get" class="hidden" data-site="https://picodotdev.github.io/blog-bitix/">
        <input type="hidden" name="q" value="">
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      
<nav class="nav nav-pills nav-fill">
  <a href="/blog-bitix/tags/java/" class="nav-item nav-link">Java</a>
  <a href="/blog-bitix/tags/gnu-linux/" class="nav-item nav-link">GNU/Linux</a>
  <a href="/blog-bitix/tags/javascript/" class="nav-item nav-link">JavaScript</a>
  <a href="/blog-bitix/tags/tapestry/" class="nav-item nav-link">Tapestry</a>
  <a href="/blog-bitix/archive/" class="nav-item nav-link">Archivo y hemeroteca</a>
  <a href="/blog-bitix/pages/links/" class="nav-item nav-link">Enlaces</a>
  <a href="/blog-bitix/pages/about/" class="nav-item nav-link">Acerca de...</a>
  
</nav>

    </div>
  </div>
</header> 
      </div>
    </div>
    <div class="row">
      <div class="col-12 adblock-container-billboard">
        <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <div class="adblock-sidebar-container">
          <div class="adblock-sidebar-container-left"></div>
          <div class="adblock-sidebar-container-right">
            <div class="adsense adsense-vertical">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="7450235768"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
<article>
    <h1>Alternativa a Hibernate u ORM y ejemplo de jOOQ</h1>
    <p class="information">
      
        Escrito por
       
      <span>picodotdev</span> el <time>29/05/2015</time>, actualizado el <time>18/06/2017</time>.
      
        <br>
        
          <a href="/blog-bitix/tags/java/">java</a>
        
          <a href="/blog-bitix/tags/programacion/">programacion</a>
        
          <a href="/blog-bitix/tags/planeta-codigo/">planeta-codigo</a>
        
      
      <br>
      <a href="/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">Enlace permanente</a>
      
        <a href="/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/#comments">Comentarios</a>
      
    </p>

    
      <p class="summary">Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N+1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible.</p>
    
    

    
      <div class="adblock-container-leaderboard">
      <div class="adsense adsense-leaderboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="8238629013"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    

    <div class="content">
      


      <div class="logotypes"> 
<p>
<img src="/blog-bitix/assets/images/logotypes/jooq.png" width="200" height="200" alt="jOOQ" title="jOOQ" class="" loading="false"></p>
</div>
<p>Con el auge de los lenguajes de programación orientados a objetos han surgido varias herramientas que intentan hacer que el trabajo de unir el mundo orientado a objetos del lenguaje que empleemos y el modelo relacional de las bases de datos sea más transparente, estas herramientas son conocidas como <a href="https://es.wikipedia.org/wiki/Mapeo_objeto-relacional">Object Realtional Mapping</a> (ORM). Una de las más conocidas y usada en la plataforma Java es <a href="https://hibernate.org/">Hibernate</a>. Sin embargo, aunque facilitan el acceso a los datos no están exentas de problemas y están surgiendo nuevas alternativas para tratar de solventar algunos de ellos, una de ellas es <a href="https://www.jooq.org/">jOOQ</a>.</p>
<p>Si hemos usado Hibernate sabremos que aunque este ampliamente usado facilitando la conversión entre el modelo relacional en base de datos y el modelo orientado a objetos del lenguaje Java también presenta problemas. Uno de los problemas es que al abstraer el acceso a base de datos no somos tan conscientes de las sentencias SQL que se envían a la base de datos provocando los problemas <a href="https://picodotdev.github.io/blog-bitix/2014/05/detectar-problema-n-plus-1-y-obtener-estadisticas-de-hibernate-con-grails/">N+1</a> y que la aplicación sea lenta, poco eficiente y sobrecargar la base de datos en el caso de realizar demasiadas consultas SQL. Otro problema es que cuando necesitamos realizar una consulta compleja o avanzada el <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql">lenguaje HQL</a> no nos ofrezca todo lo que necesitamos haciendo que tengamos que escribir directamente la consulta en lenguaje SQL con lo que perdemos la validación del compilador y si usamos una funcionalidad específica de un motor de base de datos la independencia del mismo. También puede ocurrirnos que diseñamos los modelos para complacer al <em>framework</em> de persistencia ORM.</p>
<p>jOOQ es una herramienta que facilita el acceso a la base de datos usando un enfoque diferente de los ORM, no trata de crear una abstracción sobre la base de datos relacional sino que pone el modelo relacional como elemento central de la aplicación en cuanto a la persistencia. Algunas de las características destacables de jOOQ son:</p>
<ul>
<li>La base de datos primero: los datos son probablemente lo más importante de una aplicación. En los ORM los modelos de objetos dirigen el modelo de base de datos, no siempre es sencillo (más) en bases de datos heredadas que no tienen la estructura necesaria usable por los ORMs. En jOOQ el modelo relacional dirige el modelo de objetos, para jOOQ el modelo relacional es más importante que el modelo de objetos.</li>
<li>jOOQ usa SQL como elemento central: en jOOQ se pueden construir las SQLs usando una API fluida con la que el compilador puede validar la sintaxis, metadatos y tipos de datos. Se evitan y se detectan rápidamente los errores de sintaxis con la ayuda del compilador y con la ayuda de un IDE se ofrece asistencia de código que facilita el uso de la API. Está a un nivel bastante cercano al lenguaje SQL.</li>
<li>SQL con tipado seguro: las sentencias se pueden construir usando código Java con la que el compilador validará el código y que los tipos de los datos usados sean los correctos, los errores los encontraremos en tiempo de compilación en vez de en tiempo de ejecución. jOOQ proporciona un DSL y una API fluida de fácil uso y lectura.</li>
<li>Generación de código: jOOQ genera clases a partir de los metadatos (el modelo relacional) de la base de datos. Cuando se renombre una tabla o campo en base de datos generados los modelos el compilador indicará los errores de compilación. Si en algún momento hay que renombrar una columna de la base de datos deberemos modificar los modelos, jOOQ permite regenerar las clases Java de acceso a la base de datos y el compilador nos avisará de aquello que no esté sincronizado entre la base de datos y el código Java.</li>
<li><em>Multi-Tenancy</em>: permite configurar la base de datos a la que se accederá en desarrollo, pruebas y producción.</li>
<li><em>Active Records</em>: jOOQ puede generar el código de acceso a la base de datos a partir del esquema, estas clases emplean el <a href="https://en.wikipedia.org/wiki/Active_record_pattern">patrón Active Record</a>. La implementación de este patrón ya proporciona las operaciones CRUD (uno de los avances de Hibernate) con lo que no tendremos que escribirlas para cada uno de los modelos de la aplicación, nos ahorraremos mucho código. Este código que se genera es opcional, jOOQ puede usarse simplemente para generar las sentencias SQL y usar JDBC sin la abstracción de los <em>Active Records</em>.</li>
<li>Estandarización: las bases de datos tienen diferencias en los dialectos SQL. jOOQ realiza transformaciones de expresiones SQL comunes a la correspondencia de la base de datos de forma que las SQLs escritas funcionen en todas las bases de datos de forma transparente, esto permite migrar de un sistema de datos sin cambiar el código de la aplicación. Este también era un avance proporcionado por los ORM, incluido Hibernate.</li>
<li>Ciclo de vida de las consultas: proporciona llamadas o <em>hooks</em> de forma que se puedan añadir comportamientos, por ejemplo para <em>logging</em>, manejo de transacciones, generación de identificadores, transformación de SQLs y más cosas.</li>
<li>Procedimientos almacenados: los procedimientos almacenados son ciudadanos de primera clase y pueden usarse de forma simple al contrario de lo que sucede en los ORM. Para algunas tareas los procedimientos almacenados son muy útiles y más eficientes.</li>
</ul>
<p>Los ORMs ofrecen como ventajas sobre el uso directo de JDBC la implementación de las operaciones CRUD, construir las SQLs con una API en vez de concatenando <em>Strings</em> propensos a errores al modificarlos y la independencia del motor de base de datos usado pudiendo cambiar a otro sin afectar al código de la aplicación. La navegación de las relaciones es más explícita que en Hibernate y <a href="https://picodotdev.github.io/blog-bitix/2015/11/obtener-datos-de-multiples-tablas-con-jooq/">obtener datos de múltiples tablas con jOOQ</a> diferente.</p>
<p>Si nos convencen estas características y propiedades de jOOQ podemos empezar leyendo la <a href="http://www.jooq.org/doc/3.6/manual/getting-started/tutorials/jooq-in-7-steps/">guía de inicio</a> donde se comenta los primeros pasos para usarlo. La <a href="http://www.jooq.org/doc/3.6/manual-single-page/">documentación de jOOQ</a> está bastante bien explicada pero no se comentan algunas cosas que al usarlo en un proyecto tendremos que buscar.</p>
<p>En el siguiente ejemplo mostraré como usar jOOQ y la configuración necesaria para emplearlo junto con <a href="https://spring.io/">Spring</a>. En la siguiente configuración de Spring usando únicamente código Java se construye un <em>DataSource</em>, un <em>Datasource</em> con soporte de transacciones para el acceso a la base de datos, un <a href="http://www.jooq.org/javadoc/latest/org/jooq/ConnectionProvider.html"><em>ConnectionProvider</em></a> de jOOQ que usará el <em>DataSource</em> para obtener las conexiones a la base de datos, con la clase <a href="http://www.jooq.org/javadoc/latest/org/jooq/Configuration.html"><em>Configuration</em></a> realizamos la configuración de jOOQ y finalmente <a href="http://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html"><em>DSLContext</em></a> es el objeto que usaremos para construir las sentencias SQL.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.services.spring</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.AdsenseDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.AdsenseDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.ImportSourceDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.ImportSourceDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.IndexationDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.IndexationDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.LabelDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.LabelDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.NewsletterDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.NewsletterDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsIndexationsDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsIndexationsDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsLabelsDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsLabelsDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.SourceDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.SourceDAOImpl</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp.BasicDataSource</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.ConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.SQLDialect</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DSL</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DataSourceConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DefaultConfiguration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.support.ResourceTransactionManager</span><span class="o">;</span>&#10;&#10;<span class="nd">@Configuration</span>&#10;<span class="nd">@ComponentScan</span><span class="o">({</span> <span class="s">&#34;info.blogstack&#34;</span> <span class="o">})</span>&#10;<span class="nd">@EnableTransactionManagement</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfiguration</span> <span class="o">{</span>&#10;&#10;	<span class="nd">@Bean</span><span class="o">(</span><span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&#34;close&#34;</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">BasicDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">&#34;org.h2.Driver&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&#34;jdbc:h2:./misc/database/app&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">ds</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">transactionAwareDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">TransactionAwareDataSourceProxy</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ResourceTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ConnectionProvider</span> <span class="nf">connectionProvider</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceConnectionProvider</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="nf">config</span><span class="o">(</span><span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">DefaultConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConfiguration</span><span class="o">();</span>&#10;		<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">);</span>&#10;		<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SQLDialect</span><span class="o">.</span><span class="na">H2</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">config</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">DSLContext</span> <span class="nf">dsl</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">DSL</span><span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">AdsenseDAO</span> <span class="nf">adsenseDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">AdsenseDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ImportSourceDAO</span> <span class="nf">importSourceDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">ImportSourceDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">IndexationDAO</span> <span class="nf">indexationDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">IndexationDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">LabelDAO</span> <span class="nf">labelDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">LabelDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostDAO</span> <span class="nf">postDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostsIndexationsDAO</span> <span class="nf">postsIndexationsDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostsIndexationsDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostsLabelsDAO</span> <span class="nf">postsLabelsDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostsLabelsDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">SourceDAO</span> <span class="nf">sourceDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">SourceDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">NewsletterDAO</span> <span class="nf">newsletterDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">NewsletterDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppConfiguration.java</span>
    </div>
</div>
<p>Una de las cosas que tendremos que resolver es que al generar código y usar el patrón <em>Active Record</em>, si lo usamos ya que podemos usar jOOQ para generar únicamente las sentencias SQL o en los casos que lo hagamos pudiendo combiar <em>Active Records</em> para unos casos y sentencias SQL con JDBC para otros, puede que necesitemos incluir campos adicionales a los presentes en la base de datos que manejen cierta lógica en la aplicación, también puede que necesitemos incluir métodos de lógica de negocio adicionales. Para incluir estos datos y métodos tendremos que extender la clase <em>Active Record</em> que genera jOOQ. En aquellos sitios de la aplicación que necesitemos usar esas propiedades y métodos adicionales deberemos transformar la instancia de la clase que usa jOOQ (<em>PostRecord</em>) por la clase que tenga esos datos adicionales (<em>AppPostRecord</em>). Para ello la API de la clase <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html">Record</a> ofrece el método <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html#into-java.lang.Class-"><em>into</em></a> o <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html#from-java.lang.Object-"><em>from</em></a> como muestro en el código de <em>AppPostRecord</em> a continuación. Esta es la solución que he usado en <a href="https://twitter.com/blogstackinfo">Blog Stack</a>.</p>
<p>jOOQ genera automáticamente las clases que implementa el patrón <em>Active Record</em> y dispondremos de los métodos CRUD heredados de la clase <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html">Record</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.records</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.misc.Globals</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.misc.Utils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.Keys</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.interfaces.IPost</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.ByteArrayInputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.StringReader</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.StringWriter</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.zip.GZIPInputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.zip.GZIPOutputStream</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.joda.time.DateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppPostRecord</span> <span class="kd">extends</span> <span class="n">PostRecord</span> <span class="o">{</span>&#10;&#10;	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">2075090879800194733L</span><span class="o">;</span>&#10;&#10;	<span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>&#10;&#10;	<span class="kd">private</span> <span class="n">Boolean</span> <span class="n">fresh</span><span class="o">;</span>&#10;&#10;	<span class="kd">public</span> <span class="nf">AppPostRecord</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">fresh</span> <span class="o">=</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">FALSE</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">getContentcompressed</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">try</span> <span class="o">{</span>&#10;				<span class="n">GZIPInputStream</span> <span class="n">zis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">getContentcompressed</span><span class="o">()));</span>&#10;				<span class="n">StringWriter</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">();</span>&#10;				<span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">zis</span><span class="o">,</span> <span class="n">sw</span><span class="o">);</span>&#10;				<span class="n">zis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;				<span class="n">sw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;&#10;				<span class="n">content</span> <span class="o">=</span> <span class="n">sw</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>&#10;			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;				<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>&#10;			<span class="o">}</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>&#10;		<span class="k">try</span> <span class="o">{</span>&#10;			<span class="n">String</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">content</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="n">content</span><span class="o">;</span>&#10;			<span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>&#10;			<span class="n">GZIPOutputStream</span> <span class="n">zos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>&#10;			<span class="n">StringReader</span> <span class="n">sr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>&#10;			<span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">sr</span><span class="o">,</span> <span class="n">zos</span><span class="o">);</span>&#10;			<span class="n">sr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;			<span class="n">zos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;&#10;			<span class="n">setContentcompressed</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>&#10;		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentExcerpt</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">getContent</span><span class="o">());</span>&#10;		<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">text</span><span class="o">();</span>&#10;		&#10;		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">Globals</span><span class="o">.</span><span class="na">POST_EXCERPT_LENGHT</span><span class="o">);</span>&#10;		<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">isFresh</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">fresh</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFresh</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">fresh</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">fresh</span> <span class="o">=</span> <span class="n">fresh</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateHash</span><span class="o">()</span> <span class="o">{</span>		&#10;		<span class="n">setHash</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">getHash</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">fetchParent</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">POST_SOURCE_ID</span><span class="o">)));</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getConsolidatedUpdateDate</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">getUpdatedate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getUpdatedate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">getPublishdate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getPublishdate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getCreationdate</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getConsolidatedPublishDate</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">getPublishdate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getPublishdate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getCreationdate</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreationdate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">creationDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setCreationdate</span><span class="o">(</span><span class="n">creationDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUpdatedate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">updateDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setUpdatedate</span><span class="o">(</span><span class="n">updateDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPublishdate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">publishDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setPublishdate</span><span class="o">(</span><span class="n">publishDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">from</span><span class="o">(</span><span class="n">IPost</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">from</span><span class="o">);</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">from</span> <span class="k">instanceof</span> <span class="n">AppPostRecord</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">AppPostRecord</span> <span class="n">afrom</span> <span class="o">=</span> <span class="o">(</span><span class="n">AppPostRecord</span><span class="o">)</span> <span class="n">from</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">setFresh</span><span class="o">(</span><span class="n">afrom</span><span class="o">.</span><span class="na">isFresh</span><span class="o">());</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">afrom</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppPostRecord.java</span>
    </div>
</div>
<p><a href="https://blog.jooq.org/2014/09/12/why-you-should-not-implement-layered-architecture/">Los desarrolladores de jOOQ abogan por la eliminación de capas</a> en la arquitectura de la aplicación pero puede que aún preferimos desarrollar una capa que contenga las consultas a la base de datos que sea usada y compartida por el resto la aplicación para el acceso los datos, quizá más que una capa en este caso es una forma de organizar el código. Los <em>Active Records</em> proporcionan algunos métodos de consulta pero probablemente necesitaremos más. En el siguiente ejemplo podemos ver como son las consultas con jOOQ. Si necesitamos métodos de búsqueda adicionales a los que por defecto jOOQ proporciona en Blog Stack he creado una clase <a href="https://es.wikipedia.org/wiki/Data_Access_Object">DAO</a> por cada entidad de la base de datos. En el siguiente ejemplo se puede ver como se construyen las sentencias SQL con jOOQ usando su API fluida.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.daos</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.LabelRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.NewsletterRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.SourceRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostDAO</span> <span class="o">{</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllBySource</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByYearMonth</span><span class="o">(</span><span class="n">Integer</span> <span class="n">year</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">month</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByLabel</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByShared</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">shared</span><span class="o">);</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findNewsletter</span><span class="o">();</span>&#10;&#10;	<span class="n">PostRecord</span> <span class="nf">findByURL</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">);</span>&#10;&#10;	<span class="n">PostRecord</span> <span class="nf">findByHash</span><span class="o">(</span><span class="n">String</span> <span class="n">hash</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countAll</span><span class="o">();</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">);</span>&#10;	&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countAuthors</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByDates</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByLabels</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveBySources</span><span class="o">();</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByNewsletter</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">);</span>&#10;	&#10;	<span class="kt">int</span> <span class="nf">updateNewsletter</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="n">posts</span><span class="o">,</span> <span class="n">NewsletterRecord</span> <span class="n">newslettter</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>PostDAO.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.daos</span><span class="o">;</span>&#10;&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.LABEL</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.POST</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.POSTS_LABELS</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.SOURCE</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.Post</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.LabelRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.NewsletterRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.SourceRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.joda.time.DateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DSL</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostDAOImpl</span> <span class="kd">implements</span> <span class="n">PostDAO</span> <span class="o">{</span>&#10;&#10;	<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;&#10;	<span class="kd">public</span> <span class="nf">PostDAOImpl</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">()).</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllBySource</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">source</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByYearMonth</span><span class="o">(</span><span class="n">Integer</span> <span class="n">year</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">month</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">Post</span> <span class="n">p</span> <span class="o">=</span> <span class="n">POST</span><span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="s">&#34;year(\&#34;p\&#34;.publishDate) = ?&#34;</span><span class="o">,</span> <span class="n">year</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="s">&#34;month(\&#34;p\&#34;.publishDate) = ?&#34;</span><span class="o">,</span> <span class="n">month</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">DATE</span><span class="o">.</span><span class="na">desc</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByLabel</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">POST_ID</span><span class="o">)).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">LABEL_ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">label</span><span class="o">.</span><span class="na">getId</span><span class="o">())))</span>&#10;				<span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">()).</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByShared</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">shared</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SHARED</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">shared</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">asc</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findNewsletter</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">DateTime</span> <span class="n">friday</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="o">().</span><span class="na">withDayOfWeek</span><span class="o">(</span><span class="n">5</span><span class="o">).</span><span class="na">withHourOfDay</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>&#10;		<span class="n">DateTime</span> <span class="n">tuesday</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="o">().</span><span class="na">withDayOfWeek</span><span class="o">(</span><span class="n">2</span><span class="o">).</span><span class="na">withHourOfDay</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>&#10;		<span class="n">DateTime</span> <span class="n">date</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">friday</span><span class="o">.</span><span class="na">isBeforeNow</span><span class="o">())</span> <span class="o">{</span>&#10;		&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">date</span> <span class="o">=</span> <span class="n">friday</span><span class="o">;</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">tuesday</span><span class="o">.</span><span class="na">isBeforeNow</span><span class="o">())</span> <span class="o">{</span>&#10;			<span class="n">date</span> <span class="o">=</span> <span class="n">tuesday</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">date</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">EMPTY_LIST</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">.</span><span class="na">isNull</span><span class="o">()).</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">lt</span><span class="o">(</span><span class="n">date</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">asc</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">PostRecord</span> <span class="nf">findByURL</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">URL</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">url</span><span class="o">)).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">PostRecord</span> <span class="nf">findByHash</span><span class="o">(</span><span class="n">String</span> <span class="n">hash</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">HASH</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">hash</span><span class="o">)).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countAll</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">source</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">POST_ID</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">LABEL_ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">label</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">newsletter</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countAuthors</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">DSL</span><span class="o">.</span><span class="na">countDistinct</span><span class="o">(</span><span class="n">DSL</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">,</span> <span class="n">POST</span><span class="o">.</span><span class="na">AUTHOR</span><span class="o">))).</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByDates</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select year(p.publishDate) as year, month(p.publishDate) as month, count(*) as posts from BLOGSTACK.POST as p where p.visible = true group by year(p.publishDate), month(p.publishDate) order by year(p.publishDate) desc, month(p.publishDate) desc&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByLabels</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select l.id as id, count(*) as posts from BLOGSTACK.LABEL as l inner join BLOGSTACK.POSTS_LABELS as pl on l.id = pl.label_id inner join BLOGSTACK.POST as p on pl.post_id = p.id where l.enabled = true and p.visible = true group by l.id order by l.name&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">LabelRecord</span> <span class="n">label</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">LABEL</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">LABEL</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;LABEL&#34;</span><span class="o">,</span> <span class="n">label</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveBySources</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select s.id as id, count(*) as posts from BLOGSTACK.SOURCE as s inner join BLOGSTACK.POST as p on s.id = p.source_id where p.visible = true group by s.id order by s.name&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">SourceRecord</span> <span class="n">source</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">SOURCE</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">SOURCE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;SOURCE&#34;</span><span class="o">,</span> <span class="n">source</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByNewsletter</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select l.id as id, count(*) as posts from BLOGSTACK.LABEL as l inner join BLOGSTACK.POSTS_LABELS as pl on l.id = pl.label_id inner join BLOGSTACK.POST as p on pl.post_id = p.id where l.enabled = true and p.visible = true and p.newsletter_id = ? group by l.id order by l.name&#34;</span><span class="o">,</span> <span class="n">newsletter</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">LabelRecord</span> <span class="n">label</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">LABEL</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">LABEL</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;LABEL&#34;</span><span class="o">,</span> <span class="n">label</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">updateNewsletter</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="n">posts</span><span class="o">,</span> <span class="n">NewsletterRecord</span> <span class="n">newslettter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">PostRecord</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>&#10;		<span class="o">}</span> &#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">,</span> <span class="n">newslettter</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">ids</span><span class="o">)).</span><span class="na">execute</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>PostDAOImpl.java</span>
    </div>
</div>
<p>Para usar el generador de código de jOOQ con <a href="https://gradle.org/">Gradle</a> debemos añadir la siguiente configuración al archivo de construcción del proyecto, este generador se conectará a la base de datos, obtendrá los datos de esquema y generará todas las clases del paquete <a href="https://github.com/picodotdev/blog-stack/tree/master/src/main/java/info/blogstack/persistence/jooq">info.blogstack.persistence.jooq</a>. Por ejemplo, puede que queramos usar <a href="https://www.joda.org/joda-time/">JodaTime</a> en vez de las clases <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html">Date</a> y <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Timestamp.html">Timesptamp</a> de la API de Java al menos si no usamos aún <a href="https://picodotdev.github.io/blog-bitix/2014/03/novedades-y-nuevas-caracteristicas-de-java-8/">Java 8 y sus novedades</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="o">...</span>&#10;&#10;<span class="n">task</span> <span class="n">generateJooq</span> <span class="o">{</span>&#10;	<span class="n">Configuration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withJdbc</span><span class="o">(</span><span class="k">new</span> <span class="n">Jdbc</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDriver</span><span class="o">(</span><span class="s1">&#39;org.h2.Driver&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withUrl</span><span class="o">(</span><span class="s1">&#39;jdbc:h2:./misc/database/app&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withPassword</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withGenerator</span><span class="o">(</span><span class="k">new</span> <span class="n">Generator</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withGenerate</span><span class="o">(</span><span class="k">new</span> <span class="n">Generate</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="o">.</span><span class="na">withInterfaces</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="o">.</span><span class="na">withRelations</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.DefaultGenerator&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">Database</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withCustomTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="k">new</span> <span class="nf">CustomType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.joda.time.DateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withConverter</span><span class="o">(</span><span class="s1">&#39;info.blogstack.persistence.records.DateTimeConverter&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withForcedTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="k">new</span> <span class="nf">ForcedType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.joda.time.DateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withTypes</span><span class="o">(</span><span class="s1">&#39;TIMESTAMP&#39;</span><span class="o">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.h2.H2Database&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withIncludes</span><span class="o">(</span><span class="s1">&#39;.*&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withExcludes</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withInputSchema</span><span class="o">(</span><span class="s1">&#39;BLOGSTACK&#39;</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withTarget</span><span class="o">(</span><span class="k">new</span> <span class="n">Target</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withPackageName</span><span class="o">(</span><span class="s1">&#39;info.blogstack.persistence.jooq&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDirectory</span><span class="o">(</span><span class="s1">&#39;src/main/java&#39;</span><span class="o">)));</span>&#10;&#10;	<span class="n">GenerationTool</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">configuration</span><span class="o">)</span>&#10;<span class="o">}</span>&#10;&#10;<span class="o">...</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>build.gradle</span>
    </div>
</div>
<p>Otra alternativa con algunas similitudes a jOOQ es <a href="https://jdbi.org/">JDBI</a> pero en esta las consultas no tienen el soporte del compilador que ofrece jOOQ, otra es <a href="https://scala-slick.org/">Slick</a> para <a href="https://www.scala-lang.org/">Scala</a>. También tiene cierta similitud con <a href="https://mybatis.org/mybatis-3/es/">MyBatis</a> que existe desde hace bastante tiempo aunque jOOQ ofrece más posibilidades.</p>
<p>En el <a href="https://github.com/picodotdev/blog-stack/tree/master">código fuente de Blog Stack</a> está el código completo de uso de jOOQ, en el paquete <a href="https://github.com/picodotdev/blog-stack/tree/master/src/main/java/info/blogstack/persistence">info.blogstack.persistence</a> están las clases relacionadas con la persistencia en una base de datos <a href="https://www.h2database.com/html/main.html">H2</a>, usa Spring para los servicios y la transaccionalidad, en la clase <a href="https://github.com/picodotdev/blog-stack/blob/master/src/main/java/info/blogstack/services/spring/AppConfiguration.java">AppConfiguration</a> se encuentra la definición de ambas cosas y la integración con jOOQ. En  la <a href="https://github.com/picodotdev/blog-stack/releases/tag/0.1">versión 0.1</a> está la misma aplicación pero usando Hibernate.</p>
<p>Como comentan en su propio blog <a href="https://blog.jooq.org/2013/08/06/use-modelmapper-and-jooq-to-regain-control-of-your-domain-model/">usa ModelMapper y jOOQ para recuperar el control de tu modelo de dominio</a> que probablemente no es nada menos que lo más importante de tu aplicación o negocio. Herramientas como jOOQ contribuyen a que haya <a href="https://picodotdev.github.io/blog-bitix/2015/05/10-razones-para-seguir-usando-java/">razones para seguir usando Java</a>.</p>
<p>jOOQ está <a href="http://www.jooq.org/legal/licensing">licenciado</a> de forma dual, <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL</a> para la versión <em>community</em> que ofrece soporte para las bases de datos <a href="https://www.mysql.com/">MySQL</a>, <a href="https://www.postgresql.org/">PostgreSQL</a>, SQLite, H2 y alguna más y una licencia comercial que ofrece soporte para bases de datos como <a href="https://products.office.com/es-ES/access">Microsoft Access</a>, <a href="https://www.oracle.com/database/">Oracle</a> y <a href="https://www.microsoft.com/en-us/sql-server/sql-server-2016">Microsoft SQL Server</a>.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.jooq.org/">jOOQ</a></li>
<li><a href="http://modelmapper.org/">ModelMapper</a></li>
<li><a href="http://modelmapper.org/user-manual/jooq-integration/">Integración entre jOOQ y ModelMapper</a></li>
<li><a href="http://teonos.com/blog/java/development/2014/11/10/experiences-with-jOOQ.html">Experiences with jOOQ</a></li>
<li><a href="https://hibernate.org/">Hibernate</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2012/03/herramienta-de-construccion-gradle.html">Introducción a Gradle</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2012/08/jodatime-y-como-integrarlo-con-hibernate.html">Usar DateTime en Hibernate</a></li>
</ul>
</div>

    </div>

    <p class="information">
      
    </p>

    
  </article>
        <div>
          <hr>
        </div>
        
  <div class="row serie">
    <div class="col-md-12">
      <h3>Este artículo forma parte de la serie <strong>jooq</strong>:</h3>
        
        <ol class="serie-articles">
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">Alternativa a Hibernate u ORM y ejemplo de jOOQ</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2015/10/multiples-esquemas-o-bases-de-datos-con-jooq-y-spring-en-java/">Múltiples esquemas o bases de datos con jOOQ y Spring en Java</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2015/11/obtener-datos-de-multiples-tablas-con-jooq/">Obtener datos de múltiples tablas con jOOQ</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2015/11/validar-objetos-con-spring-validation-ejemplo-registros-de-jooq/">Validar objetos con Spring Validation, ejemplo registros de jOOQ</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/05/log-de-sentencias-sql-sentencias-lentas-y-otra-informacion-en-jooq/">Log de sentencias SQL, sentencias lentas y otra información en jOOQ</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/05/implementar-la-paginacion-eficientemente-en-consultas-sql-con-seek/">Implementar la paginación eficientemente en consultas SQL con seek</a>
            </li>
          
        </ol>
      
    </div>
  </div>


        
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-text">
      Comparte el artículo:
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-inline-share-buttons"></div>
  </div>
</div>


        
        <div class="row">
          <div class="col-12 adblock-container-billboard">
            <span id="pageBottom"></span>
            <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
  <div class="row">
    <div class="col-md-12">
      <span id="comments"></span>
      <div id="disqus_thread"></div>
    </div>
  </div>

  <script type="text/javascript" async>
    var disqus_shortname = 'blog-bitix';
    var disqus_identifier = 'blog-bitix-82';
    var disqus_url = 'https:\/\/picodotdev.github.io\/blog-bitix\/2015\/05\/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq\/';
    var disqus_script = 'embed.js';
  </script>

      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    





<footer>
  <div class="row">
    <div class="col-12 col-sm-4">
      <p><strong>Blog Bitix</strong></p>
      <p>Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</p>
      <p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p>
    </div>
    <div class="col-12 col-sm-4 text-center menu">
      <ul class="list-unstyled">
        <li><a href="/blog-bitix/tags/java/">Java</a></li>
        <li><a href="/blog-bitix/tags/gnu-linux/">GNU/Linux</a></li>
        <li><a href="/blog-bitix/tags/javascript/">JavaScript</a></li>
        <li><a href="/blog-bitix/tags/tapestry/">Tapestry</a></li>
        <li><a href="/blog-bitix/archive/">Archivo y hemeroteca</a></li>
        <li><a href="/blog-bitix/pages/links/">Enlaces</a></li>
        <li><a href="/blog-bitix/pages/advertising/">Publicidad</a></li>
        <li><a href="/blog-bitix/pages/donate/">Donaciones</a></li>
        <li><a href="/blog-bitix/pages/about/">Acerca de...</a></li>
        
      </ul>
    </div>
    <div class="col-12 col-sm-4 text-center links">
      
        <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
      
      
        <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
      
      
      
        <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
      
      
      
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      Copyleft <span class="copyleft">&copy;</span> 2022 - <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" width="80" height="15" alt="Creative Commons License" title="Creative Commons License"></a><br />
      <a href="https://www.planetacodigo.com/" rel="nofollow"><img src="/blog-bitix/assets/images/planeta-codigo.png" width="80" height="15" alt="Planeta código" title="Planeta código"></a>
      <br/>
      <a href="https://picodotdev.github.io/blog-bitix/" rel="nofollow">Blog Bitix</a> by <a href="https://picodotdev.github.io/blog-bitix/">pico.dev</a> is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.
      <br/>
      <span class="credit">Powered by <a href="https://gohugo.io/" rel="nofollow" title="A fast and modern static website engine">Hugo</a> and <a href="https://pages.github.com/" title="Websites for you and your projects">GitHub Pages</a>.</span>
      <span class="credit">Background patterns from <a href="https://www.toptal.com/designers/subtlepatterns/" rel="nofollow">Subtle Patterns</a>.</span>
    </div>
  </div>
</footer>

  </div>
  
<div
  id="blueimp-gallery"
  class="blueimp-gallery blueimp-gallery-controls"
  aria-label="image gallery"
  aria-modal="true"
  role="dialog"
>
  <div class="slides" aria-live="polite"></div>
  <h3 class="title"></h3>
  <span
    class="prev"
    aria-controls="blueimp-gallery"
    aria-label="previous slide"
    aria-keyshortcuts="ArrowLeft"
  ></span>
  <span
    class="next"
    aria-controls="blueimp-gallery"
    aria-label="next slide"
    aria-keyshortcuts="ArrowRight"
  ></span>
  <span
    class="close"
    aria-controls="blueimp-gallery"
    aria-label="close"
    aria-keyshortcuts="Escape"
  ></span>
  <span
    class="play-pause"
    aria-controls="blueimp-gallery"
    aria-label="play slideshow"
    aria-keyshortcuts="Space"
    aria-pressed="false"
    role="button"
  ></span>
  <ol class="indicator"></ol>
</div>

  
  
</body>
</html>