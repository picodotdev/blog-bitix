





<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="base" href="/blog-bitix/">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="picodotdev">
  <meta name="keywords" content="java, programacion, software, hardware, tapestry, software libre, gnu, linux, gnu/linux, unix, arch, arch linux, web, html, css, javascript, tutorial, guía, básico, avanzado, análisis, tecnología, juegos, productos">
  <meta name="description" content="Una aplicación que trabaje con importes y diferentes divisas necesitará ratios de conversión, estos ratios de conversión deberemos obtenerlos de algún servicio. Con la API de Java Money que aun en Java 8 no está incorporada en el JDK aunque si como una librería podremos trabajar de forma cómoda con importes, divisas y ratios. En este artículo explicaré un ejemplo de uso práctico de la clase ServiceLoader y como obtener ratios del servicio Open Exchange Rates. &hellip;">
  <meta name="theme-color" content="#FFFFFF"/>

  <title>Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money</title>

  <link rel="shortcut icon" href="/blog-bitix/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog-bitix/assets/apple-touch-icon-144-precomposed.png">
  <link rel="canonical" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/" hreflang="es">
  <link rel="alternate" type="application/rss&#43;xml" href="https://picodotdev.github.io/blog-bitix/index.xml" hreflang="es" title="Blog Bitix">
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/" hreflang="es" title="Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money">
  
  <link rel="amphtml" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/index-amp.html" hreflang="es" title="Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money">
  
  <link rel="humans" type="text/plain" href="/blog-bitix/humans.txt">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel="stylesheet">

  

  <!-- Social -->
<meta property="og:title" content="Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money">
<meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/">
<meta property="og:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/java-750.png">

<meta property="og:site_name" content="Blog Bitix">
<meta property="og:description" content="Una aplicación que trabaje con importes y diferentes divisas necesitará ratios de conversión, estos ratios de conversión deberemos obtenerlos de algún servicio. Con la API de Java Money que aun en Java 8 no está incorporada en el JDK aunque si como una librería podremos trabajar de forma cómoda con importes, divisas y ratios. En este artículo explicaré un ejemplo de uso práctico de la clase ServiceLoader y como obtener ratios del servicio Open Exchange Rates. &hellip;">
<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/java-750.png">

<meta name="twitter:site" content="@picodotdev">
<meta name="twitter:title" content="Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money">
<meta name="twitter:description" content="Una aplicación que trabaje con importes y diferentes divisas necesitará ratios de conversión, estos ratios de conversión deberemos obtenerlos de algún servicio. Con la API de Java Money que aun en Java 8 no está incorporada en el JDK aunque si como una librería podremos trabajar de forma cómoda con importes, divisas y ratios. En este artículo explicaré un ejemplo de uso práctico de la clase ServiceLoader y como obtener ratios del servicio Open Exchange Rates. &hellip;">
<meta name="twitter:creator" content="@picodotdev">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://picodotdev.github.io/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/"
    },
    "headline": "Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money",
    "image": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/structured-data/java-750.png"
        
      },
    "datePublished": "2015-09-13T11:00:00+02:00",
    "dateModified": "2015-09-13T11:00:00+02:00",
    "inLanguage": "es",
    
    "wordCount": "964",
    "license": "https://creativecommons.org/licenses/by-sa/4.0/",
    "author": {
        "@type": "Person",
        "name": "picodotdev",
        "description": "Ingeniero de software. I ♥ Java, GNU/Linux and libre software.",
        "url": "https://twitter.com/picodotdev/"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog Bitix",
        "logo": {
            "@type": "ImageObject",
            "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
        }
    },
    "description": "Una aplicación que trabaje con importes y diferentes divisas necesitará ratios de conversión, estos ratios de conversión deberemos obtenerlos de algún servicio. Con la API de Java Money que aun en Java 8 no está incorporada en el JDK aunque si como una librería podremos trabajar de forma cómoda con importes, divisas y ratios. En este artículo explicaré un ejemplo de uso práctico de la clase ServiceLoader y como obtener ratios del servicio Open Exchange Rates."
}
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Blog Bitix",
    "description": "Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.",
    "url": "https://picodotdev.github.io/blog-bitix/",
    "logo": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
    }
}
  </script>

  <!-- css -->
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" media="all">
  <!-- theme -->
  <link rel="preload" href="/blog-bitix/assets/css/syntax.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/main.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/cookieconsent.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/syntax.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/main.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/cookieconsent.min.css" media="all">

  <!-- javascript -->
  <link rel="preload" href="/blog-bitix/assets/js/require-config.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/libs/require.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/js/main.js" as="script">
  <script type="text/javascript" src="/blog-bitix/assets/js/require-config.js" defer></script>
  <script type="text/javascript" src="/blog-bitix/assets/libs/require.js" data-main="/blog-bitix/assets/js/main" defer></script>

  <script type="text/javascript">
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-12874075-4', 'picodotdev.github.io');
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  <script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" defer></script>
<script type="text/javascript" defer>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: 'ca-pub-3533636310991304',
    enable_page_level_ads: true
  });
</script>

  
  <script type="text/javascript" src="/blog-bitix/assets/js/app.js" defer></script>
</head>
<body>  
  <div class="container">
    <div class="row">
      <div class="col-12">
        





<header>
  <div class="row">
    <div class="col-12 col-lg-4"></div>
    <div class="col-12 col-lg-4">
      <span class="title"><a href="https://picodotdev.github.io/blog-bitix/">Blog Bitix</a></span>
      <div class="links">
        
          <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
        
        
          <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
        
        
          <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
        
        
        
      </div>
    </div>
    <div class="col-12 col-lg-4 text-center">
      <form name="query" class="form-inline search" onsubmit="return false;">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Buscar en Blog Bitix" aria-label="Buscar en Blog Bitix">
        </div>
      </form>
      <form name="search" action="https://duckduckgo.com/" method="get" class="hidden" data-site="https://picodotdev.github.io/blog-bitix/">
        <input type="hidden" name="q" value="">
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      
<nav class="nav nav-pills nav-fill">
  <a href="/blog-bitix/tags/java/" class="nav-item nav-link">Java</a>
  <a href="/blog-bitix/tags/gnu-linux/" class="nav-item nav-link">GNU/Linux</a>
  <a href="/blog-bitix/tags/javascript/" class="nav-item nav-link">JavaScript</a>
  <a href="/blog-bitix/tags/tapestry/" class="nav-item nav-link">Tapestry</a>
  <a href="/blog-bitix/archive/" class="nav-item nav-link">Archivo y hemeroteca</a>
  <a href="/blog-bitix/pages/links/" class="nav-item nav-link">Enlaces</a>
  <a href="/blog-bitix/pages/about/" class="nav-item nav-link">Acerca de...</a>
  
</nav>

    </div>
  </div>
</header> 
      </div>
    </div>
    <div class="row">
      <div class="col-12 adblock-container-billboard">
        <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <div class="adblock-sidebar-container">
          <div class="adblock-sidebar-container-left"></div>
          <div class="adblock-sidebar-container-right">
            <div class="adsense adsense-vertical">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="7450235768"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
<article>
    <h1>Ejemplo práctico de ServiceLoader con ServiceProvider de Java Money</h1>
    <p class="information">
      
        Escrito por
       
      <span>picodotdev</span> el <time>13/09/2015</time>.
      
        <br>
        
          <a href="/blog-bitix/tags/java/">java</a>
        
          <a href="/blog-bitix/tags/planeta-codigo/">planeta-codigo</a>
        
          <a href="/blog-bitix/tags/programacion/">programacion</a>
        
      
      <br>
      <a href="/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/">Enlace permanente</a>
      
        <a href="/blog-bitix/2015/09/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money/#comments">Comentarios</a>
      
    </p>

    
      <p class="summary">Una aplicación que trabaje con importes y diferentes divisas necesitará ratios de conversión, estos ratios de conversión deberemos obtenerlos de algún servicio. Con la API de Java Money que aun en Java 8 no está incorporada en el JDK aunque si como una librería podremos trabajar de forma cómoda con importes, divisas y ratios. En este artículo explicaré un ejemplo de uso práctico de la clase ServiceLoader y como obtener ratios del servicio Open Exchange Rates.</p>
    
    

    
      <div class="adblock-container-leaderboard">
      <div class="adsense adsense-leaderboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="8238629013"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    

    <div class="content">
      


      <div class="logotypes"> 
<p>
<img src="/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java" class="" loading="false"></p>
</div>
<p>La semana pasada comentaba la <a href="https://picodotdev.github.io/blog-bitix/2015/09/aplicacion-java-extensible-con-la-clase-serviceloader/">clase ServiceLoader disponibles en el JDK</a> y como nos puede servir para que nuestra aplicación o API sea extensible en futuras versiones o para alguien que quiera adaptarla a sus necesidades. La clase ServiceLoader es el método que se emplea en la <a href="https://picodotdev.github.io/blog-bitix/2015/07/como-trabajar-con-importes-ratios-y-divisas-en-java/">API de Java para tratamiento de divisas, importes y conversiones</a> que quizá en un futuro se ofrezca en Java con la especificación JSR-354. Por el momento se puede usar la <a href="https://github.com/JavaMoney/jsr354-ri">librería con la implementación de referencia</a>. En este ejemplo mostraré cómo proporcionar un nuevo proveedor de ratios que obtenga <a href="https://picodotdev.github.io/blog-bitix/2015/06/servicio-para-obtener-ratios-de-conversion-entre-divisas/">ratios de conversión del servicio Open Exchange Rates</a>.</p>
<p>Para disponer del proveedor de ratios usable para Java Money deberemos implementar una clase que extienda de <a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/spi/AbstractRateProvider.java">AbstractRateProvider</a> junto con la implementación para el método <em>getExchangeRate</em> que devolverá los ratios, también el método <em>newDataLoaded</em> que procesará los datos de ratios obtenidos del servicio. El código del método <em>getExchangeRate</em> es una copia del <a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/convert/ECBAbstractRateProvider.java">proveedor del Banco Central Europeo</a> (ECB), el método <em>newDataLoaded</em> obtiene los ratios a partir de un <em>InputStream</em> con los ratios devueltos por la URL del servicio, en el caso de <a href="https://openexchangerates.org">Open Exchange Rates</a> en el <em>endpoint</em> <em>/api/latest.json?app_id=[api_key]</em>.</p>
<p>Internamente la implementación de referencia de Java Money usa la clase <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>. En el archivo <em>META-INF/services/javax.money.convert.ExchangeRateProvider</em> incluimos el nombre cualificado completo de la clase de la implementación de AbstractRateProvider, en este caso <em>io.github.picodotdev.javamoney.OpenExchangeRatesRateProvider</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext">io.github.picodotdev.javamoney.OpenExchangeRatesRateProvider&#10;&#10;</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>javax.money.convert.ExchangeRateProvider</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span><span class="lnt">172&#10;</span><span class="lnt">173&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.javamoney</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.math.MathContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.Period</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.money.Monetary</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.ConversionContextBuilder</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.ConversionQuery</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.CurrencyConversionException</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.ExchangeRate</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.ProviderContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.ProviderContextBuilder</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.convert.RateType</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.money.spi.Bootstrap</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.javamoney.moneta.ExchangeRateBuilder</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.javamoney.moneta.spi.AbstractRateProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.javamoney.moneta.spi.DefaultNumberValue</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.javamoney.moneta.spi.LoaderService</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.javamoney.moneta.spi.LoaderService.LoaderListener</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OpenExchangeRatesRateProvider</span> <span class="kd">extends</span> <span class="n">AbstractRateProvider</span> <span class="kd">implements</span> <span class="n">LoaderListener</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DATA_ID</span> <span class="o">=</span> <span class="n">OpenExchangeRatesRateProvider</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ProviderContext</span> <span class="n">CONTEXT</span> <span class="o">=</span> <span class="n">ProviderContextBuilder</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;OER&#34;</span><span class="o">,</span> <span class="n">RateType</span><span class="o">.</span><span class="na">DEFERRED</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;providerDescription&#34;</span><span class="o">,</span> <span class="s">&#34;Open Exchange Rates&#34;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;days&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">build</span><span class="o">();</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">String</span> <span class="n">BASE_CURRENCY_CODE</span> <span class="o">=</span> <span class="s">&#34;USD&#34;</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">protected</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">load</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">protected</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">LocalDate</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ExchangeRate</span><span class="o">&gt;&gt;</span> <span class="n">rates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="nf">OpenExchangeRatesRateProvider</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">super</span><span class="o">(</span><span class="n">CONTEXT</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LoaderService</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Bootstrap</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">LoaderService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">loader</span><span class="o">.</span><span class="na">addLoaderListener</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">getDataId</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">load</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="na">loadDataAsync</span><span class="o">(</span><span class="n">getDataId</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDataId</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">DATA_ID</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">newDataLoaded</span><span class="o">(</span><span class="n">String</span> <span class="n">resourceId</span><span class="o">,</span> <span class="n">InputStream</span> <span class="n">is</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">try</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LocalDate</span> <span class="n">date</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRateBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExchangeRateBuilder</span><span class="o">(</span><span class="n">ConversionContextBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">CONTEXT</span><span class="o">,</span> <span class="n">RateType</span><span class="o">.</span><span class="na">DEFERRED</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">date</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rates</span><span class="o">.</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ExchangeRate</span><span class="o">&gt;());</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">JSONObject</span> <span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="s">&#34;rates&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setBase</span><span class="o">(</span><span class="n">Monetary</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">(</span><span class="n">BASE_CURRENCY_CODE</span><span class="o">));</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">term</span> <span class="o">:</span> <span class="n">r</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(!</span><span class="n">Monetary</span><span class="o">.</span><span class="na">isCurrencyAvailable</span><span class="o">(</span><span class="n">term</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Double</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="n">term</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setTerm</span><span class="o">(</span><span class="n">Monetary</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">(</span><span class="n">term</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setFactor</span><span class="o">(</span><span class="n">DefaultNumberValue</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">factor</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRate</span> <span class="n">exchangeRate</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">date</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="n">term</span><span class="o">,</span> <span class="n">exchangeRate</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ExchangeRate</span> <span class="nf">getExchangeRate</span><span class="o">(</span><span class="n">ConversionQuery</span> <span class="n">conversionQuery</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">try</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">load</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">rates</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LocalDate</span><span class="o">[]</span> <span class="n">dates</span> <span class="o">=</span> <span class="n">getQueryDates</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LocalDate</span> <span class="n">selectedDate</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ExchangeRate</span><span class="o">&gt;</span> <span class="n">targets</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="o">(</span><span class="n">LocalDate</span> <span class="n">date</span> <span class="o">:</span> <span class="n">dates</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">targets</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">rates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">targets</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">selectedDate</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">targets</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRateBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">getBuilder</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">,</span> <span class="n">selectedDate</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRate</span> <span class="n">sourceRate</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRate</span> <span class="n">target</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">createExchangeRate</span><span class="o">(</span><span class="n">conversionQuery</span><span class="o">,</span> <span class="n">builder</span><span class="o">,</span> <span class="n">sourceRate</span><span class="o">,</span> <span class="n">target</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">LocalDate</span><span class="o">[]</span> <span class="nf">getQueryDates</span><span class="o">(</span><span class="n">ConversionQuery</span> <span class="n">query</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LocalDate</span> <span class="n">date</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LocalDate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">date</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">LocalDateTime</span> <span class="n">dateTime</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">dateTime</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">date</span> <span class="o">=</span> <span class="n">dateTime</span><span class="o">.</span><span class="na">toLocalDate</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">date</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">LocalDate</span><span class="o">[]</span> <span class="o">{</span> <span class="n">date</span><span class="o">,</span> <span class="n">date</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">Period</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="n">1</span><span class="o">)),</span> <span class="n">date</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">Period</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="n">2</span><span class="o">)),</span> <span class="n">date</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">Period</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="n">3</span><span class="o">))</span> <span class="o">};</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">ExchangeRateBuilder</span> <span class="nf">getBuilder</span><span class="o">(</span><span class="n">ConversionQuery</span> <span class="n">query</span><span class="o">,</span> <span class="n">LocalDate</span> <span class="n">localDate</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRateBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExchangeRateBuilder</span><span class="o">(</span><span class="n">ConversionContextBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">RateType</span><span class="o">.</span><span class="na">HISTORIC</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">localDate</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setBase</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setTerm</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">builder</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">ExchangeRate</span> <span class="nf">createExchangeRate</span><span class="o">(</span><span class="n">ConversionQuery</span> <span class="n">query</span><span class="o">,</span> <span class="n">ExchangeRateBuilder</span> <span class="n">builder</span><span class="o">,</span> <span class="n">ExchangeRate</span> <span class="n">sourceRate</span><span class="o">,</span> <span class="n">ExchangeRate</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">areBothBaseCurrencies</span><span class="o">(</span><span class="n">query</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setFactor</span><span class="o">(</span><span class="n">DefaultNumberValue</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">BASE_CURRENCY_CODE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">()))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">sourceRate</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">reverse</span><span class="o">(</span><span class="n">sourceRate</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">BASE_CURRENCY_CODE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">()))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">target</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Get Conversion base as derived rate: base -&gt; EUR -&gt; term&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRate</span> <span class="n">rate1</span> <span class="o">=</span> <span class="n">getExchangeRate</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toBuilder</span><span class="o">().</span><span class="na">setTermCurrency</span><span class="o">(</span><span class="n">Monetary</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">(</span><span class="n">BASE_CURRENCY_CODE</span><span class="o">)).</span><span class="na">build</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ExchangeRate</span> <span class="n">rate2</span> <span class="o">=</span> <span class="n">getExchangeRate</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toBuilder</span><span class="o">().</span><span class="na">setBaseCurrency</span><span class="o">(</span><span class="n">Monetary</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">(</span><span class="n">BASE_CURRENCY_CODE</span><span class="o">)).</span><span class="na">setTermCurrency</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">()).</span><span class="na">build</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">rate1</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">rate2</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setFactor</span><span class="o">(</span><span class="n">multiply</span><span class="o">(</span><span class="n">rate1</span><span class="o">.</span><span class="na">getFactor</span><span class="o">(),</span> <span class="n">rate2</span><span class="o">.</span><span class="na">getFactor</span><span class="o">()));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">builder</span><span class="o">.</span><span class="na">setRateChain</span><span class="o">(</span><span class="n">rate1</span><span class="o">,</span> <span class="n">rate2</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="k">new</span> <span class="n">CurrencyConversionException</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">(),</span> <span class="n">query</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">(),</span> <span class="n">sourceRate</span><span class="o">.</span><span class="na">getContext</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">areBothBaseCurrencies</span><span class="o">(</span><span class="n">ConversionQuery</span> <span class="n">query</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">BASE_CURRENCY_CODE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">BASE_CURRENCY_CODE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">().</span><span class="na">getCurrencyCode</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">ExchangeRate</span> <span class="nf">reverse</span><span class="o">(</span><span class="n">ExchangeRate</span> <span class="n">rate</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">rate</span><span class="o">))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Rate null is not reversible.&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">ExchangeRateBuilder</span><span class="o">(</span><span class="n">rate</span><span class="o">).</span><span class="na">setRate</span><span class="o">(</span><span class="n">rate</span><span class="o">).</span><span class="na">setBase</span><span class="o">(</span><span class="n">rate</span><span class="o">.</span><span class="na">getCurrency</span><span class="o">()).</span><span class="na">setTerm</span><span class="o">(</span><span class="n">rate</span><span class="o">.</span><span class="na">getBaseCurrency</span><span class="o">())</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">setFactor</span><span class="o">(</span><span class="n">divide</span><span class="o">(</span><span class="n">DefaultNumberValue</span><span class="o">.</span><span class="na">ONE</span><span class="o">,</span> <span class="n">rate</span><span class="o">.</span><span class="na">getFactor</span><span class="o">(),</span> <span class="n">MathContext</span><span class="o">.</span><span class="na">DECIMAL64</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AbstractRateProvider.java</span>
    </div>
</div>
<p>También deberemos sobrescribir la propiedad <em>conversion.default-chain</em> en el archivo <em>javamoney.properties</em>,  junto con algunas otras propiedades necesarias para que cargue los datos a partir de una URL del servicio que proporciona los ratios. La URL será la del servicio Open Exchange Rates que devolverá un resultado en formato JSON, lo procesaremos y construiremos los ExchangeRates a partir de los datos que nos son proporcionados en la clase <em>AbstractRateProvider</em> con el método <em>newDataLoaded</em> en forma de <em>InputStream</em>. En el archivo <em>javamoney.properties</em> el número entre llaves ({}) indica la prioridad de la propiedad cuando haya varios archivos <em>javamoney.properties</em> en diferentes archivos jar, deberemos indicar 0 o más ya que la prioridad por defecto es -1.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"># OER Rates&#10;{0}load.OpenExchangeRatesRateProvider.type=SCHEDULED&#10;{0}load.OpenExchangeRatesRateProvider.period=03:00&#10;{0}load.OpenExchangeRatesRateProvider.resource=/java-money/defaults/OER/open-exchange-rates.json&#10;{0}load.OpenExchangeRatesRateProvider.urls=https://openexchangerates.org/api/latest.json?app_id=9275a617a9d248129a32d996914c9344&#10;&#10;#Currency Conversion&#10;{0}conversion.default-chain=IDENT,ECB,IMF,ECB-HIST,ECB-HIST90,OER</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>javamoney.properties</span>
    </div>
</div>
<p>Implementado el servicio de ratios personalizado de Open Exchange Rates y configurado podemos usarlo con las siguientes líneas de código tal y como hacíamos con el servicio del Banco Central Europeo (ECB) proporcionado en la implementación de referencia de la librería de Java Money.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// exchange rates&#10;</span><span class="c1"></span><span class="n">ExchangeRateProvider</span> <span class="n">exchangeRateProviderECB</span> <span class="o">=</span> <span class="n">MonetaryConversions</span><span class="o">.</span><span class="na">getExchangeRateProvider</span><span class="o">(</span><span class="s">&#34;ECB&#34;</span><span class="o">);</span>&#10;<span class="n">ExchangeRateProvider</span> <span class="n">exchangeRateProviderOER</span> <span class="o">=</span> <span class="n">MonetaryConversions</span><span class="o">.</span><span class="na">getExchangeRateProvider</span><span class="o">(</span><span class="s">&#34;OER&#34;</span><span class="o">);</span>&#10;<span class="n">ExchangeRate</span> <span class="n">exchangeRateECB</span> <span class="o">=</span> <span class="n">exchangeRateProviderECB</span><span class="o">.</span><span class="na">getExchangeRate</span><span class="o">(</span><span class="s">&#34;USD&#34;</span><span class="o">,</span> <span class="s">&#34;EUR&#34;</span><span class="o">);</span>&#10;<span class="n">ExchangeRate</span> <span class="n">exchangeRateOER</span> <span class="o">=</span> <span class="n">exchangeRateProviderOER</span><span class="o">.</span><span class="na">getExchangeRate</span><span class="o">(</span><span class="s">&#34;USD&#34;</span><span class="o">,</span> <span class="s">&#34;EUR&#34;</span><span class="o">);</span>&#10;&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;exchange rates&#34;</span><span class="o">);</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Ratio de conversión de USD a EUR (ECB, European Central Bank): %f\n&#34;</span><span class="o">,</span> <span class="n">exchangeRateECB</span><span class="o">.</span><span class="na">getFactor</span><span class="o">().</span><span class="na">doubleValue</span><span class="o">());</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Ratio de conversión de USD a EUR (OER, Open Exchange Rates): %f\n&#34;</span><span class="o">,</span> <span class="n">exchangeRateOER</span><span class="o">.</span><span class="na">getFactor</span><span class="o">().</span><span class="na">doubleValue</span><span class="o">());</span>&#10;&#10;<span class="c1">// conversion&#10;</span><span class="c1"></span><span class="n">CurrencyConversion</span> <span class="n">toEuroECB</span> <span class="o">=</span> <span class="n">MonetaryConversions</span><span class="o">.</span><span class="na">getConversion</span><span class="o">(</span><span class="s">&#34;EUR&#34;</span><span class="o">,</span> <span class="s">&#34;ECB&#34;</span><span class="o">);</span>&#10;<span class="n">CurrencyConversion</span> <span class="n">toEuroOER</span> <span class="o">=</span> <span class="n">MonetaryConversions</span><span class="o">.</span><span class="na">getConversion</span><span class="o">(</span><span class="s">&#34;EUR&#34;</span><span class="o">,</span> <span class="s">&#34;OER&#34;</span><span class="o">);</span>&#10;<span class="n">MonetaryAmount</span> <span class="n">tenDollarToEuroECB</span> <span class="o">=</span> <span class="n">tenDollar</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">toEuroECB</span><span class="o">);</span>&#10;<span class="n">MonetaryAmount</span> <span class="n">tenDollarToEuroOER</span> <span class="o">=</span> <span class="n">tenDollar</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">toEuroOER</span><span class="o">);</span>&#10;&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;conversion&#34;</span><span class="o">);</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;10 USD son %s EUR (ECB)\n&#34;</span><span class="o">,</span> <span class="n">tenDollarToEuroECB</span><span class="o">);</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;10 USD son %s EUR (OER)\n&#34;</span><span class="o">,</span> <span class="n">tenDollarToEuroOER</span><span class="o">);</span>&#10;&#10;<span class="c1">// exchange rates&#10;</span><span class="c1">// Ratio de conversión de USD a EUR (ECB, European Central Bank): 0,887469&#10;</span><span class="c1">// Ratio de conversión de USD a EUR (OER, Open Exchange Rates): 0,882016&#10;</span><span class="c1"></span>&#10;<span class="c1">// conversion&#10;</span><span class="c1">// 10 USD son EUR 8.874689385871494 EUR (ECB)&#10;</span><span class="c1">// 10 USD son EUR 8.82016 EUR (OER)&#10;</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<p>La API de Java Money ofrece más posibilidades como obtener datos históricos de los ratios de conversión, Open Exchange Rates también ofrece datos históricos en un <em>endpoint</em> tal que <em>/api/historical/2011-10-18.json</em>. Sin embargo, cómo  hacer esto será tarea para el lector o tema para otro futuro artículo.</p>
<p>No es muy complicado lo que hay que hacer para integrar un proveedor de ratios sabiendo lo que hay que hacer y adaptando otro proveedor similar, sin embargo, no hay documentación que lo explique y he tenido que indagar en el código fuente del proyecto para saber cómo hacerlo, sin el código fuente me hubiese sido imposible escribir este artículo, esta es una de las ventajas del código abierto y software libre.</p>
<p>Puedes obtener el <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/JavaMoney">código fuente completo del ejemplo</a> del repositorio de ejemplos de este blog en GitHub.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://github.com/JavaMoney/jsr354-api">JSR-354 API</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri">JSR-354 RI</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-api/blob/master/src/main/java/javax/money/spi/Bootstrap.java">Bootstrap.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-api/blob/master/src/main/java/javax/money/convert/ExchangeRateProvider.java">ExchangeRateProvider.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/spi/AbstractRateProvider.java">AbstractRateProvider.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/convert/ECBAbstractRateProvider.java">ECBAbstractRateProvider.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/convert/ECBRateReadingHandler.java">ECBRateReadingHandler.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/convert/ECBCurrentRateProvider.java">ECBCurrentRateProvider.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/resources/META-INF/services/javax.money.convert.ExchangeRateProvider">javax.money.convert.ExchangeRateProvider</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-api/blob/master/src/main/java/javax/money/convert/MonetaryConversions.java">MonetaryConversions.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-api/blob/master/src/main/java/javax/money/spi/MonetaryConversionsSingletonSpi.java">MonetaryConversionsSingletonSpi.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/convert/DefaultMonetaryConversionsSingletonSpi.java">DefaultMonetaryConversionsSingletonSpi.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/loader/LoaderConfigurator.java">LoaderConfigurator.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/spi/MonetaryConfig.java">MonetaryConfig.java</a></li>
<li>[javamoney.properties](https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/resources/javamoney.properties &lt;- aqui está la configuración)</li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/loader/DefaultLoaderServiceFacade.java">DefaultLoaderServiceFacade.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/loader/LoadDataLoaderService.java">LoadDataLoaderService.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/loader/ResourceCache.java">ResourceCache.java</a></li>
<li><a href="https://github.com/JavaMoney/jsr354-ri/blob/master/src/main/java/org/javamoney/moneta/internal/loader/DefaultResourceCache.java">DefaultResourceCache.java</a></li>
</ul>
</div>

    </div>

    <p class="information">
      
    </p>

    
  </article>
        <div>
          <hr>
        </div>
        

        
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-text">
      Comparte el artículo:
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-inline-share-buttons"></div>
  </div>
</div>


        
    
    
    <div class="row related"><div class="col-12"><p>Artículos relacionados:</p></div></div>
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/09/aplicacion-java-extensible-con-la-clase-serviceloader/">
                <img src="/blog-bitix/assets/images/logotypes/java.svg" width="326" height="125" alt="Aplicación Java extensible con la clase ServiceLoader" title="Aplicación Java extensible con la clase ServiceLoader" class="" loading="lazy">
                <h3>Aplicación Java extensible con la clase ServiceLoader</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/08/implementacion-de-maquina-de-estados-finita-fsm-con-java-8/">
                <img src="/blog-bitix/assets/images/logotypes/java.svg" width="326" height="125" alt="Implementación de máquina de estados finita (FSM) con Java 8" title="Implementación de máquina de estados finita (FSM) con Java 8" class="" loading="lazy">
                <h3>Implementación de máquina de estados finita (FSM) con Java 8</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/07/como-trabajar-con-importes-ratios-y-divisas-en-java/">
                <img src="/blog-bitix/assets/images/logotypes/java.svg" width="326" height="125" alt="Cómo trabajar con importes, ratios y divisas en Java" title="Cómo trabajar con importes, ratios y divisas en Java" class="" loading="lazy">
                <h3>Cómo trabajar con importes, ratios y divisas en Java</h3>
                </a>
                
            </div>
        </div>
    </div>
    
    
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/06/hemeroteca-7/">
                <img src="/blog-bitix/assets/images/logotypes/blogbitix.svg" width="326" height="125" alt="Hemeroteca #7" title="Hemeroteca #7" class="" loading="lazy">
                <h3>Hemeroteca #7</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/06/servicio-para-obtener-ratios-de-conversion-entre-divisas/">
                <img src="/blog-bitix/assets/images/logotypes/java.svg" width="326" height="125" alt="Servicio para obtener ratios de conversión entre divisas" title="Servicio para obtener ratios de conversión entre divisas" class="" loading="lazy">
                <h3>Servicio para obtener ratios de conversión entre divisas</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2015/06/nueva-visita-a-herramientas-para-un-proyecto-java/">
                <img src="/blog-bitix/assets/images/logotypes/java.svg" width="326" height="125" alt="Nueva visita a Herramientas para un proyecto Java" title="Nueva visita a Herramientas para un proyecto Java" class="" loading="lazy">
                <h3>Nueva visita a Herramientas para un proyecto Java</h3>
                </a>
                
            </div>
        </div>
    </div>
    

        <div class="row">
          <div class="col-12 adblock-container-billboard">
            <span id="pageBottom"></span>
            <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
  <div class="row">
    <div class="col-md-12">
      <span id="comments"></span>
      <div id="disqus_thread"></div>
    </div>
  </div>

  <script type="text/javascript" async>
    var disqus_shortname = 'blog-bitix';
    var disqus_identifier = 'blog-bitix-95';
    var disqus_url = 'https:\/\/picodotdev.github.io\/blog-bitix\/2015\/09\/ejemplo-practico-de-serviceloader-con-serviceprovider-de-java-money\/';
    var disqus_script = 'embed.js';
  </script>

      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    





<footer>
  <div class="row">
    <div class="col-12 col-sm-4">
      <p><strong>Blog Bitix</strong></p>
      <p>Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</p>
      <p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p>
    </div>
    <div class="col-12 col-sm-4 text-center menu">
      <ul class="list-unstyled">
        <li><a href="/blog-bitix/tags/java/">Java</a></li>
        <li><a href="/blog-bitix/tags/gnu-linux/">GNU/Linux</a></li>
        <li><a href="/blog-bitix/tags/javascript/">JavaScript</a></li>
        <li><a href="/blog-bitix/tags/tapestry/">Tapestry</a></li>
        <li><a href="/blog-bitix/archive/">Archivo y hemeroteca</a></li>
        <li><a href="/blog-bitix/pages/links/">Enlaces</a></li>
        <li><a href="/blog-bitix/pages/advertising/">Publicidad</a></li>
        <li><a href="/blog-bitix/pages/donate/">Donaciones</a></li>
        <li><a href="/blog-bitix/pages/about/">Acerca de...</a></li>
        
      </ul>
    </div>
    <div class="col-12 col-sm-4 text-center links">
      
        <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
      
      
        <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
      
      
      
        <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
      
      
      
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      Copyleft <span class="copyleft">&copy;</span> 2021 - <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" width="80" height="15" alt="Creative Commons License" title="Creative Commons License"></a><br />
      <a href="https://www.planetacodigo.com/" rel="nofollow"><img src="/blog-bitix/assets/images/planeta-codigo.png" width="80" height="15" alt="Planeta código" title="Planeta código"></a>
      <br/>
      <a href="https://picodotdev.github.io/blog-bitix/" rel="nofollow">Blog Bitix</a> by <a href="https://picodotdev.github.io/blog-bitix/">pico.dev</a> is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.
      <br/>
      <span class="credit">Powered by <a href="https://gohugo.io/" rel="nofollow" title="A fast and modern static website engine">Hugo</a> and <a href="https://pages.github.com/" title="Websites for you and your projects">GitHub Pages</a>.</span>
      <span class="credit">Background patterns from <a href="https://www.toptal.com/designers/subtlepatterns/" rel="nofollow">Subtle Patterns</a>.</span>
    </div>
  </div>
</footer>

  </div>
  
<div
  id="blueimp-gallery"
  class="blueimp-gallery blueimp-gallery-controls"
  aria-label="image gallery"
  aria-modal="true"
  role="dialog"
>
  <div class="slides" aria-live="polite"></div>
  <h3 class="title"></h3>
  <span
    class="prev"
    aria-controls="blueimp-gallery"
    aria-label="previous slide"
    aria-keyshortcuts="ArrowLeft"
  ></span>
  <span
    class="next"
    aria-controls="blueimp-gallery"
    aria-label="next slide"
    aria-keyshortcuts="ArrowRight"
  ></span>
  <span
    class="close"
    aria-controls="blueimp-gallery"
    aria-label="close"
    aria-keyshortcuts="Escape"
  ></span>
  <span
    class="play-pause"
    aria-controls="blueimp-gallery"
    aria-label="play slideshow"
    aria-keyshortcuts="Space"
    aria-pressed="false"
    role="button"
  ></span>
  <ol class="indicator"></ol>
</div>

  
  
</body>
</html>