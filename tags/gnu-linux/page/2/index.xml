<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title type="text">Blog Bitix</title>
    <subtitle type="text">Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</subtitle>
    <link rel="self" href="https://picodotdev.github.io/blog-bitix/index.xml"/>
    <link href="https://picodotdev.github.io/blog-bitix/" />
    <id>https://picodotdev.github.io/blog-bitix/tags/gnu-linux/</id>
    <updated>2022-04-28T19:00:00+02:00</updated>
    <author><name>picodotdev</name></author>
    <generator>Hugo</generator>
    <icon>https://picodotdev.github.io/blog-bitix/assets/favicon.ico</icon>
    <logo>https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg</logo>
    <rights>https://creativecommons.org/licenses/by-sa/4.0/</rights>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/</id>
        <title>Convertir texto o imagen a arte de caracteres ASCII</title>
        <updated>2021-03-27T00:00:00+01:00</updated>
        <published>2021-03-27T00:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>El arte ASCII es utilizar caracteres para obtener una composición que simula una imagen o dibujo. Es posible convertir texto a arte de caracteres ASCII o una imagen en formato <em>svg</em>, <em>jpeg</em> o <em>png</em> a texto. En GNU/Linux hay herramientas de línea de comandos que permiten crear arte ASCII tanto para texto como para imágenes. En internet también hay disponibles páginas que ofrecen el servicio de generar arte ASCII sin necesidad de instalar ningún software en la propia computadora.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" width="200" height="196" alt="GNU" title="GNU"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/linux.svg" width="200" height="232" alt="Linux" title="Linux"  class=""></p>
</div>
<p>Con la combinación adecuada de caracteres y varias líneas de texto es posible crear composiciones artísticas de texto, formando un arte ASCII basado en múltiples caracteres. El arte ASCII permite crear dibujos o convertir una frase en un texto en forma de dibujo.</p>
<p>El arte ASCII es adecuado para ser mostrado en interfaces basadas en texto como la terminal del sistema operativo. En <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> hay utilidades de línea de comandos que permiten crear arte ASCII, también hay páginas web que proporcionan la funcionalidad sin necesidad de instalar ningún software en el sistema.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="texto-a-arte-de-caracteres-ascii">Texto a arte de caracteres ASCII</h3>
<p>La herramienta <a href="http://www.figlet.org/">figlet</a> de linea de comandos permite convertir una frase a arte ASCII, es posible configurarla con diferentes estilos de fuente que producen resultados diferentes en el arte ASCII. Utilizando caracteres de escape de la terminal es posible añadir colores, <a href="https://picodotdev.github.io/blog-bitix/2018/11/formatear-con-color-sentencias-sql-o-codigo-fuente-en-la-terminal-con-java-y-jansi/">Jansi es una librería Java que permite añadir colores a texto emitido en la terminal</a>.</p>
<p>Además de instalar el paquete de <em>figlet</em> en la distribución de GNU/Linux hay que descargar los <a href="http://www.figlet.org/fontdb.cgi">archivos de las fuentes</a> para generar el arte ASCII con el estilo deseado. La fuente se indica en el comando con el parámetro <em>-f</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ figlet -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ figlet -f ~/Descargas/alphabet.flf -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ figlet -f ~/Descargas/3-d.flf -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ figlet -f ~/Descargas/lean.flf -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ figlet -f ~/Descargas/slant.flf -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ figlet -f ~/Descargas/univers.flf -w <span class="m">240</span> <span class="s2">&#34;Blog Bitix&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>figlet.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">Font: standard&#10;</span></span><span class="line"><span class="cl"> ____  _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ____  _ _   _&#10;</span></span><span class="line"><span class="cl">| __ )| | ___   __ _| __ )(_| |_(___  __&#10;</span></span><span class="line"><span class="cl">|  _ \| |/ _ \ / _` |  _ \| | __| \ \/ /&#10;</span></span><span class="line"><span class="cl">| |_) | | (_) | (_| | |_) | | |_| |&gt;  &lt;&#10;</span></span><span class="line"><span class="cl">|____/|_|\___/ \__, |____/|_|\__|_/_/\_\&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   |___/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Font: alphabet&#10;</span></span><span class="line"><span class="cl">BBBB  l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  BBBB&nbsp;&nbsp;&nbsp;&nbsp;  t&#10;</span></span><span class="line"><span class="cl">B   B l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  B   B ii  t  ii&#10;</span></span><span class="line"><span class="cl">BBBB  l ooo ggg  BBBB&nbsp;&nbsp;&nbsp;&nbsp; ttt&nbsp;&nbsp;&nbsp;&nbsp;x x&#10;</span></span><span class="line"><span class="cl">B   B l o o g g  B   B ii  t  ii  x&#10;</span></span><span class="line"><span class="cl">BBBB  l ooo ggg  BBBB  ii  tt ii x x&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  g&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggg&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Font: 3-d&#10;</span></span><span class="line"><span class="cl"> ******&nbsp;&nbsp;&nbsp;&nbsp;**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;******   **   **   **&#10;</span></span><span class="line"><span class="cl">/*////**  /**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   *****   /*////** //   /**  //&#10;</span></span><span class="line"><span class="cl">/*   /**  /**  ******  **///**  /*   /**  ** ****** ** **   **&#10;</span></span><span class="line"><span class="cl">/******   /** **////**/**  /**  /******  /**///**/ /**//** **&#10;</span></span><span class="line"><span class="cl">/*//// ** /**/**   /**//******  /*//// **/**  /**  /** //***&#10;</span></span><span class="line"><span class="cl">/*&nbsp;&nbsp;&nbsp;&nbsp;/** /**/**   /** /////**  /*&nbsp;&nbsp;&nbsp;&nbsp;/**/**  /**  /**  **/**&#10;</span></span><span class="line"><span class="cl">/*******  ***//******   *****   /******* /**  //** /** ** //**&#10;</span></span><span class="line"><span class="cl">///////  ///  //////   /////&nbsp;&nbsp;&nbsp;&nbsp;///////  //&nbsp;&nbsp;&nbsp;&nbsp;//  // //   //&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Font: lean&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;_/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/&#10;</span></span><span class="line"><span class="cl">   _/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/_/&nbsp;&nbsp;&nbsp;&nbsp;  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&#10;</span></span><span class="line"><span class="cl">  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/&nbsp;&nbsp;&nbsp;&nbsp;_/_/&#10;</span></span><span class="line"><span class="cl"> _/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/&nbsp;&nbsp;&nbsp;&nbsp;_/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&#10;</span></span><span class="line"><span class="cl">_/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;_/_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/_/&nbsp;&nbsp;&nbsp;&nbsp;_/&nbsp;&nbsp;&nbsp;&nbsp;  _/_/  _/  _/&nbsp;&nbsp;&nbsp;&nbsp;_/&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _/&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_/_/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Font: slant&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;____  __&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ____  _ __  _&#10;</span></span><span class="line"><span class="cl">   / __ )/ /___  ____ _   / __ )(_) /_(_)  __&#10;</span></span><span class="line"><span class="cl">  / __  / / __ \/ __ `/  / __  / / __/ / |/_/&#10;</span></span><span class="line"><span class="cl"> / /_/ / / /_/ / /_/ /  / /_/ / / /_/ /&gt;  &lt;&#10;</span></span><span class="line"><span class="cl">/_____/_/\____/\__, /  /_____/_/\__/_/_/|_|&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /____/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Font: univers&#10;</span></span><span class="line"><span class="cl">88888888ba   88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   88888888ba   88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   88&#10;</span></span><span class="line"><span class="cl">88&nbsp;&nbsp;&nbsp;&nbsp;  &#34;8b  88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   88&nbsp;&nbsp;&nbsp;&nbsp;  &#34;8b  &#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;,d&nbsp;&nbsp;&nbsp;&nbsp; &#34;&#34;&#10;</span></span><span class="line"><span class="cl">88&nbsp;&nbsp;&nbsp;&nbsp;  ,8P  88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   88&nbsp;&nbsp;&nbsp;&nbsp;  ,8P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;88&#10;</span></span><span class="line"><span class="cl">88aaaaaa8P&#39;  88   ,adPPYba,&nbsp;&nbsp;&nbsp;&nbsp;,adPPYb,d8&nbsp;&nbsp;&nbsp;&nbsp; 88aaaaaa8P&#39;  88  MM88MMM  88  8b,&nbsp;&nbsp;&nbsp;&nbsp; ,d8&#10;</span></span><span class="line"><span class="cl">88&#34;&#34;&#34;&#34;&#34;&#34;8b,  88  a8&#34;&nbsp;&nbsp;&nbsp;&nbsp; &#34;8a  a8&#34;&nbsp;&nbsp;&nbsp;&nbsp;`Y88&nbsp;&nbsp;&nbsp;&nbsp; 88&#34;&#34;&#34;&#34;&#34;&#34;8b,  88&nbsp;&nbsp;&nbsp;&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp; 88   `Y8, ,8P&#39;&#10;</span></span><span class="line"><span class="cl">88&nbsp;&nbsp;&nbsp;&nbsp;  `8b  88  8b&nbsp;&nbsp;&nbsp;&nbsp;   d8  8b&nbsp;&nbsp;&nbsp;&nbsp;   88&nbsp;&nbsp;&nbsp;&nbsp; 88&nbsp;&nbsp;&nbsp;&nbsp;  `8b  88&nbsp;&nbsp;&nbsp;&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp; 88&nbsp;&nbsp;&nbsp;&nbsp; )888(&#10;</span></span><span class="line"><span class="cl">88&nbsp;&nbsp;&nbsp;&nbsp;  a8P  88  &#34;8a,   ,a8&#34;  &#34;8a,   ,d88&nbsp;&nbsp;&nbsp;&nbsp; 88&nbsp;&nbsp;&nbsp;&nbsp;  a8P  88&nbsp;&nbsp;&nbsp;&nbsp;88,&nbsp;&nbsp;&nbsp;&nbsp;88   ,d8&#34; &#34;8b,&#10;</span></span><span class="line"><span class="cl">88888888P&#34;   88   `&#34;YbbdP&#34;&#39;&nbsp;&nbsp;&nbsp;&nbsp;`&#34;YbbdP&#34;Y8&nbsp;&nbsp;&nbsp;&nbsp; 88888888P&#34;   88&nbsp;&nbsp;&nbsp;&nbsp;&#34;Y888  88  8P&#39;&nbsp;&nbsp;&nbsp;&nbsp; `Y8&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   aa,&nbsp;&nbsp;&nbsp;&nbsp;,88&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Y8bbdP&#34;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>figlet.txt</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/figlet_hu035957f211688b4f3b03f9f72c1e31ee_99005_2560x1440_fit_box_3.png" data-gallery=""><img src="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/figlet_hu035957f211688b4f3b03f9f72c1e31ee_99005_650x450_fit_box_3.png" width="301" height="450"  class="lozad "></a></p>
<figcaption>Texto convertido a arte de caracteres ASCII</figcaption>
</figure>
</div>
<h3 id="imagen-a-arte-de-caracteres-ascii">Imagen a arte de caracteres ASCII</h3>
<p>También es posible convertir una imagen a arte ASCII, en el caso de las imágenes el resultado ha de tener un número adecuado de líneas y columnas para producir resultados con la suficiente definición para obtener resultados fieles a la imagen original.</p>
<p>La herramienta <a href="https://csl.name/jp2a/">jp2a</a> permite convertir una imagen a arte ASCII. Basta con indicar la imagen fuente y personalizar las opciones del resultado como la anchura de caracteres con la opción <em>&ndash;width</em>. Utilizando las tuberías del intérprete de comandos es posible combinar el resultado de un comando que procese o transforme la imagen y se la proporcione como entrada a <em>jp2a</em>, en este caso para utilizar formatos no soportado por <em>jp2a</em> convirtiéndolo previamente a uno soportado permite obtener el arte ASCII.</p>
<p>La herramienta <em>jp2a</em> combinada con el <a href="https://picodotdev.github.io/blog-bitix/2016/04/cambiar-el-formato-de-archivos-de-video-o-peliculas-en-gnu-linux/">extraer un fotograma de una película</a> permite generar el arte ASCII de un momento de una película.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ jp2a --width<span class="o">=</span><span class="m">80</span> --invert ~/Descargas/blogbitix-750.png&#10;</span></span><span class="line"><span class="cl">$ jp2a --width<span class="o">=</span><span class="m">80</span> --invert ~/Descargas/blogbitix-750.jpg&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ convert ~/Descargas/archlinux.svg jpg:- <span class="p">|</span> jp2a --width<span class="o">=</span><span class="m">80</span> --invert -&#10;</span></span><span class="line"><span class="cl">$ convert ~/Descargas/linux.svg jpg:- <span class="p">|</span> jp2a --width<span class="o">=</span><span class="m">80</span> --invert -&#10;</span></span><span class="line"><span class="cl">$ convert ~/Descargas/gnu.svg jpg:- <span class="p">|</span> jp2a --width<span class="o">=</span><span class="m">80</span> --invert -&#10;</span></span><span class="line"><span class="cl">$ convert ~/Descargas/gnome.svg jpg:- <span class="p">|</span> jp2a --width<span class="o">=</span><span class="m">80</span> --invert -</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>jp2a.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   l&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  coo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :oooo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;oooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ,oooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .oooooooool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...;ooooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;ool:;:looooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#39;oooooooooooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ,oooooooooooooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;oooooooooooooooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;oooooooooooooooooooool.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   :ooooooool&#39;.  .:ooooooooo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  cooooooooc&nbsp;&nbsp;&nbsp;&nbsp;   &#39;ooooooooo&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.cooooooooo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,ooooooooo;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .looooooooo:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ooooooc:;:;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .loooooooooo:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ooooooool;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;oooooooooc;,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;;:loooooool,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,ooool:,..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&#39;;looooc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ;ol:&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .;col.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ld.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :. ..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">  ..&#39;&#39;..&nbsp;&nbsp;&nbsp;&nbsp;..  ..&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;&#39;kk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl"> ,kxdxkkx&#39; ;kkokko,okkkkkko.&#39;kdokkkkxc.  o. &#39;. .,.,,,,;.  ,.&nbsp;&nbsp;&nbsp;&nbsp;  :  ,.   .&#39;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl"> ,ccllckkd ;kkl. &#39;kko&#39;. .,. &#39;kkc   .xko  o. ;. ,c&nbsp;&nbsp;&nbsp;&nbsp;  c. :&#39;&nbsp;&nbsp;&nbsp;&nbsp; .o   ;, &#39;:&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">okkc,;okkd ;kk&#39;  ckk.&nbsp;&nbsp;&nbsp;&nbsp;   &#39;kk.&nbsp;&nbsp;&nbsp;&nbsp;xko  o. ;. ,;&nbsp;&nbsp;&nbsp;&nbsp;  :. :&#39;&nbsp;&nbsp;&nbsp;&nbsp; .o&nbsp;&nbsp;&nbsp;&nbsp;&#39;o,&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">xko   .kkd ;kk&#39;  &#39;kkl.   .. &#39;kk.&nbsp;&nbsp;&nbsp;&nbsp;dko  o  ;. ,,&nbsp;&nbsp;&nbsp;&nbsp;  c. :&#39;&nbsp;&nbsp;&nbsp;&nbsp; .l   .:.;&#39;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">.dkkdxkoxd ;kk&#39;   .okkxdkkd.&#39;kk.&nbsp;&nbsp;&nbsp;&nbsp;dko  o  :. ;,&nbsp;&nbsp;&nbsp;&nbsp;  c. &#39;c.  .&#39;;l  ;&#39;   .;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">  .:c;.&#39;,. .,.&nbsp;&nbsp;&nbsp;&nbsp;   ,cc:.  .:,&nbsp;&nbsp;&nbsp;&nbsp; c:.  .  .  ..&nbsp;&nbsp;&nbsp;&nbsp;  &#39;   .:ll; ., ..&nbsp;&nbsp;&nbsp;&nbsp; ..   &#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .,:cllc:,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .lONMMMMMMMMMWXk:.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .OMMMMMMMMMMMMWkkKWWx.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.XMMMMMMMMMMMMMN0KNWMMN;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dMMMMMMMMMMMMMMMMMMMMMMW;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XMMMWNWMMMMMMMMMNXWMMMMMX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .MMNkxx0XMMMM0oc:lx0NMMMMMc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .MX.&#39;,..kMMMc  ,,. ,NMMMMMx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .WO,WOk.:WNX  OMKO. dMMMMMd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XN&#39;0WK;:lco,.OMMN&#39; xMMMMMd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0MO&#39;c&#39;&#39;&#39;..&#39;&#39;..;:&#39;.:WMMMMMX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xXl&#39;............,,&#39;KMMMMMMc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lXl,.........,,,&#39;&#39;:NMMKKNMN.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:Mdll;,,,,,,,&#39;,,&#39;&#39;&#39;kMMXxd0MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OMc.;lc:;;;;;,.&nbsp;&nbsp;&nbsp;&nbsp;.0MMMNWMMO.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .OMX.  .;::;,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kMMMMMMMX&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cNMk.&nbsp;&nbsp;&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KMMMMMMMWl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .0MMx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .NMMMMMMMMK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  oWMMK&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ;WMMMMMMMMWc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kMMMNo;.&nbsp;&nbsp;&nbsp;&nbsp;  .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..&#39;,;;,.lMMWWMMMMMM0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kMWMWl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .&#39;;.oMMNXNMMMMMK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   xMNNMl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ..oMMWNWWMMMMX.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :MNNWc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   kWXNWKWMMMMX.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .NNNW:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,MMMMWKMMMMMO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.XMWMO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  XMMMMNMMMMMMc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .XMXWM;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  kMMMMWMMMMMMX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .NMMKNN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  xMMMXXMMMMMMM&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  xMMMNKX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  kMMWKWMMMMMMM&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;xc:o0K.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  KWNNWWNNXKWMO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .......c0d.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ....lMMMMMMMMX0d.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;........&#39;kW0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;..&#39;dMMMMMMMWx...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  ....,,...........cNMNd.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&#39;:..&#39;cd0XXXKk:....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.&#39;..................;KMMM0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .;c&#39;..&#39;,::::;&#39;......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.&#39;...................&#39;xWMMMc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .:l,..................&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.,.....................lX0x&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  oKo;.....................&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.,......................&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .cXMKl,......................&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.........................,:&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .&#39;:dKMMMMkc&#39;....................&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.........................&#39;:kN0kxxkO0KNMMMMMMMMNo:&#39;..............&#39;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;..,;;;;,,,&#39;&#39;&#39;...........&#39;,coNMMMMMMMMMMMMMMMMMKo:,&#39;........&#39;,;,&#39;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  ...&#39;,;::cccc;,,&#39;&#39;&#39;&#39;&#39;&#39;,:cox0kddooolllccclodxOOol:;,,,,,;:c:;.....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;........&#39;,;::ccccccll:,..................&#39;&#39;;oolllclll:&#39;.....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...........&#39;,,,&#39;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ........&#39;,,,,&#39;.....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .,ccccllllllll,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.;::::::;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,;;,&#39;  .:;&#39;;loc::l:;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;,;;,,,. .&#39;.&#39;&#39;&#39;,&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; ,:;. .cKXNXollc;;o;.,&#39; .&#39;&#39;lo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  c,&#39;&#39;..;;ldcddxkKkko .;:&#39;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">   ;l&#39; .0WMMd.;:,,,,&#39;&#39;,,,,,&#39;&#39;&#39;,&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .&#39;.....&#39;&#39;...&#39;&#39;&#39;:;:XNKo &#39;c,   &#10;</span></span><span class="line"><span class="cl">  :;  xWMK;.&#39;c,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .;;&#39;:0MK: ,c  &#10;</span></span><span class="line"><span class="cl"> :,  cMMX; c,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&nbsp;&nbsp;&nbsp;&nbsp;  .&#39;........&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :,;NMX. &#39;c &#10;</span></span><span class="line"><span class="cl">,c  :MMW..o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .:;. .&#39;:clc;&#39;.,:&#39; .dl .,cc:&#39;  &#39;,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&#39;:MMX  :,&#10;</span></span><span class="line"><span class="cl">o   oMMK.o.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.:, &#39;l0WMMMMMMMNo.,ldxOlkXXMMMNOc.&#39;;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ;,NMX,  l&#10;</span></span><span class="line"><span class="cl">l  .0MMo.o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:; ;0MMMMMMMMMMMMMWd   ,c ,k0MMMMMNo.,:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ; kMW:  o&#10;</span></span><span class="line"><span class="cl">l  .OMMk.d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ;c.&#39;0MMMMMMMMMMMMMMWNO&nbsp;&nbsp;&nbsp;&nbsp;:  ,0MMMMMMMX:.;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:.KMN:  o&#10;</span></span><span class="line"><span class="cl">o   cWMK&#39;l;&nbsp;&nbsp;&nbsp;&nbsp;   ;c..xWMMMWN0xolloddl,. &#39;:.   &#39;&#39;&#39;&#39;;lNOkKNMM0&#39;&#39;,.&nbsp;&nbsp;&nbsp;&nbsp; .,cWMK,  d&#10;</span></span><span class="line"><span class="cl">l&#39; .:0MM; ;l&#39;  .:c&#39;,kWNx;..&nbsp;&nbsp;&nbsp;&nbsp;  &#39;l.&nbsp;&nbsp;&nbsp;&nbsp;. .&#39;,&#39;;o.&nbsp;&nbsp;&nbsp;&nbsp;o.   &#39;dWWd.&#39;,&#39;..;,.xMMd. .d&#10;</span></span><span class="line"><span class="cl">.d  .xWMWN, &#39;,&#39;::oKNd,&nbsp;&nbsp;&nbsp;&nbsp;   .d;0Mk&nbsp;&nbsp;&nbsp;&nbsp; .co.  ,l; ;Kd.&#39;,&nbsp;&nbsp;&nbsp;&nbsp;.OMW0o:.,,;NMMNc  o&#39;&#10;</span></span><span class="line"><span class="cl"> ,c  c0MMMWNNodNMM0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,d. dc ....,.  &#39;.&nbsp;&nbsp;&nbsp;&nbsp; K0.. ;&nbsp;&nbsp;&nbsp;&nbsp;  dMMMM0NMMMMWd. :, &#10;</span></span><span class="line"><span class="cl">  &#39;c  &#39;oNWMMMMMMM0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;&nbsp;&nbsp;&nbsp;  ..&#39;&#39;;k   l.&nbsp;&nbsp;&nbsp;&nbsp;O,,;::&nbsp;&nbsp;&nbsp;&nbsp;   kMMMMMWW0d.. c&#39;  &#10;</span></span><span class="line"><span class="cl">   .l; ..,KxMNWW0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .&nbsp;&nbsp;&nbsp;&nbsp;dkkMMK,.   .&nbsp;&nbsp;&nbsp;&nbsp;oONMNx.&nbsp;&nbsp;&nbsp;&nbsp;  .0MXKdd&#39;.  ;c.   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; .:;.   &#39;,oK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;.,&#39;dOo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :K0x;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lX,  .&#39;,;.&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,;;;;;O;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.. ..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  o:;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .k:,&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lK;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::d;:,.&nbsp;&nbsp;&nbsp;&nbsp;  :l,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; co&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ,d; ,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;,,,,.&nbsp;&nbsp;&nbsp;&nbsp;  :0. .,,,,,&#39;&#39;&#39;:d,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :o;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :xo:. .,:;.&nbsp;&nbsp;&nbsp;&nbsp;,c::::.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .:d.   .,:cccK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xXl.;;,.  &#39;,..&nbsp;&nbsp;&nbsp;&nbsp;  .d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cx;,,codW:.   x;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ..&nbsp;&nbsp;&nbsp;&nbsp;  .  xk,cc&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;   k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;l;&#39;;&#39; .W.&nbsp;&nbsp;&nbsp;&nbsp;o:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&#39;  .&nbsp;&nbsp;&nbsp;&nbsp;   ..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .o;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.W.&nbsp;&nbsp;&nbsp;&nbsp;.xc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.:cc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.N.&nbsp;&nbsp;&nbsp;&nbsp; ,O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .d.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .&#39;&#39;ll.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0;&nbsp;&nbsp;&nbsp;&nbsp;  clk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.O.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,lk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .lcc;;;:::cldxk0xl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  x.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....&nbsp;&nbsp;&nbsp;&nbsp;   o;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .x.&nbsp;&nbsp;&nbsp;&nbsp;   .lcol,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ..&#39;,,,,,d.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .o;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;lKc  .&nbsp;&nbsp;&nbsp;&nbsp;   &#39;dXKkkNK:&#39;..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lX&#39;:OX&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ol&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ,,&nbsp;&nbsp;&nbsp;&nbsp;   lXl0MMWo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .  x&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ..&nbsp;&nbsp;&nbsp;&nbsp;  .:ONk0K&#39;&nbsp;&nbsp;&nbsp;&nbsp;   l:;cl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .kK.xWXl  cONWNl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :d;. ;WMX.OMMMMMO&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .   x:NMNXMMMMMMMWKc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   . .dNNKWXd0WMKl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .o;&#39;cc..,,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .&#39;,,&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .ckXMMMMMMMNk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ,OWMMWO.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.kMMMMMMMMMMMMMO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  lMMMMMMMK&nbsp;&nbsp;&nbsp;&nbsp;   oWMMMMMMMMMMMMMMd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,c:.&nbsp;&nbsp;&nbsp;&nbsp; .WMMMMMMMN&nbsp;&nbsp;&nbsp;&nbsp;  kMMMMMMMMMMMMMMMK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  dWMMMW;&nbsp;&nbsp;&nbsp;&nbsp;,MMMMMMMMO&nbsp;&nbsp;&nbsp;&nbsp; lMMMMMMMMMMMMMMMK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lMMMMMMN.   .NMMMMMMW,&nbsp;&nbsp;&nbsp;&nbsp; XMMMMMMMMMMMMMWo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oMMMMMMM;&nbsp;&nbsp;&nbsp;&nbsp;lMMMMMMc&nbsp;&nbsp;&nbsp;&nbsp; .MMMMMMMMMMMMMO.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .,.&nbsp;&nbsp;&nbsp;&nbsp;.XMMMMMM,&nbsp;&nbsp;&nbsp;&nbsp; lWMMK,&nbsp;&nbsp;&nbsp;&nbsp;   KMMMMMMMMMWO,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,XMMM0.   .KMMMMK&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .XMMMMMW0l.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NMMMMMK&nbsp;&nbsp;&nbsp;&nbsp; cKW0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,clc,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OMMMMMMc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.0MMMMMx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.,cdk0XNWMMMMMMWNKko;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  :0MMMc&nbsp;&nbsp;&nbsp;&nbsp;   .:d0NMMMMMMMMMMMMMMMMMMMMMM0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&#39;.&nbsp;&nbsp;&nbsp;&nbsp; &#39;oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  cKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;XMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;MMMMMMMMMMMMMMMMMMMMMMMMMMMMWOl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;MMMMMMMMMMMMMMMMMMMMMMMMMWk;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KMMMMMMMMMMMMMMMMMMMMMNx;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;MMMMMMMMMMMMMMMMMMMO,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  dMMMMMMMMMMMMMMMMK.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#39;lx0XNWNXOc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   oMMMMMMMMMMMMMMM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,NMMMMMMMMMMMl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;NMMMMMMMMMMMMM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oMMMMMMMMMMMW.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .xMMMMMMMMMMMMWo.&nbsp;&nbsp;&nbsp;&nbsp;  .KMMMMMMMMMMW:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .OMMMMMMMMMMMMM0o:,;dNMMMMMMMMMMN,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;OMMMMMMMMMMMMMMMMMMMMMMMMMMMk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   .l0MMMMMMMMMMMMMMMMMMMMMWk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .:xXMMMMMMMMMMMMMMWOc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  .,coxkO00Oxo:&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;   ;oxkxdc.  co&#39;&nbsp;&nbsp;&nbsp;&nbsp; oo&#39;   .cdkkdc.&nbsp;&nbsp;&nbsp;&nbsp;;ooc&nbsp;&nbsp;&nbsp;&nbsp;.ooo   ;ooooooo&#39;  .:.,&#39;.:&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; oWMXxoox0.  0MMd   .MMc  dWM0od0MMd   KMMM;   KMMM,  dMMKkkkk,   : :&#39;,;&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;lMMk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0MMMX&#39; .MMc oMMl&nbsp;&nbsp;&nbsp;&nbsp;oMMl .WMWMX  oMMMMl  dMM:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;OMM&#39;  &#39;dddd  0M0xMWc.MMc 0MM.&nbsp;&nbsp;&nbsp;&nbsp;.MMO ,MMdKMl.WMdMMk  dMMNXXX,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;xMM:  .odWM. 0Mk ,XMXMMc OMM&#39;&nbsp;&nbsp;&nbsp;&nbsp;,MMx lMM,,MNKMO KMX  dMMd,,,.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;.WMNc.  &#39;WM. 0Mk  .OMMMc &#39;WMK&#39;  ,KMN. OMW. xMMN. xMM. dMMo.....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; .dXMMWMMWO  0Mk&nbsp;&nbsp;&nbsp;&nbsp;:NMc  .xNMMMMNk.  NMK  .NMc  cMM: dMMMMMMMd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>jp2a.txt</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-archlinux_hufa78db7286ea68380bcd19c44a390a25_51670_2560x1440_fit_box_3.png" data-gallery="" title="Logotipo de Arch Linux convertido a arte de caracteres ASCII con jp2a"><img src="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-archlinux_hufa78db7286ea68380bcd19c44a390a25_51670_200x150_fit_box_3.png" width="128" height="150" alt="Logotipo de Arch Linux convertido a arte de caracteres ASCII con jp2a" title="Logotipo de Arch Linux convertido a arte de caracteres ASCII con jp2a"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-linux_hu941a9e990a78b4605de9cf15b58287c0_88888_2560x1440_fit_box_3.png" data-gallery="" title="Logotipo de Linux convertido a arte de caracteres ASCII con jp2a"><img src="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-linux_hu941a9e990a78b4605de9cf15b58287c0_88888_200x150_fit_box_3.png" width="128" height="150" alt="Logotipo de Linux convertido a arte de caracteres ASCII con jp2a" title="Logotipo de Linux convertido a arte de caracteres ASCII con jp2a"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-gnome_hu7db3540cf064f583661be03a0e99708a_86965_2560x1440_fit_box_3.png" data-gallery="" title="Logotipo de GNOME convertido a arte de caracteres ASCII con jp2a"><img src="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-gnome_hu7db3540cf064f583661be03a0e99708a_86965_200x150_fit_box_3.png" width="128" height="150" alt="Logotipo de GNOME convertido a arte de caracteres ASCII con jp2a" title="Logotipo de GNOME convertido a arte de caracteres ASCII con jp2a"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-gnu_hud3a1beaafe768dd84689b6b826d668c1_93921_2560x1440_fit_box_3.png" data-gallery="" title="Logotipo de GNU convertido a arte de caracteres ASCII con jp2a"><img src="https://picodotdev.github.io/blog-bitix/2021/03/convertir-texto-o-imagen-a-arte-de-caracteres-ascii/images/jp2a-gnu_hud3a1beaafe768dd84689b6b826d668c1_93921_200x150_fit_box_3.png" width="128" height="150" alt="Logotipo de GNU convertido a arte de caracteres ASCII con jp2a" title="Logotipo de GNU convertido a arte de caracteres ASCII con jp2a"  class="lozad "></a></p>
<figcaption>Varios logotipos convertidos a arte de caracteres ASCII con jp2a</figcaption>
</figure>
</div>
<h3 id="páginas-web-de-conversión-a-arte-de-caracteres-ascii">Páginas web de conversión a arte de caracteres ASCII</h3>
<p>No es necesario instalar aplicaciones para generar tanto un texto en arte ASCII como convertir una imagen a arte ASCII, hay algunas páginas que ofrecen estas funcionalidades simplemente introduciendo el texto a convertir a arte ASCII como proporcionando la imagen a convertir a arte ASCII.</p>
<p>El resultado es un conjunto de caracteres que forman el arte ASCII. El propio <a href="https://picodotdev.github.io/blog-bitix/2017/12/el-buscador-que-respeta-tu-privacidad-duckduckgo/">buscador DuckDuckGo</a> es capaz de generar el arte ASCII de <em>figlet</em> con la fuente <em>standard</em>, la página <a href="https://onlineasciitools.com/convert-text-to-ascii-art">Online Ascii Tools</a> permite convertir un texto a arte ASCII seleccionando la fuente o incluyendo <a href="https://textfancy.com/ascii-art/">una colección de arte ASCII</a> y la página <a href="https://ascii-generator.site/">ASCII Generator</a> permite convertir una imagen a arte ASCII.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://textkool.com/en/ascii-art-generator?hl=default&amp;vl=default&amp;font=Red%20Phoenix&amp;text=Your%20text%20here%20">TextKool</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
                <category term="software-libre"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/</id>
        <title>Autenticación con segundo factor de autenticación en SSH</title>
        <updated>2021-03-26T17:00:00+01:00</updated>
        <published>2021-03-26T17:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>El servicio SSH permite el acceso a equipos remotos a un usuario desde cualquier ubicación en la que se encuentre el usuario siempre que tenga conectividad desde el punto de acceso a internet y el equipo remoto. La autenticación se realiza mediante un usuario y contraseña o mediante clave privada y pública, adicionalmente SSH también se puede configurar para requerir un segundo factor de autenticación o 2FA que consituye una segunda clave.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" width="200" height="196" alt="GNU" title="GNU"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/linux.svg" width="200" height="232" alt="Linux" title="Linux"  class=""></p>
</div>
<p>Una forma de acceso a sistemas remotos para realizar tareas de administración es mediante SSH. La red permite acceder a sistemas remotos con SSH siempre que haya conectividad entre el la red del usuario y la red del servidor, con el auge de los servidores ofrecidos por los proveedores de hospedaje o los servicios de computación en la nube en la que lo servidores ya no son físicos sino lógicos SSH es la forma de acceder a los sistemas desde cualquier lugar.</p>
<p>SSH es un protocolo seguro y cifrado que utiliza como método de autenticación un usuario y contraseña o para mayor seguridad una clave SSH, también se puede configurar para añadir adicionalmente un segundo factor de autenticación o 2FA para mayor seguridad.</p>
<p>En el artículo específico comento como <a href="https://picodotdev.github.io/blog-bitix/2019/05/autenticacion-mediante-clave-publica-y-privada-con-ssh/">configurar SSH con autenticación mediante clave pública y privada</a>, en otro artículo comento como tener <a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/">acceso simple y seguro a sistemas remotos con Boundary</a>.</p>
<p>Es recomendable <a href="https://picodotdev.github.io/blog-bitix/2020/11/que-es-por-que-y-como-activar-un-segundo-factor-de-autenticacion-en-google-amazon-paypal-y-otros-servicios/">usar segundo factor de autenticación en servicios como Google, Amazon y Paypal</a> y otros relevantes que lo ofrezcan. También es recomendable utilizar un <a href="https://picodotdev.github.io/blog-bitix/2016/11/guardar-contrasenas-de-forma-segura-con-keepassxc/">gestor de contraseñas como KeePassXC</a> para guardar las contraseñas únicas y como aplicación para generar los <em>tokens</em> de 2FA.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="instalar-el-módulo-ssh-de-google-2fa">Instalar el módulo SSH de Google 2FA</h3>
<p>Usar 2FA con SSH requiere instalar un módulo de autenticación que valide el proceso de autenticación. El módulo permite usar los <em>tokens</em> de un solo uso en el proceso de autenticación adicionalmente a la contraseña o clave SSH.</p>
<p>En los sistemas basados en <a href="https://www.debian.org/">Debian</a> como <a href="https://www.ubuntu.com/">Ubuntu</a> hay que instalar el siguiente paquete que añade un nuevo módulo de PAM para 2FA.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ sudo apt install libpam-google-authenticator&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>apt-install-libpam-google-authenticator.sh</span>
    </div>
</div>
<p>Posteriormente hay que configurar SSH para que haga uso del módulo PAM de Google Authenticator añadiendo la siguiente línea en el archivo <em>/etc/pam.d/sshd</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo vim /etc/pam.d/sshd&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">auth required pam_google_authenticator.so&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd-1</span>
    </div>
</div>
<p>También hay que modificar el archivo de configuración de SSH <em>/etc/ssh/sshd_config</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo vim /etc/ssh/sshd_config&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd_config.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">UsePAM yes&#10;</span></span><span class="line"><span class="cl">ChallengeResponseAuthentication yes&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd_config-1</span>
    </div>
</div>
<h3 id="configurar-el-módulo-ssh-de-google-2fa">Configurar el módulo SSH de Google 2FA</h3>
<p>La autenticación con 2FA es una segunda contraseña o código a introducir al iniciar sesión en el sistema remoto. Para utilizar 2FA hay que configurar previamente una aplicación que proporcione los códigos temporales.</p>
<p>El siguiente comando ejecutado con el usuario permite generar un código QR y la información para generar los <em>tokens</em> o configurar una aplicación como <a href="https://keepassxc.org/">KeePassXC</a> para generarlos. El comando realiza varias preguntas a las que se puede contestar con los siguientes valores.</p>
<ul>
<li><em>Make tokens &ldquo;time-base&rdquo;</em>: yes</li>
<li><em>Update the .google_authenticator file</em>: yes</li>
<li><em>Disallow multiple uses</em>: yes</li>
<li><em>Increase the original generation time limit</em>: no</li>
<li><em>Enable rate-limiting</em>: yes</li>
</ul>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">pi@raspberrypi:~ $ google-authenticator&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Do you want authentication tokens to be time-based (y/n) y&#10;</span></span><span class="line"><span class="cl">Warning: pasting the following URL into your browser exposes the OTP secret to Google:&#10;</span></span><span class="line"><span class="cl">  https://www.google.com/chart?chs=200x200&amp;chld=M|0&amp;cht=qr&amp;chl=otpauth://totp/pi@raspberrypi%3Fsecret%3DZDLUAXH4UI3AJIX6EPHVQSVD5E%26issuer%3Draspberrypi&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">Your new secret key is: ZDLUAXH4UI3AJIX6EPHVQSVD5E&#10;</span></span><span class="line"><span class="cl">Your verification code is 998007&#10;</span></span><span class="line"><span class="cl">Your emergency scratch codes are:&#10;</span></span><span class="line"><span class="cl">  46891237&#10;</span></span><span class="line"><span class="cl">  64319086&#10;</span></span><span class="line"><span class="cl">  49832138&#10;</span></span><span class="line"><span class="cl">  91155656&#10;</span></span><span class="line"><span class="cl">  34340292&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Do you want me to update your &#34;/home/pi/.google_authenticator&#34; file? (y/n) y&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Do you want to disallow multiple uses of the same authentication&#10;</span></span><span class="line"><span class="cl">token? This restricts you to one login about every 30s, but it increases&#10;</span></span><span class="line"><span class="cl">your chances to notice or even prevent man-in-the-middle attacks (y/n) y&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">By default, a new token is generated every 30 seconds by the mobile app.&#10;</span></span><span class="line"><span class="cl">In order to compensate for possible time-skew between the client and the server,&#10;</span></span><span class="line"><span class="cl">we allow an extra token before and after the current time. This allows for a&#10;</span></span><span class="line"><span class="cl">time skew of up to 30 seconds between authentication server and client. If you&#10;</span></span><span class="line"><span class="cl">experience problems with poor time synchronization, you can increase the window&#10;</span></span><span class="line"><span class="cl">from its default size of 3 permitted codes (one previous code, the current&#10;</span></span><span class="line"><span class="cl">code, the next code) to 17 permitted codes (the 8 previous codes, the current&#10;</span></span><span class="line"><span class="cl">code, and the 8 next codes). This will permit for a time skew of up to 4 minutes&#10;</span></span><span class="line"><span class="cl">between client and server.&#10;</span></span><span class="line"><span class="cl">Do you want to do so? (y/n) n&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">If the computer that you are logging into isn&#39;t hardened against brute-force&#10;</span></span><span class="line"><span class="cl">login attempts, you can enable rate-limiting for the authentication module.&#10;</span></span><span class="line"><span class="cl">By default, this limits attackers to no more than 3 login attempts every 30s.&#10;</span></span><span class="line"><span class="cl">Do you want to enable rate-limiting? (y/n) y&#10;</span></span><span class="line"><span class="cl">pi@raspberrypi:~ $ &#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>google-authenticator.sh</span>
    </div>
</div>
<p>El resultado del comando es un código QR que se puede escanear con la aplicación de Google Authenticator para teléfono inteligente o con la clave secreta utilizar KeePassXC para generar los <em>tokens</em>.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/google-authenticator_hu2c255425ff58f8fdbcff60b77bb4ef5f_68013_2560x1440_fit_box_3.png" data-gallery="" title="Configuración de Google Authenticator"><img src="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/google-authenticator_hu2c255425ff58f8fdbcff60b77bb4ef5f_68013_300x200_fit_box_3.png" width="157" height="200" alt="Configuración de Google Authenticator" title="Configuración de Google Authenticator"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/keepassxc-1_hu23fbfb18afe0b0b47c4376c042088074_40451_2560x1440_fit_box_3.png" data-gallery="" title="Configuración OTP en KeePassXC"><img src="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/keepassxc-1_hu23fbfb18afe0b0b47c4376c042088074_40451_300x200_fit_box_3.png" width="149" height="200" alt="Configuración OTP en KeePassXC" title="Configuración OTP en KeePassXC"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/keepassxc-2_hu53fa4e18c12c13dc801784161862cd29_29257_2560x1440_fit_box_3.png" data-gallery="" title="Obtención de OTP en KeePassXC"><img src="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/images/keepassxc-2_hu53fa4e18c12c13dc801784161862cd29_29257_300x200_fit_box_3.png" width="231" height="200" alt="Obtención de OTP en KeePassXC" title="Obtención de OTP en KeePassXC"  class="lozad "></a></p>
<figcaption>Configuracón para Google Authenticator, KeePassXC y obtención OTP desde KeePassXC</figcaption>
</figure>
</div>
<p>Una vez modificada la configuración hay que reiniciar el servicio de SSH.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ sudo systemctl restart sshd.service&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd-restart.sh</span>
    </div>
</div>
<h3 id="usar-autenticación-2fa-con-claves-ssh">Usar autenticación 2FA con claves SSH</h3>
<p>Al utilizar la autenticación mediante claves públicas y privadas con la configuración por defecto es suficiente para otorgar acceso al sistema remoto, con lo que no se solicitará el segundo factor de autenticación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh-copy-id -i <span class="s2">&#34;/home/picodotdev/pico.dev@gmail.com&#34;</span> pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl">/usr/bin/ssh-copy-id: INFO: Source of key<span class="o">(</span>s<span class="o">)</span> to be installed: <span class="s2">&#34;/home/picodotdev/pico.dev@gmail.com.pub&#34;</span>&#10;</span></span><span class="line"><span class="cl">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key<span class="o">(</span>s<span class="o">)</span>, to filter out any that are already installed&#10;</span></span><span class="line"><span class="cl">/usr/bin/ssh-copy-id: INFO: <span class="m">1</span> key<span class="o">(</span>s<span class="o">)</span> remain to be installed -- <span class="k">if</span> you are prompted now it is to install the new keys&#10;</span></span><span class="line"><span class="cl"><span class="o">(</span>pi@192.168.1.101<span class="o">)</span> Password: &#10;</span></span><span class="line"><span class="cl"><span class="o">(</span>pi@192.168.1.101<span class="o">)</span> Verification code: &#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Number of key<span class="o">(</span>s<span class="o">)</span> added: <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Now try logging into the machine, with:   <span class="s2">&#34;ssh &#39;pi@192.168.1.101&#39;&#34;</span>&#10;</span></span><span class="line"><span class="cl">and check to make sure that only the key<span class="o">(</span>s<span class="o">)</span> you wanted were added.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-copy-id.sh</span>
    </div>
</div>
<p>Para que se pida el segundo factor de autenticación aún utilizando la autenticación mediante clave pública y privada hay que modificar la configuración de SSH de nuevo con los siguientes cambios de adicionales.</p>
<p>La siguiente línea del archivo <em>/etc/pam.d/sshd</em> ha de estar comentada de esta forma y añadir al final de archivo los métodos de autenticación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">#@include common-auth&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd-2</span>
    </div>
</div>
<p>Nuevamente hay que modificar el archivo <em>/etc/ssh/sshd_config</em> y añadir esta línea al final.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">AuthenticationMethods publickey,keyboard-interactive&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd_config-2</span>
    </div>
</div>
<p>Y después reiniciar el servicio de SSH.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ sudo systemctl restart sshd.service&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd-restart.sh</span>
    </div>
</div>
<h3 id="probar-la-autenticación-ssh">Probar la autenticación SSH</h3>
<p>Una vez realizada la configuración es recomendable probar que la autenticación se realiza de forma correcta tanto con usuario y contraseña como en el caso de claves. Una vez proporcionado el usuario y la contraseña se solicita el <em>token</em> del segundo factor de autenticación que es generado por la aplicación Google Authenticator, KeePassXC u otra aplicación configurada para generarlos.</p>
<p>En este caso realizando la autenticación con usuario y contraseña se solicita el <em>token</em> 2FA.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl"><span class="o">(</span>pi@192.168.1.101<span class="o">)</span> Password: &#10;</span></span><span class="line"><span class="cl"><span class="o">(</span>pi@192.168.1.101<span class="o">)</span> Verification code: &#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.17+ <span class="c1">#1403 Mon Feb 22 11:26:13 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Fri Mar <span class="m">26</span> 16:49:20 <span class="m">2021</span> from 192.168.1.4&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">SSH is enabled and the default password <span class="k">for</span> the <span class="s1">&#39;pi&#39;</span> user has not been changed.&#10;</span></span><span class="line"><span class="cl">This is a security risk - please login as the <span class="s1">&#39;pi&#39;</span> user and <span class="nb">type</span> <span class="s1">&#39;passwd&#39;</span> to <span class="nb">set</span> a new password.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">pi@raspberrypi:~ $ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-pi-password.sh</span>
    </div>
</div>
<p>En este otro caso con clave privada y pública también se solicita el <em>token</em> 2FA.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl"><span class="o">(</span>pi@192.168.1.101<span class="o">)</span> Verification code: &#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.17+ <span class="c1">#1403 Mon Feb 22 11:26:13 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Fri Mar <span class="m">26</span> 16:47:26 <span class="m">2021</span> from 192.168.1.4&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">SSH is enabled and the default password <span class="k">for</span> the <span class="s1">&#39;pi&#39;</span> user has not been changed.&#10;</span></span><span class="line"><span class="cl">This is a security risk - please login as the <span class="s1">&#39;pi&#39;</span> user and <span class="nb">type</span> <span class="s1">&#39;passwd&#39;</span> to <span class="nb">set</span> a new password.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">pi@raspberrypi:~ $ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-pi-pubkey.sh</span>
    </div>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://ubuntu.com/tutorials/configure-ssh-2fa#1-overview">Configure SSH to use two-factor authentication</a></li>
<li><a href="https://pimylifeup.com/setup-2fa-ssh/">Using Two-Factor Authentication for SSH</a></li>
<li><a href="https://www.rosehosting.com/blog/how-to-set-up-multi-factor-authentication-for-ssh-on-ubuntu-20-04/">Set Up Multi-Factor Authentication for SSH on Ubuntu 20.04</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="seguridad"/>
            
                <category term="software-libre"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/</id>
        <title>Acceso simple y seguro a sistemas remotos con Boundary</title>
        <updated>2021-03-05T15:00:00+01:00</updated>
        <published>2021-03-05T15:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Boundary es otra herramienta de HashiCorp dedicada a la seguridad. Vault está centrada en el almacenamiento de secretos, Boundary está centrada en otro aspecto de la seguridad que es el acceso a sistemas remotos. Una herramienta mejor adaptada y teniendo en cuenta las propiedades dinámicas de los sistemas actuales. Es una alternativa a los métodos de VPN, bastión y <em>firewall</em> que se utilizan para permitir estos accesos remotos.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-boundary.svg" width="200" height="210" alt="HashiCorp Boundary" title="HashiCorp Boundary"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp.svg" width="200" height="200" alt="HashiCorp" title="HashiCorp"  class=""></p>
</div>
<p>El acceso de forma remota a sistemas es necesario y útil más cuando las máquinas ya no son máquinas físicas sino que están en centros de datos en diferentes ubicaciones en el mundo e incluso son máquinas lógicas como las máquinas virtuales ejecutadas en la computación de la nube.</p>
<p>El acceso a las máquinas no solo se requiere para las aplicaciones de forma automatizada sino que en algunas situaciones se requiere acceso manual para realizar tareas administrativas o conexión con clientes específicos como escritorio remoto o clientes de bases de datos.</p>
<p>Permitir el acceso remoto es necesario, sin embargo, requiere seguridad de forma que únicamente los usuarios autorizados accedan únicamente a los sistemas autorizados.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="funcionamiento-acceso-remoto-tradicional">Funcionamiento acceso remoto tradicional</h3>
<p>La forma habitual de proporcionar acceso remoto a sistemas de una red privada es mediante una VPN o a través de un sistema intermediario denominado bastión. Estos conceptos proporcionan acceso remoto en ciertos aspectos de forma segura pero no están exentas de problemas e inconvenientes.</p>
<p>El primer problema es que una vez conectado a una VPN o un bastión se tiene acceso a cualquier ordenador de la red privada a la que uno se ha conectado. Un usuario que necesite acceso a una máquina potencialmente tiene conectividad con otros sistemas en esa red, lo que es riesgo de seguridad por permitir la posibilidad de accesos a sistemas no autorizados.</p>
<p>El segundo problema es que las infraestructuras actuales de computación en la nube no son estáticas sino que son dinámicas en las que los sistemas cambian de dirección IP o se crean y destruyen instancias.</p>
<p>Mediante un <em>firewall</em> ubicado entre el bastión y el sistema de acceso remoto es posible limitar a que sistemas de la red es posible conectarse. Sin embargo, un <em>firewall</em> constituye un elemento más a administrar que añade más complejidad en la infraestructura.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-workflow_hu2f4d93802e25afa09320a79a8acbf31f_141260_2560x1440_fit_box_3.png" data-gallery="" title="Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-workflow_hu2f4d93802e25afa09320a79a8acbf31f_141260_650x450_fit_box_3.png" width="650" height="229" alt="Boundary" title="Boundary"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-use-cases_hu45b28899952f60fced4840107d75c409_88910_2560x1440_fit_box_3.png" data-gallery="" title="Casos de uso de Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-use-cases_hu45b28899952f60fced4840107d75c409_88910_605x450_fit_box_3.png" width="605" height="286" alt="Casos de uso de Boundary" title="Casos de uso de Boundary"  class="lozad "></a></p>
<figcaption>Boundary</figcaption>
</figure>
</div>
<h3 id="acceso-remoto-con-boundary">Acceso remoto con Boundary</h3>
<p>Para tratar de solventar los problemas de acceso remoto con VPN, bastión y <em>firewall</em>, simplificar la infraestructura y una administración de más alto nivel lógico de usuarios, permisos y sistemas HashiCorp ha publicado otra herramienta dedicada a la seguridad específica para el acceso remoto.</p>
<p><a href="https://www.boundaryproject.io/">Boundary</a> es una herramienta adaptada a los entornos modernos de computación en la nube y dinámicos agnóstica de la infraestructura y de las aplicaciones utilizadas por los clientes remotos. Su funcionamiento es similar al de un bastión con una diferencia importante de que Boundary es el que realiza la conexión a los equipos remotos y no la aplicación cliente.</p>
<p>Boundary gestiona el inventario de <em>hosts</em>, usuarios, grupos y roles y permisos con los que es capaz de permitir o denegar el acceso únicamente a los <em>hosts</em> permitidos y denegar el acceso a los hosts para los que no se dispone acceso. Funciona en modo cliente y servidor, el servidor hace de bastión y es el que realmente se conecta al sistema remoto, en el modo cliente proporciona a la aplicación cliente conexión con el servidor, a diferencia de un sistema con un bastión o VPC la aplicación cliente no se conecta con el sistema remoto sino que únicamente se conecta al servidor de Boundary.</p>
<p>Boundary es un único binario tanto cuando actúa en modo servidor como en modo cliente, dispone una interfaz de línea de comandos y una interfaz web. En las primeras versiones no están todas la <a href="https://www.boundaryproject.io/docs/roadmap">funcionalidades planificadas en el <em>roadmap</em></a>, a medida que madure el servicio ganará en funcionalidades y utilidad. Integrando Boundary con <a href="https://www.consul.io/">Consul</a> tendrá acceso al inventario de servicios y <em>hosts</em>. Integrando Boundary con <a href="https://www.vaultproject.io/">Vault</a> en el momento de acceso al sistema remoto Vault será capaz de crear credenciales de forma dinámica y efímeras.</p>
<p>En su modo servidor requiere de una base de datos <a href="https://www.postgresql.org/">PostgreSQL</a> que inicia como un contenedor de <a href="https://www.docker.com/">Docker</a>. La consola de administración se inicia en el puerto <em>9200</em> y el usuario y contraseña se emite en la salida de la terminal al iniciar la herramienta.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-console-1_hu439945904a4816b0a917f80cda7b1ddf_55235_2560x1440_fit_box_3.png" data-gallery="" title="Consola de administración de Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-console-1_hu439945904a4816b0a917f80cda7b1ddf_55235_300x200_fit_box_3.png" width="300" height="199" alt="Consola de administración de Boundary" title="Consola de administración de Boundary"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-console-2_hu90c9765d4f1a8c1f38c528ef0fa6de88_69361_2560x1440_fit_box_3.png" data-gallery="" title="Consola de administración de Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-console-2_hu90c9765d4f1a8c1f38c528ef0fa6de88_69361_300x200_fit_box_3.png" width="300" height="199" alt="Consola de administración de Boundary" title="Consola de administración de Boundary"  class="lozad "></a></p>
<figcaption>Consola de administración de Boundary</figcaption>
</figure>
</div>
<div class="media media-video">
  <iframe width="640" height="360" src="https://www.youtube.com/embed/tUMe7EsXYBQ" frameborder="0" class="lozad" allowfullscreen></iframe>
</div>
<h4 id="conceptos">Conceptos</h4>
<p>Boundary tiene varios conceptos de dominio, por un lado está el catálogo o inventario de <em>hosts</em>, un conjunto de <em>hosts</em> agrupados en un <em>host set</em> y estos a su vez en un <em>host catalog</em>. Por otro lado, están los usuarios, grupo y roles. Finalmente los <em>targets</em> son la abstracción del elemento al que se quiere realizar una conexión, el <em>target</em> se traduce en un <em>host</em>. Finalmente, todos estos elementos se agrupan en ámbitos o <em>scopes</em> y proyectos o <em>projects</em>.</p>
<p>En una organización con unas cuantas decenas de sistemas y usuarios, la gestión de este inventario se vuelve ciertamente complicado.</p>
<h3 id="clientes-soportados">Clientes soportados</h3>
<p>Boundary incorpora varios clientes en su modo de funcionamiento como cliente. Estos son:</p>
<ul>
<li><em>ssh</em>: por defecto es el cliente SSH local (<em>ssh</em>)</li>
<li><em>postgres</em>: por defecto el del cliente oficial de línea de comandos de Postgres (<em>psql</em>)</li>
<li><em>rdp</em>: por defecto es el cliente de Windows RDP (<em>mstsc</em>)</li>
<li><em>http</em>: por defecto es <em>curl</em></li>
<li><em>kube</em>: por defecto es <em>kubectl</em></li>
</ul>
<p>Boundary soportar estos clientes de forma nativa sin embargo es agnóstico de la herramienta cliente, con la opción <em>exec</em> es posible utilizar cualquier herramienta que se conecte con un sistema remoto.</p>
<ul>
<li><a href="https://www.boundaryproject.io/docs/getting-started/connect-to-target">Connect to Your First Target</a></li>
</ul>
<h3 id="ejemplo-de-conexión-ssh-con-boundary">Ejemplo de conexión SSH con Boundary</h3>
<p>En el siguiente ejemplo muestro como conectarse a un <em>host</em> a través de Boundary con SSH. En el mismo ejemplo muestro como usar Boundary con autenticación con claves SSH y como usar Boundary con Vault que generar un OTP para realizar la misma conexión sin usar claves SSH y únicamente con credenciales temporales. En este ejemplo el <em>host</em> remoto es una <a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/">Raspberry Pi con sistema operativo Raspberry Pi OS instalado</a> y con el servicio de SSH iniciado.</p>
<p>En este ejemplo el servidor de Boundary y Vault están en la misma máquina. Los pasos del ejemplo para usar Boundary y SSH, los pasos que involucran ORP son opcionales si se usan claves SSH:</p>
<ul>
<li>Iniciar el servidor de Boundary.</li>
<li>Configurar el servidor SSH para que valide los OTP conectándose a Vault.</li>
<li>Iniciar Vault y permitir su acceso al <em>host</em> remoto para validar los OTP.</li>
<li>Realizar la conexión SSH con Boundary desde la máquina local a la máquina remota.</li>
</ul>
<p>Iniciar el servidor Boundary es sencillo, basta <a href="https://picodotdev.github.io/blog-bitix/2021/01/que-es-la-variable-path-del-sistema-y-como-cambiarla-en-gnu-linux/">instalar el binario de Boundary en el PATH del sistema</a> e <a href="https://picodotdev.github.io/blog-bitix/2014/11/como-instalar-y-guia-de-inicio-basica-de-docker/">instalar el gestor de contenedores Docker</a> previamente. Al iniciar el servidor de Boundary este descarga la imagen de Postgres e inicia su contenedor.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo systemctl start docker.service&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>start-docker.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault server -dev -dev-listen-address <span class="s2">&#34;0.0.0.0:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Vault server configuration:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Api Address: http://0.0.0.0:8200&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cgo: disabled&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cluster Address: https://0.0.0.0:8201&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Go Version: go1.15.8&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Listener 1: tcp <span class="o">(</span>addr: <span class="s2">&#34;0.0.0.0:8200&#34;</span>, cluster address: <span class="s2">&#34;0.0.0.0:8201&#34;</span>, max_request_duration: <span class="s2">&#34;1m30s&#34;</span>, max_request_size: <span class="s2">&#34;33554432&#34;</span>, tls: <span class="s2">&#34;disabled&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Log Level: info&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Mlock: supported: true, enabled: <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Recovery Mode: <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Storage: inmem&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version: Vault v1.5.7&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version Sha: 81d55e35dbbe844a6feb4f52a9a3d072c052d228+CHANGES&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory&#10;</span></span><span class="line"><span class="cl">and starts unsealed with a single unseal key. The root token is already&#10;</span></span><span class="line"><span class="cl">authenticated to the CLI, so you can immediately begin using Vault.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">You may need to <span class="nb">set</span> the following environment variable:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;$ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s1">&#39;http://0.0.0.0:8200&#39;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The unseal key and root token are displayed below in <span class="k">case</span> you want to&#10;</span></span><span class="line"><span class="cl">seal/unseal the Vault or re-authenticate.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Unseal Key: oqt+hwz0gOD9nxz8gc9C79B0M6mDx7rsbJelYZDsg5I<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">Root Token: s.PAPTxv16g0o9amLr82NYcxBT&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Development mode should NOT be used in production installations!&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Vault server started! Log data will stream in below:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">2021-03-05T15:07:47.964+0100 <span class="o">[</span>INFO<span class="o">]</span>  proxy environment: <span class="nv">http_proxy</span><span class="o">=</span> <span class="nv">https_proxy</span><span class="o">=</span> <span class="nv">no_proxy</span><span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">2021-03-05T15:07:47.964+0100 <span class="o">[</span>WARN<span class="o">]</span>  no <span class="sb">`</span>api_addr<span class="sb">`</span> value specified in config or in VAULT_API_ADDR<span class="p">;</span> falling back to detection <span class="k">if</span> possible, but this value should be manually <span class="nb">set</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>start-vault.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ boundary <span class="nv">dev</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Boundary server configuration:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[</span>Controller<span class="o">]</span> AEAD Key Bytes: A7NiMQ0fNlBiCpFxMxg21k8TAdSNcui/okJGxBg6eZs<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">[</span>Recovery<span class="o">]</span> AEAD Key Bytes: H4U5vaCh1ZmgrRJXhlljvOqkLDzU9ZNy4Cn9Z4+a7Bo<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">[</span>Worker-Auth<span class="o">]</span> AEAD Key Bytes: rWZi4UxADHAlsqbhemdM6YIIyFG9+AuqIcCbAOZILtQ<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">[</span>Recovery<span class="o">]</span> AEAD Type: aes-gcm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">[</span>Root<span class="o">]</span> AEAD Type: aes-gcm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[</span>Worker-Auth<span class="o">]</span> AEAD Type: aes-gcm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cgo: disabled&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; Controller Public Cluster Addr: 127.0.0.1:9201&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dev Database Container: confident_mcnulty&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Dev Database Url: postgres://postgres:password@localhost:49153/boundary?sslmode<span class="o">=</span>disable&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Generated Admin Login Name: admin&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Generated Admin Password: password&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Generated Auth Method Id: ampw_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Generated Host Catalog Id: hcst_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Generated Host Id: hst_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Generated Host Set Id: hsst_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Generated Org Scope Id: o_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Generated Project Scope Id: p_1234567890&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generated Target Id: ttcp_1234567890&#10;</span></span><span class="line"><span class="cl">  Generated Unprivileged Login Name: user&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Generated Unprivileged Password: password&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Listener 1: tcp <span class="o">(</span>addr: <span class="s2">&#34;127.0.0.1:9200&#34;</span>, cors_allowed_headers: <span class="s2">&#34;[]&#34;</span>, cors_allowed_origins: <span class="s2">&#34;[*]&#34;</span>, cors_enabled: <span class="s2">&#34;true&#34;</span>, max_request_duration: <span class="s2">&#34;1m30s&#34;</span>, purpose: <span class="s2">&#34;api&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Listener 2: tcp <span class="o">(</span>addr: <span class="s2">&#34;127.0.0.1:9201&#34;</span>, max_request_duration: <span class="s2">&#34;1m30s&#34;</span>, purpose: <span class="s2">&#34;cluster&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Listener 3: tcp <span class="o">(</span>addr: <span class="s2">&#34;127.0.0.1:9202&#34;</span>, max_request_duration: <span class="s2">&#34;1m30s&#34;</span>, purpose: <span class="s2">&#34;proxy&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Log Level: info&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Mlock: supported: true, enabled: <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version: Boundary v0.1.7&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version Sha: bc565922fbd3a18c9f6a22cd2e80a93df0d7cd45&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Worker Public Proxy Addr: 127.0.0.1:9202&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Boundary server started! Log data will stream in below:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">2021-03-05T15:08:05.051+0100 <span class="o">[</span>INFO<span class="o">]</span>  worker: connected to controller: <span class="nv">address</span><span class="o">=</span>127.0.0.1:9201&#10;</span></span><span class="line"><span class="cl">2021-03-05T15:08:05.054+0100 <span class="o">[</span>INFO<span class="o">]</span>  controller: worker successfully authed: <span class="nv">name</span><span class="o">=</span>dev-worker&#10;</span></span><span class="line"><span class="cl">2021-03-05T15:08:05.059+0100 <span class="o">[</span>WARN<span class="o">]</span>  worker: got no controller addresses from controller<span class="p">;</span> possibly prior to first status save, not persisting</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>start-boudary.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps -a&#10;</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  CREATED&nbsp;&nbsp;&nbsp;&nbsp;   STATUS&nbsp;&nbsp;&nbsp;&nbsp;   PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAMES&#10;</span></span><span class="line"><span class="cl">e48475a774bb   postgres:11   <span class="s2">&#34;docker-entrypoint.s…&#34;</span>   <span class="m">2</span> hours ago   Up <span class="m">2</span> hours   0.0.0.0:49153-&gt;5432/tcp   confident_mcnulty</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-ps.sh</span>
    </div>
</div>
<h4 id="conexión-ssh-a-sistema-remoto">Conexión SSH a sistema remoto</h4>
<p>Realizando la conexión directamente al <em>host</em> remoto con SSH se realiza con el siguiente comando, esta es la forma tradicional de hacerlo usando claves SSH.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.11+ <span class="c1">#1399 Thu Jan 28 12:02:28 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Thu Feb <span class="m">25</span> 21:21:31 <span class="m">2021</span> from 192.168.1.7&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>pi@raspberrypi ~<span class="o">]</span>$</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh.sh</span>
    </div>
</div>
<p>Utilizando Boundary como intermediario estos son los comandos. Primero hay que realizar la autenticación en Boundary y luego usar Boundary para que establezca la conexión SSH con el <em>host</em> destino, previamente hay es necesario haber configurado los recursos en Boundary.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ boundary authenticate password -auth-method-id<span class="o">=</span>ampw_1234567890 -login-name<span class="o">=</span>admin -password<span class="o">=</span>password&#10;</span></span><span class="line"><span class="cl">Authentication information:&#10;</span></span><span class="line"><span class="cl">  Account ID:&nbsp;&nbsp;&nbsp;&nbsp;  apw_cxGWZ0KOIc&#10;</span></span><span class="line"><span class="cl">  Auth Method ID:  ampw_1234567890&#10;</span></span><span class="line"><span class="cl">  Expiration Time: Fri, <span class="m">12</span> Mar <span class="m">2021</span> 15:21:11 CET&#10;</span></span><span class="line"><span class="cl">  Token:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   at_1PE5BRB96M_s18pNSYQHzzoZmPD8eyuUyEpqiZw5VFBvAPN7bs2MUamBpdY316whSfZthEVw3KED7khERfPxRTKAm8TH14vNAWW7UrCamxSgYToYBQ3x7kxJHPfeZdtEwhfwx7NZ8TWaXVL2gdppJ4sZ&#10;</span></span><span class="line"><span class="cl">  User ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u_1234567890&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">BOUNDARY_TOKEN</span><span class="o">=</span><span class="s2">&#34;at_1PE5BRB96M_s18pNSYQHzzoZmPD8eyuUyEpqiZw5VFBvAPN7bs2MUamBpdY316whSfZthEVw3KED7khERfPxRTKAm8TH14vNAWW7UrCamxSgYToYBQ3x7kxJHPfeZdtEwhfwx7NZ8TWaXVL2gdppJ4sZ&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>boundary-authentication.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ boundary connect ssh -target-id ttcp_23T9SbQ7ce -username pi -- -i <span class="s2">&#34;~/.ssh/pico.dev@gmail.com&#34;</span>&#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.11+ <span class="c1">#1399 Thu Jan 28 12:02:28 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Fri Mar  <span class="m">5</span> 15:12:56 <span class="m">2021</span> from 192.168.1.4&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>pi@raspberrypi ~<span class="o">]</span>$ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-boundary-1.sh</span>
    </div>
</div>
<p>Utilizar Boundary como intermediario requiere configurar la herramienta para que tenga un inventario de <em>host</em> a los cuales es posible conectarse y usuarios con sus permisos. En el ejemplo utilizo una Raspberry Pi como <em>host</em> al que realizar la conexión en la dirección IP <em>192.168.1.101</em>. Para utilizar la linea de comandos de Boundary hay que autenticarse y establecer la variable de entorno <em>BOUNDARY_TOKEN</em>.</p>
<p>Las operaciones de estos comandos para crear los recursos están disponibles también para realizarlas desde su consola web de administración.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-host-catalog_hu3235fc6497f0f2f8d98a146c111fece0_87274_2560x1440_fit_box_3.png" data-gallery="" title="Crear recursos de Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-host-catalog_hu3235fc6497f0f2f8d98a146c111fece0_87274_300x200_fit_box_3.png" width="300" height="199" alt="Crear recursos de Boundary" title="Crear recursos de Boundary"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-targets_hu69bed4a0b9e08a5db2c473e5d06f4cef_75202_2560x1440_fit_box_3.png" data-gallery="" title="Crear recursos de Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-targets_hu69bed4a0b9e08a5db2c473e5d06f4cef_75202_300x200_fit_box_3.png" width="300" height="199" alt="Crear recursos de Boundary" title="Crear recursos de Boundary"  class="lozad "></a></p>
<figcaption>Crear recursos de Boundary</figcaption>
</figure>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span><span class="lnt">172&#10;</span><span class="lnt">173&#10;</span><span class="lnt">174&#10;</span><span class="lnt">175&#10;</span><span class="lnt">176&#10;</span><span class="lnt">177&#10;</span><span class="lnt">178&#10;</span><span class="lnt">179&#10;</span><span class="lnt">180&#10;</span><span class="lnt">181&#10;</span><span class="lnt">182&#10;</span><span class="lnt">183&#10;</span><span class="lnt">184&#10;</span><span class="lnt">185&#10;</span><span class="lnt">186&#10;</span><span class="lnt">187&#10;</span><span class="lnt">188&#10;</span><span class="lnt">189&#10;</span><span class="lnt">190&#10;</span><span class="lnt">191&#10;</span><span class="lnt">192&#10;</span><span class="lnt">193&#10;</span><span class="lnt">194&#10;</span><span class="lnt">195&#10;</span><span class="lnt">196&#10;</span><span class="lnt">197&#10;</span><span class="lnt">198&#10;</span><span class="lnt">199&#10;</span><span class="lnt">200&#10;</span><span class="lnt">201&#10;</span><span class="lnt">202&#10;</span><span class="lnt">203&#10;</span><span class="lnt">204&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ boundary scopes create -name bitix-scope -description <span class="s2">&#34;Example Bitix scope&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Scope information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:24:33 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Example Bitix scope&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitix-scope&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:24:33 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope <span class="o">(</span>parent<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  global&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  global&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">$ boundary scopes create -name bitix-project -description <span class="s2">&#34;Example Bitix project&#34;</span> -scope-id<span class="o">=</span>o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Scope information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:26:54 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Example Bitix project&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitix-project&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:26:54 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope <span class="o">(</span>parent<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  bitix-scope&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:   global&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  org&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">$ boundary host-catalogs create static -name bitix-host-catalog -description <span class="s2">&#34;Bitix host-catalog&#34;</span> -scope-id<span class="o">=</span>p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Host Catalog information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:30:22 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bitix host-catalog&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitix-host-catalog&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:30:22 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:   o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions on Host Catalog<span class="se">\&#39;</span>s Collections:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;host-setss:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  create&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  list&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;hostss:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  create&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  list&#10;</span></span><span class="line"><span class="cl">$ boundary host-sets create static -name<span class="o">=</span>raspberrypi -description<span class="o">=</span><span class="s2">&#34;Raspberry Pi host set&#34;</span> -host-catalog-id<span class="o">=</span>hcst_8t06PaPJHK &#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Host Set information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:58:01 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Raspberry Pi host <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">  Host Catalog ID:&nbsp;&nbsp;&nbsp;&nbsp; hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hsst_e6BJkM7PqR&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raspberrypi&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:58:01 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:   o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;add-hosts&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;set-hosts&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;remove-hosts&#10;</span></span><span class="line"><span class="cl">$ boundary hosts create static -name raspberrypi -description <span class="s2">&#34;Static host for Raspberry Pi&#34;</span> -address <span class="s2">&#34;192.168.1.101&#34;</span> -host-catalog-id<span class="o">=</span>hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Host information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:38:18 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Static host <span class="k">for</span> Raspberry Pi&#10;</span></span><span class="line"><span class="cl">  Host Catalog ID:&nbsp;&nbsp;&nbsp;&nbsp; hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hst_2eN5yaTE41&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raspberrypi&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:38:18 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:   o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Attributes:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;address:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   192.168.1.101&#10;</span></span><span class="line"><span class="cl">$ boundary host-sets add-hosts --host<span class="o">=</span>hst_2eN5yaTE41 -id<span class="o">=</span>hsst_e6BJkM7PqR&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Host Set information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:58:01 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Raspberry Pi host <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">  Host Catalog ID:&nbsp;&nbsp;&nbsp;&nbsp; hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hsst_e6BJkM7PqR&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raspberrypi&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri, <span class="m">05</span> Mar <span class="m">2021</span> 16:01:36 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:   o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;add-hosts&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;set-hosts&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;remove-hosts&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Host IDs:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;hst_2eN5yaTE41&#10;</span></span><span class="line"><span class="cl">$ boundary targets create tcp -name raspberrypi -description <span class="s2">&#34;Raspberry Pi target&#34;</span> -default-port<span class="o">=</span><span class="m">22</span> -scope-id<span class="o">=</span>p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Target information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:42:04 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Raspberry Pi target&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ttcp_23T9SbQ7ce&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   raspberrypi&#10;</span></span><span class="line"><span class="cl">  Session Connection Limit:   <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">  Session Max Seconds:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">28800</span>&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   tcp&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:42:04 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;add-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;set-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;remove-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;authorize-session&#10;</span></span><span class="line"><span class="cl">$ boundary targets add-host-sets -host-set<span class="o">=</span>hsst_e6BJkM7PqR -id<span class="o">=</span>ttcp_23T9SbQ7ce&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Target information:&#10;</span></span><span class="line"><span class="cl">  Created Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:42:04 CET&#10;</span></span><span class="line"><span class="cl">  Description:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Raspberry Pi target&#10;</span></span><span class="line"><span class="cl">  ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ttcp_23T9SbQ7ce&#10;</span></span><span class="line"><span class="cl">  Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   raspberrypi&#10;</span></span><span class="line"><span class="cl">  Session Connection Limit:   <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">  Session Max Seconds:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">28800</span>&#10;</span></span><span class="line"><span class="cl">  Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   tcp&#10;</span></span><span class="line"><span class="cl">  Updated Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Fri, <span class="m">05</span> Mar <span class="m">2021</span> 15:59:03 CET&#10;</span></span><span class="line"><span class="cl">  Version:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Scope:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   p_MPpTkaalUm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bitix-project&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Parent Scope ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  o_PuL7bdpoKw&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; project&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Authorized Actions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;update&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;delete&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;add-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;set-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;remove-host-sets&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;authorize-session&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  Host Sets:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Host Catalog ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  hcst_8t06PaPJHK&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   hsst_e6BJkM7PqR</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>boundary-configuration.sh</span>
    </div>
</div>
<p>Una de las funcionalidades que proporciona Boundary es trazabilidad en el <em>log</em> se muestran los inicio de las conexiones y su finalización, permite ver las conexiones abiertas y forzar el cierre de una conexión.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">2021-03-05T16:31:06.880+0100 [INFO]  controller.worker-handler: authorized connection: session_id=s_S91yFIr4qi connection_id=sc_tg5qgexhhe connections_left=0&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:31:06.888+0100 [INFO]  controller.worker-handler: connection established: session_id=s_S91yFIr4qi connection_id=sc_tg5qgexhhe client_tcp_address=127.0.0.1 client_tcp_port=40058 endpoint_tcp_address=192.168.1.101 endpoint_tcp_port=22&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:31:09.001+0100 [INFO]  controller.worker-handler: connection closed: connection_id=sc_tg5qgexhhe&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:29.299+0100 [INFO]  controller.worker-handler: session activated: session_id=s_7yPhGF7hHz target_id=ttcp_23T9SbQ7ce user_id=u_1234567890 host_set_id=hsst_e6BJkM7PqR host_id=hst_2eN5yaTE41&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:29.305+0100 [INFO]  controller.worker-handler: authorized connection: session_id=s_7yPhGF7hHz connection_id=sc_u5dxQjveKv connections_left=0&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:29.314+0100 [INFO]  controller.worker-handler: connection established: session_id=s_7yPhGF7hHz connection_id=sc_u5dxQjveKv client_tcp_address=127.0.0.1 client_tcp_port=40078 endpoint_tcp_address=192.168.1.101 endpoint_tcp_port=22&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:32.302+0100 [INFO]  controller.worker-handler: connection closed: connection_id=sc_u5dxQjveKv&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:34.745+0100 [INFO]  controller.worker-handler: session activated: session_id=s_xmwSyOuFgW target_id=ttcp_23T9SbQ7ce user_id=u_1234567890 host_set_id=hsst_e6BJkM7PqR host_id=hst_2eN5yaTE41&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:34.757+0100 [INFO]  controller.worker-handler: authorized connection: session_id=s_xmwSyOuFgW connection_id=sc_XkYBKBV1J0 connections_left=0&#10;</span></span><span class="line"><span class="cl">2021-03-05T16:33:34.772+0100 [INFO]  controller.worker-handler: connection established: session_id=s_xmwSyOuFgW connection_id=sc_XkYBKBV1J0 client_tcp_address=127.0.0.1 client_tcp_port=40088 endpoint_tcp_address=192.168.1.101 endpoint_tcp_port=22</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>boundary.log</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-sessions_hu47a87baa44953f42b9aa3bbaa41c3074_139386_2560x1440_fit_box_3.png" data-gallery="" title="Conexiones realizadas con Boundary"><img src="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/images/boundary-sessions_hu47a87baa44953f42b9aa3bbaa41c3074_139386_300x200_fit_box_3.png" width="300" height="199" alt="Conexiones realizadas con Boundary" title="Conexiones realizadas con Boundary"  class="lozad "></a></p>
<figcaption>Conexiones realizadas con Boundary</figcaption>
</figure>
</div>
<h3 id="autenticación-con-ssh">Autenticación con SSH</h3>
<p>La autenticaión de SSH usando Boudary no cambia, se solicita la contraseña del usuario con el que se realiza la conexión, la clave pública en caso de que el servidor se haya configurado con clave pública y privada o incluso un segundo factor de autenticación.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/05/autenticacion-mediante-clave-publica-y-privada-con-ssh/">Autenticación mediante clave pública y privada con SSH</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2021/03/autenticacion-con-segundo-factor-de-autenticacion-en-ssh/">Autenticación con segundo factor de autenticación en SSH</a></li>
</ul>
<h4 id="segundo-factor-de-autenticación-con-vault">Segundo factor de autenticación con Vault</h4>
<p>Vault permite generar contraseñas de un solo uso y configurando SSH validar los OTP proporcionados en la conexión. La ventaja de usar OTP es que no es necesario distribuir las claves públicas en cada una de las máquinas en las que se quiera realizar la conexión SSH. Hay que cambiar los archivos de configuración <em>/etc/pam.d/sshd</em>, <em>/etc/ssh/sshd_config</em>, <em>/etc/vault-ssh-helper.d/config.hcl</em> y reiniciar el servicio de SSH, estos cambios permiten al servidor SSH validar los <em>tokens</em> proporcionados conectándose con Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ssh pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl">$ wget https://releases.hashicorp.com/vault-ssh-helper/0.2.1/vault-ssh-helper_0.2.1_linux_amd64.zip&#10;</span></span><span class="line"><span class="cl">$ wget https://releases.hashicorp.com/vault-ssh-helper/0.2.1/vault-ssh-helper_0.2.1_linux_arm.zip&#10;</span></span><span class="line"><span class="cl">$ sudo unzip -q vault-ssh-helper_0.2.1_linux_arm.zip -d /usr/local/bin&#10;</span></span><span class="line"><span class="cl">$ sudo chmod <span class="m">0755</span> /usr/local/bin/vault-ssh-helper&#10;</span></span><span class="line"><span class="cl">$ sudo chown root:root /usr/local/bin/vault-ssh-helper&#10;</span></span><span class="line"><span class="cl">$ sudo mkdir /etc/vault-ssh-helper.d/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ sudo tee /etc/vault-ssh-helper.d/config.hcl <span class="s">&lt;&lt;EOF&#10;</span></span></span><span class="line"><span class="cl"><span class="s">vault_addr = &#34;http://192.168.1.4:8200&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">tls_skip_verify = false&#10;</span></span></span><span class="line"><span class="cl"><span class="s">ssh_mount_point = &#34;ssh&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">allowed_roles = &#34;*&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault-ssh-helper -verify-only -dev -config /etc/vault-ssh-helper.d/config.hcl&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; WARNING: Dev mode is enabled!&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> using SSH mount point: ssh&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> using namespace: us&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> vault-ssh-helper verification successful!</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>install-ssh-helper.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo vim /etc/pam.d/sshd&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">#@include common-auth&#10;</span></span><span class="line"><span class="cl">auth requisite pam_exec.so quiet expose_authtok log=/var/log/vault-ssh.log /usr/local/bin/vault-ssh-helper -dev -config=/etc/vault-ssh-helper.d/config.hcl&#10;</span></span><span class="line"><span class="cl">auth optional pam_unix.so not_set_pass use_first_pass nodelay</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo vim /etc/ssh/sshd_config&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd_config.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">ChallengeResponseAuthentication yes&#10;</span></span><span class="line"><span class="cl">UsePAM yes&#10;</span></span><span class="line"><span class="cl">PasswordAuthentication no</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>sshd_config</span>
    </div>
</div>
<p>Para validar el OTP el servidor SSH a través del módulo de autenticación PAM le pide a Vault que lo valide, para ello necesita conectividad de red, si es necesario activando la regla del <em>firewall</em> para permitir el tráfico de red para el puerto <em>8200</em> que utiliza Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo ufw allow 8200/tcp&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-configuration-firewall.sh</span>
    </div>
</div>
<p>También hay que configurar Vault con las políticas y permisos para permitir a un usuario autenticado generar los OTP de autenticación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:8200&#39;</span>&#10;</span></span><span class="line"><span class="cl">$ vault secrets <span class="nb">enable</span> ssh&#10;</span></span><span class="line"><span class="cl">$ vault write ssh/roles/otp_ssh <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">key_type</span><span class="o">=</span>otp <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">default_user</span><span class="o">=</span>pi <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">cidr_list</span><span class="o">=</span>192.168.1.0/24</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-configuration.sh</span>
    </div>
</div>
<p>El comando para generar el OTP e iniciar la conexión es el siguiente. Este comando realiza dos acciones, generar el OTP e iniciar la conexión SSH, el OTP hay que copiarlo y pegarlo de forma manual en la solicitud de contraseña que corresponde con el OTP generado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ vault ssh -role otp_ssh -mode otp -strict-host-key-checking<span class="o">=</span>no pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl">Vault could not locate <span class="s2">&#34;sshpass&#34;</span>. The OTP code <span class="k">for</span> the session is displayed&#10;</span></span><span class="line"><span class="cl">below. Enter this code in the SSH password prompt. If you install sshpass,&#10;</span></span><span class="line"><span class="cl">Vault can automatically perform this step <span class="k">for</span> you.&#10;</span></span><span class="line"><span class="cl">OTP <span class="k">for</span> the session is: 31233d29-e822-6891-6a34-9a101fb2e344&#10;</span></span><span class="line"><span class="cl">Password:&#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.11+ <span class="c1">#1399 Thu Jan 28 12:02:28 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Fri Mar  <span class="m">5</span> 15:12:56 <span class="m">2021</span> from 192.168.1.4&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>pi@raspberrypi ~<span class="o">]</span>$ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-vault-otp-1.sh</span>
    </div>
</div>
<p>Generar el OTP y realizar la conexión se puede realizar en dos pasos separados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ vault write ssh/creds/otp_ssh <span class="nv">username</span><span class="o">=</span>pi <span class="nv">ip</span><span class="o">=</span>192.168.1.101&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">lease_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ssh/creds/otp_ssh/7vB38cBFRWl883ePHusCBAMI&#10;</span></span><span class="line"><span class="cl">lease_duration&nbsp;&nbsp;&nbsp;&nbsp; 768h&#10;</span></span><span class="line"><span class="cl">lease_renewable&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.1.101&#10;</span></span><span class="line"><span class="cl">key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;93e489c2-c30c-6e4e-f22c-96e719d41fd3&#10;</span></span><span class="line"><span class="cl">key_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   otp&#10;</span></span><span class="line"><span class="cl">port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="m">22</span>&#10;</span></span><span class="line"><span class="cl">username&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   pi&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh pi@192.168.1.101&#10;</span></span><span class="line"><span class="cl">Password:&#10;</span></span><span class="line"><span class="cl">Linux raspberrypi 5.10.11+ <span class="c1">#1399 Thu Jan 28 12:02:28 GMT 2021 armv6l</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the&#10;</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span><span class="line"><span class="cl">permitted by applicable law.&#10;</span></span><span class="line"><span class="cl">Last login: Fri Mar  <span class="m">5</span> 15:12:56 <span class="m">2021</span> from 192.168.1.4&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>pi@raspberrypi ~<span class="o">]</span>$ </span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-vault-otp-2.sh</span>
    </div>
</div>
<p>Usando Vault la conexión se realiza entre la máquina local y la máquina destino, usando Boundary como intermediario el comando es el mismo que al usar una clave SSH pero al iniciar la conexión se solicita la contraseña OTP.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ boundary connect ssh -target-id ttcp_23T9SbQ7ce -username pi&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-boundary-2.sh</span>
    </div>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://learn.hashicorp.com/tutorials/boundary/getting-started-install?in=boundary/getting-started">Boundary Quick Start Guide</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/vault/ssh-otp">SSH Secrets Engine: One-Time SSH Password</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/</id>
        <title>Cifrado y descifrado como servicio con Vault</title>
        <updated>2021-02-26T16:00:00+01:00</updated>
        <published>2021-02-26T16:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Implementar la seguridad en una aplicación no es sencillo, cuando un sistema se compone de múltiples aplicaciones los posibles fallos de seguridad se multiplican. Vault es una herramienta que permite centralizar y delegar varios aspectos de las aplicaciones relativos a la seguridad, uno de ellos es el cifrado y descifrado de los datos para su almacenamiento y recuperación de una base de datos. Entre sus funcionalidades Vault ofrece como servicio el cifrado y descifrado de datos.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-vault.svg" width="200" height="286" alt="HashiCorp Vault" title="HashiCorp Vault"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp.svg" width="200" height="200" alt="HashiCorp" title="HashiCorp"  class=""></p>
</div>
<p>La seguridad en una aplicación involucra a los datos, tanto en la transmisión entre aplicaciones como en el almacenamiento a ambos se les conoce por la seguridad de los datos en tránsito o <em>transit</em> y por la seguridad en persistencia o <em>rest</em>. La seguridad de los datos en tránsito se consigue utilizando protocolos de comunicación seguros como TLS y la seguridad de los datos en persistencia se consigue cifrando los datos ya sea a nivel de sistema de archivos, base de datos o datos específicos aplicando un algoritmo de cifrado.</p>
<p>No es fácil implementar la seguridad, por un lado hay que utilizar algoritmos de cifrado considerados seguros, en un sistema grande en el que hay múltiples aplicaciones que utilizan potencialmente diferentes lenguajes de programación y librerías han de tener soporte para esos algoritmos de cifrado. Por otro lado, al tener múltiples aplicaciones requiere que cada una de ellas mantenga seguras las claves privadas en las que se fundamenta la seguridad de cifrado y descifrado, con múltiples aplicaciones los posibles puntos vulnerables son varios.</p>
<p>La seguridad de los datos es muy importante, ciertos datos personales sensibles y que permiten identificar a personas están protegidos por leyes. El no cumplimiento de las leyes implica potencialmente a una empresa recibir importantes multas o descrédito que afecte a la viabilidad del negocio o suponga una reducción de facturación. Algunos datos candidatos a ser cifrados o transformados al guardarse en base de datos son, datos personales e identificativos como nombre y apellidos, DNI, dirección, tarjetas de crédito, bancarios u otros datos que estén regulados por las leyes de protección de datos.</p>
<p>Los datos protegidos incluso no es deseable que sean accesibles por cualesquiera trabajadores de la propia empresa, solo debería tener acceso a ellos aquellos trabajadores que los necesitan para desempeñar su trabajo y ofrecer el servicio que proporciona la empresa. Para el desarrollo de una aplicación los programadores necesitan una base de datos con el mismo esquema de la base de datos de producción y un conjunto de datos, una opción es <a href="https://picodotdev.github.io/blog-bitix/2020/05/copia-de-seguridad-restauracion-y-carga-de-datos-en-postgresql-y-mysql/">obtener una copia de la base de datos</a> de producción, sin embargo, obtener una copia de la base de datos de producción otorga acceso a los programadores acceso a los datos, al hacer la copia es posible aplicar un proceso que ofusque los datos sin embargo esto sigue sin solventar el problema de mantener seguros los datos en la propia base de datos de producción o sus réplicas. Si algunos datos se guardan cifrados aunque se tenga acceso a la base de datos los datos cifrados siguen protegidos.</p>
<p>Una de las funcionalidades que ofrece <a href="https://www.vaultproject.io/">Vault</a> de <a href="https://www.hashicorp.com/">HashiCorp</a> es ofrecer el cifrado y descifrado como servicio. Este artículo está basado en la <a href="https://learn.hashicorp.com/tutorials/vault/eaas-spring-demo?in=vault/encryption-as-a-service">guía de Vault sobre la funcionalidad de cifrado y descifrado</a>.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="vault-como-servicio-de-cifrado-y-descifrado">Vault como servicio de cifrado y descifrado</h3>
<p>Vault es una herramienta dedicada a la seguridad de la empresa HashiCorp. Tiene diferentes funcionalidades como servir de almacenamiento de secretos en su base de datos de claves y valores, <a href="https://picodotdev.github.io/blog-bitix/2019/08/generar-credenciales-de-conexion-a-base-de-datos-bajo-demanda-con-vault/">generar credenciales de acceso bajo demanda a recursos como bases de datos</a> entre otras como cifrado y descifrado como servicio. En todas estás funcionalidades diversos aspectos de la seguridad se centralizan en un único componente del sistema.</p>
<p>Las claves de cifrado únicamente se almacenan en Vault, por otro lado las aplicaciones no han de mantener credenciales para el acceso a una base de datos sino que es Vault el que crea las credenciales válidas únicamente por un periodo de tiempo corto con posibilidad de renovación. Esto aumenta la seguridad ya que una aplicación no ha de mantener unas credenciales para la base de datos válidas por un tiempo indefinido, al mismo tiempo las claves de cifrado están centralizadas en vez estar incluidas en cada aplicación. En caso necesario Vault es capaz de revocar las credenciales de cualquier aplicación.</p>
<p>Vault ofrece dos servicios para proteger los datos, el servicio de cifrado y descifrado está disponible en Vault y el de transformación requiere la versión <em>Enterprise</em>.</p>
<div class="media media-video">
  <iframe width="640" height="360" src="https://www.youtube.com/embed/HVK-a8SKqvc" frameborder="0" class="lozad" allowfullscreen></iframe>
</div>
<div class="media media-video">
  <iframe width="640" height="360" src="https://www.youtube.com/embed/DOw0Y6ig1i4" frameborder="0" class="lozad" allowfullscreen></iframe>
</div>
<h4 id="servicio-de-cifrado-y-descifrado">Servicio de cifrado y descifrado</h4>
<p>El servicio de cifrado y descifrado de Vault consisten simplemente en aplicar un algoritmo de cifrado a un dato en texto plano y devolverlo cifrado y realizar la operación contraria aplicar el algoritmo de descifrado a un dato cifrado y devolverlo en texto plano. Además de mantener las claves de cifrado con la posibilidad rotarlas, es decir, crear nuevas claves.</p>
<p>El proceso de cifrado de Vault transforma el dato original en un valor que no tiene ningún sentido sin aplicar el proceso de descifrado. El formato del dato original se pierde, esto es, si el dato original es un número de teléfono con el formato <em>(+34) 666554433</em> el dato cifrado es una secuencia de caracteres de cierta longitud con otro formato. Esta pérdida de formato es un inconveniente al guardar el dato en la base de datos para solventarlo Vault ofrece el servicio de transformación.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/images/vault-encryption_hua0680acd84a53d760197920946a57315_65049_2560x1440_fit_box_3.png" data-gallery="" title="Uso del servicio de cifrado y descifrado de Vault"><img src="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/images/vault-encryption_hua0680acd84a53d760197920946a57315_65049_650x450_fit_box_3.png" width="650" height="242" alt="Uso del servicio de cifrado y descifrado de Vault" title="Uso del servicio de cifrado y descifrado de Vault"  class="lozad "></a></p>
<figcaption>Uso del servicio de cifrado y descifrado de Vault</figcaption>
</figure>
</div>
<h4 id="servicio-de-transformación">Servicio de transformación</h4>
<p>En vez de cifrado Vault también ofrece un servicio de transformación que permite obtener un dato ofuscado pero que conserva el mismo formato y longitud que el original. Que el dato tenga el formato original es importante en una base de datos relacional ya que la longitud y formato de la columna para guardarlo será el mismo que el original, en el caso de un dato cifrado el campo se ha ade adaptar al resultado cifrado lo que no es deseable.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ vault secrets enable transform&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-transform.sh</span>
    </div>
</div>
<p>En este ejemplo se codifica y descodifica un número de tarjeta de crédito conservando el formato.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ vault write transform/encode/payments value=1111-2222-3333-4444&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">encoded_value&nbsp;&nbsp;&nbsp;&nbsp;9300-3376-4943-8903</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-transform-encode.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">$ vault write transform/decode/payments value=9300-3376-4943-8903&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">decoded_value&nbsp;&nbsp;&nbsp;&nbsp;1111-2222-3333-4444</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-transform-decode.sh</span>
    </div>
</div>
<h4 id="proveedor-de-claves">Proveedor de claves</h4>
<p>En un caso de uso en el que es necesario cifrar volúmenes de datos grandes, como <em>blobs</em> de 1 GB, requiere codificar en <em>base64</em> y enviar a Vault por red y obtener la respuesta de tal volumen de datos, esto no es deseable para obtener el mejor rendimiento. En vez de enviar los datos se pueden cifrar los datos localmente con la clave obtenida de Vault. La idea es permitir a la aplicación cifrar y descifrar los datos sin necesidad de llamadas y retornos a Vault con grandes volúmenes de datos.</p>
<p>La respuesta para obtener la clave de cifrado contiene la clave de datos tanto en texto plano como en forma cifrada. Con la clave de datos en texto plano se pueden cifrar los datos y almacenar la clave de datos cifrada junto a los datos. Al necesitar descifrar los datos se solicita a Vault descifrar la clave de datos cifrada para obtener la clave de datos en texto plano permitiendo de esta forma descifrar los datos localmente. Esto es, una vez que el <em>blob</em> está cifrado no es necesario almacenar la clave de datos, solo se necesita almacenar la versión cifrada de la misma.</p>
<p>Esta idea permite cifrar y descifrar grandes volúmenes de datos a la aplicación sin realizar comunicaciones de red costosas con Vault. En este caso Vault no proporciona el servicio de cifrado y descifrado sino que lo hace la aplicación, sin embargo, Vault administra la gestión de las claves usadas por la aplicación que no ha de mantener ninguna clave privada.</p>
<h3 id="ejemplo-de-cifrado-y-descifrado-de-datos">Ejemplo de cifrado y descifrado de datos</h3>
<p>Vault dispone tres métodos de acceso a sus funcionalidades entre ellas el servicio de cifrado y descifrado. Los tres métodos son mediante línea de comandos, mediante API REST o mediante la consola web de administración. En este ejemplo solo se muestra la versión de línea de comandos, la opción mediante API REST es posible probarla mediante una herramienta de linea de comandos como <em>curl</em>.</p>
<p>El primer paso es iniciar Vault, en este caso por simplicidad en modo desarrollo y habilitar el <em>transit engine</em> que proporciona el servicio de cifrado y descifrado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault server -dev&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:8200&#39;</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-start.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault secrets <span class="nb">enable</span> transit&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-enable-transit.sh</span>
    </div>
</div>
<p>El siguiente paso es obtener una clave, Vault la devuelve en texto plano o <em>plaintext</em> y cifrada o <em>ciphertext</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault write -f transit/keys/app&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-create-key.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault write -f transit/datakey/plaintext/app&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   │&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   │&#10;</span></span><span class="line"><span class="cl">ciphertext&nbsp;&nbsp;&nbsp;&nbsp; vault:v1:l5Y2HZn+LLq6O5ttSlquXo+x2OMzNH/7ReLpgi47DOWeIGUXmdxHBkk0OtqJe4hqmpyz5QCSx99kwyZu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   │&#10;</span></span><span class="line"><span class="cl">key_version&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   │&#10;</span></span><span class="line"><span class="cl">plaintext&nbsp;&nbsp;&nbsp;&nbsp;  k0n6o+vBAy0g2IFGqoRi5G4t1pMypljY9G4+wWewrEg<span class="o">=</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-key.sh</span>
    </div>
</div>
<p>Una vez creada la clave, se solicita a Vault cifrar y descifrar datos. Los datos han de proporcionase en codificados en <em>base64</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault write transit/encrypt/app <span class="nv">plaintext</span><span class="o">=</span><span class="k">$(</span>base64 <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;4111 1111 1111 1111&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">ciphertext&nbsp;&nbsp;&nbsp;&nbsp; vault:v1:kYVkH1OxTEai1zjO+uQ9FKiHanlbaQ2bF5b5GYwUiEef5d31ProquZ5grVJfDWrc&#10;</span></span><span class="line"><span class="cl">key_version&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault write transit/decrypt/app <span class="nv">ciphertext</span><span class="o">=</span><span class="s2">&#34;vault:v1:kYVkH1OxTEai1zjO+uQ9FKiHanlbaQ2bF5b5GYwUiEef5d31ProquZ5grVJfDWrc&#34;</span>&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">plaintext&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NDExMSAxMTExIDExMTEgMTExMQo</span><span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ base64 --decode <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;NDExMSAxMTExIDExMTEgMTExMQo=&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="m">4111</span> <span class="m">1111</span> <span class="m">1111</span> <span class="m">1111</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-encrypt-decrypt.sh</span>
    </div>
</div>
<p>Algunas aplicaciones para aumentar la seguridad y evitar usar una única clave que en el tiempo quede comprometida Vault proporciona la opción de generar una nueva versión de la misma, la clave antigua sigue siendo válida pero los datos serán cifrados con la última versión. Una vez todos los datos hayan sido cifrados con una versión más reciente las versiones antiguas se pueden deshabilitar.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault write -f transit/keys/app/rotate&#10;</span></span><span class="line"><span class="cl">$ vault write transit/encrypt/app <span class="nv">plaintext</span><span class="o">=</span><span class="k">$(</span>base64 <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;4111 1111 1111 1111&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">ciphertext&nbsp;&nbsp;&nbsp;&nbsp; vault:v2:aVuvvlcyPX5J4sPYXFWHL53sIDx3HP9oBBTNjhY6NyshliMZzw8g8Ir9+BRpI8FJ&#10;</span></span><span class="line"><span class="cl">key_version&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault write transit/encrypt/app <span class="nv">plaintext</span><span class="o">=</span><span class="k">$(</span>base64 <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;4111 1111 1111 1111&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">ciphertext&nbsp;&nbsp;&nbsp;&nbsp; vault:v2:8coGwMB2WZsWb8Ogm4Fi8zGgzJq45V+VgYXYaMLHoVSCv9IJXs7Js6Jp5bqDGTUV&#10;</span></span><span class="line"><span class="cl">key_version&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault write transit/decrypt/app <span class="nv">ciphertext</span><span class="o">=</span><span class="s2">&#34;vault:v2:8coGwMB2WZsWb8Ogm4Fi8zGgzJq45V+VgYXYaMLHoVSCv9IJXs7Js6Jp5bqDGTUV&#34;</span>&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">plaintext&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NDExMSAxMTExIDExMTEgMTExMQo</span><span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ base64 --decode <span class="o">&lt;&lt;&lt;</span> <span class="s2">&#34;NDExMSAxMTExIDExMTEgMTExMQo=&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="m">4111</span> <span class="m">1111</span> <span class="m">1111</span> <span class="m">1111</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-rotate-key.sh</span>
    </div>
</div>
<h3 id="ejemplo-aplicación-con-spring">Ejemplo aplicación con Spring</h3>
<p><a href="https://spring.io/">Spring</a> proporciona clases de soporte para el acceso al servicio de Vault. Tanto para la configuración de acceso a Vault como para usar sus servicios mediante una API de clases Java sin tener que recurrir a la API REST de Vault directamente. La clase <a href="https://docs.spring.io/spring-vault/docs/current/api/org/springframework/vault/core/VaultOperations.html">VaultOperations</a> contiene las referencias de clases para el acceso a las API de Vault, para el caso de el servicio de cifrado y descifrado con la clase <a href="https://docs.spring.io/spring-vault/docs/current/api/org/springframework/vault/core/VaultTransitOperations.html">VaultTransitOperations</a>.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/images/vault-encryption-java_hudea10222b8f8a519c16c06b964997b0f_48852_2560x1440_fit_box_3.png" data-gallery="" title="Uso del servicio de cifrado y descifrado de Vault en una aplicación Java"><img src="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/images/vault-encryption-java_hudea10222b8f8a519c16c06b964997b0f_48852_650x450_fit_box_3.png" width="650" height="251" alt="Uso del servicio de cifrado y descifrado de Vault en una aplicación Java" title="Uso del servicio de cifrado y descifrado de Vault en una aplicación Java"  class="lozad "></a></p>
<figcaption>Uso del servicio de cifrado y descifrado de Vault en una aplicación Java</figcaption>
</figure>
</div>
<p>Para usar el servicio de cifrado y descifrado en una aplicación de Spring, Vault permite la autenticación mediante el mecanismo <em>AppRole</em>. <em>AppRole</em> es un método de autenticación destinadas a las aplicaciones, básicamente proporciona unas credenciales como un usuario y contraseña. El <em>policy</em> se asocia con las credenciales de la aplicación para permitirle el acceso a la clave de cifrado y descifrado <em>app</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault auth <span class="nb">enable</span> approle&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault policy write app -<span class="s">&lt;&lt;EOF&#10;</span></span></span><span class="line"><span class="cl"><span class="s">path &#34;transit/encrypt/app&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">   capabilities = [ &#34;update&#34; ]&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">path &#34;transit/decrypt/app&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">   capabilities = [ &#34;update&#34; ]&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault write auth/approle/role/app <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">secret_id_ttl</span><span class="o">=</span>10m <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">token_num_uses</span><span class="o">=</span><span class="m">10</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">token_ttl</span><span class="o">=</span>20m <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">token_max_ttl</span><span class="o">=</span>30m <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">secret_id_num_uses</span><span class="o">=</span><span class="m">40</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">policies</span><span class="o">=</span>app</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>app-vault-approle.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vault <span class="nb">read</span> auth/approle/role/app/role-id&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">role_id&nbsp;&nbsp;&nbsp;&nbsp;c0b643d1-9507-dae1-ffbd-6e405e082f1d&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault write -f auth/approle/role/app/secret-id&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   -----&#10;</span></span><span class="line"><span class="cl">secret_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9b1b6fe6-0ee5-4182-c08d-245d20a59351&#10;</span></span><span class="line"><span class="cl">secret_id_accessor&nbsp;&nbsp;&nbsp;&nbsp;b9f5af8e-29ee-694c-2751-6f65d5361caf</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>app-vault-role.sh</span>
    </div>
</div>
<p>Credo el rol <em>app</em> para la aplicación las credenciales formadas por el <em>role_id</em> y <em>secret_id</em> ponen en el archivo de configuración de la aplicación de Spring.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring.cloud.vault</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://127.0.0.1:8200</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="l">APPROLE</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">app-role</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="nt">role-id</span><span class="p">:</span><span class="w"> </span><span class="l">c0b643d1-9507-dae1-ffbd-6e405e082f1d</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="nt">secret-id</span><span class="p">:</span><span class="w"> </span><span class="l">9b1b6fe6-0ee5-4182-c08d-245d20a59351</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="nt">app-role-path</span><span class="p">:</span><span class="w"> </span><span class="l">approle</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>application.yml</span>
    </div>
</div>
<p>El cifrado y descifrado en la aplicación consiste simplemente en hacer uso de la API que proporciona Spring para el acceso a Vault, esta API hace transparente las llamadas REST subyacentes que se hacen a Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springcloudvaultcipher</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.vault.core.VaultOperations</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span>&#10;</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Autowired</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">VaultOperations</span> <span class="n">vault</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">String</span> <span class="n">plaintext</span> <span class="o">=</span> <span class="s">&#34;Hello World!&#34;</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">String</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="na">opsForTransit</span><span class="o">().</span><span class="na">encrypt</span><span class="o">(</span><span class="s">&#34;app&#34;</span><span class="o">,</span> <span class="n">plaintext</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">String</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">vault</span><span class="o">.</span><span class="na">opsForTransit</span><span class="o">().</span><span class="na">decrypt</span><span class="o">(</span><span class="s">&#34;app&#34;</span><span class="o">,</span> <span class="n">encrypted</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Plaintext: &#34;</span> <span class="o">+</span> <span class="n">plaintext</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Encrypted: &#34;</span> <span class="o">+</span> <span class="n">encrypted</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Decrypted: &#34;</span> <span class="o">+</span> <span class="n">decrypted</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<p>El resultado de cifrar y descifrar el dato se muestra como salida en la consola.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">Plaintext: Hello World!&#10;</span></span><span class="line"><span class="cl">Encrypted: vault:v2:arPaLH7cRy221vCTZvNd8csswtmzOc42caVjBQ+T32SW7+x1tLEH0Q==&#10;</span></span><span class="line"><span class="cl">Decrypted: Hello World!</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>System.out</span>
    </div>
</div>
<p>En el archivo de dependencias de la aplicación se ha de incluir la que proporciona Spring para añadir el soporte a Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">plugins</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">id</span> <span class="s1">&#39;java&#39;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">id</span> <span class="s1">&#39;application&#39;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">mainClassName</span> <span class="o">=</span> <span class="s1">&#39;io.github.picodotdev.blogbitix.springcloudvaultcipher.Main&#39;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">repositories</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mavenCentral</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">configurations</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">	<span class="n">all</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">		<span class="n">exclude</span> <span class="nl">group:</span> <span class="s1">&#39;org.springframework.boot&#39;</span><span class="o">,</span> <span class="nl">module:</span> <span class="s1">&#39;spring-boot-starter-logging&#39;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span> <span class="nf">platform</span><span class="o">(</span><span class="s1">&#39;org.springframework.boot:spring-boot-dependencies:2.4.3&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span> <span class="nf">platform</span><span class="o">(</span><span class="s1">&#39;org.springframework.cloud:spring-cloud-dependencies:2020.0.1&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span><span class="o">(</span><span class="s1">&#39;org.springframework.boot:spring-boot-starter&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span><span class="o">(</span><span class="s1">&#39;org.springframework.boot:spring-boot-starter-log4j2&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span><span class="o">(</span><span class="s1">&#39;org.springframework.cloud:spring-cloud-starter-config&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">implementation</span><span class="o">(</span><span class="s1">&#39;org.springframework.cloud:spring-cloud-starter-vault-config&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runtimeOnly</span> <span class="s1">&#39;com.fasterxml.jackson.core:jackson-databind:2.12.1&#39;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runtimeOnly</span> <span class="s1">&#39;com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.12.1&#39;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>build.gradle</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/SpringCloudVaultEncryption">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./gradlew run</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.vaultproject.io/use-cases/data-encryption">Encrypt Application Data in Low Trust Networks</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/vault/eaas-transit?in=vault/encryption-as-a-service">Encryption as a Service: Transit Secrets Engine</a></li>
<li><a href="https://www.vaultproject.io/docs/secrets/transit">Transit Secrets Engine</a></li>
<li><a href="https://www.vaultproject.io/docs/secrets/transform">Transform Secrets Engine</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/02/herramientas-para-convertir-texto-a-audio-de-voz-natural/</id>
        <title>Herramientas para convertir texto a audio de voz natural</title>
        <updated>2021-02-14T00:30:00+01:00</updated>
        <published>2021-02-14T00:30:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/02/herramientas-para-convertir-texto-a-audio-de-voz-natural/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Los archivos de audio son difíciles de editar, un cambio requiere volverlos a grabar de forma parcial o de forma completa lo que requiere mucho tiempo. Hay herramientas que permiten convertir texto a audio de voz sintetizada, el resultado de algunas herramientas es suficientemente bueno como para no distinguirse de una voz humana natural.</strong></p>]]>
        <![CDATA[<p>Al grabar un audio de voz se crea un archivo binario con la grabación en formato <em>wav</em> o comprimido con <em>mp3</em>. Estos formatos de audio son archivos poco editables, no se puede sustituir una palabra, frase o realizar una corrección. La única edición que permite un audio de voz es cortar un trozo o añadir un trozo de audio nuevo. Sin embargo, la edición no es perfecta y el tono de la voz de la parte editada puede variar con la parte anterior y posterior. Además, grabar un audio de voz requiere el tiempo para realizar la grabación.</p>
<p>Hay herramientas que usando un sintetizador de voz permiten transformar un texto en un audio, dando solución a dos de los problemas de la grabación de voz a partir de texto. Al convertir un texto a voz es más fácil la edición ya que basta simplemente cambiar el texto y generar de nuevo el audio y es más rápido ya que la generación del audio es más rápido que grabarlo en tiempo real. Algunos sintetizadores y herramientas además permiten seleccionar el idioma de la voz o ser una voz masculina o femenina.</p>
<p>Una de estas herramientas es <a href="https://github.com/mozilla/TTS">TTS: Text-to-Speech</a>, un proyecto de <a href="https://www.mozilla.org/">Mozilla</a> y las ofrecidas por Amazon, Google y Microsoft. Esta y otras herramientas alternativas de conversión de texto a voz producen audios de voz bastante fieles a la voz humana natural. Para ayudar en la interpretación del texto se enriquece con un lenguaje de marcado que indica a la computadora como entonar e interpretar el texto.</p>
<p>En la actualidad hay herramientas de conversión de texto a voz natural que producen resultados difícilmente indisinguibles de si la voz ha sido producida por un humano por una computadora. Otra tarea para la que hay herramientas que producen buenos resultados es <a href="https://picodotdev.github.io/blog-bitix/2021/04/herramientas-de-reconocimiento-de-texto-en-imagenes-con-ocr/">reconocimiento de texto en imágenes con OCR</a>. Estas son tareas aparentemente simples pero significativamente complejas para una computadora que a pesar de su rapidez y capacidad enorme de cálculo no posee la inteligencia humana.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="convertir-texto-a-voz-natural">Convertir texto a voz natural</h3>
<h4 id="herramientas-web">Herramientas web</h4>
<p>Hay algunas páginas web que ofrecen el servicio de conversión de texto a audio sin necesidad de software adicional a un navegador web. Algunas con limitaciones de número de caracteres pero suficiente para un uso básico. También algunas permiten descargar el archivo de audio, en caso de que no ofrezcan la descargar se puede reproducir y capturar con el <a href="https://www.videolan.org/vlc/">reproductor multimedia VLC</a> en la opción <em>Captura de audio &gt; Monitor de audio interno (HDMI) &gt; Guardar</em>.</p>
<ul>
<li><a href="https://www.texttospeechfree.com/">TextToSpeechFree</a></li>
<li><a href="https://freetts.com/">Free TTS</a></li>
<li><a href="http://fromtexttospeech.com/">Free online Text To Speech</a></li>
</ul>
<h4 id="servicios-de-conversión">Servicios de conversión</h4>
<p>Para un uso más profesional y avanzado hay algunas aplicaciones para <a href="https://www.microsoft.com/es-es/windows/">Windows</a> y entre los muchos servicios que ofrecen <a href="https://aws.amazon.com/es/ec2/">Amazon AWS</a>, <a href="https://www.google.es/">Google</a> y <a href="https://www.microsoft.com/">Microsoft</a> para hacer la operación de convertir audio a texto que realmente producen unos resultados muy buenos con una voz natural difícil de distinguir de una real.</p>
<p>Aplicaciones.</p>
<ul>
<li><a href="https://www.microsoft.com/en-us/p/any-text-to-voice-convert-text-to-speech-text-to-audio-mp3-for-free/9n92n3shd1mv?activetab=pivot:overviewtab#">Any Text to Voice</a></li>
<li><a href="https://www.microsoft.com/en-us/p/convert-text-to-speech/9wzdncrddlsc?activetab=pivot:overviewtab#">Convert Text to Speech</a></li>
</ul>
<p>Servicios.</p>
<ul>
<li><a href="https://aws.amazon.com/es/polly/">Amazon Polly</a></li>
<li><a href="https://aws.amazon.com/es/transcribe/">Amazon Transcribe</a></li>
<li><a href="https://cloud.google.com/text-to-speech/">Google Text‑to‑Speech</a></li>
<li><a href="https://azure.microsoft.com/es-es/services/cognitive-services/text-to-speech/">Microsoft Text to Speech</a></li>
</ul>
<h4 id="mozilla-tts">Mozilla TTS</h4>
<p>La herramienta TTS es capaz de generar un audio de voz sintética a partir de un texto de bastante buena calidad. El audio de voz sintética no es perfecta ni tiene todos los matices en tono, velocidad de habla, contiene algunos defectos y otros matices de las voces humanas pero es aceptablemente bueno.</p>
<p>TTS se ofrece como una imagen de <a href="https://www.docker.com/">Docker</a> que permite una instalación y uso sencillo de la herramienta. Previamente hay que <a href="https://picodotdev.github.io/blog-bitix/2014/11/como-instalar-y-guia-de-inicio-basica-de-docker/">instalar Docker</a>, una vez instalado descargar la <a href="https://github.com/synesthesiam/docker-mozillatts">imagen del contenedor TTS</a> e iniciar un contenedor de la herramienta TTS.</p>
<p>Hay varias voces disponibles específicas para cada idioma, la del español se indica con <em>es</em>, la de inglés con <em>en</em></p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -it -p 5002:5002 synesthesiam/mozillatts:es&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker.sh</span>
    </div>
</div>
<p>Iniciado el servidor de TTS este ofrece dos interfaces una interfaz web en la dirección <em>http://localhost:5002/</em> y una interfaz de linea de comandos con una API REST. Tanto en la interfaz web como en la interfaz de linea de comandos se ha de indicar el texto que convertir a audio. Esto genera como resultado un archivo de audio en formato <em>wav</em>. Para que ocupe menos es posible convertirlo a <em>mp3</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -o voice.wav -X POST -H <span class="s1">&#39;Content-Type: text/plain&#39;</span> --data <span class="s1">&#39;@text.txt&#39;</span> http://localhost:5002/api/tts&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>curl.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/herramientas-para-convertir-texto-a-audio-de-voz-natural/images/mozilla-tts_hu79366de10d1d5b6673f1a83d83ff31aa_92030_2560x1440_fit_box_3.png" data-gallery="" title="Interfaz web de Mozilla TTS"><img src="https://picodotdev.github.io/blog-bitix/2021/02/herramientas-para-convertir-texto-a-audio-de-voz-natural/images/mozilla-tts_hu79366de10d1d5b6673f1a83d83ff31aa_92030_300x200_fit_box_3.png" width="250" height="200" alt="Interfaz web de Mozilla TTS" title="Interfaz web de Mozilla TTS"  class="lozad "></a></p>
<figcaption>Interfaz web de Mozilla TTS</figcaption>
</figure>
</div>
<h4 id="espeak">espeak</h4>
<p><em>espeak</em> y <em>espeak-ng</em> son dos herramientas de linea de comandos que aunque producen una voz sintetizada con un tono fácilmente reconocible como generado por computadora, robótico y metálico, son otras opciones conocidas.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ espeak -f text.txt -v europe/es -w voice.wav&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>espeak.sh</span>
    </div>
</div>
<h3 id="lenguaje-de-marcado-de-síntesis-de-voz-ssml">Lenguaje de marcado de síntesis de voz (SSML)</h3>
<p>Dependiendo de la herramienta de conversión de texto a voz la calidad de las voces de resultado son más fieles a la voz humana o son fácilmente reconocibles como haber sido generadas por una computadora. Algunas de estas herramientas ya producen conversiones de texto a voz que imitan con fidelidad las voces humanas haciendo uso de redes neuronales entrenadas. Un aspecto por el que son todavía fácilmente identificables es por la entonación y personalidad que los humanos imprimimos en el habla, sin ayuda las conversiones sintéticas de texto a voz son monótonas.</p>
<p>El <a href="https://cloud.google.com/text-to-speech/docs/ssml">lenguaje de marcado de síntesis de voz</a> o SSML es un lenguaje que sirve de ayuda a la computadora para interpretar y dar entonación al texto a convertir a voz. Es un lenguaje similar al HTML, con etiquetas atributos y valores, utilizado en las páginas web pero con el propósito de la conversión a voz.</p>
<p>Hay aplicaciones que permite la edición del texto para añadirle el lenguaje de marcado SSML.</p>
<ul>
<li><a href="https://www.getwoord.com/ssml-editor">getwoord ssml-editor</a></li>
<li><a href="https://www.ssml-editor.com/">SSML Editor</a></li>
<li><a href="https://www.amazon.com/-/es/dp/B07L64KVNR">SSML Editor</a> para Alexa, <a href="https://topvoiceapps.com/ssml">SSML WYSIWYG editor y probador</a></li>
</ul>
<h3 id="resultado-y-ejemplo-de-conversión-de-texto-a-voz">Resultado y ejemplo de conversión de texto a voz</h3>
<p>El texto que he utilizado para hacer pruebas ha sido el de la descripción de mi blog. Con los siguientes resultados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux,&#10;</span></span><span class="line"><span class="cl">lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática.&#10;</span></span><span class="line"><span class="cl">El contenido puede contener trazas de asuntos fuera de tema.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Publicando de uno a tres artículos únicos a la semana desde el año 2010.</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>text.txt</span>
    </div>
</div>
<p>Utilizando el servicio Microsoft Text to Speech.</p>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/microsoft-alvaro.mp3" type="audio/mpeg">
</audio>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/microsoft-elvira.mp3" type="audio/mpeg">
</audio>
<p>Utilizando el servicio Free TTS.</p>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/freetts-enrique.mp3" type="audio/mpeg">
</audio>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/freetts-lucia.mp3" type="audio/mpeg">
</audio>
<p>Utilizando Mozilla TTS.</p>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/mozilla-tts.mp3" type="audio/mpeg">
</audio>
<p>Utilizando espeak.</p>
<audio width="300" style="width: 300px" controlslist="nodownload" controls="">
  <source src="audios/espeak.mp3" type="audio/mpeg">
</audio>
<h3 id="convertir-el-audio-en-formato-_wav_-a-_mp3_">Convertir el audio en formato <em>wav</em> a <em>mp3</em></h3>
<p>En el artículo cómo <a href="https://picodotdev.github.io/blog-bitix/2016/03/cambiar-el-formato-de-archivos-de-musica-o-audio-en-gnu-linux/">Cambiar el formato de archivos de música o audio en GNU/Linux</a> comentaba cómo convertir diferentes tipos de audio entre formatos con la herramienta <a href="https://www.ffmpeg.org/">FFmpeg</a>.</p>
<p>El comando para convertir un <em>wav</em> a los formatos <em>mp3</em> y <em>ogg</em> comprimidos que ocupan significativamente menos sin pérdida de calidad perceptible son los siguientes. En función del formato</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ffmpeg -i voice.wav -codec:a libmp3lame voice.mp3&#10;</span></span><span class="line"><span class="cl">$ ffmpeg -i voice.wav -codec:a libvorbis voice.ogg&#10;</span></span><span class="line"><span class="cl">$ ffmpeg -i voice.mp3 -codec:a libvorbis voice.ogg&#10;</span></span><span class="line"><span class="cl">$ ffmpeg -i voice.mp3 -codec:a libmp3lame -b:a 128k voice.mp3</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>convert.sh</span>
    </div>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://alternativeto.net/software/from-text-to-speech/">From Text to Speech Alternatives</a></li>
<li><a href="https://en.wikipedia.org/wiki/Comparison_of_speech_synthesizers">Comparison of speech synthesizers</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/</id>
        <title>Guía de instalación de GNU/Linux para la Raspberry Pi</title>
        <updated>2021-02-12T16:00:00+01:00</updated>
        <published>2021-02-12T16:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>El propósito original del computador de pequeño tamaño Raspberry Pi es el educativo y aprendizaje de progamación e introducción a la  electrónica, sin embargo, debido a su bajo coste y ser una computador de propósito general es utilizado con otros múltiples propósitos. El primer paso para empezar a usar una Raspberry Pi es instalarle un sistema operativo, dos opciones son el ofrecido por la fundación de la Raspberry Pi o la versión ofrecida por Ubuntu.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/raspberrypi.svg" width="200" height="255" alt="Raspberry Pi" title="Raspberry Pi"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/ubuntu.svg" width="200" height="200" alt="Ubuntu" title="Ubuntu"  class=""></p>
</div>
<p>La evolución tecnológica permite desarrollar componentes electrónicos cada vez más pequeños, más baratos y más capaces que los de la generación anterior. En ejemplo de esto es la <a href="https://www.raspberrypi.org/">Raspberry Pi</a>, una computadora del tamaño de una tarjeta de crédito pero con las características de una computadora de gama baja, aún así suficiente para múltiples propósitos.</p>
<p>Y es que aunque la Raspberry Pi aún no tiene la suficiente potencia como para reemplazar una computadora de escritorio tiene una potencia significativa comparable en procesador y cantidad de memoria a las computadoras de hace una década o lustro. Es seguro que en futuras versiones de la Raspberry Pi será aún más potente y entonces sí quizá para algunos usuarios pase a ser una opción viable para convertirse en el ordenador de escritorio de uso habitual.</p>
<p>La Raspberry Pi 4 es una computadora con las siguientes <a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/specifications/">especificaciones en su cuarta versión</a>. Además, hay diferentes modelos como la Raspberry Pi 400 que está integrada con un teclado.</p>
<p>El propósito primario de la Raspberry Pi no es proporcionar a los usuarios avanzados computadoras de bajo coste, es facilitar la educación en computadoras eliminando la barrera del precio. La primera barrera era el precio, es difícil sino imposible encontrar una computadora con todas las características, de propósito general por menos de lo que cuesta comprar una RPi.</p>
<p>La Raspberry Pi no es barata, hay que tener en cuenta que además hay que comprar el dispositivo de almacenamiento y cargador de energía aparte cuando menos si no hace falta además una carcasa. El modelo con 8 GiB tiene un precio de 85 €. Un NUC de última generación puede equipar mínimo 8 GiB de memoria en los modelos más básicos y hasta 64 GiB en los más capaces siendo sus procesadores significativamente más potentes. Los NUC parten de los 120 € a los que hay que incorporarles la memoria y almacenamiento.</p>
<p>El propósito original de la Raspberry Pi es el educativo y la electrónica, en cualquier caso es capaz de utilizarse para multitud de propósitos como servidor NAS, descargas torrent, centro multimedia, servidor <a href="https://nextcloud.com/">NextCloud</a> como alternativa a las herramientas de <a href="https://www.google.es/intl/es/docs/about/">Google Docs</a> o <a href="https://www.google.com/photos/about/">Photos</a> o evitar anuncios con AdGuard, consola de juegos retro con <a href="https://retropie.org.uk/">RetroPie</a> o <a href="https://www.lakka.tv/">Lakka</a>.</p>
<p>Desde su aparición en el año 2010 han surgido <a href="https://picodotdev.github.io/blog-bitix/2018/03/7-plus-computadoras-baratas-del-tamano-de-una-tarjeta-de-credito-basadas-en-gnu-linux-y-arm/">numerosas alternativas de la Raspberry Pi</a> en formato y características similares. Algunas incluso más potentes, sin embargo, dada la popularidad de la RPi es la que mejor soporte de software ofrece y de la que hay más información en caso de buscarla.</p>
<p>La <a href="https://magpi.raspberrypi.org/">revista MagPi</a> en PDF se puede descargar de forma gratuita y contiene numerosos artículos sobre como realizar proyectos de programación y electrónica con esta computadora. También puede adquirirse en formato impreso, se solicita pagar un pequeño importe  para mantener la publicación así que si la sueles obtener todos los números considera hacer un pago de vez en cuando.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="cómo-instalar-gnulinux-en-la-raspberry-pi">Cómo instalar GNU/Linux en la Raspberry Pi</h3>
<p>Una vez en posesión de una Raspberry Pi y elementos imprescindibles, cargador de alimentación y tarjeta SD o microSD y opcionalmente teclado y monitor, el primer paso es realizar la instalación del sistema operativo. El sistema operativo oficial es <a href="https://www.raspberrypi.org/software/">Raspberry Pi OS</a>.</p>
<p>La instalación se hace en una tarjeta de memoria microSD o una memoria USB, para la instalación se requiere de otra computadora en la que utilizar la aplicación <em>Raspberry Pi Image</em> que descarga la imagen del sistema operativo y formatea la unidad de almacenamiento. Dispone de una versión para los sistemas operativos <a href="https://www.microsoft.com/es-es/windows/">Windows</a>, <a href="https://www.apple.com/macos/">macOS</a> y como aplicación <a href="https://flatpak.org/">Flatpak</a> para cualquier distribución <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a>.</p>
<p>El grabar la imagen en la tarjeta de almacenamiento conlleva la pérdida de los datos que tuviese con lo es necesario previamente haber hecho una copia de seguridad de los datos que contenga.</p>
<h4 id="raspberry-pi-os">Raspberry Pi OS</h4>
<p>El sistema operativo Raspberry Pi OS está basado en la distribución <a href="https://www.debian.org/">Debian</a>, dispone de varias versiones una con entorno gráfico de escritorio y la versión <em>Lite</em> sin entorno de escritorio.</p>
<p>Una de las ventajas de Raspberry Pi OS es que la misma imagen de la distribución sirve par cualesquiera versiones de la Raspberry Pi independientemente de las diferentes versiones que se han lanzado, incluyendo las primeras 1, 2, 3 y 4.</p>
<p>La aplicación Raspberry Pi Image es muy sencilla, basta seleccionar la versión de la Raspberry Pi OS, insertar la tarjeta SD, seleccionar la unidad de la tarjeta SD y proceder a la instalación que se completa en unos pocos minutos. En la tarjeta SD se crean dos particiones, la de arranque o <em>boot</em> y la raíz o <em>root</em>.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-1_hu7d5590c82cda5545dc8cffd0c09998f0_30691_2560x1440_fit_box_3.png" data-gallery="" title="Raspberry Pi Imager"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-1_hu7d5590c82cda5545dc8cffd0c09998f0_30691_300x200_fit_box_3.png" width="297" height="200" alt="Raspberry Pi Imager" title="Raspberry Pi Imager"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-2_hu69e5fcde9137b06559d21408fdf5d56a_86159_2560x1440_fit_box_3.png" data-gallery="" title="Raspberry Pi Imager"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-2_hu69e5fcde9137b06559d21408fdf5d56a_86159_300x200_fit_box_3.png" width="297" height="200" alt="Raspberry Pi Imager" title="Raspberry Pi Imager"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-3_huf0e1b8e24ddc7d5a25be99972d0ce44e_69685_2560x1440_fit_box_3.png" data-gallery="" title="Raspberry Pi Imager"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-3_huf0e1b8e24ddc7d5a25be99972d0ce44e_69685_300x200_fit_box_3.png" width="297" height="200" alt="Raspberry Pi Imager" title="Raspberry Pi Imager"  class="lozad "></a></p>
<figcaption>Raspberry Pi Imager</figcaption>
</figure>
</div>
<p>Una vez instalado Raspberry Pi OS basta con insertar la tarjeta SD y conectar el adaptador de corriente. Para comenzar a trabajar con ella antes del inicio se puede conectar a un monitor y un teclado. También es posible acceder a la terminal de la Raspberry Pi desde otro ordenador en la misma red con SSH sin necesidad de conectar a la RPi un teclado y monitor directamente. Para ello es necesario conocer qué dirección IP le ha asignado el <em>router</em> local mediante DHCP.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-os-boot_hud34a1a0fa270c9cf0708e62141610a08_78782_2560x1440_fit_box_3.png" data-gallery="" title="Raspberry Pi OS root"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-os-boot_hud34a1a0fa270c9cf0708e62141610a08_78782_300x200_fit_box_3.png" width="300" height="194" alt="Raspberry Pi OS root" title="Raspberry Pi OS root"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-os-root_hu341bc58c2e5d23c0ee0219b129aa316f_54029_2560x1440_fit_box_3.png" data-gallery="" title="Raspberry Pi OS boot"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-os-root_hu341bc58c2e5d23c0ee0219b129aa316f_54029_300x200_fit_box_3.png" width="300" height="194" alt="Raspberry Pi OS boot" title="Raspberry Pi OS boot"  class="lozad "></a></p>
<figcaption>Archivos de Raspberry Pi OS</figcaption>
</figure>
</div>
<p>Para activar SSH en la Raspberry Pi hay que crean un archivo de nombre ssh en la partición <em>boot</em>. Cuando se inicia la Raspberry Pi lo detecta, activa SSH y lo elimina. El usuario y contraseña por defecto son <em>pi</em> y <em>raspberry</em> respectivamente, es aconsejable eliminar este usuario o cambiar de contraseña.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>picodotdev@archlinux ~<span class="o">]</span>$ ssh pi@192.168.1.100&#10;</span></span><span class="line"><span class="cl">pi@192.168.1.100<span class="s1">&#39;s password: &#10;</span></span></span><span class="line"><span class="cl"><span class="s1">Linux raspberrypi 5.10.11+ #1399 Thu Jan 28 12:02:28 GMT 2021 armv6l&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">The programs included with the Debian GNU/Linux system are free software;&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">the exact distribution terms for each program are described in the&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">individual files in /usr/share/doc/*/copyright.&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">permitted by applicable law.&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">Last login: Sat Feb  6 18:47:28 2021 from 192.168.1.7&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">SSH is enabled and the default password for the &#39;</span>pi<span class="s1">&#39; user has not been changed.&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">This is a security risk - please login as the &#39;</span>pi<span class="s1">&#39; user and type &#39;</span>passwd<span class="err">&#39;</span> to <span class="nb">set</span> a new password.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">pi@raspberrypi:~ $</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ssh-raspberrypio-os.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo useradd -m -G adm,dialout,cdrom,sudo,audio,video,plugdev,games,users,input,netdev,gpio,i2c,spi picodotdev&#10;</span></span><span class="line"><span class="cl">$ sudo passwd picodotdev&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>create-user.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo passwd pi&#10;</span></span><span class="line"><span class="cl">$ sudo passwd picodotdev&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>change-user-password.sh</span>
    </div>
</div>
<p>Una vez con acceso a la Raspberry Pi se pueden instalar los paquetes y programas de software con el gestor de paquetes de las distribuciones basadas en Debian.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt update&#10;</span></span><span class="line"><span class="cl">$ sudo apt upgrade&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>apt-update-upgrade.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt install nginx&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>apt-install-nginx.sh</span>
    </div>
</div>
<h4 id="ubuntu-server">Ubuntu Server</h4>
<p><a href="https://www.ubuntu.com/">Ubuntu</a> también ofrece una versión de su distribución GNU/Linux para la Raspberry Pi para las versiones 2+, no soportando los primeros modelos originales de la Raspberry Pi. La versión de escritorio de Ubuntu para la Raspberry Pi requiere al menos 4 GiB y la versión RPi 4, Ubuntu Server y Ubuntu Core no incluye interfaz gráfica.</p>
<p>El proceso de instalación de Ubuntu tanto para la versión de escritorio como la para las versiones <em>Server</em> y <em>Core</em>, es posible realizarlas mediante Raspberry Pi Image. Raspberry Pi Image permite seleccionar la versión de Ubuntu y esta se encarga de descargarla e instalarla en la tarjeta microSD seleccionada.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-other_hu226fdf089178d9ceca9b56b0cd3bac00_96854_2560x1440_fit_box_3.png" data-gallery="" title="Ubuntu para la Raspberry Pi"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-other_hu226fdf089178d9ceca9b56b0cd3bac00_96854_300x200_fit_box_3.png" width="297" height="200" alt="Ubuntu para la Raspberry Pi" title="Ubuntu para la Raspberry Pi"  class="lozad "></a></p>
<figcaption>Ubuntu para la Raspberry Pi</figcaption>
</figure>
</div>
<p>El usuario y contraseña por defecto son <em>ubuntu</em> y <em>ubuntu</em> respectivamente, es aconsejable eliminar este usuario o cambiar de contraseña. Como Ubuntu también es una distribución derivada de Debian el gestor de paquetes y los comandos para instalarlos son los mismos.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt update&#10;</span></span><span class="line"><span class="cl">$ sudo apt upgrade&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>apt-update-upgrade.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt install nginx&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>apt-install-nginx.sh</span>
    </div>
</div>
<h4 id="otras-distribuciones-y-documentación">Otras distribuciones y documentación</h4>
<p>La misma Raspberry Pi Image permite instalar otras distribuciones de uso específico o paquetes como consola de juegos retro, servidor multimedia, servidor NAS, <em>proxy</em> de navegación para evitar publicidad y ser rastreado, nube de documentos personal, &hellip; Otras distribuciones también ofrecen una versión de su sistema operativo para la Raspberry como <a href="https://wiki.debian.org/RaspberryPi">Debian RPi</a> y <a href="https://archlinuxarm.org/">Arch Linux ARM</a>. Como el sistema operativo se almacena en una tarjeta de memoria o USB es fácil cambiar de una distribución a otra.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-games_huecca789fd30fabc538306ef5fcf105ab_45947_2560x1440_fit_box_3.png" data-gallery="" title="Juegos retro para la Raspberry Pi"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-games_huecca789fd30fabc538306ef5fcf105ab_45947_300x200_fit_box_3.png" width="297" height="200" alt="Juegos retro para la Raspberry Pi" title="Juegos retro para la Raspberry Pi"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-media-player_huc7d3fc32989b0d242b9bd54029b7de65_30395_2560x1440_fit_box_3.png" data-gallery="" title="Reproductor multimedia para la Raspberry Pi"><img src="https://picodotdev.github.io/blog-bitix/2021/02/guia-de-instalacion-de-gnu-linux-para-la-raspberry-pi/images/raspberrypi-imager-media-player_huc7d3fc32989b0d242b9bd54029b7de65_30395_300x200_fit_box_3.png" width="297" height="200" alt="Reproductor multimedia para la Raspberry Pi" title="Reproductor multimedia para la Raspberry Pi"  class="lozad "></a></p>
<figcaption>Otros sistemas operativos para la Raspberry Pi</figcaption>
</figure>
</div>
<p>Documentación y ayuda:</p>
<ul>
<li><a href="https://www.raspberrypi.org/software/operating-systems/">Sistemas operativos para la Raspberry Pi</a></li>
<li><a href="https://www.raspberrypi.org/documentation/">Documentación de la Raspberry Pi</a></li>
<li><a href="https://www.raspberrypi.org/help/">Ayuda para la Raspberry Pi</a></li>
<li><a href="https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up">Configuración de la Raspberry Pi</a></li>
<li><a href="https://projects.raspberrypi.org/en/projects">Proyectos de ejemplo para la Raspberry Pi</a></li>
</ul>
<p>En otros artículos he comentado como realizar algunos proyectos de electrónica con la Raspberry Pi:</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/series/electronica/">Artículos sobre la Raspberry Pi y ejemplos con electrónica</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2018/02/consola-de-juegos-retro-con-lakka-y-una-raspberry-pi/">Consola de juegos retro con Lakka y una Raspberry Pi</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/12/nube-privada-para-documentos-personales-con-nextcloud-y-onlyoffice/">Nube privada para documentos personales con Nextcloud y OnlyOffice</a></li>
</ul>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.tomshardware.com/how-to/boot-raspberry-pi-4-usb">How to Boot Raspberry Pi 4 From a USB SSD or Flash Drive</a></li>
<li><a href="https://ubuntu.com/tutorials/how-to-install-ubuntu-desktop-on-raspberry-pi-4#1-overview">How to install Ubuntu Desktop on Raspberry Pi 4</a></li>
<li><a href="https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#1-overview">How to install Ubuntu Server on your Raspberry Pi</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2021/01/que-es-la-variable-path-del-sistema-y-como-cambiarla-en-gnu-linux/</id>
        <title>Qué es la variable PATH del sistema y cómo cambiarla en GNU/Linux</title>
        <updated>2021-01-24T00:30:00+01:00</updated>
        <published>2021-01-24T00:30:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2021/01/que-es-la-variable-path-del-sistema-y-como-cambiarla-en-gnu-linux/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/linux.svg" width="200" height="232" alt="Linux" title="Linux"  class=""></p>
</div>
<p>Al ejecutar un comando en la terminal el intérprete de comandos de <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> lo busca en los directorios especificados en la variable de entorno del sistema <em>PATH</em>, esta variable de entorno contiene una lista de directorios separados por el caracter <em>:</em> en la que se busca por orden. Al instalar un paquete seguramente el programa ejecutable se instale en <em>/usr/bin</em>, directorio que por defecto está incluido en la variable <em>PATH</em>.</p>
<p>En algún caso quizá nos interese instalar un programa ejecutable propio, un caso puede ser que la distribución usada no disponga del paquete del programa o esté en una versión antigua y se desee una más nueva. Como ejemplo usando <a href="https://www.archlinux.org/">Arch Linux</a> mi caso ha sido con las herramientas de <a href="https://www.hashicorp.com/">HashiCorp</a> como <a href="https://www.consul.io/">Consul</a>, <a href="https://www.vaultproject.io/">Vault</a> y <a href="https://www.nomadproject.io/">Nomad</a> para las que de algunas no está en los repositorios oficiales sino que está en los repositorios de los usuarios AUR.</p>
<p>Las herramientas que está desarrolladas con el lenguaje <a href="https://golang.org/">Go</a> suelen un único binario que no tienen más dependencias. Basta con copiar ese binario al directorio <em>/usr/local/bin/</em> que está destinado a que los usuarios instalen sus propios binarios sin entrar en conflicto con los que los paquetes instalan. El directorio <em>/usr/local/bin/</em> es otro de los directorios incluídos en los directorios de búsqueda de la variable <em>PATH</em>.</p>
<p>Otra posibilidad es modificar la variable PATH del sistema y añadir el directorio que deseemos, por ejemplo, se puede crear el directorio <em>~/Software/bin</em>. El intérprete de comandos cuando el usuario introduce un comando lo busca en orden en los directorios especificados por la variable <em>PATH</em>, ya sea un binario o un <em>script</em> ejecutable de un intérprete de comandos como <a href="https://es.wikipedia.org/wiki/Bash">Bash</a>.</p>
<p>Este es parte del contenido de la variable <em>PATH</em> del sistema en Arch Linux (los tres puntos es contenido que he omitido). Las distribuciones GNU/Linux suelen instalar los binarios de los programa ejecutables en los directorios <em>/usr/local/sbin</em> con los binarios para el usuario <em>root</em> y <em>/usr/bin</em> es donde los paquetes ubican sus binarios y programas ejecutables. En el directorio <em>/usr/local/bin</em> el usuario puede ubicar sus propios binarios sin que entren en conflicto con los instalados por los paquetes.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="nv">$PATH</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>echo-path.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">...:/usr/local/bin:/usr/local/sbin:/usr/bin:...&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>echo-path.out</span>
    </div>
</div>
<p>Dado que el programa que manualmente se ubica en el directorio para binarios de los usuarios <em>/usr/local/bin</em> o en un directorio propio no proviene de un paquete cuando se publique una nueva versión es el usuario el que ha de actualizar a la nueva versión descargando de nuevo el binario y copiarlo de nuevo al directorio.</p>
<p>La variable <em>PATH</em> se configura en el <em>script</em> de inicialización del intérprete de comandos, el de Bash es el archivo oculto <em>.bashrc</em> ubicado en el directorio de inicio del usuario, en mi caso en <em>/home/picodotdev/.bashrc</em>. El archivo <em>.bashrc</em> sirve también para <a href="https://picodotdev.github.io/blog-bitix/2018/04/personalizar-el-prompt-del-sistema-del-interprete-de-comandos-bash/">Personalizar el prompt del sistema del intérprete de comandos Bash</a> y el caso de utilizar el sistema de control de versiones <a href="https://git-scm.com/">Git</a> para <a href="https://picodotdev.github.io/blog-bitix/2018/04/prompt-de-la-terminal-personalizado-en-carpetas-de-git-con-el-interprete-bash/">Personalizar el prompt del intérprete Bash con información de estado del repositorio git</a>.</p>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="gnu-linux"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/</id>
        <title>Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos</title>
        <updated>2020-08-14T16:00:00+02:00</updated>
        <published>2020-08-14T16:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-consul.svg" width="200" height="278" alt="HashiCorp Consul" title="HashiCorp Consul"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-vault.svg" width="200" height="286" alt="HashiCorp Vault" title="HashiCorp Vault"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-nomad.svg" width="200" height="260" alt="HashiCorp Nomad" title="HashiCorp Nomad"  class=""></p>
</div>
<p>La empresa <a href="https://www.hashicorp.com/">HashiCorp</a> cataloga las necesidades de las aplicaciones basadas en la computación en la nube u orientadas a microservicios en cuatro aspectos que necesitan: aprovisionamiento, registro y conexión, seguridad y ejecución. HashiCorp en base a estos cuatro aspectos de las aplicaciones ha desarrollado para cada una de ellas una aplicación específica integrable con las otras pero también con la posibilidad de usar cada una de forma individual e independiente que permiten disponer de un centro de datos y cubre varias de las necesidades computacionales de una empresa en entornos modernos basados en nube que son dinámicos y requieren elasticidad.</p>
<p>En muchas organizaciones los desarrolladores solo se encargan del desarrollo de la aplicación o servicio, del despliegue y administración se encargan los administradores de sistemas. Los centros de datos se operan en base a peticiones entre los desarrolladores y los administradores de sistemas, este modelo organización es lento y propenso a ineficiencias, para evitarlo hay que tratar que los desarrolladores sean lo más autosuficientes posible para operar el entorno de ejecución de sus servicios haciendo que estos no solo desarrollen sus aplicaciones sino que también tengan capacidad de desplegarlas y monitorizarlas.</p>
<p>En este artículo muestro un ejemplo usando tres de estos mismos productos que se usarían en un entorno de producción <a href="https://www.consul.io/">Consul</a> para el registro de servicios y conexión de forma segura, <a href="https://www.vaultproject.io/">Vault</a> para seguridad y servicios de cifrado y <a href="https://www.nomadproject.io/">Nomad</a> para la ejecución de servicios con contenedores <a href="https://www.docker.com/">Docker</a>. Para el aprovisionamiento y ejecutar el ejemplo en la propia máquina el ejemplo usa <a href="https://www.vagrantup.com/">Vagrant</a> que permite crear y aprovisionar máquinas virtuales sobre <a href="https://www.virtualbox.org/">VirtualBox</a>, en un entorno basado en la nube se usaría <a href="https://www.terraform.io/">Terraform</a>. Consul, Vault y Nomad forman lo que sería un centro de datos de un entorno de ejecución para aplicaciones y servicios.</p>
<p><a href="https://github.com/servian/hashiqube/">HashiQube</a> proporciona un entorno para hacer pruebas de desarrollo con todas las herramientas de HashiCorp, pero no es utilizable en un entorno de producción. Para construir un entorno con grado de producción hay que leer mucha de la buena documentación que ofrece HashiCorp de sus productos. Los productos de HashiCorp tienen una buena documentación en formato guía y tutoriales divididos en secciones individuales sobre un tema en concreto.</p>
<ul>
<li><a href="https://learn.hashicorp.com/consul">Tutorial</a> y <a href="https://www.consul.io/docs/index.html">documentación</a> de Consul</li>
<li><a href="https://learn.hashicorp.com/vault">Tutorial</a> y <a href="https://www.vaultproject.io/docs">documentación</a>  de Vault</li>
<li><a href="https://learn.hashicorp.com/nomad">Tutorial</a> y <a href="https://www.nomadproject.io/docs/index.html">documentación</a> de Nomad</li>
<li><a href="https://learn.hashicorp.com/terraform">Totorial</a> y <a href="https://www.terraform.io/docs/index.html">documentación</a> de Terraform</li>
<li><a href="https://www.vagrantup.com/docs">Documentación de Vagrant</a> y <a href="https://www.packer.io/docs">documentación de Packer</a></li>
<li><a href="https://www.youtube.com/c/HashiCorp/">Canal de YouTube de HashiCorp</a></li>
</ul>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-static-dynamic_hu67ee66e9105feacc23ca157c69e694b7_274544_2560x1440_fit_box_3.png" data-gallery="" title="Diferencias entre entornos estáticos anteriores y dinámicos nuevos"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-static-dynamic_hu67ee66e9105feacc23ca157c69e694b7_274544_650x450_fit_box_3.png" width="650" height="285" alt="Diferencias entre entornos estáticos anteriores y dinámicos nuevos" title="Diferencias entre entornos estáticos anteriores y dinámicos nuevos"  class="lozad "></a></p>
<figcaption>Diferencias entre entornos estáticos anteriores y dinámicos nuevos</figcaption>
</figure>
</div>
<p>Este artículo hace uso, está relacionado y se complementa con otros artículos que muestran varias de las funcionalidades individuales utilizadas en el ejemplo.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/05/crear-de-forma-sencilla-y-rapida-maquinas-virtuales-de-virtualbox-con-vagrant/">Crear de forma sencilla y rápida máquinas virtuales de VirtualBox con Vagrant</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">Configurar HTTP/2 en Nginx, Apache HTTPD, WildFly o Jetty</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/08/configurar-autenticacion-basica-en-los-servidores-web-nginx-y-apache/">Configurar autenticación básica en los servidores web Nginx y Apache</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/">Cómo crear un proxy inverso entre el servidor web Nginx y un servidor de aplicaciones Java</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/">Comandos para crear una autoridad de certificación (CA) con OpenSSL</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/">Comunicaciones seguras, autenticación mutua y autorizaciones con intenciones entre servicios usando Consul Connect y Nomad</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/10/microservicios-con-spring-cloud-consul-nomad-y-traefik/">Microservicios con Spring Cloud, Consul, Nomad y Traefik</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/07/obtener-un-nombre-de-dominio-para-una-direccion-ip-privada/">Obtener un nombre de dominio para una dirección IP privada</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/">Introducción a Nomad para gestionar aplicaciones y microservicios</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/">Estrategias de despliegue para microservicios con Nomad</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/07/administrar-secretos-y-proteger-datos-sensibles-con-vault/">Administrar secretos y proteger datos sensibles con Vault</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/08/generar-credenciales-de-conexion-a-base-de-datos-bajo-demanda-con-vault/">Generar credenciales de conexión a base de datos bajo demanda con Vault</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/08/utilizar-credenciales-de-conexion-a-la-base-de-datos-generadas-por-vault-en-una-aplicacion-de-spring/">Utilizar credenciales de conexión a la base de datos generadas por Vault en una aplicación de Spring</a></li>
</ul>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="servicios-de-hashicorp">Servicios de HashiCorp</h3>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-1_hucb41f3f4a0c4e341c8fa5add26daf72f_433163_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-1_hucb41f3f4a0c4e341c8fa5add26daf72f_433163_200x150_fit_box_3.png" width="200" height="103" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_200x150_fit_box_3.png" width="200" height="117" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_200x150_fit_box_3.png" width="200" height="117" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class="lozad "></a></p>
<figcaption>Productos de HashiCorp</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-consul-before-after_huda1232b206f99140993a7a4fc131887b_205943_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Consul"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-consul-before-after_huda1232b206f99140993a7a4fc131887b_205943_200x150_fit_box_3.png" width="200" height="135" alt="Antes y después con Consul" title="Antes y después con Consul"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-vault-before-after_hu4179baf61d235b37bc3c87f7b3fc2feb_126149_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Vault"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-vault-before-after_hu4179baf61d235b37bc3c87f7b3fc2feb_126149_200x150_fit_box_3.png" width="200" height="140" alt="Antes y después con Vault" title="Antes y después con Vault"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-nomad-before-after_hu6c36a4999c82fd8d966d5a10a753b488_178820_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-nomad-before-after_hu6c36a4999c82fd8d966d5a10a753b488_178820_200x150_fit_box_3.png" width="192" height="150" alt="Antes y después con Nomad" title="Antes y después con Nomad"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Terraform"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_200x150_fit_box_3.png" width="164" height="150" alt="Antes y después con Terraform" title="Antes y después con Terraform"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_2560x1440_fit_box_3.png" data-gallery="" title="Ecosistema con Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_200x150_fit_box_3.png" width="164" height="150" alt="Ecosistema con Nomad" title="Ecosistema con Nomad"  class="lozad "></a></p>
<figcaption>Ecosistema con Nomad</figcaption>
</figure>
</div>
<h4 id="consul">Consul</h4>
<p>En una aplicación basada en servicios a lo largo del tiempo estos se añaden y se eliminan, varía el número de instancias, cambian de ubicación, pueden dejar de estar accesibles de forma inesperada y los servicios necesitan comunicarse de forma segura.</p>
<p>La herramienta Consul proporciona proporcionan funcionalidades para todas estas necesidades con un registro de registro y descubrimiento que mantiene el catálogo de servicios e instancias con su ubicación, proporciona comprobaciones de estado o <em>health checks</em> para conocer en todo momento que las instancias están funcionado correctamente, proporciona comunicaciones seguras entre los servicios con <a href="https://www.consul.io/docs/connect">Consul Connect</a> y permite o deniega la comunicación con intenciones y basándose en la identidad de los servicios.</p>
<p>El catálogo de servicios es accesible mediante una API REST, también ofrece su catálogo de servicios a través de una interfaz DNS ya que incorpora la funcionalidad de servidor DNS. Consul además proporciona un almacén de clave/valor que los servicios pueden utilizar como valores de configuración que cambian de forma dinámica sin necesidad de reiniciar las instancias del servicio para que los nuevos valores surtan efecto.</p>
<h4 id="vault">Vault</h4>
<p>Vault proporciona servicios de seguridad. En vez de implementar las necesidades de seguridad en cada aplicación con el lenguaje de programación en el que esté desarrollado Vault permite delegar y centralizar en él los requerimientos y políticas de seguridad.</p>
<p>Proporciona funcionalidades de cifrado y descifrado, cifrado y descifrado conservando el formato y enmascaramiento basado en políticas. También permite generar certificados con un tiempo de expiración pequeño y generación de credenciales dinámicas, esto es, en vez de generar unas credenciales de conexión para cada aplicación a una base de datos la aplicación puede solicitar a Vault unas credenciales de conexión para la base de datos que únicamente son válidas mientras la aplicación necesita la conexión. Las credenciales dinámicas permiten aumentar la seguridad.</p>
<h4 id="nomad">Nomad</h4>
<p>Los servicios necesitan ejecutarse y crear instancias para proporcionar sus funcionalidades, Nomad hace las funciones de orquestador de servicios. Se encarga de planificar el nodo de entre los disponibles en los que se ejecutara cada instancia del servicio, de mantener el número de instancias indicadas en la descripción de cada servicio y de aplicar la estrategia de despliegue según la política definida para cada servicio, como <em>blue/green</em> o <em>canary</em>.</p>
<p>Nomad se integra con Consul y permite que al iniciar la instancia de un servicio se registre en Consul y configurar un <em>health check</em> para que Consul monitorice el estado de la instancia del servicio.</p>
<h4 id="vagrant-y-terraform">Vagrant y Terraform</h4>
<p>Para automatizar la creación de los entornos, crear los entornos como código y que estos queden descritos en archivos se utilizan herramientas de aprovisionamiento. HashiCorp proporciona dos, una es Vagrant para crear máquinas virtuales en local con VirtualBox para un entorno de desarrollo. Para un entorno de producción se usará un proveedor de computación en la nube como <a href="https://aws.amazon.com/es/">Amazon Web Services</a>, <a href="https://cloud.google.com/">Google Cloud Platform</a>, <a href="https://azure.microsoft.com/es-es/">Microsoft Azure</a> u otros como <a href="https://www.digitalocean.com/">Digital Ocean</a> o <a href="https://www.linode.com/">Linode</a>.</p>
<p>Cada uno de estos entornos de computación tiene sus peculiaridades, Terraform permite describir las necesidades de sistemas en cuanto a infraestructura del entorno de ejecución de forma independiente a cada uno de estos proveedores, automatizar el aprovisionamiento y definir la infraestructura como código lo que permite guardar en un repositorio de control de versiones los cambios que se realizan a la infraestructura.</p>
<h4 id="packer">Packer</h4>
<p>La herramienta Packer permite construir las imágenes base para los sistemas en la nube y de los contenedores. Es agnóstica de los diferentes sistemas en la nube permitiendo construir imágenes para cada una de ellas, esto permite no estar encadenado a un proveedor determinado.</p>
<h3 id="comparación-con-kubernetes">Comparación con Kubernetes</h3>
<p><a href="https://kubernetes.io/">Kubernetes</a> es otro sistema con la funcionalidad de orquestador de contenedores desarrollado originalmente por Google y al que ahora contribuyen numerosas empresas como  <a href="https://www.redhat.com/es">Red Hat</a>. Proporciona todas las características que necesitan las aplicaciones basadas en contenedores incluyendo gestión del clúster, planificación, descubrimiento de servicios, monitorización, gestión de secretos y otros más.</p>
<p>HashiCorp proporciona la mayoría de las funcionalidades de Kubernetes en cada una de las diferentes herramientas que tiene siguiendo la filosofía Unix de herramientas con un ámbito reducido y agregables, por ejemplo, Consul proporciona descubrimiento de servicios, Vault seguridad y Nomad está diseñado específicamente para proporcionar gestión del cluster y planificación.</p>
<p>Kubernetes se centra en Docker mientras que Nomad soporta aplicaciones de propósito general como pueden ser comandos del sistema, aplicaciones Java, Docker o <a href="https://podman.io/">Podman</a>. Kubernetes está diseñado como una colección de más de media docena de servicios que interoperan para proporcionar la funcionalidad completa. Soporta alta disponibilidad pero operacionalmente es complejo de configurar.</p>
<p>La arquitectura de las herramientas de HashiCorp  es más simple, cada  una de las herramientas es un único binario que sirve tanto para actuar como servidor como cliente y que se pueden utilizar sin requerir al resto, tanto es así que Consul se puede utilizar y algunos lo utilizan junto a Kubernetes. Los servidores son distribuidos, con alta disponibilidad y operacionalmente más fáciles. Los servidores soportan configuraciones multicentro de datos y multiregión llegando a tamaños que superan los 10K nodos en entornos de producción.</p>
<ul>
<li><a href="https://www.nomadproject.io/intro/vs/kubernetes.html">Nomad vs Kubernetes</a></li>
<li><a href="https://www.consul.io/intro/vs">Consul vs. Other Software</a></li>
</ul>
<h3 id="arquitectura-de-referencia">Arquitectura de referencia</h3>
<p>En una arquitectura de referencia para proporcionar alta disponibilidad y tolerancia a fallos es necesario crear varias instancias de cada servicio. Las diferentes instancias de Consul, Vault y Nomad forman un clúster algunas funcionando en modo servidor y otras funcionando en modo cliente. Para los servidores de Consul, Vault y Nomad se recomiendan al menos 3 instancias de cada uno de ellos, en total 9 instancias. En cada instancia de Vault y Nomad se crea un agente de Consul que actúa en modo cliente que atiende a las peticiones de forma local y realiza las comunicaciones con los servidores de Consul. De Nomad habrá varias instancias adicionales más actuando en modo cliente que serán donde se ejecuten las instancias de los servicios de aplicación como un un contenedor Docker con Nginx, una base de datos <a href="https://www.postgresql.org/">PostgresQL</a> o una aplicación Java con <a href="https://projects.spring.io/spring-boot/">Spring Boot</a>.</p>
<p>En total un centro de datos para un entorno puede estar compuesto como mínimo entre 9, 15 o 21 para el clúster con 3, 5, 7 servidores de Consul, Vault y Nomad según las necesidades de computación del centro de datos. De Nomad en modo cliente donde se ejecutan los servicios el número de instancias variará según las necesidades de computación y número de servicios que necesitan las aplicaciones, también puede ser un número significativo de entre 10 a 100 o más instancias. El número de máquinas e instancias es elevado por eso hay que tratarlas como ganado y no como animales de compañía que requieran administrarlas de forma individual.</p>
<ul>
<li><a href="https://learn.hashicorp.com/tutorials/consul/reference-architecture">Consul Reference Architecture</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/vault/reference-architecture">Vault Reference Architecture</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/nomad/production-reference-architecture-vm-with-consul">Nomad Reference Architecture</a></li>
</ul>
<p>Estos son los esquemas de las arquitecturas de referencia de Consul, Vault y Nomad para configuraciones de producción formado por varios servidores, clientes y regiones o centros de datos.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Consul"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_200x150_fit_box_3.png" width="145" height="150" alt="Arquitectura de referencia de Consul" title="Arquitectura de referencia de Consul"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-reference-architecture_hub96d9a47201c2cff1173d26e179d39dc_82391_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Vault"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-reference-architecture_hub96d9a47201c2cff1173d26e179d39dc_82391_200x150_fit_box_3.png" width="200" height="148" alt="Arquitectura de referencia de Vault" title="Arquitectura de referencia de Vault"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-reference-architecture_hue8f6b812b8cda77506103d14e4ef96ee_43308_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-reference-architecture_hue8f6b812b8cda77506103d14e4ef96ee_43308_200x150_fit_box_3.png" width="200" height="141" alt="Arquitectura de referencia de Nomad" title="Arquitectura de referencia de Nomad"  class="lozad "></a></p>
<figcaption>Arquitecturas de referencia de Consul, Vault y Nomad</figcaption>
</figure>
</div>
<h4 id="precio">Precio</h4>
<p>Dependiendo del tamaño de las máquinas de cómputo elegidas para cada instancia el coste de la infraestructura varia. En AWS una instancia <em>t3a.medium</em>, <em>t3a.large</em> y <em>t3a.xlarge</em> con 4, 8 y 16 GiB tienen un coste aproximado de $125, $250 y $400 al año si se paga por adelantado una reserva de 3 años. Multiplicado esto por el número de instancias el coste no es despreciable pero asequible para una empresa que llega a necesitar 100 instancias para sus servicios. La ventaja de la computación en la nube y estas herramientas de HashiCorp es que permiten adaptar el entorno del centro de datos a las necesidades suficientes para cada momento, si se necesitan más máquinas e instancias se añaden si dejan de necesitar se eliminan, esta la elasticidad ofrecida por la computación en la nube que los costes sean únicamente los necesarios.</p>
<p>Es difícil calcular el coste exacto de un centro de datos ya que tendrá una mezcla de diferentes tipos de instancias, instancias reservadas y bajo demanda aprovechando la elasticidad de la computación en la nube, también hay que tener en cuanta que una organización necesitará entornos de pruebas aún siendo de menor tamaño y número que el de producción. El mayor coste lo determina el número de nodos de Nomad, para 50 nodos estarán sobre los $20K y para 1000 los $400K anuales teniendo en cuenta que una empresa que necesita esas cantidades de nodos ya son muy grandes seguramente sean del tamaño multinacionales con facturaciones de varios cientos o miles de millones.</p>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="4">Coste anual por instancia reservada durante 3 años (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo instancia</th>
       <th width="100px">Cores</th>
       <th width="100px">Memoria (GiB)</th>
       <th width="200px">Precio/año (reserva 3 años)</th>
     </tr>
   </thead>
   <tbody>
       <tr>
           <td>t3a.medium</td>
           <td>2</td>
           <td>4</td>
           <td>$125</td>
       </tr>
       <tr>
           <td>t3a.large</td>
           <td>2</td>
           <td>8</td>
           <td>$250</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>4</td>
           <td>16</td>
           <td>$400</td>
       </tr>
   </tbody>
</table>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="4">Coste anual del clúster de servidores Consul, Nomad y Vault con diferente número de instancias (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo</th>
       <th width="100px">Número de instancias</th>
       <th width="200px">Precio/año (reserva 3 años)</th>
     </tr>
   </thead>
   <tbody>
       <tr>
           <td>t3a.xlarge</td>
           <td>3 (1x3)</td>
           <td>$1200</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>9 (3x3)</td>
           <td>$3600</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>15 (5x3)</td>
           <td>$6000</td>
       </tr>
   </tbody>
</table>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="7">Coste anual nodos Nomad con diferente número de instancias (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo</th>
       <th width="100px">10</th>
       <th width="100px">50</th>
       <th width="100px">100</th>
       <th width="100px">300</th>
       <th width="100px">1000</th>
     </tr>
   </thead>
       <tr>
           <td>t3a.medium</td>
           <td>$1.25K</td>
           <td>$6.25K</td>
           <td>$12.5K</td>
           <td>$37.5K</td>
           <td>$125K</td>
       </tr>
       <tr>
           <td>t3a.large</td>
           <td>$2.5K</td>
           <td>$12.5K</td>
           <td>$25K</td>
           <td>$75K</td>
           <td>$250K</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>$4K</td>
           <td>$20K</td>
           <td>$40K</td>
           <td>$120K</td>
           <td>$400K</td>
       </tr>
   </tbody>
</table>
<h3 id="ejemplo-de-la-arquitectura-de-referencia-con-vagrant">Ejemplo de la arquitectura de referencia con Vagrant</h3>
<p>Para ejecutar la arquitectura de referencia en vez de crear 3 o 5 instancias de Consul, Vault y Nomad en el siguiente ejemplo se utiliza solo 1 instancia de cada uno de ellos. Para ejecutarlos en local se usa Vagrant para crear y aprovisionar las máquinas virtuales de VirtualBox.</p>
<p>Vault se comunica con Consul para utilizar el almacén de clave-valor o KV en el que Vault almacena los datos cifrados, Nomad se comunica con Vault para proporcionar a las aplicaciones algunos requerimientos de seguridad y con Consul para obtener datos de su KV y proporcionarlos a las instancias de los servicios, también para registrar en Consul las instancias de los servicios y si lo utilizan proporcionales sus necesidades de comunicación con <em>Consul Connect</em>.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/virtualbox_hu7e0f4556887a85d7014492c191ac5a11_199415_2560x1440_fit_box_3.png" data-gallery="" title="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/virtualbox_hu7e0f4556887a85d7014492c191ac5a11_199415_300x250_fit_box_3.png" width="300" height="224" alt="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant" title="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant"  class="lozad "></a></p>
<figcaption>Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant</figcaption>
</figure>
</div>
<p>La comunicación entre Consul, Vault y Nomad se realiza utilizando diferentes protocolos y puertos de red, el entorno de computación como el que proporcionan los proveedores de computación en la nube no es confiable por ser compartido aún con las medidas de aislamiento de red que implementan. Para mayor seguridad Consul, Vault y Nomad permite utilizar comunicaciones cifradas para todo el tráfico de red entrante y saliente para lo que es necesario generar certificados que permitan cifrar las comunicaciones y permitan identificar tanto al servidor como al cliente con autenticación mutua basada en certificados.</p>
<p>Los certificados se generan con <a href="https://www.openssl.org/">OpenSSL</a> con una pequeña autoridad de certificación (CA) propia.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span>./ca.sh&#10;</span></span><span class="line"><span class="cl">./server-certs.sh</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>generate-certificates.sh</span>
    </div>
</div>
<p>Vault requiere una inicialización para generar un <em>token</em> raíz y hacer el <em>unseal</em>. El <em>unseal</em> es un proceso que permite desbloquear el almacén cifraddo de Vault en el que interviene una clave dividida en varias partes de las cuales un número igual o menor al total son necesarias para desbloquear Vault cuando se inicia el clúster de servidores Vault.</p>
<p>Las máquinas virtuales utilizan la distribución <a href="https://www.ubuntu.com/">Ubuntu</a> de <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> en las que se instala las herramientas de HashiCorp para los servidores y adicionalmente Docker en las instancia cliente de Nomad. En la instancia que da acceso a las consolas web de administración se instala el servidor web Nginx que hace de <em>proxy</em> con el servidor de Consul, Vault y Nomad. El aprovisionamiento de las maquinas se realiza con varios <em>scripts</em> de <em>bash</em> que contienen los comandos necesarios para instalar los paquetes, realizar la misma configuración que se realizaría de forma manual desde una terminal y copiar los archivos de configuración y certificados desde la máquina anfitrión a las máquinas virtuales.</p>
<p>Dado que el ejemplo aún con el mínimo número de máquinas virtuales necesarias requiere varias es necesario una máquina <em>host</em> tenga entre 8 y 16 GiB de memoria RAM como mínimo, se puede ajustar la cantidad de memoria que usa cada máquina virtual en el archivo de configuración de Vagrant.</p>
<p>El ejemplo consta de las siguientes máquinas virtuales.</p>
<ul>
<li>1 máquina virtual servidor Consul, <em>nomad-server-1</em>.</li>
<li>1 máquina virtual servidor Vault, <em>vault-server-1</em>.</li>
<li>1 máquina virtual servidor Nomad, <em>nomad-server-1</em>.</li>
<li>1 máquina virtual cliente Nomad, <em>nomad-agent-1</em>.</li>
<li>1 máquina virtual con Nginx como <em>proxy</em> a consolas de administración web Consul, Vault, Nomad, <em>ui-server</em>.</li>
</ul>
<p>Estos son los <em>scripts</em> de aprovisionamiento con sus funciones:</p>
<ul>
<li><em>hashicorp_role_script</em>: instala los binarios de Consul, Vault, Nomad, Envoy para Consul Connect y los <em>cni-plugins</em>.</li>
<li><em>docker_role_script</em>: instala Docker.</li>
<li><em>nginx_role_script</em>: instala Nginx.</li>
<li><em>consul_dns_server_role_script</em>: redirige las consultas DNS del puerto 53 al puerto 8600 e instala <em>iptables-persistent</em>. Esto permite ejecutar Consul sin requerir permisos de administrador requeridos para abrir un puerto privilegiado como el 53.</li>
<li><em>create_provision_directories_script</em>: inicializa los directorios de aprovisionamiento en la máquina virtual.</li>
<li><em>consul_provision_script</em>, <em>vault_provision_script</em>, <em>nomad_provision_script</em>, <em>ui_server_provision_script</em>: aprovisionan los archivos de configuración de la máquina anfitrión a las máquinas virtuales en los directorios apropiados.</li>
<li><em>vault_configure_script</em>, <em>nomad_configure_script</em>: realizan la configuración de los servidores Vault y Nomad.</li>
<li><em>consul_services_script</em>, <em>vault_services_script</em>, <em>nomad_services_script</em>, <em>ui_server_services_script</em>, <em>docker_services_script</em>: inician los servicios de <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a>.</li>
</ul>
<p>Consul tiene la función de servidor DNS con el catálogo de servicios registrados. Para dar acceso a las máquinas virtuales al servidor de nombres DNS de Consul es necesario redirigir el tráfico del puerto 53 al puerto 8600 y modificar el archivo <em>resolv.conf</em>. Esto requiere un poco de configuración en Ubuntu modificando <em>iptables</em> y utilizar <em>iptables-persistent</em> para que los cambios sean permanentes entre reinicios.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-dns_huac6fb6b58138cf8f40ea6c567899a579_105867_2560x1440_fit_box_3.png" data-gallery="" title="Servicio DNS de Consul accedido desde el servidor de Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-dns_huac6fb6b58138cf8f40ea6c567899a579_105867_300x250_fit_box_3.png" width="300" height="216" alt="Servicio DNS de Consul accedido desde el servidor de Nomad" title="Servicio DNS de Consul accedido desde el servidor de Nomad"  class="lozad "></a></p>
<figcaption>Servicio DNS de Consul que expone el catálogo de servicios accedido desde el servidor de Nomad</figcaption>
</figure>
</div>
<p>Este es el archivo de aprovisionamiento de Vagrant para crear las máquinas virtuales en VirtualBox. En todos los servidores no son necesarias todas las herramienta pero por simplicidad en el ejemplo se instalan, por ejemplo, en el servidor de Nomad no es necesario instalar el binario de Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span><span class="lnt">172&#10;</span><span class="lnt">173&#10;</span><span class="lnt">174&#10;</span><span class="lnt">175&#10;</span><span class="lnt">176&#10;</span><span class="lnt">177&#10;</span><span class="lnt">178&#10;</span><span class="lnt">179&#10;</span><span class="lnt">180&#10;</span><span class="lnt">181&#10;</span><span class="lnt">182&#10;</span><span class="lnt">183&#10;</span><span class="lnt">184&#10;</span><span class="lnt">185&#10;</span><span class="lnt">186&#10;</span><span class="lnt">187&#10;</span><span class="lnt">188&#10;</span><span class="lnt">189&#10;</span><span class="lnt">190&#10;</span><span class="lnt">191&#10;</span><span class="lnt">192&#10;</span><span class="lnt">193&#10;</span><span class="lnt">194&#10;</span><span class="lnt">195&#10;</span><span class="lnt">196&#10;</span><span class="lnt">197&#10;</span><span class="lnt">198&#10;</span><span class="lnt">199&#10;</span><span class="lnt">200&#10;</span><span class="lnt">201&#10;</span><span class="lnt">202&#10;</span><span class="lnt">203&#10;</span><span class="lnt">204&#10;</span><span class="lnt">205&#10;</span><span class="lnt">206&#10;</span><span class="lnt">207&#10;</span><span class="lnt">208&#10;</span><span class="lnt">209&#10;</span><span class="lnt">210&#10;</span><span class="lnt">211&#10;</span><span class="lnt">212&#10;</span><span class="lnt">213&#10;</span><span class="lnt">214&#10;</span><span class="lnt">215&#10;</span><span class="lnt">216&#10;</span><span class="lnt">217&#10;</span><span class="lnt">218&#10;</span><span class="lnt">219&#10;</span><span class="lnt">220&#10;</span><span class="lnt">221&#10;</span><span class="lnt">222&#10;</span><span class="lnt">223&#10;</span><span class="lnt">224&#10;</span><span class="lnt">225&#10;</span><span class="lnt">226&#10;</span><span class="lnt">227&#10;</span><span class="lnt">228&#10;</span><span class="lnt">229&#10;</span><span class="lnt">230&#10;</span><span class="lnt">231&#10;</span><span class="lnt">232&#10;</span><span class="lnt">233&#10;</span><span class="lnt">234&#10;</span><span class="lnt">235&#10;</span><span class="lnt">236&#10;</span><span class="lnt">237&#10;</span><span class="lnt">238&#10;</span><span class="lnt">239&#10;</span><span class="lnt">240&#10;</span><span class="lnt">241&#10;</span><span class="lnt">242&#10;</span><span class="lnt">243&#10;</span><span class="lnt">244&#10;</span><span class="lnt">245&#10;</span><span class="lnt">246&#10;</span><span class="lnt">247&#10;</span><span class="lnt">248&#10;</span><span class="lnt">249&#10;</span><span class="lnt">250&#10;</span><span class="lnt">251&#10;</span><span class="lnt">252&#10;</span><span class="lnt">253&#10;</span><span class="lnt">254&#10;</span><span class="lnt">255&#10;</span><span class="lnt">256&#10;</span><span class="lnt">257&#10;</span><span class="lnt">258&#10;</span><span class="lnt">259&#10;</span><span class="lnt">260&#10;</span><span class="lnt">261&#10;</span><span class="lnt">262&#10;</span><span class="lnt">263&#10;</span><span class="lnt">264&#10;</span><span class="lnt">265&#10;</span><span class="lnt">266&#10;</span><span class="lnt">267&#10;</span><span class="lnt">268&#10;</span><span class="lnt">269&#10;</span><span class="lnt">270&#10;</span><span class="lnt">271&#10;</span><span class="lnt">272&#10;</span><span class="lnt">273&#10;</span><span class="lnt">274&#10;</span><span class="lnt">275&#10;</span><span class="lnt">276&#10;</span><span class="lnt">277&#10;</span><span class="lnt">278&#10;</span><span class="lnt">279&#10;</span><span class="lnt">280&#10;</span><span class="lnt">281&#10;</span><span class="lnt">282&#10;</span><span class="lnt">283&#10;</span><span class="lnt">284&#10;</span><span class="lnt">285&#10;</span><span class="lnt">286&#10;</span><span class="lnt">287&#10;</span><span class="lnt">288&#10;</span><span class="lnt">289&#10;</span><span class="lnt">290&#10;</span><span class="lnt">291&#10;</span><span class="lnt">292&#10;</span><span class="lnt">293&#10;</span><span class="lnt">294&#10;</span><span class="lnt">295&#10;</span><span class="lnt">296&#10;</span><span class="lnt">297&#10;</span><span class="lnt">298&#10;</span><span class="lnt">299&#10;</span><span class="lnt">300&#10;</span><span class="lnt">301&#10;</span><span class="lnt">302&#10;</span><span class="lnt">303&#10;</span><span class="lnt">304&#10;</span><span class="lnt">305&#10;</span><span class="lnt">306&#10;</span><span class="lnt">307&#10;</span><span class="lnt">308&#10;</span><span class="lnt">309&#10;</span><span class="lnt">310&#10;</span><span class="lnt">311&#10;</span><span class="lnt">312&#10;</span><span class="lnt">313&#10;</span><span class="lnt">314&#10;</span><span class="lnt">315&#10;</span><span class="lnt">316&#10;</span><span class="lnt">317&#10;</span><span class="lnt">318&#10;</span><span class="lnt">319&#10;</span><span class="lnt">320&#10;</span><span class="lnt">321&#10;</span><span class="lnt">322&#10;</span><span class="lnt">323&#10;</span><span class="lnt">324&#10;</span><span class="lnt">325&#10;</span><span class="lnt">326&#10;</span><span class="lnt">327&#10;</span><span class="lnt">328&#10;</span><span class="lnt">329&#10;</span><span class="lnt">330&#10;</span><span class="lnt">331&#10;</span><span class="lnt">332&#10;</span><span class="lnt">333&#10;</span><span class="lnt">334&#10;</span><span class="lnt">335&#10;</span><span class="lnt">336&#10;</span><span class="lnt">337&#10;</span><span class="lnt">338&#10;</span><span class="lnt">339&#10;</span><span class="lnt">340&#10;</span><span class="lnt">341&#10;</span><span class="lnt">342&#10;</span><span class="lnt">343&#10;</span><span class="lnt">344&#10;</span><span class="lnt">345&#10;</span><span class="lnt">346&#10;</span><span class="lnt">347&#10;</span><span class="lnt">348&#10;</span><span class="lnt">349&#10;</span><span class="lnt">350&#10;</span><span class="lnt">351&#10;</span><span class="lnt">352&#10;</span><span class="lnt">353&#10;</span><span class="lnt">354&#10;</span><span class="lnt">355&#10;</span><span class="lnt">356&#10;</span><span class="lnt">357&#10;</span><span class="lnt">358&#10;</span><span class="lnt">359&#10;</span><span class="lnt">360&#10;</span><span class="lnt">361&#10;</span><span class="lnt">362&#10;</span><span class="lnt">363&#10;</span><span class="lnt">364&#10;</span><span class="lnt">365&#10;</span><span class="lnt">366&#10;</span><span class="lnt">367&#10;</span><span class="lnt">368&#10;</span><span class="lnt">369&#10;</span><span class="lnt">370&#10;</span><span class="lnt">371&#10;</span><span class="lnt">372&#10;</span><span class="lnt">373&#10;</span><span class="lnt">374&#10;</span><span class="lnt">375&#10;</span><span class="lnt">376&#10;</span><span class="lnt">377&#10;</span><span class="lnt">378&#10;</span><span class="lnt">379&#10;</span><span class="lnt">380&#10;</span><span class="lnt">381&#10;</span><span class="lnt">382&#10;</span><span class="lnt">383&#10;</span><span class="lnt">384&#10;</span><span class="lnt">385&#10;</span><span class="lnt">386&#10;</span><span class="lnt">387&#10;</span><span class="lnt">388&#10;</span><span class="lnt">389&#10;</span><span class="lnt">390&#10;</span><span class="lnt">391&#10;</span><span class="lnt">392&#10;</span><span class="lnt">393&#10;</span><span class="lnt">394&#10;</span><span class="lnt">395&#10;</span><span class="lnt">396&#10;</span><span class="lnt">397&#10;</span><span class="lnt">398&#10;</span><span class="lnt">399&#10;</span><span class="lnt">400&#10;</span><span class="lnt">401&#10;</span><span class="lnt">402&#10;</span><span class="lnt">403&#10;</span><span class="lnt">404&#10;</span><span class="lnt">405&#10;</span><span class="lnt">406&#10;</span><span class="lnt">407&#10;</span><span class="lnt">408&#10;</span><span class="lnt">409&#10;</span><span class="lnt">410&#10;</span><span class="lnt">411&#10;</span><span class="lnt">412&#10;</span><span class="lnt">413&#10;</span><span class="lnt">414&#10;</span><span class="lnt">415&#10;</span><span class="lnt">416&#10;</span><span class="lnt">417&#10;</span><span class="lnt">418&#10;</span><span class="lnt">419&#10;</span><span class="lnt">420&#10;</span><span class="lnt">421&#10;</span><span class="lnt">422&#10;</span><span class="lnt">423&#10;</span><span class="lnt">424&#10;</span><span class="lnt">425&#10;</span><span class="lnt">426&#10;</span><span class="lnt">427&#10;</span><span class="lnt">428&#10;</span><span class="lnt">429&#10;</span><span class="lnt">430&#10;</span><span class="lnt">431&#10;</span><span class="lnt">432&#10;</span><span class="lnt">433&#10;</span><span class="lnt">434&#10;</span><span class="lnt">435&#10;</span><span class="lnt">436&#10;</span><span class="lnt">437&#10;</span><span class="lnt">438&#10;</span><span class="lnt">439&#10;</span><span class="lnt">440&#10;</span><span class="lnt">441&#10;</span><span class="lnt">442&#10;</span><span class="lnt">443&#10;</span><span class="lnt">444&#10;</span><span class="lnt">445&#10;</span><span class="lnt">446&#10;</span><span class="lnt">447&#10;</span><span class="lnt">448&#10;</span><span class="lnt">449&#10;</span><span class="lnt">450&#10;</span><span class="lnt">451&#10;</span><span class="lnt">452&#10;</span><span class="lnt">453&#10;</span><span class="lnt">454&#10;</span><span class="lnt">455&#10;</span><span class="lnt">456&#10;</span><span class="lnt">457&#10;</span><span class="lnt">458&#10;</span><span class="lnt">459&#10;</span><span class="lnt">460&#10;</span><span class="lnt">461&#10;</span><span class="lnt">462&#10;</span><span class="lnt">463&#10;</span><span class="lnt">464&#10;</span><span class="lnt">465&#10;</span><span class="lnt">466&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="c1"># -*- mode: ruby -*-</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># vi: set ft=ruby :</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_ROOT_TOKEN</span> <span class="o">=</span> <span class="s2">&#34;s.ltQXU2wZeWYNSEf946CefIuG&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_UNSEAL_KEY_1</span> <span class="o">=</span> <span class="s2">&#34;GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_UNSEAL_KEY_2</span> <span class="o">=</span> <span class="s2">&#34;zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;consul-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.10&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Consul Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;consul-server/consul.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;vault-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.20&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Vault Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/vault.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/nomad-server-policy.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/nomad-server-policy.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/nomad-cluster-role.json&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/nomad-cluster-role.json&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">,</span> <span class="s2">&#34;VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_UNSEAL_KEY_1</span><span class="p">,</span> <span class="s2">&#34;VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_UNSEAL_KEY_1</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;nomad-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Nomad Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-server/nomad.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;nomad-agent-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Nomad Agent 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;2048&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$docker_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-agent/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-agent/nomad.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$docker_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;ui-server&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.50&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Web Server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;512&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nginx_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/vault.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/nomad.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/vault-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/nomad-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/ui-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/ui-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/ui-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/ui-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$ui_server_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$ui_server_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$hashicorp_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">apt</span><span class="o">.</span><span class="n">releases</span><span class="o">.</span><span class="n">hashicorp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gpg</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">repository</span> <span class="s2">&#34;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">consul</span> <span class="n">vault</span> <span class="n">nomad</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&#34;/usr/local/bin/envoy&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">getenvoy</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">cli</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">bash</span> <span class="o">-</span><span class="n">s</span> <span class="o">--</span> <span class="o">-</span><span class="n">b</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span> &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">getenvoy</span> <span class="n">run</span> <span class="ss">standard</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">15</span><span class="o">.</span><span class="mi">0</span> <span class="o">--</span> <span class="o">--</span><span class="n">version</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">getenvoy</span><span class="o">/</span><span class="n">builds</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">15</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">linux_glibc</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">envoy</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;/opt/cni/bin&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">o</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">containernetworking</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">v0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/opt/</span><span class="n">cni</span><span class="o">/</span><span class="n">bin</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">tar</span> <span class="o">-</span><span class="n">C</span> <span class="sr">/opt/</span><span class="n">cni</span><span class="o">/</span><span class="n">bin</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$docker_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">apt</span><span class="o">-</span><span class="n">transport</span><span class="o">-</span><span class="n">https</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span> <span class="n">curl</span> <span class="n">gnupg</span><span class="o">-</span><span class="n">agent</span> <span class="n">software</span><span class="o">-</span><span class="n">properties</span><span class="o">-</span><span class="n">common</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">gpg</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="s2">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">aG</span> <span class="n">docker</span> <span class="n">vagrant</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">aG</span> <span class="n">docker</span> <span class="n">nomad</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nginx_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">nginx</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_dns_server_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">PREROUTING</span> <span class="o">-</span><span class="nb">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">PREROUTING</span> <span class="o">-</span><span class="nb">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">OUTPUT</span> <span class="o">-</span><span class="n">d</span> <span class="n">localhost</span> <span class="o">-</span><span class="nb">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">OUTPUT</span> <span class="o">-</span><span class="n">d</span> <span class="n">localhost</span> <span class="o">-</span><span class="nb">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="no">DEBIAN_FRONTEND</span><span class="o">=</span><span class="n">noninteractive</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">iptables</span><span class="o">-</span><span class="n">persistent</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span><span class="o">-</span><span class="n">save</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/etc/i</span><span class="n">ptables</span><span class="o">/</span><span class="n">rules</span><span class="o">.</span><span class="n">v4</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_dns_agent_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="err">$</span><span class="p">(</span><span class="n">grep</span> <span class="o">-</span><span class="n">q</span> <span class="s2">&#34;nameserver 127.0.0.1&#34;</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^$/</span><span class="se">\\</span><span class="s2">nnameserver 127.0.0.1/g&#34;</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$create_provision_directories_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/*.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$remove_provision_directories_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/*.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^StartLimitIntervalSec=*$//g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^StartLimitIntervalSec=*$//g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^#Wants=consul.service$/Wants=consul.service/g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^#After=consul.service$/After=consul.service/g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">service</span> &#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$ui_server_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_configure_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CAPATH</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">operator</span> <span class="n">unseal</span> <span class="s2">&#34;$VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">operator</span> <span class="n">unseal</span> <span class="s2">&#34;$VAULT_UNSEAL_KEY_2&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">login</span> <span class="s2">&#34;$VAULT_ROOT_TOKEN&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">policy</span> <span class="n">write</span> <span class="n">nomad</span><span class="o">-</span><span class="n">server</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">write</span> <span class="n">auth</span><span class="o">/</span><span class="n">token</span><span class="o">/</span><span class="n">roles</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span> <span class="err">@</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_configure_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CAPATH</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"> &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">login</span> <span class="s2">&#34;$VAULT_ROOT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="no">VAULT_TOKEN</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">vault</span> <span class="n">token</span> <span class="n">create</span> <span class="o">-</span><span class="n">policy</span> <span class="n">nomad</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">period</span> <span class="mi">72</span><span class="n">h</span> <span class="o">-</span><span class="n">orphan</span> <span class="o">-</span><span class="n">field</span> <span class="n">token</span><span class="p">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/\$VAULT_TOKEN/$VAULT_TOKEN/g&#34;</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$ui_server_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$docker_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl"><span class="k">end</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Vagrantfile</span>
    </div>
</div>
<p>El comando que permite crear y aprovisionar las máquinas es el siguiente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span>vagrant up --provision&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up.sh</span>
    </div>
</div>
<p>En el primer inicio Vault requiere generar el <em>token root</em> que tiene los permisos de superusuario, también se divide una clave en varias partes de las cuales un número mínimo son necesarias para realizar la operación de <em>unseal</em>, las partes de la clave son distribuidas entre varias personas y son necesarias varias para realizar la operación <em>unseal</em>, para que la persona que genera las partes de las claves no conozca todas las partes de la clave y para transmitirlas de forma segura las partes de la clave se cifran con PGP. Para la creación del <em>token root</em> y las claves en la creación de más máquinas en vez de usar <em>vagrant-up.sh</em> hay que aprovisionar las máquinas en varios pasos.</p>
<p>Se inicializa la máquina virtual del servidor Consul, luego del servidor Vault y se genera el <em>token root</em>, se inicia sesión con el <em>token root</em> y se realiza la operación <em>unseal</em> con el número mínimo de claves necesarias para desbloquear los datos cifrados del servidor.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vagrant up --provision consul-server-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision vault-server-1&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault operator init -key-shares<span class="o">=</span><span class="m">5</span> -key-threshold<span class="o">=</span><span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Unseal Key 1: GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#10;</span></span><span class="line"><span class="cl">Unseal Key 2: zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL+B&#10;</span></span><span class="line"><span class="cl">Unseal Key 3: CZ4T0oqwLvniuufFimkpPLxSeo6nWAWpHrrJn+utDLlF&#10;</span></span><span class="line"><span class="cl">Unseal Key 4: aVkAonumA5ryLy7hpWDCG+bWb1RboxnhXfk7tvybmFpx&#10;</span></span><span class="line"><span class="cl">Unseal Key 5: a5mCVlK4E+wEtH2m7Tc+KMaXBYWVqSRv3HhmFs5yL93A&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Initial Root Token: s.ltQXU2wZeWYNSEf946CefIuG&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Vault initialized with <span class="m">5</span> key shares and a key threshold of 2. Please securely&#10;</span></span><span class="line"><span class="cl">distribute the key shares printed above. When the Vault is re-sealed,&#10;</span></span><span class="line"><span class="cl">restarted, or stopped, you must supply at least <span class="m">2</span> of these keys to unseal it&#10;</span></span><span class="line"><span class="cl">before it can start servicing requests.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Vault does not store the generated master key. Without at least <span class="m">2</span> key to&#10;</span></span><span class="line"><span class="cl">reconstruct the master key, Vault will remain permanently sealed!&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">It is possible to generate new unseal keys, provided you have a quorum of&#10;</span></span><span class="line"><span class="cl">existing unseal keys shares. See <span class="s2">&#34;vault operator rekey&#34;</span> <span class="k">for</span> more information.&#10;</span></span><span class="line"><span class="cl">$ vault status&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">Seal Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  shamir&#10;</span></span><span class="line"><span class="cl">Initialized&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Sealed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Total Shares&nbsp;&nbsp;&nbsp;&nbsp;   <span class="m">5</span>&#10;</span></span><span class="line"><span class="cl">Threshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Unseal Progress&nbsp;&nbsp;&nbsp;&nbsp;0/2&#10;</span></span><span class="line"><span class="cl">Unseal Nonce&nbsp;&nbsp;&nbsp;&nbsp;   n/a&#10;</span></span><span class="line"><span class="cl">Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.5.0&#10;</span></span><span class="line"><span class="cl">HA Enabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault operator unseal GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#10;</span></span><span class="line"><span class="cl">$ vault operator unseal zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL+B&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----&#10;</span></span><span class="line"><span class="cl">Seal Type&nbsp;&nbsp;&nbsp;&nbsp;   shamir&#10;</span></span><span class="line"><span class="cl">Initialized&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Sealed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">Total Shares&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">5</span>&#10;</span></span><span class="line"><span class="cl">Threshold&nbsp;&nbsp;&nbsp;&nbsp;   <span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.5.0&#10;</span></span><span class="line"><span class="cl">Cluster Name&nbsp;&nbsp;&nbsp;&nbsp;vault-cluster-28313ce3&#10;</span></span><span class="line"><span class="cl">Cluster ID&nbsp;&nbsp;&nbsp;&nbsp;  dcb97a2c-520c-2d41-9dc3-979b1cda5423&#10;</span></span><span class="line"><span class="cl">HA Enabled&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">HA Cluster&nbsp;&nbsp;&nbsp;&nbsp;  https://192.168.33.20:8201&#10;</span></span><span class="line"><span class="cl">HA Mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault login <span class="s2">&#34;s.ltQXU2wZeWYNSEf946CefIuG&#34;</span>&#10;</span></span><span class="line"><span class="cl">Success! You are now authenticated. The token information displayed below&#10;</span></span><span class="line"><span class="cl">is already stored in the token helper. You <span class="k">do</span> NOT need to run <span class="s2">&#34;vault login&#34;</span>&#10;</span></span><span class="line"><span class="cl">again. Future Vault requests will automatically use this token.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">token&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.ltQXU2wZeWYNSEf946CefIuG&#10;</span></span><span class="line"><span class="cl">token_accessor&nbsp;&nbsp;&nbsp;&nbsp;   l2YGtM1V4z3Sv0Gey0l646BX&#10;</span></span><span class="line"><span class="cl">token_duration&nbsp;&nbsp;&nbsp;&nbsp;   ∞&#10;</span></span><span class="line"><span class="cl">token_renewable&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">token_policies&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">[</span><span class="s2">&#34;root&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">identity_policies&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[]</span>&#10;</span></span><span class="line"><span class="cl">policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">[</span><span class="s2">&#34;root&#34;</span><span class="o">]</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up-1.sh</span>
    </div>
</div>
<p>El <em>token</em> raíz devuelto en la inicialización de Vault es necesario ponerlo en la variable <em>VAULT_ROOT_TOKEN</em> del archivo <em>Vagranfile</em> junto con 2 de las 5 claves para desellar Vault en las variables <em>VAULT_UNSEAL_KEY_1</em> y <em>VAULT_UNSEAL_KEY_2</em>. Luegos se inician y aprovisionan el resto de máquinas virtuales.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vagrant up --provision nomad-server-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision nomad-agent-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision ui-server</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up-2.sh</span>
    </div>
</div>
<p>Tanto Consul, Vault como Nomad necesitan un archivo de configuración, en él se describe las direcciones IP de los servidores en las máquinas virtuales, se usan las propiedades de configuración necesarias para que la comunicaciones estén cifradas y diferentes propiedades adicionales para configurar cada servicio servidor.</p>
<ul>
<li>El servidor Consul utiliza la dirección IP <em>192.168.33.10</em></li>
<li>El servidor Vault utiliza la dirección IP <em>192.168.33.20</em></li>
<li>El servidor Nomad utiliza la dirección IP <em>192.168.33.30</em></li>
<li>El cliente de Nomad utiliza la dirección IP <em>192.168.33.40</em></li>
<li>El servidor Nginx con las consolas de administración web utiliza la dirección IP <em>192.168.33.50</em></li>
</ul>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&#34;consul-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bootstrap_expect</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bind_addr</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.10&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/consul/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_incoming</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_outgoing</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">recursors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;8.8.8.8&#34;, &#34;8.8.4.4&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">retry_join</span> <span class="o">=</span> <span class="p">[]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">ui</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">client_addr</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">ports</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  grpc</span> <span class="o">=</span> <span class="m">8502</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="err">-</span><span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  https</span> <span class="o">=</span> <span class="m">8501</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">connect</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">auto_encrypt</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  allow_tls</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>consul-server/consul.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">ui</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">api_addr</span> <span class="o">=</span> <span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">service_registration</span> <span class="s2">&#34;consul&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  scheme</span> <span class="o">=</span> <span class="s2">&#34;https&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">storage</span> <span class="s2">&#34;consul&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  scheme</span> <span class="o">=</span> <span class="s2">&#34;https&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  path</span> <span class="o">=</span> <span class="s2">&#34;vault/&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">listener</span> <span class="s2">&#34;tcp&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/vault-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/vault-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_client_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-server/vault.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;nomad-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/nomad&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">advertise</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  serf</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  bootstrap_expect</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  encrypt</span> <span class="o">=</span><span class="n"> &#34;aUcxnl/42fcutmLyRO/TVg</span><span class="o">==</span><span class="err">&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">consul</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ssl</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  server_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  client_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">vault</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  token</span> <span class="o">=</span> <span class="s2">&#34;$VAULT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  create_from_role</span> <span class="o">=</span> <span class="s2">&#34;nomad-cluster&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>  &#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">tls</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls12&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_https_client</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-server/nomad.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;nomad-agent-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/nomad&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">advertise</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  serf</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">client</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  network_interface</span> <span class="o">=</span> <span class="s2">&#34;enp0s8&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">consul</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ssl</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  auto_advertise</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  server_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  client_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">vault</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  token</span> <span class="o">=</span> <span class="s2">&#34;$VAULT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  create_from_role</span> <span class="o">=</span> <span class="s2">&#34;nomad-cluster&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>  &#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">tls</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls12&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_https_client</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-agent/nomad.hcl</span>
    </div>
</div>
<p>Como se muestra en los esquemas de de arquitectura de referencia Vault y Nomad no se comunican directamente con los servidores Consul sino que se comunica con un cliente de Consul en la propia máquina y es el cliente de Consul el que se comunica con los servidores de Consul. Consul se instala con la función de cliente en las máquinas servidor Vault, servidor Nomad y cliente de Nomad, el archivo de configuración de Consul en modo cliente son similares a este variando la dirección IP de la interfaz de red a la que se asocian.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&#34;vault-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="kt">false</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bind_addr</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.20&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/consul/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_incoming</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_outgoing</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">recursors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;8.8.8.8&#34;, &#34;8.8.4.4&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">retry_join</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;192.168.33.10&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">ports</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  grpc</span> <span class="o">=</span> <span class="m">8502</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="err">-</span><span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  https</span> <span class="o">=</span> <span class="m">8501</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">auto_encrypt</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-server/consul-agent.hcl</span>
    </div>
</div>
<h4 id="interfaz-web-para-consul-vault-y-nomad">Interfaz web para Consul, Vault y Nomad</h4>
<p>Las consolas de administración web de Consul, Vault y Nomad están accesibles en estas direcciones URL que están protegidas por una autenticación básica, dado que el certificado de la CA no es de confianza para el navegador se muestra previamente un mensaje de advertencia. En la consola web de Consul se observan los servicios y nodos registrados registrados y su estado de salud.</p>
<ul>
<li>Dirección, usuario y contraseña de consola web Consul: <em>https://consul.192.168.33.50.xip.io</em>, <em>consul</em> y <em>consul</em>.</li>
<li>Dirección, usuario y contraseña de consola web Vault: <em>https://vault.192.168.33.50.xip.io</em>, <em>vault</em> y <em>vault</em>.</li>
<li>Dirección, usuario y contraseña de consola web Nomad: <em>https://nomad.192.168.33.50.xip.io</em>, <em>nomad</em> y <em>nomad</em>.</li>
</ul>
<p>Esta es la definición del servidor web virtual de la consola de Consul, los servidores web virtuales de Vault y Nomad son similares.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">consul.upstream</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">192.168.33.10</span><span class="p">:</span><span class="mi">8501</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span> <span class="s">consul.192.168.33.50.xip.io</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span> <span class="s">http2</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span> <span class="s">consul.192.168.33.50.xip.io</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s">certs/ui-server.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate_key</span>  <span class="s">private/ui-server.key.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_certificate</span> <span class="s">certs/consul-agent.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_certificate_key</span> <span class="s">private/consul-agent.key.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_trusted_certificate</span> <span class="s">certs/ca.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_verify</span> <span class="no">off</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_protocols</span> <span class="s">TLSv1.3</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_pass</span> <span class="s">https://consul.upstream</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="s">https</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">auth_basic</span> <span class="s">&#34;Restricted</span> <span class="s">Area&#34;</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">auth_basic_user_file</span> <span class="s">conf.d/consul-htpasswd</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ui-server/consul.conf</span>
    </div>
</div>
<p>Las consolas de administración muestran el estado de centro de datos y con todos los servicios está disponibles.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console_hucd5d737b76f12ee85ce465ae0112def7_63882_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Consul con los servicios registrados y su estado de salud"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console_hucd5d737b76f12ee85ce465ae0112def7_63882_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Consul con los servicios registrados y su estado de salud" title="Consola web de Consul con los servicios registrados y su estado de salud"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console-nodes_hu8a20f6ed6ab107f307a3ba354fd1a7b8_58226_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Consul con los nodos registrados y su estado de salud"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console-nodes_hu8a20f6ed6ab107f307a3ba354fd1a7b8_58226_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Consul con los nodos registrados y su estado de salud" title="Consola web de Consul con los nodos registrados y su estado de salud"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-console_hu47fc894059bf643b5ee1841f3679b829_45849_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Vault"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-console_hu47fc894059bf643b5ee1841f3679b829_45849_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Vault" title="Consola web de Vault"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-console_hu3baa982141d2bb7b569d1f3eab3dffb7_46853_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-console_hu3baa982141d2bb7b569d1f3eab3dffb7_46853_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Nomad" title="Consola web de Nomad"  class="lozad "></a></p>
<figcaption>Consolas web de Consul, Vault y Nomad y estados de salud de los servicios y nodos</figcaption>
</figure>
</div>
<h4 id="interfaz-de-línea-de-comandos-para-consul-vault-y-nomad">Interfaz de línea de comandos para Consul, Vault y Nomad</h4>
<p>Los mismos binarios de Consul, Vault y Nomad que tienen las funciones de servidor y cliente permiten utilizar su línea de comandos para realizar y automatizar con <em>scripts</em> las mismas acciones que se pueden hacer desde las consolas web pero la línea de comandos.</p>
<p>Dado que en el ejemplo los servidores requieren identificar al cliente es necesario configurar variables de entorno que indiquen la dirección IP del servidor y los certificados para el cifrado y autenticación. Una vez configuradas las variables de entorno se pueden lanzar comandos que permiten realizar tareas de administración para obtener información y para enviar <em>jobs</em> a Nomad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.10:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_SSL</span><span class="o">=</span><span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_SSL_VERIFY</span><span class="o">=</span><span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.30:4646&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>environment.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ consul members&#10;</span></span><span class="line"><span class="cl">Node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Status  Type&nbsp;&nbsp;&nbsp;&nbsp;Build  Protocol  DC   Segment&#10;</span></span><span class="line"><span class="cl">consul-server-1  192.168.33.10:8301  alive   server  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;all&gt;&#10;</span></span><span class="line"><span class="cl">nomad-agent-1&nbsp;&nbsp;&nbsp;&nbsp;192.168.33.40:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">nomad-server-1   192.168.33.30:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">ui-server-1&nbsp;&nbsp;&nbsp;&nbsp;  192.168.33.50:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">vault-server-1   192.168.33.20:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">$ consul catalog services&#10;</span></span><span class="line"><span class="cl">consul&#10;</span></span><span class="line"><span class="cl">nginx&#10;</span></span><span class="line"><span class="cl">nomad&#10;</span></span><span class="line"><span class="cl">nomad-client&#10;</span></span><span class="line"><span class="cl">vault&#10;</span></span><span class="line"><span class="cl">$ nomad server members&#10;</span></span><span class="line"><span class="cl">Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Port  Status  Leader  Protocol  Build   Datacenter  Region&#10;</span></span><span class="line"><span class="cl">nomad-server-1.global  192.168.33.30  <span class="m">4648</span>  alive   <span class="nb">true</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.12.2  dc1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; global&#10;</span></span><span class="line"><span class="cl">$ nomad node status&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DC   Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Class   Drain  Eligibility  Status&#10;</span></span><span class="line"><span class="cl">7469d6e5  dc1  nomad-agent-1  &lt;none&gt;  <span class="nb">false</span>  eligible&nbsp;&nbsp;&nbsp;&nbsp; ready&#10;</span></span><span class="line"><span class="cl">$ nomad job status&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; Priority  Status   Submit Date&#10;</span></span><span class="line"><span class="cl">nginx  service  <span class="m">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running  2020-08-14T18:25:59+02:00</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>environment-status.sh</span>
    </div>
</div>
<h4 id="ejecución-de-un-servicio">Ejecución de un servicio</h4>
<p>El siguiente es la definición de un servicio o <em>job</em> para Nomad que define un servidor Nginx ejecutado en un contenedor de Docker. Una vez Nomad lo pone en ejecución se registra en Consul de forma automática de forma que pudiera ser encontrado por otros servicios que consulten el catálogo de servicios de Consul.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">job</span> <span class="s2">&#34;nginx&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  datacenters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;dc1&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="k">group</span> <span class="s2">&#34;services&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;count</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">task</span> <span class="s2">&#34;nginx&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">config</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span> <span class="o">=</span> <span class="s2">&#34;nginx:alpine&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; network_mode</span> <span class="o">=</span> <span class="s2">&#34;bridge&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="k">port_map</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   http</span> <span class="o">=</span> <span class="m">80</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">resources</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory</span> <span class="o">=</span> <span class="m">512</span><span class="c1"> # MB&#10;</span></span></span><span class="line"><span class="cl"><span class="c1"></span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">network</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">port</span> <span class="s2">&#34;http&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static</span> <span class="o">=</span> <span class="m">8080</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">service</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port</span> <span class="o">=</span> <span class="s2">&#34;http&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">check</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  name</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s2">&#34;nginx-check&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s2">&#34;tcp&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  interval</span> <span class="o">=</span> <span class="s2">&#34;10s&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  timeout</span>  <span class="o">=</span> <span class="s2">&#34;2s&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">  }&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-agent/nginx.nomad</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">$ nomad run nomad-agent/nginx.nomad</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="err">&gt;</span> <span class="k">Monitoring</span> <span class="k">evaluation</span> <span class="s2">&#34;6332818e&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">Evaluation</span> <span class="k">triggered</span> <span class="k">by</span> <span class="k">job</span> <span class="s2">&#34;nginx&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">Evaluation</span> <span class="k">within</span> <span class="k">deployment</span><span class="err">:</span> <span class="s2">&#34;c9a44a2d&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation status changed: &#34;pending&#34; -&gt; &#34;complete&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="err">&gt;</span> <span class="k">Evaluation</span> <span class="s2">&#34;6332818e&#34; finished with status &#34;complete&#34;</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-job.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-job-status_hub8d6050723820277433dddbe7b2cbc64_53726_2560x1440_fit_box_3.png" data-gallery="" title="Estado de un job en la consola web de Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-job-status_hub8d6050723820277433dddbe7b2cbc64_53726_300x250_fit_box_3.png" width="300" height="209" alt="Estado de un job en la consola web de Nomad" title="Estado de un job en la consola web de Nomad"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nginx_hu18471b6e09c62b777f1265e24914b3e0_52377_2560x1440_fit_box_3.png" data-gallery="" title="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nginx_hu18471b6e09c62b777f1265e24914b3e0_52377_300x250_fit_box_3.png" width="300" height="209" alt="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker" title="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker"  class="lozad "></a></p>
<figcaption>Ejecución, estado de un job con un servicio de Nginx ejecutando en un contenedor de Docker en la consola web de Nomad</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-services-web_hu550da182edc89129de2577701546a57e_69257_2560x1440_fit_box_3.png" data-gallery="" title="Servicios en consul con el servicio de Nginx registrado por Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-services-web_hu550da182edc89129de2577701546a57e_69257_300x250_fit_box_3.png" width="300" height="209" alt="Servicios en consul con el servicio de Nginx registrado por Nomad" title="Servicios en consul con el servicio de Nginx registrado por Nomad"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/datacenter-commandline-information_hub36b2b3205cc19448b0ebeb7c5c066eb_95694_2560x1440_fit_box_3.png" data-gallery="" title="Información de estado del centro de datos obtenido desde la línea de comandos"><img src="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/datacenter-commandline-information_hub36b2b3205cc19448b0ebeb7c5c066eb_95694_300x250_fit_box_3.png" width="300" height="216" alt="Información de estado del centro de datos obtenido desde la línea de comandos" title="Información de estado del centro de datos obtenido desde la línea de comandos"  class="lozad "></a></p>
<figcaption>Servicios en consul con el servicio de Nginx registrado por Nomad e información de estado del centro de datos obtenido desde la línea de comandos</figcaption>
</figure>
</div>
<h3 id="requerimientos-de-operaciones">Requerimientos de operaciones</h3>
<p>Este artículo solo tiene un ejemplo básico pero que sirve como base para crear un entorno de producción real basado en las herramientas de HashiCorp.</p>
<p>Hay otras funcionalidades que un entorno real de producción requeriría, como telemetría y monitorización, cual sería el proceso para actualizar el centro de datos a nuevas versiones, aprovisionamiento con Terraform para un centro de computación proporcionado por un proveedor en la nube, utilizar un sistema de autenticación como OAuth en vez autenticación básica en la consolas de administración, quizá <a href="https://github.com/hashicorp/consul-template">consul-template</a> en algunos servicios para actualizar de forma dinámica configuraciones que tomen datos de Vault o Consul o utilizar <a href="https://traefik.io/">Traefik</a> para que haga de <em>proxy</em> de los servicios que utilicen el protocolo HTTP.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/ConsulVaultNomadDatacenter">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./vagrant-up.sh</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://linuxconfig.org/how-to-make-iptables-rules-persistent-after-reboot-on-linux">How to make iptables rules persistent after reboot on Linux</a></li>
<li><a href="https://github.com/hashicorp/consul/issues/7150">Securing Consul Web UI</a></li>
<li><a href="https://github.com/hashicorp/consul/issues/1720">Consul Web UI: Need to make it password enabled</a></li>
<li><a href="https://bugs.launchpad.net/cloud-images/&#43;bug/1829625">Vagrant box startup timeout due to no serial port</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/</id>
        <title>Comandos para crear una autoridad de certificación (CA) con OpenSSL</title>
        <updated>2020-08-07T15:00:00+02:00</updated>
        <published>2020-08-07T15:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Los certificados autofirmados no son suficientes para un entorno de producción. En producción hay que usar certificados firmados por una entidad de confianza. AWS Certificate Manager ofrece la suya pero tiene un coste elevado y los certificados de otras entidades tampoco son baratos. Para certificados de uso interno en una organización que proporcionan comunicaciones seguras OpenSSL permite con una serie de comandos crear una autoridad de certificación o CA en la que los servidores y clientes internos confíen. Las funciones de la CA incluyen crear certificados a partir de las solicitudes de los certificados para los servidores y también la revocación y renovación de certificados.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/openssl.svg" width="400" height="124" alt="OpenSSL" title="OpenSSL"  class=""></p>
</div>
<p>Para <a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">usar el protocolo seguro HTTPS en un servidor web</a> es necesario al menos <a href="https://picodotdev.github.io/blog-bitix/2014/02/generar-y-convertir-claves-y-certificados-con-openssl/">generar un certificado autofirmado</a> que incluya el dominio del sitio web. El certificado autofirmado proporciona comunicaciones seguras entre el servidor y cliente pero los clientes no lo consideran de confianza de modo que han de omitir la validación del certificado, un entorno de desarrollo o pruebas es suficiente pero en un escenario de producción para añadir más seguridad donde hay varios servidores que además requieren y validan también el certificado del cliente es necesario utilizar certificados generados por una entidad en la que se confíe, esta es la autoridad de certificación. La autoridad de certificación o CA es una entidad en la que se confía, si una CA ha firmado digitalmente un certificado esta asegura que el certificado pertenece a quien dice pertenecer. Las funciones de una CA son firmar los certificados que se le envían, de revocar los certificados cuando han sido comprometidos o de renovarlos cuando su validez expira.</p>
<p><a href="https://aws.amazon.com/es/">AWS</a> en su oferta de productos tiene <a href="https://aws.amazon.com/es/certificate-manager/">AWS Certificate Manager</a> que hace las funciones de autoridad de certificados, delega la complejidad de hacer las funciones de autoridad de certificados pero su inconveniente es que tiene el significativo precio de $400 mensuales más un pequeño coste por certificado emitido. La herramienta <a href="https://www.openssl.org/">OpenSSL</a> permite hacer las funciones de una autoridad de certificación con un conjunto de comandos.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="crear-la-clave-y-certificado-de-la-autoridad-de-certificación-raíz">Crear la clave y certificado de la autoridad de certificación raíz</h3>
<p>El certificado de una autoridad de certificación es un certificado autofirmado que se utilizar para comprobar que la firma de los certificados que emite la entidad es válida. Es necesario crear un par de claves asimétricas privada y pública y posteriormente generar su certificado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nv">CA_PATH</span><span class="o">=</span>ca&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CA_DIR</span><span class="o">=</span>.&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">INTERMEDIATE_DIR</span><span class="o">=</span>./intermediate&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">mkdir -p <span class="nv">$CA_PATH</span>/certs <span class="nv">$CA_PATH</span>/crl <span class="nv">$CA_PATH</span>/newcerts <span class="nv">$CA_PATH</span>/private <span class="nv">$CA_PATH</span>/intermediate/&#10;</span></span><span class="line"><span class="cl">cp openssl/ca/openssl*.conf <span class="nv">$CA_PATH</span>/&#10;</span></span><span class="line"><span class="cl">cp openssl/intermediate/openssl*.conf <span class="nv">$CA_PATH</span>/intermediate/&#10;</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$CA_PATH</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">chmod <span class="m">700</span> private&#10;</span></span><span class="line"><span class="cl">touch index.txt&#10;</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">1000</span> &gt; serial&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># CA</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">openssl genrsa -out private/ca.key.pem <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">chmod <span class="m">400</span> private/ca.key.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-root-1.sh</span>
    </div>
</div>
<p>El certificado de la CA raíz es simplemente un certificado autofirmado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -config openssl.conf <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -key private/ca.key.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -new -x509 -days <span class="m">7300</span> -sha256 -extensions v3_ca <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -subj <span class="s2">&#34;/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Acme S.A (CA)&#34;</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -out certs/ca.cert.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-root-2.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/archivos-ca_hu33cc35349f9d029cdda225fd09a64c32_41594_2560x1440_fit_box_3.png" data-gallery="" title="Archivos y directorios de la autoridad de certificación con OpenSSL"><img src="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/archivos-ca_hu33cc35349f9d029cdda225fd09a64c32_41594_300x250_fit_box_3.png" width="300" height="202" alt="Archivos y directorios de la autoridad de certificación con OpenSSL" title="Archivos y directorios de la autoridad de certificación con OpenSSL"  class="lozad "></a></p>
<figcaption>Archivos y directorios de la autoridad de certificación con OpenSSL</figcaption>
</figure>
</div>
<p>Al crear el certificado se utiliza un archivo de configuración donde se guardan las opciones por defecto de configuración que determinan varios aspectos de OpenSSL como directorios, políticas, fecha de validez de los certificados emitidos, campos de los certificados que emite o perfiles de firma entre algunos otros.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="c1"># OpenSSL root CA configuration file.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Copy to `/root/ca/openssl.cnf`.</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># `man ca`</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_ca</span> <span class="o">=</span> <span class="s">CA_default</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ CA_default ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Directory and file locations.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$ENV::CA_DIR</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/certs</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl_dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/crl</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">new_certs_dir</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/newcerts</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">database</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">$dir/index.txt</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">serial</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">$dir/serial</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">RANDFILE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">$dir/private/.rand</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">copy_extensions</span>   <span class="o">=</span> <span class="s">none</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># The root key and root certificate.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">private_key</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/private/ca.key.pem</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/certs/ca.cert.pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># For certificate revocation lists.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crlnumber</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/crlnumber</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/crl/ca.crl.pem</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl_extensions</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">crl_ext</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_crl_days</span>  <span class="o">=</span> <span class="s">30</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># SHA-1 is deprecated, so use SHA-2 instead.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_md</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">sha256</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="na">name_opt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">ca_default</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">cert_opt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">ca_default</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_days</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">1825</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">preserve</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">no</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">policy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">policy_strict</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ policy_strict ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># The root CA should only sign intermediate certificates that match.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See the POLICY FORMAT section of `man ca`.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>  <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">supplied</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ policy_loose ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Allow the intermediate CA to sign a more diverse range of certificates.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See the POLICY FORMAT section of the `ca` man page.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>  <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">supplied</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Options for the `req` tool (`man req`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">8192</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span>  <span class="o">=</span> <span class="s">req_distinguished_name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">string_mask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">utf8only</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># SHA-1 is deprecated, so use SHA-2 instead.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_md</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">sha256</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension to add when the -x509 option is used.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">x509_extensions</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">v3_ca</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req_distinguished_name ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">Country Name (2 letter code)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">State or Province Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Locality Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">0.organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Organization Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Organizational Unit Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Common Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Email Address</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Optionally, specify some defaults.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">ES</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName_default</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">Spain</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Madrid</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">0.organizationName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName_default</span>  <span class="o">=</span> <span class="s">Acme S.A. (CA)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ v3_ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for a typical CA (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid:always,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, cRLSign, keyCertSign</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ v3_intermediate_ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for a typical intermediate CA (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid:always,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true, pathlen:0</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, cRLSign, keyCertSign</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ usr_cert ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for client certificates (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsCertType</span> <span class="o">=</span> <span class="s">client, email</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsComment</span> <span class="o">=</span> <span class="s">&#34;OpenSSL Generated Client Certificate&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, nonRepudiation, digitalSignature, keyEncipherment</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">clientAuth, emailProtection</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ server_cert ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for server certificates (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsCertType</span> <span class="o">=</span> <span class="s">server</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsComment</span> <span class="o">=</span> <span class="s">&#34;OpenSSL Generated Server Certificate&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer:always</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, keyEncipherment</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">serverAuth</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ crl_ext ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension for CRLs (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span><span class="o">=</span><span class="s">keyid:always</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ ocsp ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension for OCSP signing certificates (`man ocsp`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">critical, OCSPSigning</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca/openssl.conf</span>
    </div>
</div>
<h3 id="crear-la-clave-y-certificado-de-la-autoridad-de-certificación-intermedia">Crear la clave y certificado de la autoridad de certificación intermedia</h3>
<p>De la confianza en la CA raíz depende toda la seguridad de los certificados que emite, que su clave privada y pública o certificado sean comprometidos es posiblemente lo peor que le puede ocurrir a una CA. Para minimizar el riesgo se intenta hacer el menor uso posible de la clave privada y pública de la autoridad de certificación raíz, para esto se suele crear una autoridad de certificación intermedia que es la que realmente firma, revoca y renueva los certificados para el servidor, clientes o usuarios. Si la CA intermedia es comprometida aún siendo también un problema grave de seguridad al menos la CA raíz puede crear una nueva CA intermedia en la que se pueda confiar.</p>
<p>La CA intermedia tiene su propio par de claves asimétricas privada y pública, también tiene su certificado que en este caso está firmado por la CA raíz.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Intermediate CA</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">mkdir -p intermediate/certs intermediate/crl intermediate/csr intermediate/newcerts intermediate/private&#10;</span></span><span class="line"><span class="cl">chmod <span class="m">700</span> intermediate/private&#10;</span></span><span class="line"><span class="cl">touch intermediate/index.txt&#10;</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">1000</span> &gt; intermediate/serial&#10;</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">1000</span> &gt; intermediate/crlnumber&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">openssl genrsa -out intermediate/private/intermediate.key.pem <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">chmod <span class="m">400</span> intermediate/private/intermediate.key.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-1.sh</span>
    </div>
</div>
<p>La CA raíz firma únicamente el certificado de la CA intermedia. La CA intermedia generar la solicitud de firma de certificado, la CA raíz lo firma y se genera el certificado firmado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -config intermediate/openssl.conf -new -sha256 <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -key intermediate/private/intermediate.key.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -subj <span class="s2">&#34;/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Acme S.A. (Intermediate CA)&#34;</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -out intermediate/csr/intermediate.csr.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-2.sh</span>
    </div>
</div>
<p>La CA recibe la solicitud de firma del certificado de la CA intermedia y la firma. La CA intermedia recibe las solicitudes de firma de certificados para los servidores, clientes y usuarios y genera los certificados firmados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl ca -config openssl.conf <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -extensions v3_intermediate_ca -days <span class="m">3650</span> -batch -notext -md sha256 <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -in intermediate/csr/intermediate.csr.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -out intermediate/certs/intermediate.cert.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-3.sh</span>
    </div>
</div>
<p>Una vez generado el certificado de la CA intermedia se puede inspeccionar el certificado y validar que la firma sea correcta utilizando el certificado de la CA raíz.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl x509 -noout -text <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -in intermediate/certs/intermediate.cert.pem&#10;</span></span><span class="line"><span class="cl">$ openssl verify -CAfile certs/ca.cert.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  intermediate/certs/intermediate.cert.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-4.sh</span>
    </div>
</div>
<p>Para validar los certificados emitidos por la CA intermedia se genera una cadena de certificados que incluye los certificados de la CA raíz y la CA intermedia, la cadena de certificados es simplemente la unión del contenido de ambos certificados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat intermediate/certs/intermediate.cert.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  certs/ca.cert.pem &gt; intermediate/certs/ca-chain.cert.pem&#10;</span></span><span class="line"><span class="cl">$ chmod <span class="m">444</span> intermediate/certs/ca-chain.cert.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-5.sh</span>
    </div>
</div>
<p>La CA intermedia también utiliza su propio archivo de configuración de OpenSSL. En él se incluye la opción <em>copy_extensions</em> que permite copiar algunos atributos de la solicitud al certificado que genera, esto sirve para incluir en el certificado los múltiples <em>Subject Alternative Name</em> o SAN enviados en la solicitud. Si se permite emitir certificados con el mismo <em>Subject</em> es necesario utilizar la opción de configuración <em>unique_subject = no</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="c1"># OpenSSL intermediate CA configuration file.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Copy to `/root/ca/intermediate/openssl.cnf`.</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># `man ca`</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_ca</span> <span class="o">=</span> <span class="s">CA_default</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ CA_default ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Directory and file locations.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$ENV::INTERMEDIATE_DIR</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/certs</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl_dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/crl</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">new_certs_dir</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/newcerts</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">database</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">$dir/index.txt</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">serial</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">$dir/serial</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">RANDFILE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">$dir/private/.rand</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">copy_extensions</span>   <span class="o">=</span> <span class="s">copy</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># The root key and root certificate.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">private_key</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/private/intermediate.key.pem</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/certs/intermediate.cert.pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># For certificate revocation lists.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crlnumber</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">$dir/crlnumber</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">$dir/crl/intermediate.crl.pem</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">crl_extensions</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">crl_ext</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_crl_days</span>  <span class="o">=</span> <span class="s">30</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># SHA-1 is deprecated, so use SHA-2 instead.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_md</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">sha256</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="na">name_opt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">ca_default</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">cert_opt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">ca_default</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_days</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">1825</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">preserve</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">no</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">policy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">policy_loose</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ policy_strict ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># The root CA should only sign intermediate certificates that match.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See the POLICY FORMAT section of `man ca`.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">match</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>  <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">supplied</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ policy_loose ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Allow the intermediate CA to sign a more diverse range of certificates.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See the POLICY FORMAT section of the `ca` man page.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>  <span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">supplied</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">optional</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Options for the `req` tool (`man req`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">8192</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span>  <span class="o">=</span> <span class="s">req_distinguished_name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">string_mask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">utf8only</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># SHA-1 is deprecated, so use SHA-2 instead.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_md</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">sha256</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension to add when the -x509 option is used.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">x509_extensions</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">v3_ca</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req_distinguished_name ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">Country Name (2 letter code)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">State or Province Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Locality Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">0.organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Organization Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Organizational Unit Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Common Name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Email Address</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Optionally, specify some defaults.</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">ES</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName_default</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">Spain</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Madrid</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">0.organizationName_default</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">=</span> <span class="s">Acme S.A. (Intermediate CA)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationalUnitName_default</span>  <span class="o">=</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">emailAddress_default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ v3_ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for a typical CA (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid:always,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, cRLSign, keyCertSign</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ v3_intermediate_ca ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for a typical intermediate CA (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid:always,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">critical, CA:true, pathlen:0</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, cRLSign, keyCertSign</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ usr_cert ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for client certificates (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsCertType</span> <span class="o">=</span> <span class="s">client, email</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsComment</span> <span class="o">=</span> <span class="s">&#34;OpenSSL Generated Client Certificate&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, nonRepudiation, digitalSignature, keyEncipherment</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">clientAuth, emailProtection</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ server_cert ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for server certificates (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsCertType</span> <span class="o">=</span> <span class="s">server</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsComment</span> <span class="o">=</span> <span class="s">&#34;OpenSSL Generated Server Certificate&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer:always</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature, keyEncipherment</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">serverAuth</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ client_server_cert ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extensions for server certificates (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsCertType</span> <span class="o">=</span> <span class="s">client, server</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">nsComment</span> <span class="o">=</span> <span class="s">&#34;OpenSSL Generated Server Certificate&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer:always</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, nonRepudiation, digitalSignature, keyEncipherment</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">clientAuth, serverAuth</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ crl_ext ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension for CRLs (`man x509v3_config`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span><span class="o">=</span><span class="s">keyid:always</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ ocsp ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Extension for OCSP signing certificates (`man ocsp`).</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">basicConstraints</span> <span class="o">=</span> <span class="s">CA:FALSE</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectKeyIdentifier</span> <span class="o">=</span> <span class="s">hash</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">authorityKeyIdentifier</span> <span class="o">=</span> <span class="s">keyid,issuer</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">keyUsage</span> <span class="o">=</span> <span class="s">critical, digitalSignature</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">extendedKeyUsage</span> <span class="o">=</span> <span class="s">critical, OCSPSigning</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>intermediate/openssl.conf</span>
    </div>
</div>
<h3 id="crear-y-firmar-el-certificado-del-servidor-clientes-o-usuarios">Crear y firmar el certificado del servidor, clientes o usuarios</h3>
<p>Para cada servidor, cliente de servidor o usuario hay que crear nuevamente su clave privada y pública, crear la solicitud de firma o <em>Certificate Sign Request</em> (CSR) que se envía a la autoridad de certificación intermedia para que lo firme y esta devuelva un certificado firmado. En el caso de un certificado para un servidor se incluye en el campo <em>Common Name</em> o <em>CN</em> el nombre del dominio del servidor, un certificado multidominio contiene varios nombres de dominio para los que es válido en el campo <em>Subject Alternative Names</em> o <em>SAN</em>, los certificados también se pueden asociar a una dirección IP concreta pero lo habitual es utilizar nombres de dominio.</p>
<p>Para crear el certificado firmado por la CA intermedia nuevamente el primer paso es generar la clave privada y pública y la solicitud de firma de certificado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nv">CA_PATH</span><span class="o">=</span>../ca&#10;</span></span><span class="line"><span class="cl"><span class="nv">CERTS_PATH</span><span class="o">=</span>server-certs&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CA_DIR</span><span class="o">=</span><span class="nv">$CA_PATH</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">INTERMEDIATE_DIR</span><span class="o">=</span><span class="nv">$CA_PATH</span>/intermediate&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">mkdir -p <span class="nv">$CERTS_PATH</span>/certs <span class="nv">$CERTS_PATH</span>/csr <span class="nv">$CERTS_PATH</span>/private&#10;</span></span><span class="line"><span class="cl">cp openssl/server/openssl*.conf <span class="nv">$CERTS_PATH</span>/&#10;</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$CERTS_PATH</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Server</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">openssl genrsa <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -out private/consul-server.key.pem <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">chmod <span class="m">400</span> private/consul-server.key.pem&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">openssl req -config openssl-consul-server.conf <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -key private/consul-server.key.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -subj <span class="s2">&#34;/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Consul Server&#34;</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -new -sha256 -out csr/consul-server.csr.pem</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>server-certs-1.sh</span>
    </div>
</div>
<p>Una vez la CA intermedia firma la solicitud y genera el certificado se puede validar que la firma sea correcta.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl verify -CAfile <span class="nv">$CA_PATH</span>/intermediate/certs/ca-chain.cert.pem <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  certs/consul-server.cert.pem&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>server-certs-2.sh</span>
    </div>
</div>
<p>Los clientes de un servidor como un navegador web cuando establecen la conexión segura comprueban que el nombre del dominio al que se ha realizado la solicitud esté contenido en los nombres de dominio y direcciones IP del certificado devuelto por el servidor y que esté firmado por una CA en la que se confía.</p>
<p>Para incluir en un certificados múltiples SAN ya sean dominios y direcciones IP es necesario indicarlo en el archivo de configuración al crear la solicitud en la sección <em>alt_names</em> y habilitar la extensión <em>req_ext</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[ req ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">default_bits</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">8192</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">distinguished_name</span> <span class="o">=</span> <span class="s">req_distinguished_name</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">req_extensions</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">req_ext</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req_distinguished_name ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">countryName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">Country Name (2 letter code)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">stateOrProvinceName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">State or Province Name (full name)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">localityName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">Locality Name (eg, city)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">organizationName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">=</span> <span class="s">Organization Name (eg, company)</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">commonName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s">Common Name (e.g. server FQDN or YOUR name)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[ req_ext ]</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">subjectAltName</span> <span class="o">=</span> <span class="s">@alt_names</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">[alt_names]</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.1</span>   <span class="o">=</span> <span class="s">server.dc1.consul</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.2</span>   <span class="o">=</span> <span class="s">consul.service.consul</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.3</span>   <span class="o">=</span> <span class="s">localhost</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.4</span>   <span class="o">=</span> <span class="s">consul.192.168.33.10.xip.io</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.5</span>   <span class="o">=</span> <span class="s">consul.192.168.33.11.xip.io</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.6</span>   <span class="o">=</span> <span class="s">consul.192.168.33.12.xip.io</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.7</span>   <span class="o">=</span> <span class="s">consul.192.168.33.13.xip.io</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">DNS.8</span>   <span class="o">=</span> <span class="s">consul.192.168.33.14.xip.io</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">127.0.0.1</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.2</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">192.168.33.10</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.3</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">192.168.33.11</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.4</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">192.168.33.12</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.5</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">192.168.33.13</span>&#10;</span></span><span class="line"><span class="cl"><span class="na">IP.6</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">=</span> <span class="s">192.168.33.14</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>server/openssl-consul-server.conf</span>
    </div>
</div>
<p>Inspeccionando la información del documento se observa que en la sección <em>X509v3 Subject Alternative Name</em> están incluidos los SAN adicionales.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl x509 -noout -text <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;  -in certs/consul-server.cert.pem&#10;</span></span><span class="line"><span class="cl">Certificate:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Data:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version: <span class="m">3</span> <span class="o">(</span>0x2<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial Number: <span class="m">4096</span> <span class="o">(</span>0x1000<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Signature Algorithm: sha256WithRSAEncryption&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Issuer: <span class="nv">C</span> <span class="o">=</span> ES, <span class="nv">ST</span> <span class="o">=</span> Spain, <span class="nv">O</span> <span class="o">=</span> Acme S.A., <span class="nv">CN</span> <span class="o">=</span> Acme S.A. <span class="o">(</span>Intermediate CA<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Validity&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Not Before: Aug  <span class="m">6</span> 22:39:48 <span class="m">2020</span> GMT&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Not After : Aug  <span class="m">5</span> 22:39:48 <span class="m">2025</span> GMT&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject: <span class="nv">C</span> <span class="o">=</span> ES, <span class="nv">ST</span> <span class="o">=</span> Spain, <span class="nv">L</span> <span class="o">=</span> Madrid, <span class="nv">O</span> <span class="o">=</span> Acme S.A., <span class="nv">CN</span> <span class="o">=</span> Consul Server&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subject Public Key Info:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Public Key Algorithm: rsaEncryption&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RSA Public-Key: <span class="o">(</span><span class="m">8192</span> bit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Modulus:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00:ef:5c:77:b4:e7:58:08:3f:d9:76:2c:67:52:f0:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;37:c2:19:e6:e8:32:0e:b4:39:ea:77:b5:bb:e8:9c:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d0:75:62:90:d2:9d:53:bc:55:b1:4f:c8:09:69:41:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b1:8a:b4:39:5e:ba:8c:c5:b0:40:82:8c:4b:cb:f4:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b3:97:24:8d:3e:f6:81:24:80:7a:14:da:15:dc:8f:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exponent: <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 extensions:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Basic Constraints: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CA:FALSE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netscape Cert Type: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSL Client, SSL Server&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Netscape Comment: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenSSL Generated Server Certificate&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Subject Key Identifier: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40:A7:07:BE:51:F7:20:E6:6B:5C:0F:22:93:13:FF:07:9A:11:E5:E8&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Authority Key Identifier: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyid:0F:13:28:6E:13:8F:9D:25:7A:89:07:38:CA:05:F8:CA:49:47:57:62&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DirName:/C<span class="o">=</span>ES/ST<span class="o">=</span>Spain/L<span class="o">=</span>Madrid/O<span class="o">=</span>Acme S.A./CN<span class="o">=</span>Acme S.A <span class="o">(</span>CA<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serial:10:00&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Key Usage: critical&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Digital Signature, Non Repudiation, Key Encipherment&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Extended Key Usage: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TLS Web Client Authentication, TLS Web Server Authentication&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X509v3 Subject Alternative Name: &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DNS:server.dc1.consul, DNS:consul.service.consul, DNS:localhost, DNS:consul.192.168.33.10.xip.io, DNS:consul.192.168.33.11.xip.io, DNS:consul.192.168.33.12.xip.io, DNS:consul.192.168.33.13.xip.io, DNS:consul.192.168.33.14.xip.io, IP Address:127.0.0.1, IP Address:192.168.33.10, IP Address:192.168.33.11, IP Address:192.168.33.12, IP Address:192.168.33.13, IP Address:192.168.33.14&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Signature Algorithm: sha256WithRSAEncryption&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12:15:c8:74:8d:e4:5b:8a:13:2c:ae:42:1a:ca:11:aa:c0:89:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; de:29:25:6c:4f:b4:52:24:1a:cd:25:18:55:dd:6d:9d:ea:12:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d9:f1:5d:f5:46:75:39:43:b9:6d:c0:a3:49:a9:80:63:ba:ea:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bc:24:3b:49:e8:c3:9b:60:51:fc:bb:52:a4:61:18:ac:fe:58:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3c:61:2c:af:0d:83:fa:d9:e5:ad:fa:73:10:9c:5b:f1:72:13:&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>server-certs-3.sh</span>
    </div>
</div>
<h3 id="añadir-el-certificado-de-la-ca-en-el-navegador-firefox">Añadir el certificado de la CA en el navegador Firefox</h3>
<p>Los navegadores incluyen los certificados de algunas autoridades de certificados en las que se confía. En el caso de crear una CA propia como lo mostrado en este artículo y un certificado para un servidor firmado por esta autoridad de certificados el navegador mostrará una advertencia indicando que el certificado presentado no es de confianza antes de permitir entrar al sitio web, con este mensaje el usuario es consciente de que el certificado del servidor no es de confianza y si el usuario lo desea se permite el acceso al sitio web. Aún así el navegador muestra una advertencia en el icono de seguridad del sitio web de que hay un problema con el certificado.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-security-warning_hufe8f9d8a0431282fd659700381041a92_85469_2560x1440_fit_box_3.png" data-gallery="" title="Advertencia con certificado no de confianza en Firefox"><img src="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-security-warning_hufe8f9d8a0431282fd659700381041a92_85469_300x250_fit_box_3.png" width="300" height="196" alt="Advertencia con certificado no de confianza en Firefox" title="Advertencia con certificado no de confianza en Firefox"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificate-warning_hue64cb2700b0868b63449437b8bc142f9_77265_2560x1440_fit_box_3.png" data-gallery="" title="Advertencia con certificado no de confianza en Firefox"><img src="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificate-warning_hue64cb2700b0868b63449437b8bc142f9_77265_300x250_fit_box_3.png" width="300" height="195" alt="Advertencia con certificado no de confianza en Firefox" title="Advertencia con certificado no de confianza en Firefox"  class="lozad "></a></p>
<figcaption>Advertencia con certificado no de confianza en Firefox</figcaption>
</figure>
</div>
<p>Para eliminar el mensaje de advertencia al acceder al sitio web y la advertencia del icono de seguridad del sitio web hay que instalar en el navegador el certificado de la CA raíz o intermedia. En el navegador web <a href="https://www.mozilla.org/es-ES/firefox/new/">Firefox</a> se importa un nuevo certificado de una CA en la que se confía desde la opción <em>Preferencias &gt; Privacidad y seguridad &gt; Ver certificados &gt; Autoridades &gt; Importar</em> en el navegador <a href="https://www.google.es/chrome/browser/desktop/">Chrome</a> desde <em>Configuración &gt; Privacidad y seguridad &gt; Gestionar certificados</em>. Por defecto los navegadores web ya incorporan los certificados de varias CA importantes de internet.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificates_hu3f247b7f03583946d46a95e4b00c73b3_62141_2560x1440_fit_box_3.png" data-gallery="" title="Certificados de autoridades de certificación de confianza en Firefox"><img src="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificates_hu3f247b7f03583946d46a95e4b00c73b3_62141_300x250_fit_box_3.png" width="300" height="200" alt="Certificados de autoridades de certificación de confianza en Firefox" title="Certificados de autoridades de certificación de confianza en Firefox"  class="lozad "></a></p>
<figcaption>Certificados de autoridades de certificación de confianza en Firefox</figcaption>
</figure>
</div>
<p>Una vez se importa el certificado de la CA el navegador muestra el icono de seguridad del sitio web con el icono sin advertencias indicando que no hay ningún problema de seguridad en la conexión con el sitio web, tampoco se muestra la página inicial de advertencia.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificate-valid_hua2bad78e16f7f5135943a01bcdd1e7a8_83586_2560x1440_fit_box_3.png" data-gallery="" title="Certificado de confianza y conexión segura en Firefox"><img src="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/images/firefox-certificate-valid_hua2bad78e16f7f5135943a01bcdd1e7a8_83586_300x250_fit_box_3.png" width="300" height="195" alt="Certificado de confianza y conexión segura en Firefox" title="Certificado de confianza y conexión segura en Firefox"  class="lozad "></a></p>
<figcaption>Certificado de confianza y conexión segura en Firefox</figcaption>
</figure>
</div>
<h3 id="revocar-y-renovar-un-certificado">Revocar y renovar un certificado</h3>
<p>Además de firmar y generar de certificados las funciones de una CA es revocar un certificado cuando se ha comprometido y ya no es de confianza por un problema de seguridad y renovar de los certificados cuando se fecha de validez expira.</p>
<p>Una vez se revoca un certificado hay dos formas en la que la CA permite conocer si un certificado ha sido revocado, con <em>Certificate Revocation List</em> (CRL) o <em>Online_Certificate_Status_Protocol</em> (OCSP) aunque CRL ha quedado en desuso y se prefiere OCSP. El problema del método CRL es que hay una latencia entre el momento en que se realiza la revocación esta ventana de tiempo no es deseable para evitar problemas de seguridad con la mayor inmediatez, la revocación se publica en el registro de CRL, su segundo problema es que en una CA grande con un número grande de certificados revocados el registro de CRL será también grande. OCSP también permite conocer si un certificado ha sido revocado, evita la latencia de CRL ya que no depende de un registro y requiere menos tráfico para realizar la comprobación ya que no requiere la descargar del registro CRL, pero introduce otros problemas como que debe soportar una número enorme de peticiones de comprobación de certificado ya que se hace una petición por cada visita a un sitio web, en el caso de una CA importante que tiene un número de certificados emitidos que usan sitios con mucho tráfico de internet es un problema. El segundo problema es una pérdida de privacidad para los usuarios ya que la CA al recibir una solicitud de comprobación de certificado por cada visita podría rastrear a los usuarios. Para evitar o al menos mitigar en gran medida los problemas de OCSP se ha desarrollado <a href="https://en.wikipedia.org/wiki/OCSP_stapling">OCSP Stapling</a>.</p>
<p>La CA guarda los certificados que emite, con OpenSSL en la carpeta <em>newcerts</em> con un número de serie, en el archivo a modo base de datos <em>index.txt</em> almacena entre otras cosas el número de serie y el <em>Subject</em> del certificado emitido. El comando para revocar un certificado incluye como argumento el certificado a revocar y opcionalmente el motivo de la revocación. El archivo <em>index.txt</em> se actualiza y en la entrada asociada al certificado se indica una <em>R</em> para indicar que ha sido revocado.</p>
<p>Si la revocación del certificado se realiza por un problema de seguridad en el que la clave privada y pública asociada al certificado han sido comprometidas es necesario revocar el certificado comprometido, generar un nuevo par de claves para evitar suplantaciones de identidad y emitir un nuevo certificado generado a partir de las nuevas claves privada y pública.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl ca -config intermediate/openssl.conf <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;-revoke intermediate/newcerts/1000.pem -crl_reason superseded&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-revoke.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">R	250805223948Z	25080528054Z	1000	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Consul Server&#10;</span></span><span class="line"><span class="cl">V	250805223951Z		1001	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Consul Agent&#10;</span></span><span class="line"><span class="cl">V	250805223953Z		1002	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Vault Server&#10;</span></span><span class="line"><span class="cl">V	250805223956Z		1003	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Vault Agent&#10;</span></span><span class="line"><span class="cl">V	250805223958Z		1004	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Nomad Server&#10;</span></span><span class="line"><span class="cl">V	250805224004Z		1005	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=Nomad Agent&#10;</span></span><span class="line"><span class="cl">V	250805224009Z		1006	unknown	/C=ES/ST=Spain/L=Madrid/O=Acme S.A./CN=UI Server&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>index.txt</span>
    </div>
</div>
<p>Al revocar un certificado la CA regenera el CRL.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">openssl ca -config intermediate/openssl.conf <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;-gencrl -out intermediate/crl/intermediate.crl&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca-intermediate-crl.sh</span>
    </div>
</div>
<p>Los certificados se emiten con una de caducidad, llegado en el tiempo a la fecha de caducidad el certificado ya no se considera válido. En este caso hay que renovarlo. El servidor, cliente o usuario genera una nueva solicitud de certificado a partir de las mismas u otras nuevas claves privada y pública, la autoridad intermedia la recibe y realiza dos acciones: revoca el certificado anterior y genera un nuevo certificado a partir de la nueva solicitud de certificado. El comando de OpenSSL de la autoridad de certificados no permite que haya dos certificados con el mismo <em>Subject</em> válidos de modo que primero hay que revocar el certificado anterior. Los comandos son los mismos que los mostrados anteriormente para cada una de las acciones.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/CertificateAuthority">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./ca.sh &amp;&amp; ./server-certs.sh</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://jamielinux.com/docs/openssl-certificate-authority/create-the-root-pair.html">OpenSSL Certificate Authority</a></li>
<li><a href="https://stackoverflow.com/questions/21297139/how-do-you-sign-a-certificate-signing-request-with-your-certification-authority">How do you sign a Certificate Signing Request with your Certification Authority?</a></li>
<li><a href="https://geekflare.com/san-ssl-certificate/">Know about SAN Certificate and How to Create With OpenSSL</a></li>
<li><a href="https://stackoverflow.com/a/30977497">Subject Alternative Name not present in certificate</a></li>
<li><a href="https://medium.com/@superseb/get-your-certificate-chain-right-4b117a9c0fce">Get your certificate chain right</a></li>
<li><a href="https://www.consul.io/docs/common-errors.html">Consul Common Error Messages</a></li>
<li><a href="https://tldp.org/HOWTO/SSL-Certificates-HOWTO/x195.html">Certificate management</a></li>
<li><a href="https://roll.urown.net/ca/ca_revoke.html">Revoke Certificates</a></li>
<li><a href="https://serverfault.com/questions/810557/how-do-i-issue-multiple-certificates-for-the-same-common-name/810608">How do I issue multiple certificates for the same Common Name?</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/07/obtener-un-nombre-de-dominio-para-una-direccion-ip-privada/</id>
        <title>Obtener un nombre de dominio para una dirección IP privada</title>
        <updated>2020-07-31T11:00:00+02:00</updated>
        <published>2020-07-31T11:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/07/obtener-un-nombre-de-dominio-para-una-direccion-ip-privada/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<p>Las direcciones IP en la versión 4 del protocolo son un número de 32 bits, se representan en cuatro grupos de números decimales que toman el valor entre 0 y 255 separados por un punto, por ejemplo para la dirección que representa la máquina local <em>127.0.0.1</em>. En <a href="https://picodotdev.github.io/blog-bitix/2018/11/el-agotamiento-de-direcciones-ipv4-y-el-protocolo-de-internet-ipv6/">la versión 6 del protocolo IP</a> las direcciones IP son un número de 128 bits. Dado que los números de la direcciones IP son difíciles de recordar para los humanos se usan alias o sinónimos denominados nombres de dominio, por ejemplo, <em>picodotdev.github.io</em> o <em>duckduckgo.com</em>. El software que permite la conversión de nombre de dominio a dirección IP son los servidores <em>DNS</em>.</p>
<p>Algunos rangos de las direcciones IP están reservados para crear redes privadas no accesibles desde internet estos son de <em>10.0.0.0</em> a <em>10.255.255.255</em>, de <em>172.16.0.0</em> a <em>172.31.255.255</em> y de <em>192.168.0.0</em> a <em>192.168.255.255</em>. Para estas direcciones IP privadas en algunos casos también es necesario asociarlas con nombre de dominio, los servidores web virtuales que permiten alojar en el mismo servidor varios sitios web dependen del nombre del dominio a través del cual se realiza la petición, <a href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/">usar el protocolo seguro HTTPS</a> y <a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">usar el protocolo HTTP/2</a> también depende de los nombres de dominio.</p>
<p>Para resolver nombres de dominio a direcciones IP hay dos posibilidades, la primera es utilizar el archivo <em>/etc/hosts</em> creando una línea con el nombre del dominio y su dirección IP, la segunda forma es crear y administrar un servidor DNS. Hay algunos servicios que ofrecen la funcionalidad de resolver dominios a direcciones IP sin necesidad de utilizar el archivo <em>/etc_hosts</em> ni crear un servidor DNS.</p>
<p>Los servidores DNS de <a href="https://www.xip.io/">xip.io</a> resuelven dominios a direcciones privadas IPv4 y <a href="https://sslip.io/">sslip.io</a> resuelve dominios a direcciones privadas IPv4 e IPv6. La utilidad de los nombres de dominio es hacer las direcciones IP más significativas incluyendo una cadena que las describa y permitir utilizar servidores virtuales en los servidores web sin utilizar el archivo <em>etc/hosts</em> ni un servidor DNS propio.</p>
<p>Estos servicios DNS permiten embeber en el nombre de dominio la dirección IP a la que resuelven cuando se les hace la consulta. Por ejemplo, para el nombre de dominio <em>consul.192.168.33.10.xip.io</em> resuelven a la dirección IP <em>192.168.33.10</em>. El servicio sslip permite utilizar guiones en vez de puntos para separar los elementos de la dirección IP, por ejemplo <em>consul.192-168-33-10.sslip.io</em>.</p>
<p>Utilizando el comando <em>dig</em> se obtienen los registros DNS del nombre de dominio indicado incluído el registro <em>A</em> para la dirección IP.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ dig +short consul.192.168.33.10.xip.io&#10;</span></span><span class="line"><span class="cl">192.168.33.10&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ dig +short consul.192.168.33.20.xip.io&#10;</span></span><span class="line"><span class="cl">192.168.33.20&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ dig consul.192.168.33.10.xip.io&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.16.5 &lt;&lt;&gt;&gt; consul.192.168.33.10.xip.io&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> global options: +cmd&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> Got answer:&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59742&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; QUESTION SECTION:&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;consul.192.168.33.10.xip.io.	IN	A&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; ANSWER SECTION:&#10;</span></span></span><span class="line"><span class="cl"><span class="s">consul.192.168.33.10.xip.io. 292 IN	A	192.168.33.10&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; Query time: 3 msec&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; SERVER: 192.168.1.1#53(192.168.1.1)&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; WHEN: vie jul 31 11:08:13 CEST 2020&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; MSG SIZE  rcvd: 61&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">$ dig consul.192.168.33.10.sslip.io&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">; &lt;&lt;&gt;&gt; DiG 9.16.5 &lt;&lt;&gt;&gt; consul.192.168.33.10.sslip.io&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; global options: +cmd&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; Got answer:&#10;</span></span></span><span class="line"><span class="cl"><span class="s">;; -&gt;&gt;HEADER&lt;&lt;- opcode</span>: QUERY, status: NOERROR, id: <span class="m">52060</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> OPT PSEUDOSECTION:&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span> EDNS: version: 0, flags:<span class="p">;</span> udp: <span class="m">512</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> QUESTION SECTION:&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span>consul.192.168.33.10.sslip.io.	IN	A&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> ANSWER SECTION:&#10;</span></span><span class="line"><span class="cl">consul.192.168.33.10.sslip.io. <span class="m">300</span> IN	A	192.168.33.10&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> Query time: <span class="m">263</span> msec&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> SERVER: 192.168.1.1#53<span class="o">(</span>192.168.1.1<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> WHEN: vie jul <span class="m">31</span> 11:09:12 CEST <span class="m">2020</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> MSG SIZE  rcvd: <span class="m">74</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ dig consul.192-168-33-10.sslip.io&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.16.5 &lt;&lt;&gt;&gt; consul.192-168-33-10.sslip.io&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> global options: +cmd&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> Got answer:&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">26671</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> OPT PSEUDOSECTION:&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span> EDNS: version: 0, flags:<span class="p">;</span> udp: <span class="m">512</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> QUESTION SECTION:&#10;</span></span><span class="line"><span class="cl"><span class="p">;</span>consul.192-168-33-10.sslip.io.	IN	A&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> ANSWER SECTION:&#10;</span></span><span class="line"><span class="cl">consul.192-168-33-10.sslip.io. <span class="m">300</span> IN	A	192.168.33.10&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> Query time: <span class="m">243</span> msec&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> SERVER: 192.168.1.1#53<span class="o">(</span>192.168.1.1<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> WHEN: vie jul <span class="m">31</span> 11:32:54 CEST <span class="m">2020</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">;;</span> MSG SIZE  rcvd: <span class="m">74</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>dig.sh</span>
    </div>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/</id>
        <title>Revertir un servicio a una versión anterior con Nomad</title>
        <updated>2020-07-26T09:00:00+02:00</updated>
        <published>2020-07-26T09:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Los errores no se planifican, se producen de forma inesperada. Además, un error en un entorno de producción es normalmente urgente e importante lo que obliga a cambiar las prioridades del equipo dejando lo que están haciendo y ocuparse de resolver el problema. En ocasiones no será posible resolver el problema y la única solución es revertir la versión de la aplicación a la anterior. Dependiendo de la automatización de los procesos incluso el volver a la versión anterior quizá sea complicado. Los errores no se planifican pero si se puede planificar estar preparado para algunos errores, una forma de estar preparado ante errores es tener un proceso y herramientas para volver a la versión anterior rápido y fácilmente.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-nomad.svg" width="200" height="260" alt="HashiCorp Nomad" title="HashiCorp Nomad"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp.svg" width="200" height="200" alt="HashiCorp" title="HashiCorp"  class=""></p>
</div>
<p>En el desarrollo de una aplicación se dedica un considerable esfuerzo a tener la mayor seguridad que los cambios no introducen errores, se realizan numerosas pruebas unitarias, pruebas de integración, si es una aplicación web pruebas funcionales simulando la interacción de un usuario. Todas estas pruebas se ejecutan además del equipo de cada desarrollador en un entorno de integración continua o CI en cada <em>commit</em> al repositorio de control de versiones del código fuente, el equipo de desarrollo recibe una notificación con inmediatez en caso de fallar alguna prueba. Aún se hacen mas pruebas algunas manuales en un entorno de <em>staging</em> que tiene una configuración similar al de producción. Finalmente, se despliega la versión validada en producción todavía haciendo más comprobaciones con estrategias de despliegue <em>blue/green</em> y <em>canary</em>, si no se ha descubierto ningún error se promociona la versión en todas las instancias.</p>
<p>Y aún con todo estos procesos de pruebas en ocasiones se descubren errores en producción. Si la causa del error se descubre rápido y es fácil de solucionar se opta por corregirlo, crear una nueva versión y desplegarla. Si el error es leve y no afecta a una funcionalidad importante se puede esperar a la siguiente versión para corregirlo. Pero algunos errores impactan en una funcionalidad vital para el negocio, tanto que obligan al equipo a dejar las tareas planificadas que están haciendo aún siendo también importantes para descubrir la causa del error y corregirlo, a veces la causa y la corrección se realiza rápido. En otras ocasiones la causa es difícil de determinar o la corrección es compleja, en estas ocasiones la opción adecuada es volver a la versión anterior buena conocida haciendo un <em>revert</em> o <em>rollback</em>. Se pierden las otras nuevas funcionalidades incorporadas en la misma versión pero se evita hacer cambios que introducen deuda técnica por la presión de dar solución rápido al error y se evita al equipo trabajar en un desagradable bajo presión.</p>
<p>En la operación de sistemas lo ideal es que todas las tareas estén automatizadas para evitar errores al realizar operaciones manuales y para evitar complejos procesos que impidan a cualquier miembro de equipo realizar la tarea por falta de conocimiento, complejidad o requerir formación. Dos de estas tareas a automatizar son el despliegue de una aplicación con una nueva versión y también el revertir a una versión anterior en caso de detectar que la nueva versión tiene algún tipo de error.</p>
<p><a href="https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/">Nomad es un orquestador de servicios</a> que en gran medida automatiza el despliegue de de las aplicaciones, su actualización a nuevas versiones y revertir a versiones anteriores.</p>
<p>Se inicia con el siguiente comando.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad agent -dev&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; No configuration files <span class="nv">loaded</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Starting Nomad agent...&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Nomad agent configuration:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;   Advertise Addrs: HTTP: 127.0.0.1:4646<span class="p">;</span> RPC: 127.0.0.1:4647<span class="p">;</span> Serf: 127.0.0.1:4648&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bind Addrs: HTTP: 127.0.0.1:4646<span class="p">;</span> RPC: 127.0.0.1:4647<span class="p">;</span> Serf: 127.0.0.1:4648&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Client: <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Log Level: DEBUG&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Region: global <span class="o">(</span>DC: dc1<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Server: <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Version: 0.12.0&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Nomad agent started! Log data will stream in below:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-start.sh</span>
    </div>
</div>
<p>Para ejecutar un servicio basta con enviar su definición en su archivo de configuración con un comando.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad run service-1.nomad&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Monitoring evaluation <span class="s2">&#34;56421393&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation triggered by job <span class="s2">&#34;service&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Allocation <span class="s2">&#34;b51101cc&#34;</span> created: node <span class="s2">&#34;5721462c&#34;</span>, group <span class="s2">&#34;service&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation within deployment: <span class="s2">&#34;33154ac5&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation status changed: <span class="s2">&#34;pending&#34;</span> -&gt; <span class="s2">&#34;complete&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Evaluation <span class="s2">&#34;56421393&#34;</span> finished with status <span class="s2">&#34;complete&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-run-1.sh</span>
    </div>
</div>
<p>La definición del servicio en <a href="https://www.nomadproject.io/">Nomad</a> incluye la versión del artecfacto a desplegar. En este caso el servicio es simplemente un comando que emite una traza en la consola, a efectos didácticos no es relevante ya que sería lo mismo si fuera el comando de inicio de la aplicación Java que incluya la versión del <em>jar</em> o si el contenedor Docker estuviese versionado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">job <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nv">datacenters</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;dc1&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  group <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;task <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nv">driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  config <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">image</span> <span class="o">=</span> <span class="s2">&#34;busybox:latest&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">command</span> <span class="o">=</span> <span class="s2">&#34;ash&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">args</span> <span class="o">=</span> <span class="o">[</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s2">&#34;-c&#34;</span>,&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s2">&#34;while true; do echo \&#34;Version 1\&#34;; sleep 1; done&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>service-1.nomad</span>
    </div>
</div>
<p>El servicio emite en la salida el mensaje.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad job status service&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">Allocations&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node ID   Task Group  Version  Desired  Status&nbsp;&nbsp;&nbsp;&nbsp;Created&nbsp;&nbsp;&nbsp;&nbsp; Modified&#10;</span></span><span class="line"><span class="cl">b51101cc  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp; running   40m6s ago   38m31s ago&#10;</span></span><span class="line"><span class="cl">$ nomad alloc logs b51101cc&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>service-1-logs.sh</span>
    </div>
</div>
<p>Al hacer cambios en el código de un servicio con nuevas características, correcciones de errores o mejoras de las funcionalidades existentes hay que generar una nueva versión del artefacto a desplegar, en el caso de una aplicación Java con <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> puede ser un nuevo archivo <em>jar</em> con un nuevo nombre que incluye su versión, el artefacto de despligue es un contenedor Docker este también estará versionado. En la definición del servicio para Nomad hay que actualizar la referencia del artefacto a la nueva versión. El comando para realizar el despliegue es el mismo, basta con enviar la nueva definición del servicio a Nomad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">job <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nv">datacenters</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;dc1&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  group <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;task <span class="s2">&#34;service&#34;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nv">driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  config <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">image</span> <span class="o">=</span> <span class="s2">&#34;busybox:latest&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">command</span> <span class="o">=</span> <span class="s2">&#34;ash&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nv">args</span> <span class="o">=</span> <span class="o">[</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;-c&#34;</span>,&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;while true; do echo \&#34;Version 2 (error)\&#34;; sleep 1; done&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>service-2.nomad</span>
    </div>
</div>
<p>Como una nueva versión implica cambios en el código o la configuración del servicio es posible introducir nuevos errores que aún con todos los procesos de pruebas en diferentes entornos comentados sean descubiertos solo en el entorno de producción como es el típico <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/NullPointerException.html">NullPointerException</a> o en este caso un mensaje de traza erróneo.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad job status service&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">Allocations&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node ID   Task Group  Version  Desired  Status&nbsp;&nbsp;&nbsp;&nbsp;Created&nbsp;&nbsp;&nbsp;&nbsp; Modified&#10;</span></span><span class="line"><span class="cl">f7bd853e  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp; running   38m33s ago  34m57s ago&#10;</span></span><span class="line"><span class="cl">b51101cc  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">complete</span>  40m6s ago   38m31s ago&#10;</span></span><span class="line"><span class="cl">$ nomad alloc logs f7bd853e&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">2</span> <span class="o">(</span>error<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>service-2-logs.sh</span>
    </div>
</div>
<p>Para la tarea de volver a una versión anterior el proceso con Nomad es igualmente sencillo, Nomad recuerda las definiciones anteriores enviadas con lo que solo se necesita utilizar <a href="https://www.nomadproject.io/docs/commands/job/revert.html">el comando para restaurar la definición del servicio</a>. Con los artefactos de despliegue versionados ya sea con contenedores Docker o con versiones en archivos <em>jar</em> las definiciones de los servicios contienen la referencia de los artefactos que utilizan.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad job revert service <span class="nv">0</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Monitoring evaluation <span class="s2">&#34;493bcc52&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation triggered by job <span class="s2">&#34;service&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation within deployment: <span class="s2">&#34;e13303e3&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Allocation <span class="s2">&#34;fc4fd574&#34;</span> created: node <span class="s2">&#34;5721462c&#34;</span>, group <span class="s2">&#34;service&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation status changed: <span class="s2">&#34;pending&#34;</span> -&gt; <span class="s2">&#34;complete&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Evaluation <span class="s2">&#34;493bcc52&#34;</span> finished with status <span class="s2">&#34;complete&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-revert.sh</span>
    </div>
</div>
<p>El volver a la versión anterior puede hacerse desde la consola gráfica de administración de Nomad o desde la interfaz de línea de comandos introduciendo la definición anterior del servicio. Nomad se encarga de actualizar a la versión anterior de todas las instancias de forma progresiva utilizando <a href="https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/">estrategias de despliegue <em>blue/green</em> y <em>canary</em> con Nomad</a> que haya del servicio de forma automatizada y el servicio vuelve a la normalidad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad job status service&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">Allocations&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node ID   Task Group  Version  Desired  Status&nbsp;&nbsp;&nbsp;&nbsp;Created&nbsp;&nbsp;&nbsp;&nbsp; Modified&#10;</span></span><span class="line"><span class="cl">fc4fd574  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run&nbsp;&nbsp;&nbsp;&nbsp;  running   34m58s ago  34m43s ago&#10;</span></span><span class="line"><span class="cl">f7bd853e  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">complete</span>  38m33s ago  34m57s ago&#10;</span></span><span class="line"><span class="cl">b51101cc  5721462c  service&nbsp;&nbsp;&nbsp;&nbsp; <span class="m">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">complete</span>  40m6s ago   38m31s ago&#10;</span></span><span class="line"><span class="cl">$ nomad alloc logs fc4fd574&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">Version <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>service-3-logs.sh</span>
    </div>
</div>
<p>Desde la consola web de administración también se ven las definiciones de los jobs y sus versiones con sus diferencias.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-service-1_hu46d56fa32dedc34aa925f05a6e74ed43_123650_2560x1440_fit_box_3.png" data-gallery="" title="Versión 1 del servicio"><img src="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-service-1_hu46d56fa32dedc34aa925f05a6e74ed43_123650_200x150_fit_box_3.png" width="155" height="150" alt="Versión 1 del servicio" title="Versión 1 del servicio"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-service-2_hua65f376519e85a3e38c7d189b5a61580_132252_2560x1440_fit_box_3.png" data-gallery="" title="Versión 2 del servicio"><img src="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-service-2_hua65f376519e85a3e38c7d189b5a61580_132252_200x150_fit_box_3.png" width="148" height="150" alt="Versión 2 del servicio" title="Versión 2 del servicio"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-versions_hu940a3480bfb39e48a962826728734d4b_126962_2560x1440_fit_box_3.png" data-gallery="" title="Versiones del servicio"><img src="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/images/nomad-versions_hu940a3480bfb39e48a962826728734d4b_126962_200x150_fit_box_3.png" width="200" height="150" alt="Versiones del servicio" title="Versiones del servicio"  class="lozad "></a></p>
<figcaption>Versiones del servicio</figcaption>
</figure>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/</id>
        <title>Comunicaciones seguras, autenticación mutua y autorizaciones con intenciones entre servicios usando Consul Connect y Nomad</title>
        <updated>2020-07-24T15:00:00+02:00</updated>
        <published>2020-07-24T15:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>La configuración de seguridad estática y basada en direcciones IP no es adecuada en un entorno en el que los recursos de computación está compartidos y no son confiables, ni para aplicaciones basadas en microservicios cuyo número de servicios e instancias cambia a lo largo del tiempo. Consul y Consul Connect ofrecen un mecanismo de comunicación segura adaptados a la computación en la nube y adecuado para aplicaciones basadas en microservicios.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-consul.svg" width="200" height="278" alt="HashiCorp Consul" title="HashiCorp Consul"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp-nomad.svg" width="200" height="260" alt="HashiCorp Nomad" title="HashiCorp Nomad"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/hashicorp.svg" width="200" height="200" alt="HashiCorp" title="HashiCorp"  class=""></p>
</div>
<p>El método habitual para proporcionar seguridad a varios sistemas que se comunican por red ha sido utilizar protocolos de comunicaciones cifrados, poner cortafuegos e impedir una comunicación directa con algunos sistemas como las base de datos en ocasiones en base a direcciones IP. La configuración estática cuando hay que adaptarla por añadir nuevos sistemas es difícil de cambiarla.</p>
<p>En un entorno en la nube, aún con sus propias medidas de seguridad y aislamiento que implementan, la infraestructura no es confiable por ser compartida con otras organizaciones como demuestran los <a href="https://picodotdev.github.io/blog-bitix/2018/01/explicacion-del-fallo-de-seguridad-meltdown-y-spectre-en-los-microprocesadores-intel/">fallos de seguridad de meltdown y spectre de los procesadores</a> por su ejecución especulativa. En una arquitectura dinámica de múltiples microservicios e instancias una configuración estática no es práctica para un sistema que por naturaleza es altamente dinámico y en un medio de computación compartido no confiable hay que adoptar medidas adicionales.</p>
<p>La propuesta que ofrecen algunas herramientas nativas para la computación en la nube es proporcionar seguridad realizando cada comunicación servicio a servicio de forma cifrada y transparente para las aplicaciones incluso si estas no implementan comunicación cifrada de forma nativa, con autenticación mutua entre los dos servicios utilizando su identidad en vez de direcciones IP y con autorizaciones basadas en intenciones fáciles de administrar y cambiar.</p>
<p>Una de estas herramientas es <a href="https://www.consul.io/">Consul</a> que proporciona la funcionalidad de registro y descubrimiento de servicios y conectividad entre esos servicios. Consul Connect proporciona comunicaciones seguras de forma transparente para las aplicaciones.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-static_hu40ea92732f7c799eac78c9ecc53c9f1e_687720_2560x1440_fit_box_3.png" data-gallery="" title="Infraestructura estática"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-static_hu40ea92732f7c799eac78c9ecc53c9f1e_687720_300x200_fit_box_3.png" width="270" height="200" alt="Infraestructura estática" title="Infraestructura estática"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-static-approach_hue0ef08cc5d3ec3fec4e79c39218b6127_43440_2560x1440_fit_box_3.png" data-gallery="" title="Infraestructura estática"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-static-approach_hue0ef08cc5d3ec3fec4e79c39218b6127_43440_300x200_fit_box_3.png" width="267" height="200" alt="Infraestructura estática" title="Infraestructura estática"  class="lozad "></a></p>
<figcaption>Infraestructura estática</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-dynamic_hud792d9ccac62b58fc59867570540fb55_748281_2560x1440_fit_box_3.png" data-gallery="" title="Infraestructura dinámica"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-dynamic_hud792d9ccac62b58fc59867570540fb55_748281_300x200_fit_box_3.png" width="239" height="200" alt="Infraestructura dinámica" title="Infraestructura dinámica"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-dynamic-approach_huc588b2a2c6815d010814db891979b214_44789_2560x1440_fit_box_3.png" data-gallery="" title="Infraestructura dinámica"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/infrastructure-dynamic-approach_huc588b2a2c6815d010814db891979b214_44789_300x200_fit_box_3.png" width="267" height="200" alt="Infraestructura dinámica" title="Infraestructura dinámica"  class="lozad "></a></p>
<figcaption>Infraestructura dinámica</figcaption>
</figure>
</div>
<p>El esquema de funcionamiento de <a href="https://www.consul.io/docs/connect">Consul Connect</a> es hacer que los servicios no se comuniquen directamente entre ellos sino que utilizan <em>proxys</em>, la creación del enlace de comunicación se delega en Consul que crea los <em>proxys</em> y con ellos le es posible proporcionar comunicaciones seguras, con autenticación mutua y posibilitando autorización con intenciones. Las intenciones son los permisos que establece el operador de Consul para establecer que dos servicios tiene permitido la comunicación entre ellos, cualquier intento de comunicación si no está aprobado de forma explícita por su intención no se permite.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-connect-communications_hu9b9392122792520048bdeecbe5e8f0fc_25368_2560x1440_fit_box_3.png" data-gallery="" title="Comunicación servicio a servicio con Consul Connect"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-connect-communications_hu9b9392122792520048bdeecbe5e8f0fc_25368_300x200_fit_box_3.png" width="300" height="98" alt="Comunicación servicio a servicio con Consul Connect" title="Comunicación servicio a servicio con Consul Connect"  class="lozad "></a></p>
<figcaption>Comunicación servicio a servicio con Consul Connect</figcaption>
</figure>
</div>
<p>Otra de las herramientas de <a href="https://www.hashicorp.com/">HashiCorp</a> es <a href="https://www.nomadproject.io/">Nomad</a> que proporciona la funcionalidad de orquestador de servicios, creando las instancias de los servicios necesarias en los diferentes nodos de computación. Nomad se integra con Consul y Consul Connect haciendo más sencillo utilizar todas estas tecnologías.</p>
<p>En el siguiente ejemplo sigo la <a href="https://www.nomadproject.io/docs/integrations/consul-connect">guía de ejemplo para probar Consul Connect</a> con Nomad utilizando <a href="https://www.envoyproxy.io/">Envoy</a> para crear los <em>proxys</em>. Para ejecutar el ejemplo es necesario obtener los binarios de Consul, Nomad y Envoy además de las utilidades de comunicaciones de <em>cni-plugins</em> y <a href="https://www.docker.com/">Docker</a>.</p>
<p>Hay que instalar los paquetes de Consul, Nomad, Envoy y <em>cni-plugins</em> de la distribución <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> o la descarga directa de sus binarios accesibles en la variable <em>PATH</em> del sistema utilizada por los intérpretes de comandos para buscar comandos. Para obtener Envoy hay que ejecutar el siguiente comando que instala el binario de Envoy en la carpeta <em>/usr/local/bin</em> que incluida en la variable <em>PATH</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -L https://getenvoy.io/cli <span class="p">|</span> bash -s -- -b /usr/local/bin&#10;</span></span><span class="line"><span class="cl">$ getenvoy run standard:1.11.2 -- --version&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>getenvoy.sh</span>
    </div>
</div>
<p>Nomad requiere que los <em>cni-plugins</em> esté ubicados en la carpeta <em>/opt/cni/bin</em>, en Arch Linux se instalan en la carpeta <em>/usr/lib/cni/</em> por lo que hay que crear un enlace simbólico para que sean encontrados por Nomad. En Ubuntu la opción es realizar la instalación descargando el paquete manualmente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -L -o cni-plugins.tgz https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz&#10;</span></span><span class="line"><span class="cl">$ sudo mkdir -p /opt/cni/bin&#10;</span></span><span class="line"><span class="cl">$ sudo tar -C /opt/cni/bin -xzf cni-plugins.tgz</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>install-cni-plugins.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo pacman -s cni-plugins&#10;</span></span><span class="line"><span class="cl">$ sudo ln -s /usr/lib/cni/ /opt/cni/bin&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>install-cni-plugins-archlinux.sh</span>
    </div>
</div>
<p>Con los binarios necesarios instalados hay que iniciar Consul y Nomad con los siguientes comandos que los arrancan en su configuración de desarrollo y con el soporte para Consul Connect en Nomad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ consul agent -dev&#10;</span></span><span class="line"><span class="cl">$ sudo nomad agent -dev-connect&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>start-consul-nomad.sh</span>
    </div>
</div>
<p>El siguiente paso es enviar el Nomad la definición de los servicios para que planifique su ejecución, en este caso utilizando contenedores de Docker que ha de estar instalado previamente y con su servicio del sistema iniciado.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/10/introduccion-y-caracteristicas-de-docker/">Introducción y características de Docker</a></li>
</ul>
<p>La definición incluye dos servicios uno que proporciona un contador y otro que obtiene el valor de ese contador y lo muestra en una página web. En la definición del servicio <em>count-api</em> se define que va a ofrecer su comunicación por red en el puerto 9001 asociado a la interfaz de red <em>localhost</em> de modo que este puerto solo pueda ser accedido por Consul a través del <em>proxy</em> que crea, la definición del servicio <em>count-dashboard</em>  ofrece su servicio en el puerto 9002 y que tiene tiene como dependencia el servicio <em>count-api</em> para el que Consul crea un nuevo <em>proxy</em>, el servicio <em>count-dashboard</em> se conecta al puerto <em>8080</em> para comunicarse con el  servicio <em>count-api</em> mediante los <em>proxys</em> de Consul Connect. Los servicios solo se comunican con los <em>proxys</em> y son los <em>proxys</em> los que se comunican entre ellos.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nomad run connect.nomad&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-run.sh</span>
    </div>
</div>
<p>En la definición de <em>job</em> las partes relativas a Consul Connect están en los bloques o <em>stanzas</em> <em>connect</em>, en el caso de <em>count-api</em> simplemente para indicar que desea un <em>proxy</em> y en el caso de <em>count-dashboard</em> para indicar que desea un <em>proxy</em> para conectarse al servicio <em>count-api</em>, la variable de entorno <em>COUNTING_SERVICE_URL</em> contiene la dirección del <em>proxy</em> que permite la conexión con <em>count-api</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">job</span> <span class="s2">&#34;countdash&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  datacenters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;dc1&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="k">group</span> <span class="s2">&#34;api&#34;</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">network</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  mode</span> <span class="o">=</span> <span class="s2">&#34;bridge&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">service</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  name</span> <span class="o">=</span> <span class="s2">&#34;count-api&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  port</span> <span class="o">=</span> <span class="s2">&#34;9001&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">connect</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">sidecar_service</span> {}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">task</span> <span class="s2">&#34;web&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">config</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span> <span class="o">=</span> <span class="s2">&#34;hashicorpnomad/counter-api:v1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="k">group</span> <span class="s2">&#34;dashboard&#34;</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">network</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  mode</span> <span class="o">=</span> <span class="s2">&#34;bridge&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">port</span> <span class="s2">&#34;http&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static</span> <span class="o">=</span> <span class="m">9002</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="m">9002</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">service</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  name</span> <span class="o">=</span> <span class="s2">&#34;count-dashboard&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  port</span> <span class="o">=</span> <span class="s2">&#34;9002&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">connect</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">sidecar_service</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">proxy</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">upstreams</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  destination_name</span> <span class="o">=</span> <span class="s2">&#34;count-api&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  local_bind_port</span>  <span class="o">=</span> <span class="m">8080</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">task</span> <span class="s2">&#34;dashboard&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">env</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COUNTING_SERVICE_URL</span> <span class="o">=</span> <span class="s2">&#34;http://${NOMAD_UPSTREAM_ADDR_count_api}&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">config</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span> <span class="o">=</span> <span class="s2">&#34;hashicorpnomad/counter-dashboard:v1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">  }&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>connect.nomad</span>
    </div>
</div>
<p>El resultado es esta aplicación sencilla de ejemplo que muestra un contador en una página web con el tiempo se va incrementando. En las consolas de administración de Consul se observan los servicios registrados y en Nomad la ejecución de los mismos.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-console_hu8c985d25713a41703bcc650f7b57262b_79368_2560x1440_fit_box_3.png" data-gallery="" title="Consola de administración de Consul"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-console_hu8c985d25713a41703bcc650f7b57262b_79368_300x200_fit_box_3.png" width="226" height="200" alt="Consola de administración de Consul" title="Consola de administración de Consul"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/nomad-console_hu54fd55ff47624b201af619067639abdb_116271_2560x1440_fit_box_3.png" data-gallery="" title="Consola de administración de Nomad"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/nomad-console_hu54fd55ff47624b201af619067639abdb_116271_300x200_fit_box_3.png" width="226" height="200" alt="Consola de administración de Nomad" title="Consola de administración de Nomad"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard_hu9efa3299b8ef7dc069eb9ec8b701f4f9_94363_2560x1440_fit_box_3.png" data-gallery="" title="Servicio count-dashboard"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard_hu9efa3299b8ef7dc069eb9ec8b701f4f9_94363_300x200_fit_box_3.png" width="226" height="200" alt="Servicio count-dashboard" title="Servicio count-dashboard"  class="lozad "></a></p>
<figcaption>Consola de administración de Consul y Nomad y servicio count-dashboard</figcaption>
</figure>
</div>
<p>Dado que el servicio <em>count-dashboard</em> se conecta con el servicio <em>count-api</em> a través de los <em>proxys</em> que crea Consul, Consul es capaz de permitir o denegar la comunicación con las intenciones. Las intenciones son las autorizaciones concedidas a cada servicio origen y servicio destino de comunicación. La ventaja de las intenciones es que son agnósticas de la red como redes físicas, en la nube, basadas en software o cualesquiera otras ya que están basadas en la identidades de los servicios.</p>
<p>En el modo desarrollo de Consul aún sin una intención la comunicación se autorizan las comunicaciones pero si se crea una intención que deniegue la comunicación desde el servicio <em>count-dashboard</em> a <em>count-api</em> el servicio <em>count-dashboard</em> no es capaz de recuperar el contador y se muestra desconectado. Cambiando la intención para que autorice el tráfico la comunicación se restaura y el servicio <em>count-dashboard</em> vuelve a mostrar el contador.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-intentions-deny_huc2f2a2db30104806a5ceb8366b35ea2e_64077_2560x1440_fit_box_3.png" data-gallery="" title="Intención que deniega la comunicación"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-intentions-deny_huc2f2a2db30104806a5ceb8366b35ea2e_64077_300x200_fit_box_3.png" width="226" height="200" alt="Intención que deniega la comunicación" title="Intención que deniega la comunicación"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard-deny_hud397b3ca088678316e0c34eec5fcdf4d_92971_2560x1440_fit_box_3.png" data-gallery="" title="Intención que deniega la comunicación"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard-deny_hud397b3ca088678316e0c34eec5fcdf4d_92971_300x200_fit_box_3.png" width="226" height="200" alt="Intención que deniega la comunicación" title="Intención que deniega la comunicación"  class="lozad "></a></p>
<figcaption>Intención que deniega la comunicación</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-intentions-allow_hu6eee299d1329773eb700066625f2c9e3_63546_2560x1440_fit_box_3.png" data-gallery="" title="Intención que permite la comunicación"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/consul-intentions-allow_hu6eee299d1329773eb700066625f2c9e3_63546_300x200_fit_box_3.png" width="226" height="200" alt="Intención que permite la comunicación" title="Intención que permite la comunicación"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard-allow_hu66268335fb29c6245f012040cb0b70ca_96387_2560x1440_fit_box_3.png" data-gallery="" title="Intención que permite la comunicación"><img src="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/images/dashboard-allow_hu66268335fb29c6245f012040cb0b70ca_96387_300x200_fit_box_3.png" width="226" height="200" alt="Intención que permite la comunicación" title="Intención que permite la comunicación"  class="lozad "></a></p>
<figcaption>Intención que permite la comunicación</figcaption>
</figure>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/07/un-comando-y-aplicaciones-graficas-para-descargar-todo-el-contenido-de-un-sitio-web/</id>
        <title>Un comando y aplicaciones gráficas para descargar todo el contenido de un sitio web</title>
        <updated>2020-07-19T10:00:00+02:00</updated>
        <published>2020-07-19T10:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/07/un-comando-y-aplicaciones-graficas-para-descargar-todo-el-contenido-de-un-sitio-web/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" width="200" height="196" alt="GNU" title="GNU"  class=""></p>
</div>
<p>La necesidad puede ser hacer una copia de seguridad periódicas para conservar el historial del sitio web, descargar el contenido para procesarlo de alguna forma, para consultarlo sin conexión a internet u <em>offline</em> si nuestra conexión es lenta o inestable o el servidor está caído, migrar un sitio web de un servidor web a otro o descargar los archivos de vídeo, audio, imágenes o multimedia.</p>
<p>Los navegadores web con el botón derecho del ratón ofrecen la posibilidad de descargar y guardar en el sistema de archivos la página que se está visualizando, está es la opción más simple ya que no se necesitan herramientas adicionales si solo se quiere guardar una página de las muchas de un sitio web. Su desventaja es que no sirve para guardar un sitio web completo por requerir hacer la operación manualmente por cada página, de forma que para realizar la operación de forma másiva y automatizada para el sitio web completo hay que utilizar alguna herramienta especializada.</p>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="cómo-descargar-un-sitio-web-desde-la-línea-de-comandos-con-wget">Cómo descargar un sitio web desde la línea de comandos con wget</h3>
<p>La herramienta de línea de comandos <a href="https://www.gnu.org/software/wget/">wget</a> permite descargar un sitio web completo con un comando ejecutado desde la terminal incluyendo los archivos HTML y de recursos como imágenes, vídeos, contenido multimedia como audio o música, de estilos CSS o archivos JavaScript. El contenido que descarga wget es el referenciado a través de los enlaces presentes en el propio contenido, wget explora los archivos HTML en busca de enlaces a recursos u otras páginas HTML y de forma recursiva descarga el contenido completo al sistema de archivos local. Está disponible para los sistemas operativos <a href="https://www.microsoft.com/es-es/windows/">Windows</a>, <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> y <a href="https://www.apple.com/macos/">macOS</a> y es una herramienta de software libre y gratuita.</p>
<p>Basta indicar el o los dominios del sitio web de los que se quiere descargar el contenido y la URL de rastreo de inicio u otras URLs adicionales que se desean descargar. Este comando con las opciones indicadas solo descarga los enlaces del sitio web puesto como argumento, los enlaces a sitios web externos no indicados expresamente en la opción <em>&ndash;domain</em> son ignorados. El comando wget soporta numerosas opciones para personalizar la descarga explicadas en su <a href="https://www.gnu.org/software/wget/manual/wget.html">página de manual</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ wget <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--recursive <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--no-clobber <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--page-requisites <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--html-extension <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--convert-links <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--restrict-file-names<span class="o">=</span>windows <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--domains picodotdev.github.io <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;--no-parent <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;picodotdev.github.io/blog-bitix/</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>wget-download.sh</span>
    </div>
</div>
<p>Terminado el proceso de descarga el contenido del sitio web se guarda en el sistema de archivos conservando la jerarquía de carpetas de las URLs de los recursos.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/07/un-comando-y-aplicaciones-graficas-para-descargar-todo-el-contenido-de-un-sitio-web/images/archivos-sitio-web_hu5abb769a9287f1cc7ec0e2ab9530cb7d_43788_2560x1440_fit_box_3.png" data-gallery="" title="Archivos del sitio web en el explorador de archivos"><img src="https://picodotdev.github.io/blog-bitix/2020/07/un-comando-y-aplicaciones-graficas-para-descargar-todo-el-contenido-de-un-sitio-web/images/archivos-sitio-web_hu5abb769a9287f1cc7ec0e2ab9530cb7d_43788_650x450_fit_box_3.png" width="650" height="375" alt="Archivos del sitio web en el explorador de archivos" title="Archivos del sitio web en el explorador de archivos"  class="lozad "></a></p>
<figcaption>Archivos del sitio web en el explorador de archivos</figcaption>
</figure>
</div>
<p>Descargar un sitio web no es la única funcionalidad que ofrece wget, otra necesidad habitual es <a href="https://picodotdev.github.io/blog-bitix/2015/12/como-buscar-los-enlaces-rotos-de-un-sitio-web/">buscar los enlaces rotos de una página web</a> que con el paso del tiempo se van generando ya sea porque los sitios web externos desaparecen o por errores en la edición y enlazado interno. Conocer los enlaces rotos permite arreglarlos para ofrecer mejor experiencia de usuario al visitante y para mejorar el SEO en el posicionamiento en los buscadores.</p>
<h3 id="cómo-descargar-un-sitio-web-con-programas-de-interfaz-gráfica-o-páginas-web">Cómo descargar un sitio web con programas de interfaz gráfica o páginas web</h3>
<p>Hay algunas herramientas con interfaz gráfica como <a href="https://www.httrack.com/">HTTrack</a> o <a href="https://www.cyotek.com/cyotek-webcopy">Cyotek WebCopy</a> que realizan la misma tarea que wget de forma más intuitiva. Aún así el comando de wget es una forma sencilla y rápida de realizar la descarga de un sitio web completo.</p>
<p>También hay algunas herramientas o páginas web <em>online</em> que realizan la descarga de sitios web como <a href="https://websitedownloader.io">Website Downloader</a> o <a href="https://archivarix.com/en/website-downloader-cms-converter/">Archivarix</a> sin necesidad de instalar ningún programa en el ordenador aunque tienen unos límites muy reducidos que sobrepasados no son gratuitas y hay que pagar por utilizarlas.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.linuxjournal.com/content/downloading-entire-web-site-wget">Downloading an Entire Web Site with wget</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/07/las-diferencias-entre-gnu-linux-bsd-y-sus-distribuciones/</id>
        <title>Las diferencias entre GNU/Linux, BSD y sus distribuciones</title>
        <updated>2020-07-05T11:00:00+02:00</updated>
        <published>2020-07-05T11:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/07/las-diferencias-entre-gnu-linux-bsd-y-sus-distribuciones/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Las distribuciones BSD tienen aún menor cuota de uso que las distribuciones GNU/Linux pero al igual que estas tiene una licencia de software libre aún más permisiva que las GNU/Linux y también se basan en la filosofía UNIX. Pero también tienen diferencias importantes en varios aspectos.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/bsd.svg" width="250" height="116" alt="BSD" title="BSD"  class=""></p>
</div>
<p>De los sistemas operativos <a href="https://www.microsoft.com/es-es/windows/">Windows</a> de <a href="https://www.microsoft.com/">Microsoft</a> es el más popular en el uso en empresas y en los ordenadores personales con una cuota de uso del 90% prácticamente de monopolio. La siguiente opción más popular a nivel de usuario es <a href="https://www.apple.com/macos/">macOS</a> de <a href="https://www.apple.com/">Apple</a> como única opción de sus equipos portátiles y de escritorio, macOS tiene una cuota de uso de un 7%. Con una cota de uso en el escritorio de apenas el el 3% la siguiente opción es alguna de las distribuciones <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a>, tiene una cuota de uso tan pequeña porque prácticamente todos los equipos vendidos en grandes superficies incorporan Windows preinstalado, para usar GNU/Linux son los usuarios los que de forma expresa han de instalar GNU/Linux reemplazando a Windows aunque en los últimos años hay varias marcas que ofrecen GNU/Linux como opción entre ellas <a href="https://slimbook.es/">Slimbook</a> y <a href="https://www.vantpc.es/">Vant</a>. En el lado del servidor GNU/Linux si tiene una mucha mayor cuota de uso por encima incluso de Windows, muchos de los servicios ofrecidos por las compañías más importantes usan alguna distribución de GNU/Linux como sistema operativo. Las distribuciones empresariales GNU/Linux más populares son <a href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux">RHEL</a> de <a href="https://www.redhat.com/es">RedHat</a>, <a href="https://www.ubuntu.com/">Ubuntu</a> de <a href="https://www.canonical.com/">Canonical</a> o <a href="https://www.suse.com/es-es/products/server/">SLES</a> de <a href="https://www.suse.com/es-es/">SUSE</a>.</p>
<p>Otra familia de sistemas operativos basados en UNIX al igual que GNU/Linux son las distribuciones BSD. Si la cuota de uso a nivel personal de GNU/Linux es muy reducida la de los sistemas operativos BSD es aún mucho más reducida, no llega al 0,5%, teniendo algo de mayor presencia como sistema de servidores con una comunidad de usuarios pequeña pero al igual que la de GNU/Linux activa que comparte y colabora en el desarrollo.</p>
<p>Los parecidos en las distribuciones GNU/Linux y BSD es que ambos proyectos están basados en UNIX, implementan el estándar <a href="https://es.wikipedia.org/wiki/POSIX">POSIX</a> que define una interfaz con el sistema operativo para permitir que las aplicaciones sean portables entre sistemas y están desarrollados como proyectos de código abierto en los que participan organizaciones, personas como contribuidores apoyados por el interés de algunas organizaciones y personas individuales sin intereses comerciales, aún así tienen notables diferencias en varios apartados importantes. Las diferencias entre las distribuciones GNU/Linux y BSD están en la licencia que usan, en su modelo de desarrollo, en la ya comentada cuota de uso o en aspectos importantes para los usuarios como el soporte del hardware.</p>
<p>Aunque solo para representar a los proyectos una diferencia está en su mascota, en Linux es <em>Tux</em>, en BSD es <em>Beastie</em> y en GNU es un ñu.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/linux.svg" data-gallery="" title="Tux la mascota de Linux"><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/linux.svg" width="300" height="200" alt="Tux la mascota de Linux" title="Tux la mascota de Linux"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/beastie.png" data-gallery="" title="Bestie la mascota de BSD"><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/beastie.png" width="300" height="200" alt="Bestie la mascota de BSD" title="Bestie la mascota de BSD"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" data-gallery="" title="GNU la mascota de GNU"><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" width="300" height="200" alt="GNU la mascota de GNU" title="GNU la mascota de GNU"  class="lozad "></a></p>
<figcaption>Mascotas de Linux, BSD y GNU</figcaption>
</figure>
</div>
<div class="alert alert-warning tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="diferencias-en-el-modelo-de-desarrollo">Diferencias en el modelo de desarrollo</h3>
<p>Lo que conocemos como Linux es simplemente el núcleo del sistema operativo de las distribuciones GNU/Linux. Las distribuciones GNU/Linux están compuestas por otra multitud de programas de usuario que forman el sistema operativo completo y lo hacen usable, estos programas son muchos de los programados bajo los proyectos de la fundación GNU. Este es el motivo de que las distribuciones GNU/Linux incluyan los términos de ambos proyectos. Las distribuciones GNU/Linux son una recopilación de programas de terceras partes, todos estos programas GNU y no GNU incluidos en los sistemas GNU/Linux están desarrollados por diferentes programadores ajenos a Linux y los creadores de la distribución. Los creadores de las distribuciones GNU/Linux son los encargados de juntar los diferentes programas de cada fuente y empaquetarlas como un sistema usable, estable y libre de errores.</p>
<p>Las distribuciones BSD son muy diferentes en este aspecto ya que los desarrolladores del núcleo son los mismos que desarrollan los programas de usuario que hacen el sistema operativo completo.</p>
<p>Por otro lado, la arquitectura del sistema base y las aplicaciones de usuario tienen diferentes enfoques. En GNU/Linux hay dos variaciones usar una colección fija de paquetes donde solo se incorporan modificaciones de seguridad o un modelo en constante actualización o <em>rolling release</em>. Ubuntu y Debian son ejemplos de distribuciones de colecciones fijas en los ciclos de vida de las versiones y Arch Linux y <a href="https://voidlinux.org/">Void Linux</a> son ejemplos que están en constante actualización.</p>
<p>Las distribuciones BSD siguen un enfoque en el que el sistema base es fijo pero las aplicaciones de usuario se actualizan con nuevas versiones. El sistema base es pequeño, estable y solo incorpora cambios siguiendo un calendario de publicaciones. Los programas de usuario como <a href="https://www.mozilla.org/es-ES/firefox/new/">Firefox</a>, <a href="https://www.libreoffice.org/">LibreOffice</a> o el entorno de escritorio utilizan la última versión disponible de cada proyecto. Esto permite a las distribuciones BSD usar las últimas versiones sin comprometer la estabilidad del sistema al haber errores en el núcleo del sistema. Algunas distribuciones GNU/Linux proporcionan un modelo similar a las BSD como <a href="https://silverblue.fedoraproject.org/">Fedora Silverblue</a> con una base estable y aplicaciones de usuario actualizadas.</p>
<p>Esta diferencia en el modelo de desarrollo del sistema base e independiente de las aplicaciones hace que en BSD las aplicaciones se instalen de forma independiente a los paquetes del sistema. Los <em>ports</em> son la colección de paquetes con las aplicaciones instalables en los sistemas BSD.</p>
<h3 id="diferencias-en-la-licencia">Diferencias en la licencia</h3>
<p>Otro aspecto importante con diferencias está en la licencia del código fuente. Mientras que Linux usa una <a href="https://www.gnu.org/licenses/gpl-3.0.html">licencia <em>GNU General Public License</em> o GPL</a> los sistemas BSD usan una de las diferentes <a href="https://en.wikipedia.org/wiki/BSD_licenses">licencias BSD</a> que tiene diferentes versiones según su número de clausulas de cuatro a cero en cuyo caso es considerado software de dominio público. Ambas son licencias consideradas como software libre.</p>
<p>La diferencia entre la licencia GPL y BSD está en que la BSD es más permisiva, la licencia GPL impone restricciones a los programas distribuidos requiriendo que el código fuente del software también sea entregado y obliga a que el código sea compartido. Por el contrario, la licencia BSD no impone el requerimiento a los programas de que el código fuente sea entregado en su forma original del programa compilado en formato binario. En algunos casos la licencia BSD es más atractiva para algunas empresas que pueden usar su software sin necesidad de tener que distribuir el código fuente del software en el que se basan ni sus modificaciones si han hecho alguna lo que les permite mantener su propiedad intelectual oculta a sus competidores.</p>
<p>Las licencias BSD no imponen unos requerimientos éticos y morales, la licencia GPL usada por Linux tiene un mayor activismo para promover y proteger el software libre. En BSD se centran más en el desarrollo que en el activismo del software libre y de código abierto.</p>
<p>En los últimos años el soporte de hardware en Linux ha mejorado notablemente y salvo hardware muy específico o raro lo normal es que todo funcione sin  problemas importantes. El soporte de los fabricantes se centra más hacer compatible su hardware con Windows o macOS que en Linux y es mas raro aún que ofrezcan soporte para algún BSD. De modo que el soporte de hardware en los BSD es más limitado.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2021/02/licencias-de-software-libre-y-diferencias-con-software-privativo-y-de-codigo-abierto/">Licencias de software libre y diferencias con software privativo y de código abierto</a></li>
</ul>
<h3 id="distribuciones-más-importantes-bsd">Distribuciones más importantes BSD</h3>
<p>Al igual que en GNU/Linux ha varias distribuciones BSD con algunos propósitos más prioritarios en cada una de ellas. Soportan múltiples arquitecturas de procesadores incluyendo x86, ARM, MIPS, PowerPC y UltraSPARC. Estas son algunas de las distribuciones BSD más conocidas:</p>
<ul>
<li><a href="https://www.freebsd.org/es/">FreeBSD</a>: es el BSD más popular, con el objetivo de proporcionar alto rendimiento y facilidad de uso. Soporta múltiples <a href="https://www.freebsd.org/platforms/">plataformas de 32 y 64 bits</a>.</li>
<li><a href="https://www.openbsd.org/">OpenBSD</a>: esta distribución está diseñada para la máxima seguridad realizando modificaciones de forma proactiva que otros vendedores no son capaces de hacer e integrando  criptografía.</li>
<li><a href="https://www.netbsd.org/">NetBSD</a>: uno de sus principios es hacer el sistema operativo altamente portable, valores por defecto seguros, calidad de código, corrección y adhesión a estándares.</li>
<li><a href="https://www.midnightbsd.org/">MidnightBSD</a>: es una distribución BSD orientada al escritorio que incluye las aplicaciones de usuario básicas como navegador, correo electrónico, procesador de textos, juegos y muchos más.</li>
<li><a href="https://nomadbsd.org/">NomadBSD</a>: es una distribución que funciona desde un medio vivo orientada a uso con entorno de escritorio.</li>
</ul>
<p>Hay otros sistemas BSD notables:</p>
<ul>
<li><a href="https://www.dragonflybsd.org/">DragonFly BSD</a>: sigue un camino diferente al de las anteriores BSD. Algunas características diferenciadoras son su sistema de archivos de alto rendimiento HAMMER, kernels virtuales, alto rendimiento en múltiples procesadores con SMP con poca contención.</li>
<li><a href="https://en.wikipedia.org/wiki/Darwin_%28operating_system%29">Darwin</a> / Mac OS X: los sistema de Apple con Mac OS X están basados en BSD.</li>
<li><a href="https://es.wikipedia.org/wiki/PlayStation_4">PlayStation 4</a>: el sistema operativo Orbis de esta consola está basado en FreeBSD 9.</li>
</ul>
<div class="media">
<figure>
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/freebsd.svg" width="150" height="150" alt="FreeBSD" title="FreeBSD"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/openbsd.svg" width="150" height="150" alt="OpenBSD" title="OpenBSD"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/netbsd.svg" width="150" height="150" alt="NetBSD" title="NetBSD"  class="lozad "></p>
</figure>
</div>
<div class="media">
<figure>
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/midnightbsd.svg" width="150" height="150" alt="MidnightBSD" title="MidnightBSD"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/dragonflybsd.svg" width="150" height="150" alt="DragonFly" title="DragonFly"  class="lozad "></p>
<figcaption>Varias de las distribuciones más importantes de BSD</figcaption>
</figure>
</div>
<p>La publicación digital <a href="https://bsdmag.org/">BSD Magazine</a> gratuita bajo suscripción se publica de forma mensual con varios artículos técnicos dedicados a las diferentes distribuciones BSD. Permite adentrarse en el mundo de la distribuciones BSD. Más información sobre las distribuciones en la Wikipedia.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/FreeBSD">Wikipedia FreeBSD</a></li>
<li><a href="https://en.wikipedia.org/wiki/OpenBSD">Wikipedia OpenBSD</a></li>
<li><a href="https://en.wikipedia.org/wiki/NetBSD">Wikipedia NetBSD</a></li>
<li><a href="https://en.wikipedia.org/wiki/DragonFly_BSD">Wikipedia DragonFly BSD</a></li>
<li><a href="https://en.wikipedia.org/wiki/MacOS">Wikipedia macOS</a></li>
</ul>
<h3 id="razones-por-las-que-usar-y-no-usar-una-distribución-bsd">Razones por las que usar y no usar una distribución BSD</h3>
<p>Entre las razones para usar BSD están:</p>
<ul>
<li>Posibilidad de usar características de Solaris como el avanzado sistema de archivos <a href="https://en.wikipedia.org/wiki/OpenZFS">ZFS</a> o <a href="https://en.wikipedia.org/wiki/DTrace">DTrace</a>.</li>
<li>La comunidad BSD se centra más en la tecnología que en los aspectos de licencia y políticos del software libre.</li>
<li>Estabilidad y sistema bien estructurado.</li>
<li>Alto rendimiento y gran desempeño en tareas de red.</li>
<li>Menos fragmentación en distribuciones como ocurren en Linux donde algunas no tiene objetivos claros diferenciadores.</li>
<li>La licencia BSD.</li>
<li>ZFS.</li>
</ul>
<p>Algunas de las razones por las que no usar BSD están:</p>
<ul>
<li>Falta de soporte hardware.</li>
<li>No hay soporte para suspender y continuar en portátiles.</li>
<li>Ausencia en móviles y algunas funcionalidades inexistentes.</li>
<li>Más fácil de usa Mac OS X que FreeBSD.</li>
<li><em>ports</em> rotos.</li>
<li>Menos información y ayuda en internet que de GNU/Linux.</li>
</ul>
<h3 id="distribuciones-más-importantes-de-gnulinux">Distribuciones más importantes de GNU/Linux</h3>
<p>Las distribuciones GNU/Linux son más numerosas si bien es cierto que muchas de ellas no tienen un objetivo que las diferencie claramente de otras. Algunas importantes son:</p>
<ul>
<li><a href="https://fedoraproject.org/">Fedora</a>, <a href="https://www.centos.org/">CentOS</a>, RHEL.</li>
<li>Ubuntu, <a href="https://www.debian.org/">Debian</a>, <a href="https://www.linuxmint.com/">Linux Mint</a>, <a href="https://elementary.io/es/">elementary OS</a>.</li>
<li><a href="https://www.opensuse.org/">openSUSE</a>.</li>
<li><a href="https://www.archlinux.org/">Arch Linux</a>.</li>
</ul>
<div class="media">
<figure>
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/ubuntu.svg" width="150" height="150" alt="Ubuntu" title="Ubuntu"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/opensuse.svg" width="150" height="150" alt="openSUSE" title="openSUSE"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/debian.svg" width="150" height="150" alt="Debian" title="Debian"  class="lozad "></p>
</figure>
</div>
<div class="media">
<figure>
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/archlinux.svg" width="150" height="150" alt="Arch Linux" title="Arch Linux"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/fedora.svg" width="150" height="150" alt="Fedora" title="Fedora"  class="lozad ">
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/elementary.svg" width="150" height="150" alt="elementary OS" title="elementary OS"  class="lozad "></p>
</figure>
</div>
<p>He escrito algunos artículos para <a href="https://picodotdev.github.io/blog-bitix/2016/10/elegir-una-distribucion-gnu-linux-segun-el-usuario-uso-o-equipo/">elegir la mejor distribución GNU/Linux</a> según las necesidades del usuario o uso. <a href="https://picodotdev.github.io/blog-bitix/2017/05/descargar-e-instalar-la-distribucion-ubuntu-de-gnu-linux-paso-a-paso-desde-cero/">Cómo descargar e instalar Ubuntu paso paso desde cero</a>, una de las distribuciones más populares y recomendadas para los usuarios recién llegados a GNU/Linux y que muchos usuarios con experiencia siguen usando. <a href="https://picodotdev.github.io/blog-bitix/2020/02/las-aplicaciones-integradas-del-entorno-de-escritorio-gnome/">Las aplicaciones del entorno de escritorio GNOME</a> con las que los usuarios interaccionan con la computadora o <a href="https://picodotdev.github.io/blog-bitix/2020/05/introduccion-y-uso-basico-de-la-distribucion-gnu-linux-fedora-silverblue/">la distribución Fedora Silverblue</a> con una aproximación diferente a la mayoría de las distribuciones con un sistema inmutable y basado en contenedores que le dota de mayor fiabilidad al realizar actualizaciones del sistema que en ciertos aspectos se parece a las distribuciones BSD al separar el sistema base de las aplicaciones.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.howtogeek.com/190773/htg-explains-whats-the-difference-between-linux-and-bsd/">What’s the Difference Between Linux and BSD?</a></li>
<li><a href="https://fossbytes.com/difference-linux-bsd-open-source/">Difference Between Linux And BSD | Open Source Operating Systems</a></li>
<li><a href="https://en.wikipedia.org/wiki/BSD_licenses">BSD licenses</a></li>
<li><a href="https://distrowatch.com/weekly.php?issue=20200622#qa">BSD versus Linux distribution development</a></li>
<li><a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTExMDg">Why Should You Use FreeBSD? Here&rsquo;s Some Reasons</a></li>
<li><a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTExMjE">Reasons Why You Should Not Use FreeBSD</a></li>
<li><a href="https://www.freebsd.org/ports/">FreeBSD Ports</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
                <category term="software-libre"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/</id>
        <title>Comando para convertir una imagen SVG a PNG y JPG con diferentes tamaños y color de fondo con Inkskape</title>
        <updated>2020-06-14T10:45:00+02:00</updated>
        <published>2020-06-14T09:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>El formato de imagen SVG tiene la ventaja de permitir el escalado de la imagen sin pérdida de calidad y suele tener menor tamaño que la imagen equivalente en formato PNG y JPG. Si es necesario la imagen SVG es exportable a formato de imagen PNG y JPG con el tamaño deseado o color de fondo. El editor de imágenes Inkscape permite con su utilidad de línea de comandos automatizar y exportar archivos SVG a PNG y JPG y ocultar y mostrar las capas deseadas del archivo original para obtener el resultado deseado en la exportación.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/inkscape.svg" width="200" height="200" alt="Inkscape" title="Inkscape"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/gnu.svg" width="200" height="196" alt="GNU" title="GNU"  class=""></p>
</div>
<p>El formato de imagen SVG es un formato de imagen vectorial donde las líneas, formas, posición y colores se describen en formato texto, tiene la ventaja de ser un formato escalable que no pierde resolución independiente del tamaño de imagen en la que se represente, es decir, la imagen tiene la misma calidad al tamaño <em>full hd</em> 1920x1080 que a 4K 3840x2560 que en 800x600 píxeles.</p>
<p>Con las imágenes de fotos en formato JPG y sin pérdida de calidad PNG la resolución adecuada para mostrar estas imágenes es la original del archivo a otra resolución hay que hacer un escalado con un algoritmo para añadir o quitar píxeles, el escalado es una operación imprecisa que resta algo de calidad a la imagen. <a href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-miniaturas-o-vistas-previas-de-imagenes-con-imagemagick/">Escalar el tamaño de una imagen JPG o PNG</a> es necesario para obtener la imagen en otros tamaños, dependiendo del número de píxeles a añadir si se hace más grande que la original o píxeles a quitar si se reduce el tamaño la pérdida de calidad se nota más o menos.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/201607_hu155add02d6c6e28845a8452d31796ba4_1042102_2560x1440_fit_q90_box.jpg" data-gallery="" title="Imagen en formato JPG original"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/201607_hu155add02d6c6e28845a8452d31796ba4_1042102_300x200_fit_q90_box.jpg" width="300" height="200" alt="Imagen en formato JPG original" title="Imagen en formato JPG original"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/201607-thumb-300x200_hue65376be7c7ffd5e9c6116f7adcd1047_48389_2560x1440_fit_q90_box.jpg" data-gallery="" title="Imagen en formato JPG escalada a 300x200 píxeles"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/201607-thumb-300x200_hue65376be7c7ffd5e9c6116f7adcd1047_48389_300x200_fit_q90_box.jpg" width="300" height="200" alt="Imagen en formato JPG escalada a 300x200 píxeles" title="Imagen en formato JPG escalada a 300x200 píxeles"  class="lozad "></a></p>
<figcaption>Imagen en formato JPG original y escalada a 300x200 píxeles</figcaption>
</figure>
</div>
<p>Los navegadores y dispositivos móviles ya soportan como formato de imagen el SVG, en la web y los dispositivos móviles es especialmente adecuado este formato ya que además de adaptarse a la variedad de tamaños de los dispositivos de escritorio o móviles suelen tener un menor tamaño de archivo lo que hace que se descarguen más rápido al requerir menos ancho de banda.</p>
<p>Aún con los beneficios que posee el formato SVG algunas aplicaciones no soportan el formato SVG y en este caso es necesario hacer una conversión de SVG a los formatos binarios <em>rasterizados</em> PNG o JPG. El formato SVG permite obtener estas imágenes PNG y JPG en diferentes tamaños sin pérdida de calidad.</p>
<p><a href="https://inkscape.org/es/">Inkscape</a> es un editor de imágenes vectoriales con una utilidad de línea de comandos que permite convertir y exportar imágenes en formato SVG a PNG y JPG en el tamaño y con el color de fondo deseado. El siguiente comando convierte todos los archivos SVG a PNG de una carpeta. En el comando se indican varios parámetros como la anchura deseada de la imagen, el color de fondo, los identificativos de las capas a exportar, el formato de salida y el nombre del archivo creado. Posteriormente con un segundo comando hay que <a href="https://picodotdev.github.io/blog-bitix/2019/12/comando-para-convertir-imagenes-jpeg-y-png-a-webp/">convertir las imágenes de formato PNG a JPG</a>, dependiendo del tipo de imagen, los colores y degradados de la imagen el tamaño en formato PNG será mayor o menor que en formato JPG.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="k">for</span> f in *.svg<span class="p">;</span> <span class="k">do</span> inkscape -w <span class="m">750</span> <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span> --export-background white --export-background-opacity <span class="m">1</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="k">$(</span>basename <span class="si">${</span><span class="nv">f</span><span class="p">%.*</span><span class="si">}</span><span class="k">)</span><span class="s2">-750.png&#34;</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="k">for</span> f in *.png<span class="p">;</span> <span class="k">do</span> convert <span class="s2">&#34;</span><span class="nv">$f</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">f</span><span class="p">%.*</span><span class="si">}</span><span class="s2">.jpg&#34;</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>inkscape-convert-svg-png.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry.svg" data-gallery="" title="Imagen original en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry.svg" width="300" height="200" alt="Imagen original en formato SVG" title="Imagen original en formato SVG"  class="lozad "></a></p>
<figcaption>Imagen original en formato SVG</figcaption>
</figure>
</div>
<p>El editor Inkscape permite definir capas con diferentes elementos de la imagen, la linea de comandos permite exportar únicamente capas deseadas de la imagen para obtener el resultado deseado en la exportación. El SVG anterior contiene en el mismo archivo diferentes capas con diferentes versiones de la imagen adecuadas para un fondo claro y oscuro.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span><span class="lnt">9&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">BASENAME</span><span class="o">=</span><span class="s2">&#34;apache-tapestry&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ARTWORK_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-artwork.svg&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id lightObject --export-background white -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-800-light.png&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id darkObject --export-background black -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-800-dark.png&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id lightIconObject --export-background white -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-800-light.png&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id darkIconObject --export-background black -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-800-dark.png&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id lightTextObject --export-background white -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-800-light.png&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ inkscape <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> --export-id-only --export-id darkTextObject --export-background black -w <span class="m">800</span> --export-type png --export-filename <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-800-dark.png&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>inkscape-png-versions.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-800-light_hu7e5404fb1aa31fe342672ad8214b2b9f_60725_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-800-light_hu7e5404fb1aa31fe342672ad8214b2b9f_60725_300x200_fit_box_3.png" width="300" height="134" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-800-dark_hub5b4d74b8d14e46515940c00029d3bc7_61131_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-800-dark_hub5b4d74b8d14e46515940c00029d3bc7_61131_300x200_fit_box_3.png" width="300" height="134" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-800-light_hu63592ed543dc04b632a0db3b544af56d_82881_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-800-light_hu63592ed543dc04b632a0db3b544af56d_82881_300x200_fit_box_3.png" width="200" height="200" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-800-dark_hu5561b3fa2c992556c74875e00a747250_83588_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-800-dark_hu5561b3fa2c992556c74875e00a747250_83588_300x200_fit_box_3.png" width="200" height="200" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-800-light_hu71918ce05912a609bbe5cfa98bdae2be_39579_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-800-light_hu71918ce05912a609bbe5cfa98bdae2be_39579_300x200_fit_box_3.png" width="300" height="134" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-800-dark_hud4e768763c312754ca970d2d59adcda4_39231_2560x1440_fit_box_3.png" data-gallery="" title="Imagen en formato PNG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-800-dark_hud4e768763c312754ca970d2d59adcda4_39231_300x200_fit_box_3.png" width="300" height="134" alt="Imagen en formato PNG" title="Imagen en formato PNG"  class="lozad "></a></p>
<figcaption>Diferentes versiones de la imagen SVG en formato PNG</figcaption>
</figure>
</div>
<p>También es posible modificar el SVG original para mostrar y ocultar las capas visibles del archivo. Los siguientes comandos permiten exportar a PNG la imagen en diferentes versiones (icono y texto, solo icono o solo texto), con diferente color de fondo (transparente, blanco y negro) y en diferente tamaño. Esto permite automatizar y hacerlo mucho más rápido que el repetitivo proceso que sería realizar manualmente la exportación usando la interfaz gráfica de Inkscape.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span><span class="lnt">9&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">BASENAME</span><span class="o">=</span><span class="s2">&#34;apache-tapestry&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ARTWORK_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-artwork.svg&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-light.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-light.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerToggleHide --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-dark.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icon-dark.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerPrev --verb LayerToggleHide --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-light.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-light.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerPrev --verb LayerPrev --verb LayerToggleHide --verb EditDeselect --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-dark.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-text-dark.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerToggleHide --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-light.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-light.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerToggleHide --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="o">(</span>cp <span class="s2">&#34;</span><span class="nv">$ARTWORK_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-dark.svg&#34;</span> <span class="o">&amp;&amp;</span> inkscape <span class="s2">&#34;</span><span class="nv">$BASENAME</span><span class="s2">-icontext-dark.svg&#34;</span> --verb LayerHideAll --verb DialogLayers --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerPrev --verb LayerToggleHide --verb FitCanvasToDrawing --verb FileSave --verb FileQuit<span class="o">)</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>inkscape-svg-versions.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-light.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-light.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="white-background lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-dark.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icontext-dark.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="black-background lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-light.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-light.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="white-background lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-dark.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-icon-dark.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="black-background lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-light.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-light.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="white-background lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-dark.svg" data-gallery="" title="Imagen en formato SVG"><img src="https://picodotdev.github.io/blog-bitix/2020/06/comando-para-convertir-una-imagen-svg-a-png-y-jpg-con-diferentes-tamanos-y-color-de-fondo-con-inkskape/images/apache-tapestry-text-dark.svg" width="300" height="200" alt="Imagen en formato SVG" title="Imagen en formato SVG"  class="black-background lozad "></a></p>
<figcaption>Diferentes versiones de la misma imagen SVG</figcaption>
</figure>
</div>
]]>
        </content>
        
            
                <category term="gnu-linux"/>
            
                <category term="planeta-codigo"/>
            
                <category term="software-libre"/>
            
        
    </entry>
    
</feed>