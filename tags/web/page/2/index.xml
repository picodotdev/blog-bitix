<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title type="text">Blog Bitix</title>
    <subtitle type="text">Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</subtitle>
    <link rel="self" href="https://picodotdev.github.io/blog-bitix/index.xml"/>
    <link href="https://picodotdev.github.io/blog-bitix/" />
    <id>https://picodotdev.github.io/blog-bitix/tags/web/</id>
    <updated>2021-09-12T00:30:00+02:00</updated>
    <author><name>picodotdev</name></author>
    <generator>Hugo</generator>
    <icon>https://picodotdev.github.io/blog-bitix/assets/favicon.ico</icon>
    <logo>https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg</logo>
    <rights>https://creativecommons.org/licenses/by-sa/4.0/</rights>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2019/06/comprobar-la-seguridad-de-un-sitio-web-que-use-ssl-tls/</id>
        <title>Comprobar la seguridad de un sitio web que use SSL/TLS</title>
        <updated>2019-06-23T12:00:00+02:00</updated>
        <published>2019-06-23T12:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2019/06/comprobar-la-seguridad-de-un-sitio-web-que-use-ssl-tls/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<p>Aunque un sitio web no trate datos sensibles como tarjetas de crédito o datos personales es muy recomendable que use el protocolo seguro HTTPS para proporcionar cifrado entre el servidor y el navegador del usuario para dotar de confidencialidad a las comunicaciones a la vez que evitar modificaciones por terceras personas de los datos transmitidos. Además, el buscador Google lo tiene en cuenta para el SEO o posicionamiento en su buscador.</p>
<p>Para usar HTTPS lo difícil era conseguir un certificado firmado por una autoridad de confianza que los navegadores tengan instalada, la obtención y renovación de un certificado tenía un coste. Desde hace un tiempo la autoridad <a href="https://letsencrypt.org/">Let&rsquo;s encrypt</a> emite certificados digitales gratuitamente que proporciona uno en pocos minutos y de forma automatizada incluida la renovación para usar un protocolo seguro. <a href="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/">Usar un certificado de Let&rsquo;s encrypt en el servidor web nginx</a> no es complicado.</p>
<p>Sin embargo, usar HTTPS simplemente no es suficiente y ha de configurarse el servidor web para que utilice algoritmos de cifrado fuertes y que no tengan problemas seguridad conocidos o hoy estén ya considerados débiles. Para analizar el nivel de seguridad proporcionado en las conexiones HTTPS de un servidor web se puede utilizar la herramienta <a href="https://www.ssllabs.com/">Qualys SSL Labs</a>. Por ejemplo, analizando la seguridad del protocolo HTTPS ofrecido por <a href="https://pages.github.com/">GitHub Pages</a> basta con introducir el dominio a analizar.</p>
<p>El informe que proporciona incluye información sobre el certificado del servidor entre ella su tiempo de validez y fecha de expiración, y si es de confianza para los navegadores y plataformas como Mozilla, Apple, Android, Java o Windows. Los datos de configuración como protocolos soportados, <em>cipher suites</em> y una simulación de <em>handshake</em> con una gran variedad de versiones de navegadores en diferentes plataformas y versiones incluyendo dispositivos móviles y de escritorio que permite conocer si algún dispositivo pudiera tener algún problema con la configuración de TLS en la conexión, también otros detalle del protocolo.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2019/06/comprobar-la-seguridad-de-un-sitio-web-que-use-ssl-tls/images/ssllabs_hu45897026cba3d1771fd184de0c40861a_124032_2560x1440_fit_box_3.png" data-gallery="" title="Informe de seguridad TLS"><img src="https://picodotdev.github.io/blog-bitix/2019/06/comprobar-la-seguridad-de-un-sitio-web-que-use-ssl-tls/images/ssllabs_hu45897026cba3d1771fd184de0c40861a_124032_650x450_fit_box_3.png" width="373" height="450" alt="Informe de seguridad TLS" title="Informe de seguridad TLS"  class="lozad "></a></p>
<figcaption>Informe de seguridad TLS</figcaption>
</figure>
</div>
<p>La herramienta proporciona una nota entre A y F siendo la A la mejor calificación posible. Como se observa en la captura para GitHub Pages la herramienta proporciona una calificación de A.</p>
<p>Hay múltiples combinaciones de algoritmos de cifrado o <em>cipher suites</em> usados en una conexión SSL/TLS. La primera parte de los siguientes se refieren a TLS, está el tamaño de la clave y el modo y el algoritmo de autenticación del mensaje. Algunas recomendaciones de uso es usar tamaños de clave de más de 128 bits, evitar usar RC4, DES y 3DES, preferir ECDHE y DHE ya que ofrecen <em>forward secrecy</em> que protege las comunicaciones pasadas aún habiéndose comprometida la clave privada del servidor.</p>
<ul>
<li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</li>
<li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</li>
<li>TLS_RSA_WITH_AES_256_CBC_SHA256</li>
<li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384</li>
<li>TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384</li>
<li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256</li>
<li>TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</li>
<li>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_RSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_ECDH_RSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_DHE_RSA_WITH_AES_256_CBC_SHA</li>
<li>TLS_DHE_DSS_WITH_AES_256_CBC_SHA</li>
<li>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</li>
</ul>
<p>Y algunas propiedades de los servidores web <a href="https://httpd.apache.org/">Apache HTTP</a> y <a href="https://nginx.org/">nginx</a> que afectan a los algoritmos de cifrado soportados son las siguientes. Algunos navegadores antiguos puede que no soporten los últimos algoritmos de cifrado por lo que hay que permitir en el servidor web unos que sean considerados como seguros pero que también soporten los navegadores de los usuarios del sitio web.</p>
<ul>
<li><a href="https://httpd.apache.org/docs/current/mod/mod_ssl.html">Apache Module mod_ssl</a></li>
<li><a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html">Nginx Module ngx_http_ssl_module</a></li>
</ul>
<p>Uan vez configurada la seguridad con TLS/SSL es recomendable <a href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/">redirigir el tráfico del protocolo HTTP no seguro al protocolo HTTPS seguro</a>.</p>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="seguridad"/>
            
                <category term="software"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2019/06/pruebas-de-carga-y-rendimiento-de-un-servicio-web-con-apache-bench/</id>
        <title>Pruebas de carga y rendimiento de un servicio web con Apache Bench</title>
        <updated>2019-06-14T17:00:00+02:00</updated>
        <published>2019-06-14T17:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2019/06/pruebas-de-carga-y-rendimiento-de-un-servicio-web-con-apache-bench/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>En algunos que un servicio devuelva los datos esperados no es suficiente, otros requisitos no funcionales o de términos de servicio son que sus tiempos de respuesta sean menores al especificado en sus requisitos, que sea capaz de soportar cierto número de peticiones concurrentes o de atender un número de peticiones por minuto. Para asegurar que el servicio es capaz de cumplir estos requisitos funcionales hay que utilizar herramientas que permitan evaluar su desempeño, una de ellas muy fácil de utilizar y que proporciona valiosa información es Apache Bench.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/apache.svg" width="200" height="353" alt="Apache" title="Apache"  class=""></p>
</div>
<p>Para hacer pruebas de carga o medir el rendimiento de cualquier servicio que funcione mediante el protocolo HTTP hay multitud de herramientas. Una de las más sencillas de utilizar y con un informe con información interesante es <a href="https://httpd.apache.org/docs/current/programs/ab.html">Apache Bench</a> o simplemente <em>ab</em>. Este comando se puede utilizar con simplemente tres parámetros el <em>endpoint</em> a probar, el número de peticiones en total a realizar (<em>-n</em>) y cuantas peticiones concurrentes al mismo tiempo (<em>-c</em>). Otos parámetros son los datos POST a enviar, cabeceras (<em>-H</em>) y <em>cookies</em> (<em>-C</em>) de las peticiones, tiempos de <em>timeout</em> (<em>-s</em>) o certificado de cliente (<em>-E</em>) entre algunos otros. En vez limitar las pruebas a un número de peticiones las pruebas se pueden limitar a un tiempo determinado por ejemplo 60 segundos (<em>-t</em>).</p>
<p>Es una herramienta que se utiliza para medir el rendimiento de el servidor Apache pero utilizable para cualquier otro servicio por ejemplo una web o una API REST o <a href="https://graphql.org/">GraphQL</a>. Está disponible por supuesto para <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> pero también para <a href="https://www.apple.com/macos/">macOS</a> y para <a href="https://www.microsoft.com/es-es/windows/">Windows</a>.</p>
<p>Si quisiese medir el rendimiento en mi blog alojado en <a href="https://pages.github.com/">GitHub Pages</a> podría hacerlo lanzando 1000 peticiones para que sea una muestra suficientemente amplia con 20 usuarios de forma concurrente que son los que en los momentos de más tráfico tiene mi blog. Mi conexión de internet es un ADSL que no llega a 1 MB/s de subida por lo que la conexión en cierta medida limite el test.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ab -n <span class="m">1000</span> -c <span class="m">20</span> https://picodotdev.github.io/blog-bitix/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ab.sh</span>
    </div>
</div>
<p>El informe de resultado que ofrece <em>ab</em> al finalizar la prueba incluye el tiempo dedicado en la conexión, en el procesado, esperando y en total con los valores para cada uno de ellos con mínimo y máximo, de media y la mediana. El tiempo total empleado por la prueba, el protocolo SSL/TLS usado, los bytes devueltos en la petición, el número de peticiones servidas por segundo, el tiempo de media empleado de media por cada petición y de media teniendo en cuenta la concurrencia, la tasa de transferencia en la respuesta y finalmente el tiempo de respuesta según percentil que van que desde el 50 al 100, es decir, que el 50% de las peticiones se han respondido en el tiempo en milisegundos indicado. Si las hubiera también muestra las peticiones fallidas y las que han devuelto un código de respuesta distinto de 200.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">This is ApacheBench, Version 2.3 &lt;$Revision: 1843412 $&gt;&#10;</span></span><span class="line"><span class="cl">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/&#10;</span></span><span class="line"><span class="cl">Licensed to The Apache Software Foundation, http://www.apache.org/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Benchmarking picodotdev.github.io (be patient)&#10;</span></span><span class="line"><span class="cl">Completed 100 requests&#10;</span></span><span class="line"><span class="cl">Completed 200 requests&#10;</span></span><span class="line"><span class="cl">Completed 300 requests&#10;</span></span><span class="line"><span class="cl">Completed 400 requests&#10;</span></span><span class="line"><span class="cl">Completed 500 requests&#10;</span></span><span class="line"><span class="cl">Completed 600 requests&#10;</span></span><span class="line"><span class="cl">Completed 700 requests&#10;</span></span><span class="line"><span class="cl">Completed 800 requests&#10;</span></span><span class="line"><span class="cl">Completed 900 requests&#10;</span></span><span class="line"><span class="cl">Completed 1000 requests&#10;</span></span><span class="line"><span class="cl">Finished 1000 requests&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Server Software:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GitHub.com&#10;</span></span><span class="line"><span class="cl">Server Hostname:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;picodotdev.github.io&#10;</span></span><span class="line"><span class="cl">Server Port:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;443&#10;</span></span><span class="line"><span class="cl">SSL/TLS Protocol:&nbsp;&nbsp;&nbsp;&nbsp;   TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128&#10;</span></span><span class="line"><span class="cl">Server Temp Key:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X25519 253 bits&#10;</span></span><span class="line"><span class="cl">TLS Server Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;picodotdev.github.io&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Document Path:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /blog-bitix/&#10;</span></span><span class="line"><span class="cl">Document Length:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;28389 bytes&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Concurrency Level:&nbsp;&nbsp;&nbsp;&nbsp;  20&#10;</span></span><span class="line"><span class="cl">Time taken for tests:   29.220 seconds&#10;</span></span><span class="line"><span class="cl">Complete requests:&nbsp;&nbsp;&nbsp;&nbsp;  1000&#10;</span></span><span class="line"><span class="cl">Failed requests:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&#10;</span></span><span class="line"><span class="cl">Total transferred:&nbsp;&nbsp;&nbsp;&nbsp;  29007394 bytes&#10;</span></span><span class="line"><span class="cl">HTML transferred:&nbsp;&nbsp;&nbsp;&nbsp;   28389000 bytes&#10;</span></span><span class="line"><span class="cl">Requests per second:&nbsp;&nbsp;&nbsp;&nbsp;34.22 [#/sec] (mean)&#10;</span></span><span class="line"><span class="cl">Time per request:&nbsp;&nbsp;&nbsp;&nbsp;   584.404 [ms] (mean)&#10;</span></span><span class="line"><span class="cl">Time per request:&nbsp;&nbsp;&nbsp;&nbsp;   29.220 [ms] (mean, across all concurrent requests)&#10;</span></span><span class="line"><span class="cl">Transfer rate:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  969.45 [Kbytes/sec] received&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Connection Times (ms)&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  min  mean[+/-sd] median   max&#10;</span></span><span class="line"><span class="cl">Connect:&nbsp;&nbsp;&nbsp;&nbsp;  149  349 149.7&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;&nbsp;&nbsp;&nbsp;1361&#10;</span></span><span class="line"><span class="cl">Processing:   122  225  75.5&nbsp;&nbsp;&nbsp;&nbsp;207&nbsp;&nbsp;&nbsp;&nbsp; 586&#10;</span></span><span class="line"><span class="cl">Waiting:&nbsp;&nbsp;&nbsp;&nbsp;   53  122  68.8&nbsp;&nbsp;&nbsp;&nbsp;108&nbsp;&nbsp;&nbsp;&nbsp; 481&#10;</span></span><span class="line"><span class="cl">Total:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;329  574 174.0&nbsp;&nbsp;&nbsp;&nbsp;512&nbsp;&nbsp;&nbsp;&nbsp;1612&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Percentage of the requests served within a certain time (ms)&#10;</span></span><span class="line"><span class="cl">  50%&nbsp;&nbsp;&nbsp;&nbsp;512&#10;</span></span><span class="line"><span class="cl">  66%&nbsp;&nbsp;&nbsp;&nbsp;534&#10;</span></span><span class="line"><span class="cl">  75%&nbsp;&nbsp;&nbsp;&nbsp;555&#10;</span></span><span class="line"><span class="cl">  80%&nbsp;&nbsp;&nbsp;&nbsp;744&#10;</span></span><span class="line"><span class="cl">  90%&nbsp;&nbsp;&nbsp;&nbsp;832&#10;</span></span><span class="line"><span class="cl">  95%&nbsp;&nbsp;&nbsp;&nbsp;915&#10;</span></span><span class="line"><span class="cl">  98%   1104&#10;</span></span><span class="line"><span class="cl">  99%   1171&#10;</span></span><span class="line"><span class="cl"> 100%   1612 (longest request)</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ab.out</span>
    </div>
</div>
<p>Esta herramienta puede ser utilizada para par medir el rendimiento de cualquier servicio web. Un blog de <a href="https://wordpress.org/">Wordpress</a>, una página de una organización, un <em>endpoint</em> de un servicio REST o GraphQL, etc&hellip; Es muy sencilla de utilizar y genera un informe corto pero con interesante información sobre el rendimiento. Si se hacen cambios se puede medir el antes y el después y comparar los resultados para observar de que modo han afectado al rendimiento si de forma positiva o negativa y en que grado.</p>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/</id>
        <title>Instalar y renovar un certificado de Let&#39;s Encrypt en Nginx</title>
        <updated>2017-08-18T17:00:00+02:00</updated>
        <published>2017-08-12T11:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Let&rsquo;s Encrypt es una entidad que emite certificados TLS/SSL que son reconocidos como de confianza por los navegadores web. Usando esta entidad de certificación es posible obtener y renovar un certificado TLS/SSL de forma automatizada, rápida y sin coste alguno.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/lets-encrypt.svg" width="350" height="83" alt="Let&amp;#39;s Encrypt" title="Let&amp;#39;s Encrypt"  class=""></p>
</div>
<p><a href="https://www.google.es/">Google</a> ha anunciado que su buscador va a considerar el uso del protocolo seguro HTTPS como un criterio de <abbr title="Search Engine Optimization">SEO</abbr> y posicionamiento en la lista de resultados, posicionando mejor aquellas páginas web que usen el protocolo seguro. Además, el navegador <a href="https://www.google.es/chrome/browser/desktop/">Chrome</a> va a advertir al usuario para algunas páginas que usen solo HTTP que esas páginas son inseguras. Por estos motivos y para mayor seguridad y privacidad del usuario es conveniente usar el protocolo seguro HTTPS.</p>
<p>El mayor inconveniente de usar el protocolo seguro HTTPS es que es necesario un certificado firmado por una autoridad de confianza instalada en el navegador del usuario. Hasta ahora había que comprar el certificado que puede llegar a tener un coste de más de 100 €, instalarlo en el servidor y renovarlo antes de su fecha de expiración. Tareas quizá manuales por tanto tediosas y propensas a que surjan errores o se nos olvide hacer la renovación del certificado sobre todo si son múltiples los certificados a gestionar.</p>
<p>Para mejorar la seguridad en la web y facilitar la administración de certificados hace un tiempo se creó una entidad <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> asociado a la <a href="https://www.linuxfoundation.org/">Linux Foundation</a> con la que es posible automatizar la obtención y renovación de un certificado TLS/SSL firmado por una autoridad de confianza para los navegadores. Además Let&rsquo;s Encrypt permite obtener un certificado sin ningún coste, de forma gratuita.</p>
<p>Los pasos para usar en un servidor web un certificado de Let&rsquo;s Encrypt son los siguientes. Primero hay que instalar el <a href="https://www.archlinux.org/packages/community/any/certbot/">paquete certbot</a> según la distribución de GNU/Linux, en <a href="https://www.archlinux.org/">Arch Linux</a>:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># pacman -S certbot</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>pacman.sh</span>
    </div>
</div>
<p>En el proceso de obtención del certificado demostraremos que somos los propietarios del sitio web a certificar. Usando <a href="https://nginx.org/">nginx</a> como servidor web, iniciado y el dominio a certificar con la opción <em>-d</em> se usa el siguiente comando:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># certbot certonly --webroot -w /usr/share/nginx/html -d smaug.l5.ca</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>certbot.sh</span>
    </div>
</div>
<p>El certificado obtenido tiene una fecha de expiración de únicamente tres meses periodo antes del cual hay que renovarlo. Para hacer la renovación hay que usar el comando:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># certbot renew</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>certbot-renew.sh</span>
    </div>
</div>
<p>La renovación del certificado se realiza cuando queda poco tiempo para que expire, unos 30 días, el siguiente comando permite comprobar antes si la configuración es correcta para realizar la renovación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># certbot renew --dry-run</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>certbot-renew-dry-run.sh</span>
    </div>
</div>
<p>La clave privada y certificado que Let&rsquo;s Encrypt genera una vez el dominio se ha validado se ubican en el directorio <em>/etc/letsencrypt/live/</em> con una carpeta por cada dominio. También se puede ver desde la linea de comandos los certificados existentes y sus fechas de expiración.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ls /etc/letsencrypt/live/smaug.l5.ca</span>&#10;</span></span><span class="line"><span class="cl">cert.pem  chain.pem  fullchain.pem  privkey.pem&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>key-cert.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo certbot certificates&#10;</span></span><span class="line"><span class="cl"><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> raspberrypi: &#10;</span></span><span class="line"><span class="cl">Saving debug log to /var/log/letsencrypt/letsencrypt.log&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">-------------------------------------------------------------------------------&#10;</span></span><span class="line"><span class="cl">Found the following certs:&#10;</span></span><span class="line"><span class="cl">  Certificate Name: smaug.l5.ca&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Domains: smaug.l5.ca&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Expiry Date: 2017-10-21 09:18:00+00:00 <span class="o">(</span>VALID: <span class="m">70</span> days<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Certificate Path: /etc/letsencrypt/live/smaug.l5.ca/fullchain.pem&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Private Key Path: /etc/letsencrypt/live/smaug.l5.ca/privkey.pem&#10;</span></span><span class="line"><span class="cl">-------------------------------------------------------------------------------</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>certbot-certificates.sh</span>
    </div>
</div>
<p>Dado el relativo poco tiempo de validez de los certificados es recomendable automatizar la renovación empleando una <a href="https://es.wikipedia.org/wiki/Cron_%28Unix%29">expresión cron</a>. La utilidad <em>certbot</em> solo hace la renovación del certificado cuando queda menos de un més para su expiración aunque se programe su ejecución en este caso cada 6 horas y en un minuto aleatorio que Let&rsquo;s Encrypt recomienda para que todos los usuarios no programen sus renovaciones al mismo tiempo:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo su&#10;</span></span><span class="line"><span class="cl"><span class="c1"># crontab -e</span>&#10;</span></span><span class="line"><span class="cl"><span class="m">0</span> */6 * * * sleep <span class="si">${</span><span class="nv">RANDOM</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">2</span><span class="si">}</span>m <span class="p">;</span> certbot renew --quiet --renew-hook <span class="s2">&#34;systemctl restart nginx.service&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>cron.sh</span>
    </div>
</div>
<p>Una vez que se ha renovado el certificado hay que reiniciar el servidor web para que lo utilice y para ello está el parámetro <em>--renew-hook</em> que ejecuta un comando cuando se produce una renovación. En el ejemplo anterior está el comando para reiniciar el servicio de nginx con el sistema gestión de procesos de <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a>.</p>
<p>Let&rsquo;s Encrypt con <em>certbot</em> comprueba si somos el propietario de un sitio web instalando en el servidor web un archivo que posteriormente antes de generar el certificado lo valida. Este archivo para nginx se ubica en el directorio <em>/usr/share/nginx/html/.well-known/acme-challenge/</em> y ha de estar accesible desde internet con el protocolo HTTP en la dirección <em>/.well-known/acme-challenge/</em> del servidor web.</p>
<p>La siguiente configuración del servidor web nginx redirige todo el tráfico usando el protocolo HTTPS excepto el contenido del directorio <em>/.well-known/acme-challenge/</em> que queda accesible por HTTP.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="mi">1</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">worker_connections</span> <span class="mi">64</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">include</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="s">mime.types</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">sendfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="c1">#tcp_nopush&nbsp;&nbsp;&nbsp;&nbsp; on;&#10;</span></span></span><span class="line"><span class="cl"><span class="c1"></span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_disable</span> <span class="s">&#34;msie6&#34;</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_vary</span> <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_proxied</span> <span class="s">any</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_comp_level</span> <span class="mi">6</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_buffers</span> <span class="mi">16</span> <span class="mi">8k</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_types</span> <span class="s">text/plain</span> <span class="s">text/css</span> <span class="s">application/json</span> <span class="s">application/x-javascript</span> <span class="s">text/xml</span> <span class="s">application/xml</span> <span class="s">application/xml+rss</span> <span class="s">text/javascript</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span> <span class="s">smaug.l5.ca</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/.well-known/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="kn">allow</span> <span class="s">all</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="kn">alias</span> <span class="s">/usr/share/nginx/html/.well-known/</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">443</span> <span class="s">ssl</span> <span class="s">http2</span> <span class="s">default_server</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span> <span class="s">smaug.l5.ca</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s">/etc/letsencrypt/live/smaug.l5.ca/cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate_key</span>  <span class="s">/etc/letsencrypt/live/smaug.l5.ca/privkey.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_protocols</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_ciphers</span>   <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_session_cache</span>   <span class="s">shared:SSL:1m</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_session_timeout</span> <span class="mi">3m</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Y este es el resultado al acceder con el navegador al sitio web que tengo instalado en una <a href="https://www.raspberrypi.org/">Raspberry Pi</a> accesible desde internet con un dominio de <a href="https://freedns.afraid.org/">FreeDNS</a>:</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/images/smaug-1_hu12a4623b7f6c5a899b17fffa3e5f273d_39940_2560x1440_fit_box_3.png" data-gallery="" title="Sitio web con certificado de Let&amp;#39;s Encrypt"><img src="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/images/smaug-1_hu12a4623b7f6c5a899b17fffa3e5f273d_39940_300x200_fit_box_3.png" width="285" height="200" alt="Sitio web con certificado de Let&amp;#39;s Encrypt" title="Sitio web con certificado de Let&amp;#39;s Encrypt"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/images/smaug-2_hu4cb5bdb44c9d0e30ac5cc5600a4ff243_32417_2560x1440_fit_box_3.png" data-gallery="" title="Sitio web con certificado de Let&amp;#39;s Encrypt"><img src="https://picodotdev.github.io/blog-bitix/2017/08/instalar-y-renovar-un-certificado-de-lets-encrypt-en-nginx/images/smaug-2_hu4cb5bdb44c9d0e30ac5cc5600a4ff243_32417_300x200_fit_box_3.png" width="300" height="198" alt="Sitio web con certificado de Let&amp;#39;s Encrypt" title="Sitio web con certificado de Let&amp;#39;s Encrypt"  class="lozad "></a></p>
<figcaption>Sitio web con certificado de Let&#39;s Encrypt</figcaption>
</figure>
</div>
<p>En la documentación del proyecto de Let&rsquo;s Encrypt hay explicaciones más detalladas sobre <a href="https://letsencrypt.org/how-it-works/">como funciona</a>, <a href="https://letsencrypt.org/docs/rate-limits/">límites de uso</a>, <a href="https://certbot.eff.org/docs/using.html">como usarlo</a> y <a href="https://certbot.eff.org/">varias guías según el servidor web y distribución GNU/Linux</a>.</p>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="seguridad"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/</id>
        <title>Autenticación mutua de cliente y servidor con certificados</title>
        <updated>2017-06-18T23:30:00+02:00</updated>
        <published>2017-06-17T02:45:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/openssl.svg" width="400" height="124" alt="OpenSSL" title="OpenSSL"  class=""></p>
</div>
<p>Los certificados no solo sirven para autenticar a un servidor o acceder solo a aquellos en los que confiamos. El servidor también puede autenticar a los clientes mediante un certificado como alternativa a usar un usuario y contraseña ya sea una autenticación <em>BASIC</em> o un formulario personalizado. Al igual que en el cliente usa el certificado de la autoridad de certificación en la que confía para validar el que presenta el servidor, el servidor puede requerir que el cliente también proporcione un certificado que el servidor valida según las autoridades de certificación en las que confía, en ambos casos el servidor o cliente usan su clave privada para iniciar la conexión segura con el <em>handshake</em> del <a href="https://es.wikipedia.org/wiki/Transport_Layer_Security">protocolo TLS</a>.</p>
<p>Para el ejemplo usaré un servidor web <a href="https://nginx.org/">nginx</a> ejecutado como un contenedor de <a href="https://www.docker.com/">Docker</a> configurado de tal manera que requiere autenticación para el cliente con certificados.</p>
<p>Inicialmente deberemos generar tres parejas de claves privadas y públicas, una para nuestra propia autoridad de certificación, una clave para el servidor y otra para el cliente. Al mismo tiempo generaré otras tres parejas de claves privadas y públicas para comprobar que cuando se proporciona un certificado incorrecto la autenticación falla.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl genrsa -out ca.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">Generating RSA private key, <span class="m">8192</span> bit long modulus&#10;</span></span><span class="line"><span class="cl">............................................................................................................................................++&#10;</span></span><span class="line"><span class="cl">.........................................................................................................................................................................................................................................................................................................................................++&#10;</span></span><span class="line"><span class="cl">e is <span class="m">65537</span> <span class="o">(</span>0x010001<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in ca.key -pubout &gt; ca.pub&#10;</span></span><span class="line"><span class="cl">$ openssl genrsa -out server.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in server.key -pubout &gt; server.pub&#10;</span></span><span class="line"><span class="cl">$ openssl genrsa -out client.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in ca.key -pubout &gt; client.pub</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-genrsa.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----&#10;</span></span><span class="line"><span class="cl">MIIJeTCCBWGgAwIBAgIJAMmS/dYrpwDnMA0GCSqGSIb3DQEBBQUAMDExCzAJBgNV&#10;</span></span><span class="line"><span class="cl">BAYTAkVTMQ4wDAYDVQQIEwVTcGFpbjESMBAGA1UEChMJbG9jYWxob3N0MB4XDTE3&#10;</span></span><span class="line"><span class="cl">MDQwNzA2NTcxNVoXDTIyMDQwNjA2NTcxNVowMTELMAkGA1UEBhMCRVMxDjAMBgNV&#10;</span></span><span class="line"><span class="cl">BAgTBVNwYWluMRIwEAYDVQQKEwlsb2NhbGhvc3QwggQiMA0GCSqGSIb3DQEBAQUA&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca.crt</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">-----BEGIN RSA PRIVATE KEY-----&#10;</span></span><span class="line"><span class="cl">MIISJwIBAAKCBAEAyq7VfFt8LapGTtrN4zPAp5KdiHc3raAhs7MSGmrmtqYszheS&#10;</span></span><span class="line"><span class="cl">AGok/xx9RlUrLSgzjhQ22s28OgfKnqKOK1bzcjTj5Uwjc5Tr7RY724924amECHXc&#10;</span></span><span class="line"><span class="cl">ldJGc3c/BpdbyYboxsTau8BbAk45c61QKeoTGtQ+K4a2/X0oArroTtHOlRFFUB9t&#10;</span></span><span class="line"><span class="cl">yKSD20Vj80Ks4op/Q7ucEcZ8mr9zAXzhfokK72PLRGWmmvd1NBoHUzbrkNH9A8he&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">-----END RSA PRIVATE KEY-----</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca.key</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">-----BEGIN PUBLIC KEY-----&#10;</span></span><span class="line"><span class="cl">MIIEIjANBgkqhkiG9w0BAQEFAAOCBA8AMIIECgKCBAEAyq7VfFt8LapGTtrN4zPA&#10;</span></span><span class="line"><span class="cl">p5KdiHc3raAhs7MSGmrmtqYszheSAGok/xx9RlUrLSgzjhQ22s28OgfKnqKOK1bz&#10;</span></span><span class="line"><span class="cl">cjTj5Uwjc5Tr7RY724924amECHXcldJGc3c/BpdbyYboxsTau8BbAk45c61QKeoT&#10;</span></span><span class="line"><span class="cl">GtQ+K4a2/X0oArroTtHOlRFFUB9tyKSD20Vj80Ks4op/Q7ucEcZ8mr9zAXzhfokK&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">-----END PUBLIC KEY-----</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ca.pub</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl genrsa -out ca-unknown.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in ca-unknown.key -pubout &gt; ca-unknown.pub&#10;</span></span><span class="line"><span class="cl">$ openssl genrsa -out server-unknown.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in server-unknown.key -pubout &gt; server-unknown.pub&#10;</span></span><span class="line"><span class="cl">$ openssl genrsa -out client-unknown.key <span class="m">8192</span>&#10;</span></span><span class="line"><span class="cl">$ openssl rsa -in ca-unknown.key -pubout &gt; client-unknown.pub</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-genrsa-unknown.sh</span>
    </div>
</div>
<p>El siguiente paso es generar los certificados y firmar con la clave y certificado de la autoridad de certificado los certificados del servidor y cliente. Como paso previo a que la autoridad de certificación emita los certificados del servidor y cliente hay que generar una petición de firma de certificado, los archivos <em>.csr</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -new -x509 -days <span class="m">1825</span> -key ca.key -out ca.crt&#10;</span></span><span class="line"><span class="cl">You are about to be asked to enter information that will be incorporated&#10;</span></span><span class="line"><span class="cl">into your certificate request.&#10;</span></span><span class="line"><span class="cl">What you are about to enter is what is called a Distinguished Name or a DN.&#10;</span></span><span class="line"><span class="cl">There are quite a few fields but you can leave some blank&#10;</span></span><span class="line"><span class="cl">For some fields there will be a default value,&#10;</span></span><span class="line"><span class="cl">If you enter <span class="s1">&#39;.&#39;</span>, the field will be left blank.&#10;</span></span><span class="line"><span class="cl">-----&#10;</span></span><span class="line"><span class="cl">Country Name <span class="o">(</span><span class="m">2</span> letter code<span class="o">)</span> <span class="o">[</span>AU<span class="o">]</span>:ES&#10;</span></span><span class="line"><span class="cl">State or Province Name <span class="o">(</span>full name<span class="o">)</span> <span class="o">[</span>Some-State<span class="o">]</span>:Spain&#10;</span></span><span class="line"><span class="cl">Locality Name <span class="o">(</span>eg, city<span class="o">)</span> <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">Organization Name <span class="o">(</span>eg, company<span class="o">)</span> <span class="o">[</span>Internet Widgits Pty Ltd<span class="o">]</span>:Blog Bitix Certiticate Authority&#10;</span></span><span class="line"><span class="cl">Organizational Unit Name <span class="o">(</span>eg, section<span class="o">)</span> <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">Common Name <span class="o">(</span>e.g. server FQDN or YOUR name<span class="o">)</span> <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">Email Address <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ openssl req -new -key server.key -out server.csr&#10;</span></span><span class="line"><span class="cl">You are about to be asked to enter information that will be incorporated&#10;</span></span><span class="line"><span class="cl">into your certificate request.&#10;</span></span><span class="line"><span class="cl">What you are about to enter is what is called a Distinguished Name or a DN.&#10;</span></span><span class="line"><span class="cl">There are quite a few fields but you can leave some blank&#10;</span></span><span class="line"><span class="cl">For some fields there will be a default value,&#10;</span></span><span class="line"><span class="cl">If you enter <span class="s1">&#39;.&#39;</span>, the field will be left blank.&#10;</span></span><span class="line"><span class="cl">-----&#10;</span></span><span class="line"><span class="cl">Country Name <span class="o">(</span><span class="m">2</span> letter code<span class="o">)</span> <span class="o">[</span>AU<span class="o">]</span>:ES&#10;</span></span><span class="line"><span class="cl">State or Province Name <span class="o">(</span>full name<span class="o">)</span> <span class="o">[</span>Some-State<span class="o">]</span>:Spain&#10;</span></span><span class="line"><span class="cl">Locality Name <span class="o">(</span>eg, city<span class="o">)</span> <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">Organization Name <span class="o">(</span>eg, company<span class="o">)</span> <span class="o">[</span>Internet Widgits Pty Ltd<span class="o">]</span>:Blog Bitix&#10;</span></span><span class="line"><span class="cl">Organizational Unit Name <span class="o">(</span>eg, section<span class="o">)</span> <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">Common Name <span class="o">(</span>e.g. server FQDN or YOUR name<span class="o">)</span> <span class="o">[]</span>:localhost&#10;</span></span><span class="line"><span class="cl">Email Address <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Please enter the following <span class="s1">&#39;extra&#39;</span> attributes&#10;</span></span><span class="line"><span class="cl">to be sent with your certificate request&#10;</span></span><span class="line"><span class="cl">A challenge password <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">An optional company name <span class="o">[]</span>:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ openssl req -new -key client.key -out client.csr&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ openssl x509 -req -days <span class="m">1825</span> -in server.csr -CA ca.crt -CAkey ca.key -set_serial <span class="m">01</span> -out server.crt&#10;</span></span><span class="line"><span class="cl">Signature ok&#10;</span></span><span class="line"><span class="cl"><span class="nv">subject</span><span class="o">=</span><span class="nv">C</span> <span class="o">=</span> ES, <span class="nv">ST</span> <span class="o">=</span> Spain, <span class="nv">O</span> <span class="o">=</span> Blog Bitix, <span class="nv">CN</span> <span class="o">=</span> localhost&#10;</span></span><span class="line"><span class="cl">Getting CA Private Key&#10;</span></span><span class="line"><span class="cl">$ openssl x509 -req -days <span class="m">1825</span> -in client.csr -CA ca.crt -CAkey ca.key -set_serial <span class="m">02</span> -out client.crt</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-req.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl req -new -x509 -days <span class="m">1825</span> -key ca-unknown.key -out ca-unknown.crt&#10;</span></span><span class="line"><span class="cl">$ openssl req -new -key server-unknown.key -out server-unknown.csr&#10;</span></span><span class="line"><span class="cl">$ openssl req -new -key client-unknown.key -out client-unknown.csr&#10;</span></span><span class="line"><span class="cl">$ openssl x509 -req -days <span class="m">1825</span> -in server-unknown.csr -CA ca-unknown.crt -CAkey ca-unknown.key -set_serial <span class="m">01</span> -out server-unknown.crt&#10;</span></span><span class="line"><span class="cl">$ openssl x509 -req -days <span class="m">1825</span> -in client-unknown.csr -CA ca-unknown.crt -CAkey ca-unknown.key -set_serial <span class="m">02</span> -out client-unknown.crt</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-req-unknown.sh</span>
    </div>
</div>
<p>Con la misma herramienta de <a href="https://www.openssl.org/">OpenSSL</a> es posible comprobar si un certificado es válido para una autoridad de certificación en la que se confía, para ello se usa el certificado raíz de la autoridad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl verify -CAfile ca.crt server.crt&#10;</span></span><span class="line"><span class="cl">server.crt: OK&#10;</span></span><span class="line"><span class="cl">$ openssl verify -CAfile ca.crt client.crt&#10;</span></span><span class="line"><span class="cl">client.crt: OK</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-verify.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl verify -CAfile ca.crt server-unknown.crt&#10;</span></span><span class="line"><span class="cl"><span class="nv">C</span> <span class="o">=</span> ES, <span class="nv">ST</span> <span class="o">=</span> Spain, <span class="nv">O</span> <span class="o">=</span> Unknown, <span class="nv">CN</span> <span class="o">=</span> localhost&#10;</span></span><span class="line"><span class="cl">error <span class="m">20</span> at <span class="m">0</span> depth lookup: unable to get <span class="nb">local</span> issuer certificate&#10;</span></span><span class="line"><span class="cl">error server-unknown.crt: verification failed&#10;</span></span><span class="line"><span class="cl">$ openssl verify -CAfile ca.crt client-unknown.crt&#10;</span></span><span class="line"><span class="cl"><span class="nv">C</span> <span class="o">=</span> ES, <span class="nv">ST</span> <span class="o">=</span> Spain, <span class="nv">O</span> <span class="o">=</span> Unknown Client&#10;</span></span><span class="line"><span class="cl">error <span class="m">20</span> at <span class="m">0</span> depth lookup: unable to get <span class="nb">local</span> issuer certificate&#10;</span></span><span class="line"><span class="cl">error client-unknown.crt: verification failed</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>openssl-verify-unknown.sh</span>
    </div>
</div>
<p>Para hacer que el servidor nginx requiera autenticación mediante certificados para el cliente hay que añadir un poco de configuración mediante las directivas <em>ssl</em> donde se indica el certificado del servidor, la clave privada del servidor, el certificado de la autoridad de certificación contra la que se validarán los certificados de los clientes y finalmente la directiva que establece que se ha de verificar a los clientes mediante certificados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">...</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="s">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">443</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="s">/etc/nginx/server.crt</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate_key</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="s">/etc/nginx/server.key</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_client_certificate</span>  <span class="s">/etc/nginx/ca.crt</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_verify_client</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_verify_depth</span> <span class="mi">5</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">...</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="err">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="err">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Con el siguiente archivo descriptor de <a href="https://docs.docker.com/compose/">Docker Compose</a> y comando se inicia el servidor web nginx.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker-compose up&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">nginx</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./nginx.conf:/etc/nginx/nginx.conf:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./server.key:/etc/nginx/server.key:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./server.crt:/etc/nginx/server.crt:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./ca.crt:/etc/nginx/ca.crt:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;80:80&#34;</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;443:443&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.yml</span>
    </div>
</div>
<p>Iniciado el servidor web ya se pueden realizar peticiones y el servidor y el cliente se autenticarán mutuamente. El servidor devolverá el código HTML de la página de bienvenida por defecto con las cabeceras del protocolo HTTP después de realizar el <em>handshake</em> donde se valida el certificado del servidor.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span><span class="lnt">72&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -v --cacert ca.crt --cert client.crt --key client.key <span class="s2">&#34;https://localhost/&#34;</span>&#10;</span></span><span class="line"><span class="cl">*   Trying ::1...&#10;</span></span><span class="line"><span class="cl">* TCP_NODELAY <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">443</span> <span class="o">(</span><span class="c1">#0)</span>&#10;</span></span><span class="line"><span class="cl">* ALPN, offering h2&#10;</span></span><span class="line"><span class="cl">* ALPN, offering http/1.1&#10;</span></span><span class="line"><span class="cl">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&#10;</span></span><span class="line"><span class="cl">* successfully <span class="nb">set</span> certificate verify locations:&#10;</span></span><span class="line"><span class="cl">*   CAfile: ca.crt&#10;</span></span><span class="line"><span class="cl">  CApath: none&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server hello <span class="o">(</span>2<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server key exchange <span class="o">(</span>12<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Request CERT <span class="o">(</span>13<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server finished <span class="o">(</span>14<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client key exchange <span class="o">(</span>16<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, CERT verify <span class="o">(</span>15<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS change cipher, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* SSL connection using TLSv1.0 / ECDHE-RSA-AES256-SHA&#10;</span></span><span class="line"><span class="cl">* ALPN, server accepted to use http/1.1&#10;</span></span><span class="line"><span class="cl">* Server certificate:&#10;</span></span><span class="line"><span class="cl">*  subject: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix<span class="p">;</span> <span class="nv">CN</span><span class="o">=</span>localhost&#10;</span></span><span class="line"><span class="cl">*  start date: Jun <span class="m">16</span> 22:16:18 <span class="m">2017</span> GMT&#10;</span></span><span class="line"><span class="cl">*  expire date: Jun <span class="m">15</span> 22:16:18 <span class="m">2022</span> GMT&#10;</span></span><span class="line"><span class="cl">*  common name: localhost <span class="o">(</span>matched<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">*  issuer: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix Certiticate Authority&#10;</span></span><span class="line"><span class="cl">*  SSL certificate verify ok.&#10;</span></span><span class="line"><span class="cl">&gt; GET / HTTP/1.1&#10;</span></span><span class="line"><span class="cl">&gt; Host: localhost&#10;</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.54.1&#10;</span></span><span class="line"><span class="cl">&gt; Accept: */*&#10;</span></span><span class="line"><span class="cl">&gt;&#10;</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">200</span> OK&#10;</span></span><span class="line"><span class="cl">&lt; Server: nginx/1.13.0&#10;</span></span><span class="line"><span class="cl">&lt; Date: Fri, <span class="m">16</span> Jun <span class="m">2017</span> 22:30:06 GMT&#10;</span></span><span class="line"><span class="cl">&lt; Content-Type: text/html&#10;</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">612</span>&#10;</span></span><span class="line"><span class="cl">&lt; Last-Modified: Tue, <span class="m">25</span> Apr <span class="m">2017</span> 17:23:03 GMT&#10;</span></span><span class="line"><span class="cl">&lt; Connection: keep-alive&#10;</span></span><span class="line"><span class="cl">&lt; ETag: <span class="s2">&#34;58ff85f7-264&#34;</span>&#10;</span></span><span class="line"><span class="cl">&lt; Accept-Ranges: bytes&#10;</span></span><span class="line"><span class="cl">&lt;&#10;</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;title&gt;Welcome to nginx!&lt;/title&gt;&#10;</span></span><span class="line"><span class="cl">&lt;style&gt;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;body <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width: 35em<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin: <span class="m">0</span> auto<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&lt;/style&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;If you see this page, the nginx web server is successfully installed and&#10;</span></span><span class="line"><span class="cl">working. Further configuration is required.&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;For online documentation and support please refer to&#10;</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;&#10;</span></span><span class="line"><span class="cl">Commercial support is available at&#10;</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/html&gt;&#10;</span></span><span class="line"><span class="cl">* Connection <span class="c1">#0 to host localhost left intact</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>curl.sh</span>
    </div>
</div>
<p>Si se intenta realizar una petición sin certificado de cliente o con un certificado de cliente en el que no confié el servidor (que no esté firmado por la autoridad de certificación en la que confía) se devolverá un código de estado 400 que indica que la petición se ha rechazado. También el cliente advertirá si la autoridad de certificación en la que confía no valida el certificado del servidor con un error 400 y título <em>400 The SSL certificate error</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -v --cacert ca.crt <span class="s2">&#34;https://localhost/&#34;</span>&#10;</span></span><span class="line"><span class="cl">*   Trying ::1...&#10;</span></span><span class="line"><span class="cl">* TCP_NODELAY <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">443</span> <span class="o">(</span><span class="c1">#0)</span>&#10;</span></span><span class="line"><span class="cl">* ALPN, offering h2&#10;</span></span><span class="line"><span class="cl">* ALPN, offering http/1.1&#10;</span></span><span class="line"><span class="cl">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&#10;</span></span><span class="line"><span class="cl">* successfully <span class="nb">set</span> certificate verify locations:&#10;</span></span><span class="line"><span class="cl">*   CAfile: ca.crt&#10;</span></span><span class="line"><span class="cl">  CApath: none&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server hello <span class="o">(</span>2<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server key exchange <span class="o">(</span>12<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Request CERT <span class="o">(</span>13<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server finished <span class="o">(</span>14<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client key exchange <span class="o">(</span>16<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS change cipher, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* SSL connection using TLSv1.0 / ECDHE-RSA-AES256-SHA&#10;</span></span><span class="line"><span class="cl">* ALPN, server accepted to use http/1.1&#10;</span></span><span class="line"><span class="cl">* Server certificate:&#10;</span></span><span class="line"><span class="cl">*  subject: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix<span class="p">;</span> <span class="nv">CN</span><span class="o">=</span>localhost&#10;</span></span><span class="line"><span class="cl">*  start date: Jun <span class="m">16</span> 22:16:18 <span class="m">2017</span> GMT&#10;</span></span><span class="line"><span class="cl">*  expire date: Jun <span class="m">15</span> 22:16:18 <span class="m">2022</span> GMT&#10;</span></span><span class="line"><span class="cl">*  common name: localhost <span class="o">(</span>matched<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">*  issuer: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix Certiticate Authority&#10;</span></span><span class="line"><span class="cl">*  SSL certificate verify ok.&#10;</span></span><span class="line"><span class="cl">&gt; GET / HTTP/1.1&#10;</span></span><span class="line"><span class="cl">&gt; Host: localhost&#10;</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.54.1&#10;</span></span><span class="line"><span class="cl">&gt; Accept: */*&#10;</span></span><span class="line"><span class="cl">&gt;&#10;</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">400</span> Bad Request&#10;</span></span><span class="line"><span class="cl">&lt; Server: nginx/1.13.0&#10;</span></span><span class="line"><span class="cl">&lt; Date: Fri, <span class="m">16</span> Jun <span class="m">2017</span> 22:30:49 GMT&#10;</span></span><span class="line"><span class="cl">&lt; Content-Type: text/html&#10;</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">253</span>&#10;</span></span><span class="line"><span class="cl">&lt; Connection: close&#10;</span></span><span class="line"><span class="cl">&lt;&#10;</span></span><span class="line"><span class="cl">&lt;html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;head&gt;&lt;title&gt;400 No required SSL certificate was sent&lt;/title&gt;&lt;/head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;No required SSL certificate was sent&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;hr&gt;&lt;center&gt;nginx/1.13.0&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/html&gt;&#10;</span></span><span class="line"><span class="cl">* Closing connection <span class="m">0</span>&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS alert, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ curl -v --cacert ca.crt --cert client-unknown.crt --key client-unknown.key <span class="s2">&#34;https://localhost/&#34;</span>&#10;</span></span><span class="line"><span class="cl">*   Trying ::1...&#10;</span></span><span class="line"><span class="cl">* TCP_NODELAY <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">443</span> <span class="o">(</span><span class="c1">#0)</span>&#10;</span></span><span class="line"><span class="cl">* ALPN, offering h2&#10;</span></span><span class="line"><span class="cl">* ALPN, offering http/1.1&#10;</span></span><span class="line"><span class="cl">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&#10;</span></span><span class="line"><span class="cl">* successfully <span class="nb">set</span> certificate verify locations:&#10;</span></span><span class="line"><span class="cl">*   CAfile: ca.crt&#10;</span></span><span class="line"><span class="cl">  CApath: none&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server hello <span class="o">(</span>2<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server key exchange <span class="o">(</span>12<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Request CERT <span class="o">(</span>13<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server finished <span class="o">(</span>14<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client key exchange <span class="o">(</span>16<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, CERT verify <span class="o">(</span>15<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS change cipher, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Finished <span class="o">(</span>20<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* SSL connection using TLSv1.0 / ECDHE-RSA-AES256-SHA&#10;</span></span><span class="line"><span class="cl">* ALPN, server accepted to use http/1.1&#10;</span></span><span class="line"><span class="cl">* Server certificate:&#10;</span></span><span class="line"><span class="cl">*  subject: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix<span class="p">;</span> <span class="nv">CN</span><span class="o">=</span>localhost&#10;</span></span><span class="line"><span class="cl">*  start date: Jun <span class="m">16</span> 22:16:18 <span class="m">2017</span> GMT&#10;</span></span><span class="line"><span class="cl">*  expire date: Jun <span class="m">15</span> 22:16:18 <span class="m">2022</span> GMT&#10;</span></span><span class="line"><span class="cl">*  common name: localhost <span class="o">(</span>matched<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">*  issuer: <span class="nv">C</span><span class="o">=</span>ES<span class="p">;</span> <span class="nv">ST</span><span class="o">=</span>Spain<span class="p">;</span> <span class="nv">O</span><span class="o">=</span>Blog Bitix Certiticate Authority&#10;</span></span><span class="line"><span class="cl">*  SSL certificate verify ok.&#10;</span></span><span class="line"><span class="cl">&gt; GET / HTTP/1.1&#10;</span></span><span class="line"><span class="cl">&gt; Host: localhost&#10;</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.54.1&#10;</span></span><span class="line"><span class="cl">&gt; Accept: */*&#10;</span></span><span class="line"><span class="cl">&gt;&#10;</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">400</span> Bad Request&#10;</span></span><span class="line"><span class="cl">&lt; Server: nginx/1.13.0&#10;</span></span><span class="line"><span class="cl">&lt; Date: Fri, <span class="m">16</span> Jun <span class="m">2017</span> 22:32:55 GMT&#10;</span></span><span class="line"><span class="cl">&lt; Content-Type: text/html&#10;</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">231</span>&#10;</span></span><span class="line"><span class="cl">&lt; Connection: close&#10;</span></span><span class="line"><span class="cl">&lt;&#10;</span></span><span class="line"><span class="cl">&lt;html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;head&gt;&lt;title&gt;400 The SSL certificate error&lt;/title&gt;&lt;/head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;The SSL certificate error&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;hr&gt;&lt;center&gt;nginx/1.13.0&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/html&gt;&#10;</span></span><span class="line"><span class="cl">* Closing connection <span class="m">0</span>&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS alert, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ curl -v --cacert ca-unknown.crt --cert client.crt --key client.key <span class="s2">&#34;https://localhost/&#34;</span>&#10;</span></span><span class="line"><span class="cl">*   Trying ::1...&#10;</span></span><span class="line"><span class="cl">* TCP_NODELAY <span class="nb">set</span>&#10;</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">443</span> <span class="o">(</span><span class="c1">#0)</span>&#10;</span></span><span class="line"><span class="cl">* ALPN, offering h2&#10;</span></span><span class="line"><span class="cl">* ALPN, offering http/1.1&#10;</span></span><span class="line"><span class="cl">* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&#10;</span></span><span class="line"><span class="cl">* successfully <span class="nb">set</span> certificate verify locations:&#10;</span></span><span class="line"><span class="cl">*   CAfile: ca-unknown.crt&#10;</span></span><span class="line"><span class="cl">  CApath: none&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>OUT<span class="o">)</span>, TLS handshake, Client hello <span class="o">(</span>1<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.2 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Server hello <span class="o">(</span>2<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Certificate <span class="o">(</span>11<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* TLSv1.0 <span class="o">(</span>OUT<span class="o">)</span>, TLS alert, Server hello <span class="o">(</span>2<span class="o">)</span>:&#10;</span></span><span class="line"><span class="cl">* SSL certificate problem: unable to get <span class="nb">local</span> issuer certificate&#10;</span></span><span class="line"><span class="cl">* stopped the pause stream!&#10;</span></span><span class="line"><span class="cl">* Closing connection <span class="m">0</span>&#10;</span></span><span class="line"><span class="cl">curl: <span class="o">(</span>60<span class="o">)</span> SSL certificate problem: unable to get <span class="nb">local</span> issuer certificate&#10;</span></span><span class="line"><span class="cl">More details here: https://curl.haxx.se/docs/sslcerts.html&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">curl performs SSL certificate verification by default, using a <span class="s2">&#34;bundle&#34;</span>&#10;</span></span><span class="line"><span class="cl"> of Certificate Authority <span class="o">(</span>CA<span class="o">)</span> public keys <span class="o">(</span>CA certs<span class="o">)</span>. If the default&#10;</span></span><span class="line"><span class="cl"> bundle file isn<span class="s1">&#39;t adequate, you can specify an alternate file&#10;</span></span></span><span class="line"><span class="cl"><span class="s1"> using the --cacert option.&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">If this HTTPS server uses a certificate signed by a CA represented in&#10;</span></span></span><span class="line"><span class="cl"><span class="s1"> the bundle, the certificate verification probably failed due to a&#10;</span></span></span><span class="line"><span class="cl"><span class="s1"> problem with the certificate (it might be expired, or the name might&#10;</span></span></span><span class="line"><span class="cl"><span class="s1"> not match the domain name in the URL).&#10;</span></span></span><span class="line"><span class="cl"><span class="s1">If you&#39;</span>d like to turn off curl<span class="err">&#39;</span>s verification of the certificate, use&#10;</span></span><span class="line"><span class="cl"> the -k <span class="o">(</span>or --insecure<span class="o">)</span> option.&#10;</span></span><span class="line"><span class="cl">HTTPS-proxy has similar options --proxy-cacert and --proxy-insecure.</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>curl-unknown.sh</span>
    </div>
</div>
<p>El siguiente <em>script</em> escrito en lenguaje <a href="https://www.groovy-lang.org/">Groovy</a> muestra como desde un programa para la plataforma Java se realiza autenticación mutua y que error da cuando alguno de los certificados es inválido ya sea el del cliente o el del servidor. Generando previamente los <em>keystores</em> de la autoridad de certificado y del cliente introduciendo como clave en el ejemplo <em>password</em> cuando se solicita.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ keytool -importcert -keystore ca.jks -trustcacerts -alias ca -file ca.crt&#10;</span></span><span class="line"><span class="cl">$ openssl pkcs12 -export -out client.p12 -inkey client.key -in client.crt&#10;</span></span><span class="line"><span class="cl">$ keytool -importkeystore -destkeystore client.jks -srckeystore client.p12 -srcstoretype pkcs12&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ keytool -importcert -keystore ca-unknown.jks -trustcacerts -alias ca -file ca-unknown.crt&#10;</span></span><span class="line"><span class="cl">$ openssl pkcs12 -export -out client-unknown.p12 -inkey client-unknown.key -in client-unknown.crt&#10;</span></span><span class="line"><span class="cl">$ keytool -importkeystore -destkeystore client-unknown.jks -srckeystore client-unknown.p12 -srcstoretype pkcs12</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>keytool.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;javax.activation&#39;</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;activation&#39;</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.1.1&#39;</span><span class="o">)</span> &#10;</span></span><span class="line"><span class="cl"><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;javax&#39;</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;javaee-api&#39;</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;7.0&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;org.glassfish.jersey.core&#39;</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;jersey-client&#39;</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;2.25.1&#39;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.net.ssl.KeyManagerFactory</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.net.ssl.SSLContext</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.net.ssl.TrustManagerFactory</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.ws.rs.client.Client</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.ws.rs.client.ClientBuilder</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.ws.rs.client.Entity</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.ws.rs.core.Response</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.security.KeyStore</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.glassfish.jersey.SslConfigurator</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">void</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">buildSslClient</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="s2">&#34;https://localhost&#34;</span><span class="o">).</span><span class="na">path</span><span class="o">(</span><span class="s2">&#34;/&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">request</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s2">&#34;Accept&#34;</span><span class="o">,</span> <span class="s2">&#34;text/html&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">get</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getStatus</span><span class="o">())</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">readEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="n">Client</span> <span class="nf">buildSslClient</span><span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">ClientBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">sslContext</span><span class="o">(</span><span class="n">buildSslContext</span><span class="o">()).</span><span class="na">build</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="n">SSLContext</span> <span class="nf">buildSslContext</span><span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">SslConfigurator</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">trustStoreFile</span><span class="o">(</span><span class="s2">&#34;ca.jks&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//.trustStoreFile(&#34;ca-unknown.jks&#34;)&#10;</span></span></span><span class="line"><span class="cl"><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">trustStorePassword</span><span class="o">(</span><span class="s2">&#34;password&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">keyStoreFile</span><span class="o">(</span><span class="s2">&#34;client.jks&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//.keyStoreFile(&#34;client-unknown.jks&#34;)&#10;</span></span></span><span class="line"><span class="cl"><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">keyPassword</span><span class="o">(</span><span class="s2">&#34;password&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">createSSLContext</span><span class="o">();</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nf">Main</span><span class="o">().</span><span class="na">get</span><span class="o">()</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>MutualCertAuth.groovy</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ groovy MutualCertAuth.groovy&#10;</span></span><span class="line"><span class="cl"><span class="m">200</span>&#10;</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;title&gt;Welcome to nginx!&lt;/title&gt;&#10;</span></span><span class="line"><span class="cl">&lt;style&gt;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;body <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width: 35em<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin: <span class="m">0</span> auto<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&lt;/style&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;If you see this page, the nginx web server is successfully installed and&#10;</span></span><span class="line"><span class="cl">working. Further configuration is required.&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;For online documentation and support please refer to&#10;</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;&#10;</span></span><span class="line"><span class="cl">Commercial support is available at&#10;</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/html&gt;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>groovy.sh</span>
    </div>
</div>
<p>En caso de que al usar un <em>keystore</em> con un certificado de una autoridad que no valida el certificado del servidor se producirán un error, también cuando el certificado del cliente no sea válido para el servidor.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ groovy MutualCertAuth.groovy <span class="c1"># with code change .trustStoreFile(&#34;ca-unknown.jks&#34;)</span>&#10;</span></span><span class="line"><span class="cl">Caught: javax.ws.rs.ProcessingException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target&#10;</span></span><span class="line"><span class="cl">javax.ws.rs.ProcessingException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.internal.HttpUrlConnector.apply<span class="o">(</span>HttpUrlConnector.java:287<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.ClientRuntime.invoke<span class="o">(</span>ClientRuntime.java:252<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.JerseyInvocation<span class="nv">$1</span>.call<span class="o">(</span>JerseyInvocation.java:684<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.JerseyInvocation<span class="nv">$1</span>.call<span class="o">(</span>JerseyInvocation.java:681<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.internal.Errors.process<span class="o">(</span>Errors.java:315<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.internal.Errors.process<span class="o">(</span>Errors.java:297<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.internal.Errors.process<span class="o">(</span>Errors.java:228<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.process.internal.RequestScope.runInScope<span class="o">(</span>RequestScope.java:444<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.JerseyInvocation.invoke<span class="o">(</span>JerseyInvocation.java:681<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.JerseyInvocation<span class="nv">$Builder</span>.method<span class="o">(</span>JerseyInvocation.java:411<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.JerseyInvocation<span class="nv">$Builder</span>.get<span class="o">(</span>JerseyInvocation.java:311<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at Main.get<span class="o">(</span>MutualCertAuth.groovy:19<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at Main<span class="nv">$get</span>.call<span class="o">(</span>Unknown Source<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at MutualCertAuth.run<span class="o">(</span>MutualCertAuth.groovy:43<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">Caused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.internal.HttpUrlConnector._apply<span class="o">(</span>HttpUrlConnector.java:399<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	at org.glassfish.jersey.client.internal.HttpUrlConnector.apply<span class="o">(</span>HttpUrlConnector.java:285<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">	... <span class="m">13</span> more&#10;</span></span><span class="line"><span class="cl">Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target&#10;</span></span><span class="line"><span class="cl">	... <span class="m">15</span> more&#10;</span></span><span class="line"><span class="cl">Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target&#10;</span></span><span class="line"><span class="cl">	... <span class="m">15</span> more&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ groovy MutualCertAuth.groovy <span class="c1"># with code change .keyStoreFile(&#34;client-unknown.jks&#34;)</span>&#10;</span></span><span class="line"><span class="cl"><span class="m">400</span>&#10;</span></span><span class="line"><span class="cl">&lt;html&gt;&#10;</span></span><span class="line"><span class="cl">&lt;head&gt;&lt;title&gt;400 No required SSL certificate was sent&lt;/title&gt;&lt;/head&gt;&#10;</span></span><span class="line"><span class="cl">&lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">&#34;white&#34;</span>&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;center&gt;No required SSL certificate was sent&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;hr&gt;&lt;center&gt;nginx/1.13.0&lt;/center&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/body&gt;&#10;</span></span><span class="line"><span class="cl">&lt;/html&gt;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>groovy-unknown.sh</span>
    </div>
</div>
<p>Lo anterior es usando la herramienta <em>curl</em> o un un programa en la plataforma Java, en el caso de querer realizar autenticación mutua con un navegador web como <a href="https://www.mozilla.org/es-ES/firefox/new/">Firefox</a> hay que instalar el certificado del cliente y si es necesario el certificado de la autoridad de certificación para que el candado indicativo de la seguridad del protocolo HTTPS se muestre en verde y no indique ningún problema de seguridad en la autenticación del servidor. En Firefox los certificados se añaden en el menú <em>Preferencias &gt; Avanzado &gt; Ver certificados</em>. En la pestaña <em>Sus certificados</em> hay que importar el certificado del cliente en formato <em>PKCS12</em> y en la pestaña <em>Autoridades</em> el certificado de la autoridad que haya firmado el certificado del servidor, con el botón <em>Importar</em> se selecciona el archivo <em>crt</em> de la autoridad. Al introducir la URL y realizar la petición Firefox solicita mediante un diálogo seleccionar el certificado a usar para realizar la autenticación en el servidor.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-bad-request_hu3d9115ae669622df0d998ed96444e229_29792_2560x1440_fit_box_3.png" data-gallery="" title="Autenticación mutua fallida"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-bad-request_hu3d9115ae669622df0d998ed96444e229_29792_300x250_fit_box_3.png" width="300" height="204" alt="Autenticación mutua fallida" title="Autenticación mutua fallida"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-mutual-authorized_hu21193e48d3d482f312b4ea4a564e67fd_41438_2560x1440_fit_box_3.png" data-gallery="" title="Autenticación mutua correcta"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-mutual-authorized_hu21193e48d3d482f312b4ea4a564e67fd_41438_300x250_fit_box_3.png" width="300" height="204" alt="Autenticación mutua correcta" title="Autenticación mutua correcta"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-server-cert_hu1d9bffb9f5c100af990526d53b88278c_39053_2560x1440_fit_box_3.png" data-gallery="" title="Certificado del servidor validado por la CA"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-server-cert_hu1d9bffb9f5c100af990526d53b88278c_39053_300x250_fit_box_3.png" width="300" height="204" alt="Certificado del servidor validado por la CA" title="Certificado del servidor validado por la CA"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-certs_hueb543905d41759bbe5a764bb74f95c42_34897_2560x1440_fit_box_3.png" data-gallery="" title="Certificados de cliente"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-certs_hueb543905d41759bbe5a764bb74f95c42_34897_300x250_fit_box_3.png" width="300" height="169" alt="Certificados de cliente" title="Certificados de cliente"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-cas_huf2ba739f3324fedc682eb0901881a9fc_53688_2560x1440_fit_box_3.png" data-gallery="" title="Certificados de la autoridades de certificación"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-cas_huf2ba739f3324fedc682eb0901881a9fc_53688_300x250_fit_box_3.png" width="300" height="169" alt="Certificados de la autoridades de certificación" title="Certificados de la autoridades de certificación"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-ca_hu06fe95553699a7e0d101265d04edfdcb_36230_2560x1440_fit_box_3.png" data-gallery="" title="Añadir certificado de CA"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-ca_hu06fe95553699a7e0d101265d04edfdcb_36230_300x250_fit_box_3.png" width="300" height="165" alt="Añadir certificado de CA" title="Añadir certificado de CA"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-select-cert_hu1debe2f021cf39b50ccef97256514718_46013_2560x1440_fit_box_3.png" data-gallery="" title="Selección de certificado de cliente"><img src="https://picodotdev.github.io/blog-bitix/2017/06/autenticacion-mutua-de-cliente-y-servidor-con-certificados/images/firefox-select-cert_hu1debe2f021cf39b50ccef97256514718_46013_300x250_fit_box_3.png" width="265" height="250" alt="Selección de certificado de cliente" title="Selección de certificado de cliente"  class="lozad "></a></p>
<figcaption>Autenticación mutua de cliente y servidor con el navegador web Firefox</figcaption>
</figure>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/WebServerMutualCertAuth">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>docker-compose up, groovy MutualCertAuth.groovy</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/series/docker/">Serie de artículos sobre Docker</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2015/04/guardar-contrasenas-usando-salted-password-hashing-y-otras-formas-correctas/">Guardar contraseñas usando «Salted Password Hashing» y otras formas correctas</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
                <category term="seguridad"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/</id>
        <title>Cómo y por que redirigir tráfico web del dominio raíz al subdominio www (o viceversa)</title>
        <updated>2016-08-05T18:00:00+02:00</updated>
        <published>2016-08-05T17:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>La redirección del dominio raíz al subdominio es una de las cosas básicas que es recomendable realizar en todo dominio, para ello hay que añadir algo de configuración propia de cada servidor para realizar la redirección. Junto con usar el uso del protocolo HTTPS y forzar su uso con otra redirección mejoraremos el SEO y evitaremos penalizaciones por contenido duplicado.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/html.svg" width="200" height="200" alt="HTML" title="HTML"  class=""></p>
</div>
<p>El nombre de un dominio está formado por varios subdominios separados por un caracter punto. Están los dominios de nivel superior, los genéricos y más antiguos <em>.com</em>, <em>.org</em>, <em>.info</em>, <em>.net</em>, los propios de cada país o territoriales <em>.es</em>, <em>.fr</em>, <em>.de</em> y más recientemente un montón de <a href="https://es.wikipedia.org/wiki/Dominio_de_nivel_superior">nuevos dominios de nivel superior</a> (<em>.futbol</em>, <em>.arte</em>, <em>.blog</em>, <em>.madrid</em>, &hellip;) aunque significativamente más caros. Después del dominio de nivel superior está el subdominio de la empresa, marca o personal, por ejemplo, <em>empresa.com</em> que es realmente lo que compramos cuando solicitamos registrar un dominio. En nuestro dominio <em>empresa.com</em> podemos administrar múltiples subdominios los clásicos son <em>www.empresa.com</em> para el servidor web, <em>smpt.empresa.com</em> para el correo electrónico, <em>ftp.empresa.com</em> para la transferencia de archivos y otros cualesquiera que deseemos.</p>
<p>En el caso del tráfico web debemos evitar que el servidor y la página o aplicación sea accedida por <em>empresa.com</em> y <em>www.empresa.com</em> ya que los buscadores tratarán a la página como dos diferentes y posiblemente detectando contenido duplicado que afectará negativamente o penalizando al SEO de la web. Lo que se suele hacer es hacer una <a href="https://es.wikipedia.org/wiki/HTTP_301">redirección permanente</a> (cuyo código de estado HTTP para la respuesta es 301) a nivel de servidor que redirija el tráfico de <em>empresa.com</em> a <em>www.empresa.com</em> cuando el usuario acceda con su navegador con la primera.</p>
<p>Esta es una de las cosas básicas que debemos realizar cuando instalemos un servidor web, otras cosas recomendadas para mejorar el SEO y la seguridad de los usuarios es <a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">configurar el servidor web para usar el protocolo seguro HTTPS</a> y <a href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/">configurar el servidor web para forzar el uso de HTTPS</a> también haciendo una redirección cuando la petición use el protocolo no cifrado HTTP entre otras cosas que indico en la <a href="https://picodotdev.github.io/blog-bitix/series/web/">serie web</a>.</p>
<p>Dependiendo del servidor web que utilicemos la configuración a añadir para hacer la redirección será distinta, a continuación indicaré como hacerlo en dos de los servidores web más populares como son <a href="https://nginx.org/">Nginx</a> y <a href="https://httpd.apache.org/">Apache HTTPD</a>.</p>
<h3 id="nginx">Nginx</h3>
<p>Usando Docker y el archivo de configuración completo podemos probar que funciona en local sin necesidad de instalar o cambiar la configuración de Nginx si tenemos instalado su paquete.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -p 80:80 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/nginx.conf:/etc/nginx/conf.d/default.conf:ro nginx:alpine&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-run-nginx.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">return</span> <span class="mi">301</span> <span class="s">http://www.</span><span class="nv">$host$request_uri</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">www.localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/nginx_hu60b4db62b5f01597e3dc7329c4fe0959_28084_2560x1440_fit_box_3.png" data-gallery="" title="Dominio antes de acceder al sitio"><img src="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/nginx_hu60b4db62b5f01597e3dc7329c4fe0959_28084_300x200_fit_box_3.png" width="292" height="200" alt="Dominio antes de acceder al sitio" title="Dominio antes de acceder al sitio"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/nginx-www_hu3cf963a0f16d792dac9874482b297887_38309_2560x1440_fit_box_3.png" data-gallery="" title="Dominio después de acceder al sitio"><img src="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/nginx-www_hu3cf963a0f16d792dac9874482b297887_38309_300x200_fit_box_3.png" width="292" height="200" alt="Dominio después de acceder al sitio" title="Dominio después de acceder al sitio"  class="lozad "></a></p>
<figcaption>Dominio antes y después de acceder al sitio con Nginx</figcaption>
</figure>
</div>
<h3 id="apache">Apache</h3>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -p 80:80 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro httpd:alpine&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-run-httpd.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-apache" data-lang="apache"><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">ServerName</span> www.localhost&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">ServerName</span> localhost&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteEngine</span> <span class="k">On</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteCond</span> %{HTTPS} <span class="k">off</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteRule</span> (.*) http://www.%{SERVER_NAME}$1 [R,L]&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">ServerName</span> www.localhost&#10;</span></span><span class="line"><span class="cl">   <span class="nb">DocumentRoot</span> <span class="sx">/usr/local/apache2/htdocs</span>&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>httpd.conf</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/httpd_hu60b4db62b5f01597e3dc7329c4fe0959_28382_2560x1440_fit_box_3.png" data-gallery="" title="Dominio antes de acceder al sitio"><img src="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/httpd_hu60b4db62b5f01597e3dc7329c4fe0959_28382_300x200_fit_box_3.png" width="292" height="200" alt="Dominio antes de acceder al sitio" title="Dominio antes de acceder al sitio"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/httpd-www_hu332c6287f536a309407784d237cee026_16732_2560x1440_fit_box_3.png" data-gallery="" title="Dominio después de acceder al sitio"><img src="https://picodotdev.github.io/blog-bitix/2016/08/como-y-por-que-redirigir-trafico-web-del-dominio-raiz-al-subdominio-www/images/httpd-www_hu332c6287f536a309407784d237cee026_16732_300x200_fit_box_3.png" width="292" height="200" alt="Dominio después de acceder al sitio" title="Dominio después de acceder al sitio"  class="lozad "></a></p>
<figcaption>Dominio antes y después de acceder al sitio con Apache HTTPD</figcaption>
</figure>
</div>
<p>Si prefieriesemos hacer la redirección al revés, del subdominio www al dominio, variaríamos los valores de los nombres del servidor y los valores de las directivas de redirección. En los enlaces de referencia se incluye un ejemplo de esta configuración.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/WebServerRedirectSubdomain">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub.</p>
</div>
<p>Referencia:</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://easyengine.io/tutorials/nginx/www-non-www-redirection/">Nginx config for www to non-www and non-www to www redirection</a></li>
<li><a href="http://www.thesitewizard.com/apache/redirect-domain-www-subdomain.shtml">How to Redirect URLs from Your Root Domain to the WWW Subdomain and Vice Versa</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/</id>
        <title>Configurar Nginx para cachear respuestas del servidor de aplicaciones</title>
        <updated>2016-07-31T01:00:00+02:00</updated>
        <published>2016-07-30T13:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Las caches son un recurso utilizado para aumentar el rendimiento y evitar malgastar recursos. Si una petición es muy costosa pero que no cambia muy a menudo o no se necesitan que los datos estén totalmente actualizados cachear el resultado de esa petición evitará tener que recalcularla para cada petición, si se realizan muchas peticiones el aumento de rendimiento será drásticamente mejor usando además un menor número de recursos de los sistemas. Hay soluciones específicas para cacheo pero si nuestra necesidades no son extremadamente avanzadas el cacheo ofrecido por Nginx probablemente sea suficiente.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx"  class=""></p>
</div>
<p>Los servidores web son muy eficientes devolviendo al cliente archivos estáticos. Tradicionalmente el contenido estático formado por hojas de estilo, archivos JavaScript, imágenes o vídeos de una página o aplicación web han sido devueltos por un servidor web evitando que el servidor de aplicaciones tenga que procesar una gran cantidad de peticiones, aún hoy se sigue haciendo. En caso de que los recursos estáticos estén alojados en el servidor de aplicaciones en vez de en el servidor web, porque los recursos estáticos se empaquetan con la aplicación, el servidor web puede cachearlos evitando que peticiones lleguen al servidor de aplicaciones. En este artículo comentaré cual es la configuración necesaria a añadir en el servidor web <a href="https://nginx.org/">Nginx</a> que hace de <em>proxy</em> para que cachee el resultado de las peticiones así indicadas del servidor de aplicaciones, la aplicación genera el contenido y establece las cabeceras de cache indicando como quiere que se cachee el contenido devuelto.</p>
<p>Para que el servidor web realice el cacheo de los recursos en la aplicación esta ha de devolver en las cabeceras de respuesta como quiere que los recursos sean cacheados usando las cabeceras <em>Last-Modified</em>, <em>Expires</em>, <em>Cache-Control</em> quizá <em>Etag</em>. <a href="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/">Las cabeceras de cache del protocolo HTTP</a> establecen el comportamiento deseado para la cache.</p>
<p>Hay que modificar el archivo de configuración de Nginx para que cachee el contenido. La directiva <em>proxy_cache_path</em> indica donde se guardarán el contenido cacheado, cual es el tamaño de los metadatos de la caché y el tiempo de inactividad para cachear pasado el cual los recursos serán descartables. La directiva <em>proxy_cache_key</em> permite diferenciar los recursos en la cache, <em>add_header X-Proxy-Cache</em> añade una cabecera para la respuesta de Nginx con el resultado de cache que nos permite conocer si se produjo un acierto en la caché, un fallo o se ignoró la cache. Lo que es útil para depurar la aplicación u obtener información. Con <em>proxy_pass</em> hacemos que Nginx haga de <em>proxy</em> para el servidor de aplicaciones o la aplicación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">proxy_cache_path</span> <span class="s">/tmp/nginx</span> <span class="s">levels=1:2</span> <span class="s">keys_zone=localhost_zone:10m</span> <span class="s">inactive=60m</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="k">proxy_cache_key</span> <span class="s">&#34;</span><span class="nv">$scheme$request_method$host$request_uri&#34;</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">	<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">	<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_cache</span> <span class="s">localhost_zone</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">add_header</span> <span class="s">X-Proxy-Cache</span> <span class="nv">$upstream_cache_status</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_pass</span> <span class="s">http://java:4567</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">java</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">java:alpine</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">../build/libs/:/mnt/app/</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">java -classpath &#34;/mnt/app/*&#34; io.github.picodotdev.blogbitix.cache.Main</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nginx</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./nginx.conf:/etc/nginx/conf.d/default.conf:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">links</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">java</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;80:80&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.yml</span>
    </div>
</div>
<p>La siguiente pequeña aplicación Java que usa el <a href="https://spark.apache.org/">framework Spark</a> expone dos recursos para probar el funcionamiento de cache de Nginx, un recurso añade cabeceras de cacheo para la respuesta y otro no añade las cabeceras de respuesta. Atendiendo a las cabeceras establecidas por la aplicación y Nginx configurado para hacer de <em>proxy</em> y cache devolverá el contenido deseado de su cache o solicitándolo a la aplicación y cacheándolo si así se indica en las cabeceras de respuesta.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.cache</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kn">import static</span> <span class="nn">spark.Spark.get</span><span class="o">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">get</span><span class="o">(</span><span class="s">&#34;/nocache&#34;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">getMessage</span><span class="o">();</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">get</span><span class="o">(</span><span class="s">&#34;/cache&#34;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&#34;Cache-Control&#34;</span><span class="o">,</span> <span class="s">&#34;max-age=60&#34;</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&#34;Etag&#34;</span><span class="o">,</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">getMessage</span><span class="o">();</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;¡Hola mundo! (%s)&#34;</span><span class="o">,</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<p>La primera petición que se realiza al recurso <em>cache</em> devuelve un <a href="https://es.wikipedia.org/wiki/Anexo:C%C3%B3digos_de_estado_HTTP#2xx:_Peticiones_correctas">código de estado 200 de HTTP</a> y Nginx en la cabecera <em>X-Proxy-Cache</em> indica que se ha producido un <em>MISS</em> o fallo en la cache, la segunda petición realizada antes de que pase el minuto del tiempo de expiración devuelve un <a href="https://es.wikipedia.org/wiki/Anexo:C%C3%B3digos_de_estado_HTTP#3xx:_Redirecciones">código de estado 304</a> y Nginx en la cabecera <em>X-Proxy-Cache</em> un <em>HIT</em> o acierto en la cache, finalmente pasado más de un minuto del tiempo de expiración se devuelve un código de estado 200 y Nginx en la cabecera <em>X-Proxy-Cache</em> un <em>EXPIRED</em>. En las trazas de Nginx vemos las peticiones que se producen sus códigos de estado y después de este los bytes transferidos de contenido, nótese que en los casos de los 304 los bytes transferidos son 0, bytes de datos ahorrados y evitado que la petición llegue a la aplicación que son unos de los objetivos de las caches. En el recurso <em>nocache</em> de la aplicación Nginx no cachea el contenido devuelto ya que en este no se establecen las cabeceras de cache en la respuesta.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-miss_hu304565c1a9343c13e420aa3d3414b984_122903_2560x1440_fit_box_3.png" data-gallery="" title="Fallo en la cache de Nginx"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-miss_hu304565c1a9343c13e420aa3d3414b984_122903_300x200_fit_box_3.png" width="207" height="200" alt="Fallo en la cache de Nginx" title="Fallo en la cache de Nginx"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-hit_hu304565c1a9343c13e420aa3d3414b984_119894_2560x1440_fit_box_3.png" data-gallery="" title="Acierto en la cache de Nginx"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-hit_hu304565c1a9343c13e420aa3d3414b984_119894_300x200_fit_box_3.png" width="207" height="200" alt="Acierto en la cache de Nginx" title="Acierto en la cache de Nginx"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-expired_hu304565c1a9343c13e420aa3d3414b984_124798_2560x1440_fit_box_3.png" data-gallery="" title="Expiración en la cache de Nginx"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/nginx-cache-peticion-expired_hu304565c1a9343c13e420aa3d3414b984_124798_300x200_fit_box_3.png" width="207" height="200" alt="Expiración en la cache de Nginx" title="Expiración en la cache de Nginx"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/curl-cache-miss-hit-expired_hu4df79497678506697c712136abe7a6ae_80932_2560x1440_fit_box_3.png" data-gallery="" title="Fallo, acierto y expiración en la cache de Nginx con curl"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-para-cachear-respuestas-del-servidor-de-aplicaciones/images/curl-cache-miss-hit-expired_hu4df79497678506697c712136abe7a6ae_80932_300x200_fit_box_3.png" width="252" height="200" alt="Fallo, acierto y expiración en la cache de Nginx con curl" title="Fallo, acierto y expiración en la cache de Nginx con curl"  class="lozad "></a></p>
<figcaption>Fallo, acierto y expiración que produce en la cache de Nginx al realizar peticiones</figcaption>
</figure>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">nginx_1  | 172.17.0.1 - - [30/Jul/2016:10:43:20 +0000] &#34;GET /cache HTTP/1.1&#34; 200 50 &#34;-&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&#34; &#34;-&#34;&#10;</span></span><span class="line"><span class="cl">nginx_1  | 172.17.0.1 - - [30/Jul/2016:10:43:56 +0000] &#34;GET /cache HTTP/1.1&#34; 304 0 &#34;-&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&#34; &#34;-&#34;&#10;</span></span><span class="line"><span class="cl">nginx_1  | 172.17.0.1 - - [30/Jul/2016:10:45:04 +0000] &#34;GET /cache HTTP/1.1&#34; 200 50 &#34;-&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&#34; &#34;-&#34;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.out</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -X GET -I http://localhost/cache&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>curl-cache.sh</span>
    </div>
</div>
<p>Hay servidores específicos para realizar tareas de cache como <a href="https://varnish-cache.org/">Varnish</a> con más opciones de las que ofrece Nginx. Para los casos no complicados usando Nginx evitamos añadir una nueva pieza a la arquitectura de la aplicación. Entre los productos que ofrece Amazon está <a href="https://aws.amazon.com/es/cloudfront/">Cloudfront</a> que es una cache para recursos estáticos con el añadido de que de forma automática está distribuida geográficamente de forma que los recursos se sirven por un servidor más cercano al cliente evitando un mal rendimiento por la latencia. En el artículo <a href="https://picodotdev.github.io/blog-bitix/2014/07/servir-recursos-estaticos-desde-un-cdn-en-apache-tapestry/">servir recursos estáticos de un CDN en Apache Tapestry</a> comento como usar esta red de distribución de contenido ofrecida por Amazon.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/NginxCache">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./gradlew build, cd docker, docker-compose up</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/07/servir-recursos-estaticos-desde-un-cdn-en-apache-tapestry/">Servir recursos estáticos desde un CDN en Apache Tapestry</a></li>
<li><a href="https://serversforhackers.com/nginx-caching">Nginx Caching</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/</id>
        <title>Las cabeceras de cache del protocolo HTTP</title>
        <updated>2016-07-24T22:00:00+02:00</updated>
        <published>2016-07-22T18:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Establecer directivas de cacheo en los recursos devueltos en una página o aplicación web tiene las ventajas de reducir el número de peticiones que llegan al servidor mejorando la latencia y el rendimiento pudiendo atender a más usuarios y mejora los tiempos de carga de las páginas. Usando varias directivas de cacheo la aplicación es capaz de determinar cómo quiere que el contenido devuelto o los recursos sean cacheados por los clientes o servidores de cache intermedios.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/html.svg" width="200" height="200" alt="HTML" title="HTML"  class=""></p>
</div>
<p>Cachear aquella información que es costosa de generar y es muy solicitada consigue por un lado evitar que el servidor sea capaz de atender todo el tráfico reduciendo la cantidad de capacidad necesaria del servidor y por otro lado consigue que la información sea devuelta en menor tiempo. Para aquella información que no necesite estar completamente actualizada o que no cambia cada poco tiempo es candidata a cachearla en caso necesario. La cache se puede realizar en los navegadores guardando estos recursos como imágenes y hojas de estilos que consiguen reducir el número de peticiones al servidor y mostrando la página más rápidamente al usuario. La cache también se puede hacer en el lado del servidor usando soluciones específicas como <a href="https://varnish-cache.org/">Varnish</a>, <a href="https://memcached.org/">memcached</a> o para los casos más habituales que serán la mayoría las funcionalidades incorporadas en el servidor web como en el caso de <a href="https://nginx.org/">Nginx</a>.</p>
<p>El cacheo o almacenamiento temporal de datos puede hacerse a diferentes niveles sin ser exclusivos y de diferentes tipos de información. En la base de datos, en la aplicación, a nivel de página, con servidor intermedio o en el cliente.</p>
<p>Según la cantidad de tiempo de expiración que establezcamos como cache para el contenido conseguiremos variar el número de aciertos en la cache, aumentando el tiempo unos pocos segundos el tiempo que almacenamos en la cache el contenido conseguimos aumentar el porcentaje de aciertos en mayor medida. Con un tiempo de cache de un minuto ya se consiguen porcentajes elevados de aciertos según el número de peticiones realizadas en ese periodo de tiempo.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/images/cache-hit_hudc615f1ae90aec737c335abd2694f309_25816_2560x1440_fit_box_3.png" data-gallery="" title="Petición con acierto en cache"><img src="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/images/cache-hit_hudc615f1ae90aec737c335abd2694f309_25816_300x200_fit_box_3.png" width="300" height="80" alt="Petición con acierto en cache" title="Petición con acierto en cache"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/images/cache-miss_hudc615f1ae90aec737c335abd2694f309_26206_2560x1440_fit_box_3.png" data-gallery="" title="Petición con fallo en cache"><img src="https://picodotdev.github.io/blog-bitix/2016/07/las-cabeceras-de-cache-del-protocolo-http/images/cache-miss_hudc615f1ae90aec737c335abd2694f309_26206_300x200_fit_box_3.png" width="300" height="80" alt="Petición con fallo en cache" title="Petición con fallo en cache"  class="lozad "></a></p>
<figcaption>Petición con acierto y fallo en la cache</figcaption>
</figure>
</div>
<p>En el protocolo HTTP 1.1 se definieron tres mecanismos para las caches:</p>
<ul>
<li>Validez: permite usar un recurso sin hacer ninguna comprobación con el servidor ni para revalidarlo. Por ejemplo, la cabecera <em>Expires</em> indica en que momento el recurso puede haberse quedado obsoleto y se debería revalidar. La cabecera <em>Cache-Control: max-age</em> indica durante cuanto tiempo el recurso puede considerarse válido. Esto evita hacer peticiones al servidor si los recursos se consideran válidos.</li>
<li>Validación: una vez que un recurso se considera que puede ser obsoleto se debería comprobar haciendo una petición al servidor para conocer si sigue siendo válido y si no lo es obtener una nueva versión. Usando las cabeceras <em>If-Modified-Since</em> o <em>Etag</em> puede comprobarse si el recurso ha sido modificado con posterioridad a una fecha o ha variado. Se ha de hacer una petición para comprobar la validez del recurso pero los casos que sigan siendo válidos no hará falta descargarlos de nuevo. Si el recurso sigue siendo válido el servidor responde con el <a href="https://es.wikipedia.org/wiki/Anexo:C%C3%B3digos_de_estado_HTTP#3xx:_Redirecciones">código de estado 304</a> y sin el contenido en la respuesta.</li>
<li>Invalidación: las peticiones que usen los métodos <em>PUT</em>, <em>POST</em> y <em>DELETE</em> pueden invalidar recursos ya que modifican el estado del servidor.</li>
</ul>
<p>El servidor especifica como quiere que el contenido o recursos que devuelve sean cacheados a través de varias directivas del protocolo HTTP, establecidas como cabeceras en la respuesta cuando se solicita el contenido o recurso. Algunas cabeceras realizan funciones similares habiendo cierto solapamiento de funcionalidad. Son las siguientes:</p>
<ul>
<li>Cache-Control: private | public, no-cache, no-store, max-age, s-maxage, must-revalidate, no-transform, proxy-revalidate
<ul>
<li>El valor <em>private</em> indica que el recurso es privado para el usuario y no debería ser cacheado. Esto no hace el recurso más seguro ya que la información no se transmite cifrada para ello hay que <a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">usar un protocolo seguro con TLS/SSL</a>.</li>
<li><em>no-cache</em> el recurso no debería ser cacheado.</li>
<li><em>no-store</em> el recurso no debería ser almacenado.</li>
<li><em>max-age</em> normalmente se ha usado la directiva <em>Expires</em> pero esta permite establecer el máximo tiempo especificado en segundos a cachear un recurso.</li>
<li><em>s-maxage</em> similar a max-age pero para las caches intermedias entre el cliente y el servidor.</li>
<li><em>must-revalidate</em> cuando un recurso se queda obsoleto no se debe usar sin antes validar contra el servidor si sigue siendo válido.</li>
<li><em>no-transform</em> indica que el contenido original no debe ser modificado, por ejemplo, modificando el recurso para optimizarlo si por ejemplo se trata de una imagen.</li>
<li><em>proxy-revalidate</em> lo mismo que <em>must-revalidate</em> pero para las caches intermedias.</li>
</ul>
</li>
<li>If-Modified-Since: si el recurso solicitado con su variante no ha sido modificado con posterioridad a una fecha se devolverá un código de estado 304 sin el contenido.</li>
<li>Expires: es una marca de tiempo que indica cuando el recurso expira, dado que se basa en el tiempo no es muy precisa ya que los relojes de cada ordenador no están perfectamente sincronizados y hay variaciones incluso de minutos. Preferiblemente es mejor usar <em>Etag</em> o <em>max-age</em>.</li>
<li><a href="https://es.wikipedia.org/wiki/HTTP_ETag">Etag</a>: <em>entity-tag</em> o <em>etag</em> es un código <em>hash</em> único del contenido que permite conocer si el recurso ha cambiado. Si el recurso no ha cambiado no hace falta devolver el recurso, si ha cambiado se devuelve en la misma petición. Al no depender de una marca de tiempo como <em>Expires</em> o <em>max-age</em> es más fiable.</li>
<li>Vary: indica que el recurso varía según alguna cabecera proporcionada por el cliente como por ejemplo <em>User-Agent</em> o <em>Accept-Encoding</em>.</li>
<li>Pragma: esta es una directiva antigua que indicada como <em>pragma: no-cache</em>, se interpreta como <em>cache-control: no-cache</em>.</li>
</ul>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="http://dev.mobify.com/blog/beginners-guide-to-http-cache-headers/">A Beginner&rsquo;s Guide to HTTP Cache Headers</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">Header Field Definitions</a></li>
<li><a href="https://librosweb.es/libro/symfony_2_x/capitulo_14.html">Capítulo 14. La caché de HTTP</a></li>
<li><a href="https://librosweb.es/libro/symfony_2_x/capitulo_14/introduccion_a_la_cache_de_http.html">14.3. Introducción a la caché de HTTP</a></li>
<li><a href="https://librosweb.es/libro/symfony_2_x/capitulo_14/caducidad_y_validacion_http.html">14.4. Caducidad y validación HTTP</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/</id>
        <title>Cómo crear un proxy inverso entre el servidor web Nginx y un servidor de aplicaciones Java</title>
        <updated>2016-07-16T13:30:00+02:00</updated>
        <published>2016-07-15T18:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Continuando la serie de artículos sobre varios aspectos realizados muy comúnmente en las aplicaciones y servidores web en este artículo explicaré como hacer que un servidor web nginx haga de <em>proxy</em> inverso para un servidor de aplicaciones Java en este caso Tomcat.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/tomcat.svg" width="200" height="133" alt="Tomcat" title="Tomcat"  class=""></p>
</div>
<p>Las aplicaciones web dinámicas Java se despliegan en un contenedor de <em>servlets</em> o un <a href="https://picodotdev.github.io/blog-bitix/2014/02/el-servidor-de-aplicaciones-jboss-slash-wildfly/">servidor de aplicaciones como WildFly</a> que implementa las <a href="https://picodotdev.github.io/blog-bitix/2016/03/introduccion-y-nuevas-caracteristicas-de-java-ee-7/">especificaciones de los estándares de Java EE</a> pero es habitual que los usuarios no accedan directamente al contenedor de aplicaciones Java sino que se ponga delante un servidor web como <a href="https://httpd.apache.org/">Apache</a> o <a href="https://nginx.org/">Nginx</a> con la tarea de que realice algunas tareas. Las tareas que puede realizar un servidor web son varias como:</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">Realizar la conexión TLS/SSL</a> sin necesidad de que llegue al servidor de aplicaciones.</li>
<li>Servir el contenido estático.</li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/">Balanceo de carga</a> con la que podremos tener varios servidores de aplicaciones Java en caso de que la aplicación deba soportar muchos usuarios.</li>
<li>Cacheo de páginas y contenido.</li>
<li>Redirecciones y reescritura de URL.</li>
<li>Seguridad.</li>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/08/forzar-el-uso-del-protocolo-https-en-apache-tapestry/">Forzar el uso del protocolo seguro HTTPS</a>.</li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">Ofrecer el protocolo HTTP/2</a>.</li>
</ul>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/images/reverse-proxy_hucb2175c82081c16158c94c9e724fcd73_17320_2560x1440_fit_box_3.png" data-gallery="" title="Esquema de un proxy inverso"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/images/reverse-proxy_hucb2175c82081c16158c94c9e724fcd73_17320_300x200_fit_box_3.png" width="300" height="113" alt="Esquema de un proxy inverso" title="Esquema de un proxy inverso"  class="lozad "></a></p>
<figcaption>Un proxy inverso recibe las peticiones de internet y las reenvía a los servidores de una red interna sin necesidad de que los clientes conozcan la red interna</figcaption>
</figure>
</div>
<p>Para que un servidor web como Nginx actúe como <em>proxy</em> inverso o <em>reverse proxy</em> para un servidor de aplicaciones debemos añadir unas pocas directivas al archivo de configuración del servidor web. En el caso de Nginx usando la directiva <em>proxy_pass</em> donde indicamos para una localización la URL del servidor de aplicaciones a la que se le solicitará el contenido, en el ejemplo usando un servidor <a href="https://tomcat.apache.org/">Tomcat</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">	<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">	<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_pass</span> <span class="s">http://tomcat:8080</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">		<span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="s">https</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Una forma fácil de probarlo es usando <a href="https://www.docker.com/">Docker</a> y <a href="https://docs.docker.com/compose/">Docker Compose</a> que en varios artículos introductorios siendo el primero el <a href="https://picodotdev.github.io/blog-bitix/2014/11/como-instalar-y-guia-de-inicio-basica-de-docker/">inicio básico de Docker</a> comento como empezar a usarlo y en que consiste esta nueva forma de ejecución para las aplicaciones. Con el siguiente archivo de Docker Compose creamos dos contenedores uno para Nginx en el que proporcionamos su configuración personalizada y otro contenedor para Tomcat.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">tomcat</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nginx</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./nginx.conf:/etc/nginx/conf.d/default.conf:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">links</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">tomcat</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;80:80&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.yml</span>
    </div>
</div>
<p>Al hacer un <em>proxy</em> inverso debemos tener en cuenta que el servidor Tomcat si devuelve URL absolutas las haga siendo las del servidor web por las que se accede a la aplicación, si únicamente genera URL relativas no deberemos hacer nada pero en el caso de absolutas el servidor Tomcat deberá conocer el protocolo usado en el servidor web (HTTP o HTTPS) y el puerto del servidor web que suele ser 80 para HTTP y 443 para HTTPS pero que en el servidor Tomcat suele ser 8080 para HTTP y 8443 para HTTPS. Si el protocolo y puerto usado en el servidor web y servidor de aplicaciones es diferente y una aplicación genera URL absolutas el servidor de aplicaciones deberá tener esto en cuenta que es lo que se usa el en servidor web.</p>
<p>En la documentación se comentan varios <a href="https://tomcat.apache.org/tomcat-8.0-doc/config/http.html">parámetros de configuración de Tomcat</a> como <em>proxyPort</em> y <em>scheme</em> que ajustan la información devuelta por los métodos <em>request.getServerPort()</em> y <em>request.getScheme()</em> y que nos servirá en caso de tener que generar URLs absolutas.</p>
<p>Arrancado los contenedores con el comando <code>docker-compose up</code> accediendo al servidor web veremos que el contenido proporcionado es el ofrecido por Tomcat, que con la configuración del ejemplo es la página de inicio de Tomcat. En las cabeceras de respuesta Nginx añade una, <em>Server</em>, indicando su versión.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/images/nginx-tomcat_hu65abe743fc3bbc70de8b5763b0e01416_165612_2560x1440_fit_box_3.png" data-gallery="" title="Nginx configurado como proxy inverso de un servidor de aplicaciones Tomcat"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/images/nginx-tomcat_hu65abe743fc3bbc70de8b5763b0e01416_165612_300x200_fit_box_3.png" width="278" height="200" alt="Nginx configurado como proxy inverso de un servidor de aplicaciones Tomcat" title="Nginx configurado como proxy inverso de un servidor de aplicaciones Tomcat"  class="lozad "></a></p>
<figcaption>Nginx configurado como proxy inverso de un servidor de aplicaciones Tomcat</figcaption>
</figure>
</div>
<p>En la <a href="https://www.nginx.com/resources/admin-guide/reverse-proxy/">documentación sobre <em>reverse proxy</em> de Nginx</a> se explican algunas directivas más para pasar al servidor Tomcat la dirección IP del usuario usando cabeceras HTTP, en la configuración de Nginx usando <em>proxy_set_header</em>.</p>
<p>Nginx y Apache como <em>proxys</em> inversos cubren algunos casos en los que son suficientes, aquellos en los que la configuración como <em>proxys</em> no es reducida y estática ya que requieren reiniciar el servidor web. Para la computación en la nube y arquitecturas de microservicios <a href="https://picodotdev.github.io/blog-bitix/2021/09/el-proxy-inverso-traefik-caracteristicas-y-funcionalidades-que-ofrece/">el <em>proxy</em> inverso Traefik</a> está mejor adaptado ya que su configuración de enrutado es dinámica al tomarse de diferentes proveedores como <a href="https://www.consul.io/">Consul</a>, <a href="https://www.docker.com/">Docker</a> o <a href="https://kubernetes.io/">Kubernetes</a>.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/NginxReverseProxy">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>docker-compose up</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.nginx.com/resources/admin-guide/reverse-proxy/">NGINX Reverse Proxy</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2011/02/unir-apache-httpd-y-tomcat-mediante-un.html">Unir Apache HTTPD y Tomcat mediante un reverse proxy </a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/</id>
        <title>Configurar Nginx como balanceador de carga</title>
        <updated>2016-07-09T11:00:00+02:00</updated>
        <published>2016-07-08T17:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx"  class=""></p>
</div>
<p>Un balanceador de carga distribuye las peticiones que llegan al servidor entre varios servidores para que las atiendan consiguiendo optimizar el uso de los recursos, aumentar el número de peticiones atendidas por unidad de tiempo, reducir la latencia y proporcionar tolerancia a fallos. Escalar un servidor que deba procesar un gran número de peticiones llegado un límite es más barato escalar horizontalmente añadiendo más servidores que escalar verticalmente usando servidores más potentes.</p>
<p>Distribuir las peticiones ha de hacerse eficientemente para que un servidor no reciba todas las peticiones pesadas y se sature mientras hay servidores que tienen poca carga. Usando varios servidores para atender las peticiones evita que haya un único punto de fallo en la aplicación proporcionando tolerancia a fallos, si un servidor sufre un fallo el resto de servidores se encargarán de atender las peticiones. Una mejor tolerancia a fallos aumentará la disponibilidad del servicio sin que haya caídas de servicio.</p>
<p>Hay soluciones específicas para balancear la carga como <a href="https://www.haproxy.org/">HAProxy</a> pero para los casos sencillos que son los más habituales y para no añadir una pieza más a la arquitectura de la aplicación <a href="https://nginx.org/">Nginx</a> es capaz de hacer las funciones de balanceo de carga entre varios servidores de aplicaciones.</p>
<p>Hay tres estrategias para balancear o distribuir la carga:</p>
<ul>
<li><em>round-robin</em>: las peticiones son distribuidas entre los servidores de forma cíclica. Cabe la posibilidad de que las peticiones más pesadas sean procesadas por el mismo servidor, distribuye las peticiones de forma ecuánime pero la carga no.</li>
<li><em>least-connected</em>: la siguiente petición es atendida por el servidor con menos conexiones activas.</li>
<li><em>ip-hash</em>: se selecciona el servidor que atenderá la petición en base a algún dato como la dirección IP, de esta forma todas las peticiones de un usuario son atendidas por el mismo servidor.</li>
</ul>
<p>Esta es la configuración básica con la estrategia <em>round-robin</em>. Los servidores balanceados se definen con la directiva <em>upstream</em> a los que se hace de <em>proxy</em> inverso con la directiva <em>proxy_pass</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">app</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app1</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app2</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app3</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_pass</span> <span class="s">http://app</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">add_header</span> <span class="s">X-Upstream</span> <span class="nv">$upstream_addr</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Para usar la estrategia <em>least-connected</em> hay que indicar la directiva <em>least_conn</em> en la directiva <em>upstream</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">upstream app {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;least_conn;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-least_conn.conf</span>
    </div>
</div>
<p>Hay que tener en cuenta que en las estrategias <em>round-robin</em> y <em>least-connected</em> cada petición probablemente sea atendida por un servidor diferente de modo que si los servidores no comparten las sesiones se producirán comportamientos erráticos. Usando la estrategia <em>ip_hash</em> se usará la dirección IP para redirigir todas las peticiones al mismo servidor que se conoce como <em>sticky session</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">upstream app {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ip_hash;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-ip_hash.conf</span>
    </div>
</div>
<p>Para que los servidores compartan la sesión y evitar usar <em>sticky session</em> podemos <a href="https://picodotdev.github.io/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/">usar Redis como sistema de información para guardar las sesiones de los servidores</a>, si un servidor de aplicaciones deja de funcionar las sesiones que mantuviese no se perderán y las peticiones podrán ser atendida por cualquier servidor. Si hay un servidor que queremos procese más peticiones porque tiene más capacidad podemos dar más peso a este. En esta configuración de cada 5 peticiones 3 serán atendidas por el servidor <em>app1</em>, 1 por el <em>app2</em> y otra por <em>app3</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">upstream app {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080 weight=3;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-weight.conf</span>
    </div>
</div>
<p>Cuando un servidor falla al servir una petición Nginx lo marca como en estado erróneo y deja de enviarle peticiones, las comprobaciones de salud se hacen de forma pasiva según el resultado de las peticiones que se envían. Con <em>max_fails</em> se establece el máximo número de fallos antes de considerar un servidor con estado erróneo, tiene un valor por defecto de 1. Con <em>fail_timeout</em> se establece el tiempo que un servidor se considera que está en estado erróneo antes de enviar una nueva petición, si enviada una nueva petición responde correctamente se vuelve a considerar en estado correcto. Con la directiva <em>health_check</em> se puede configurar las comprobaciones de estado que hace Nginx para determinar si el servidor de aplicaciones está funcionando correctamente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">upstream app {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080 max_fails=5 fail_timeout=30s;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080 max_fails=1 fail_timeout=60s;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-misc.conf</span>
    </div>
</div>
<p>Si queremos que el cliente conozca que servidor atendió la petición podemos añadir la <a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header">directiva <em>add_header</em></a> usando una de las <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#variables">variables añadidas por el módulo  <em>ngx_http_upstream</em></a>, nos servirá para depurar la aplicación en tiempo de desarrollo.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-1_hu01e6c56ef6a522eb9411df6425aed444_172831_2560x1440_fit_box_3.png" data-gallery="" title="Servidor balanceado 172.17.0.2:8080"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-1_hu01e6c56ef6a522eb9411df6425aed444_172831_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.2:8080" title="Servidor balanceado 172.17.0.2:8080"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-2_hu01e6c56ef6a522eb9411df6425aed444_173087_2560x1440_fit_box_3.png" data-gallery="" title="Servidor balanceado 172.17.0.3:8080"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-2_hu01e6c56ef6a522eb9411df6425aed444_173087_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.3:8080" title="Servidor balanceado 172.17.0.3:8080"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-3_hu01e6c56ef6a522eb9411df6425aed444_172434_2560x1440_fit_box_3.png" data-gallery="" title="Servidor balanceado 172.17.0.4:8080"><img src="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-3_hu01e6c56ef6a522eb9411df6425aed444_172434_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.4:8080" title="Servidor balanceado 172.17.0.4:8080"  class="lozad "></a></p>
<figcaption>Nginx balanceando la carga entre 3 servidores de aplicaciones Tomcat</figcaption>
</figure>
</div>
<p>En el ejemplo de configuración usaré <a href="https://www.docker.com/">Docker</a> para crear un servidor web Nginx que haga de balanceador de carga entre tres servidores de aplicaciones Tomcat. Con Docker hacer esta prueba es mucho más sencilla que instalar tres Tomcats y un servidor Nginx a través de los paquetes del sistema o descargando binarios, puedes leer los <a href="https://picodotdev.github.io/blog-bitix/series/docker/">artículos de la serie Docker</a> que he escrito para conocer como usarlo y que ofrece esta útil herramienta. El archivo de <em>docker-compose.yml</em> completo es el siguiente:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">app1</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">app2</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">app3</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nginx</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./nginx.conf:/etc/nginx/conf.d/default.conf:ro</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">links</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app1</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app2</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app3</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">&#10;</span></span></span><span class="line"><span class="cl"><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;80:80&#34;</span><span class="w">&#10;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.yml</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/NginxLoadBalancer">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>docker-compose up</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="http://nginx.org/en/docs/http/load_balancing.html">Using NGINX as HTTP load balancer</a></li>
<li><a href="https://www.nginx.com/blog/load-balancing-with-nginx-plus/">Load Balancing with NGINX and NGINX Plus, Part 1</a></li>
<li><a href="https://www.nginx.com/blog/load-balancing-with-nginx-plus-part2/">Load Balancing with NGINX and NGINX Plus, Part 2</a></li>
<li><a href="https://www.nginx.com/resources/admin-guide/load-balancer/">NGINX Load Balancing - HTTP Load Balancer</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/</id>
        <title>Cómo optimizar un sitio web con compresión GZIP en Nginx y Apache HTTPD</title>
        <updated>2016-07-02T12:30:00+02:00</updated>
        <published>2016-07-02T12:30:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Comprimir el contenido es de utilidad para aquellos usuarios a los que se les factura por los datos transmitidos o tienen límites de transferencia en sus contratos con los proveedores de banda ancha o red móvil. Modificando la configuración del servidor web que usemos haremos que nuestra página o aplicación web comprima el contenido que envía a los navegadores de los usuarios reduciendo los datos transferidos y optimizando el sitio web.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/apache.svg" width="150" height="264" alt="Apache HTTPD" title="Apache HTTPD"  class=""></p>
</div>
<p>Con las velocidades de transferencia que proporciona la fibra, el ADSL incluso el 4G o 3G de los móviles transmitir el contenido de una web desde el servidor al cliente ya no es el factor más determinante en el tiempo de carga de una página, lo es más la latencia de la red y el establecimiento de múltiples conexiones. Aún así hay usuarios que por una red de baja calidad o que esté saturada pueden tener tasas de transferencia bajas o puede que al usuario se le facture por la cantidad de datos que transmite. Por estos motivos aún hoy es buena idea activar en el servidor la compresión GZIP para que los datos transmitidos se compriman y reduzcan de forma significativa. La compresión GZIP es una optimización que podemos realizar para cualquier página web. Para mejorar la latencia en el establecimiento de conexiones es aconsejable <a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">configurar HTTP/2 en el servidor web</a> para mejorar la velocidad de carga de la página.</p>
<p>Dependiendo del servidor web la configuración que deberemos añadir será diferente, en este artículo mostraré la configuración a usar para dos de los servidores web más populares en internet, que son <a href="https://nginx.org/">Nginx</a> y <a href="https://httpd.apache.org/">Apache HTTPD</a>.</p>
<h3 id="nginx">Nginx</h3>
<p>Usando varias <a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html">directivas de Nginx para la compresión</a> la activamos, establecemos el nivel de compresión, el tamaño de los <em>buffers</em> dedicados a la compresión y finalmente los <em>mimetypes</em> de los archivos que queremos sean comprimidos antes de enviarse al cliente (el texto plano, contenido CSS, JSON, XML, RSS y JavaScript). El <em>mimetype</em> <em>text/html</em> no hace falta indicarlo porque siempre está activo y para los formatos de archivos que ya están comprimidos es innecesario como fotos o vídeos.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_disable</span> <span class="s">&#34;msie6&#34;</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_vary</span> <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_proxied</span> <span class="s">any</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_comp_level</span> <span class="mi">6</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_buffers</span> <span class="mi">16</span> <span class="mi">8k</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="kn">gzip_types</span> <span class="s">text/plain</span> <span class="s">text/css</span> <span class="s">application/json</span> <span class="s">application/x-javascript</span> <span class="s">text/xml</span> <span class="s">application/xml</span> <span class="s">application/xml+rss</span> <span class="s">text/javascript</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Para probarlo usaré un contenedor de <a href="https://www.docker.com/">Docker</a> en el que personalizaré la configuración y usaré mi propia bitácora como página web a servir. Para conocer Docker puedes consultar otra <a href="https://picodotdev.github.io/blog-bitix/series/docker/">serie de artículos sobre Docker</a> dedicados a esta tecnología de contenedores. Escrito el archivo de configuración, el contenedor se inicia con:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm --name nginx -p 80:80 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/nginx.conf:/etc/nginx/conf.d/default.conf:ro -v /home/picodotdev/Software/personal/git/blog-bitix/public:/usr/share/nginx/html:ro nginx&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-nginx.sh</span>
    </div>
</div>
<p>En la siguiente captura se aprecia que Nginx devuelve la cabecera de respuesta <em>Content-Encoding: gzip</em> indicando que el contenido ha sido comprimido antes de su transmisión por la red. Haciendo que Nginx haga de servidor web para mi propia bitácora se pueden apreciar la significativa diferencia en kilobytes transmitidos entre el tamaño que tienen y lo transferido para algunos recursos. Por ejemplo, el HTML de la página de inicio tiene un tamaño sin comprimir de 34,11 KB y comprimido un tamaño mucho menor 8,38 KB, una diferencia de 25,73 KB aproximadamente un ratio de compresión del 75%. Para el recurso <em>bootstrap.min.css</em> que ya está minificado eliminando caracteres innecesarios es aún más significativo de 118,43 KB a 23,36, 95,04 KB menos un 80% de reducción.</p>
<p>Unos pocos kilobytes no son mucho para un único recurso pero si tenemos en cuenta que una página tiene varias docenas y hacemos una multiplicación por cada acceso a una página la cantidad de datos ahorrados en la transferencia es notable.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/nginx-no-gzip_hu8ae7e2af929b6fa0ee8b79777cd81846_276701_2560x1440_fit_box_3.png" data-gallery="" title="Nginx configurado sin compresión GZIP"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/nginx-no-gzip_hu8ae7e2af929b6fa0ee8b79777cd81846_276701_300x200_fit_box_3.png" width="300" height="148" alt="Nginx configurado sin compresión GZIP" title="Nginx configurado sin compresión GZIP"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/nginx-gzip_hu6d61388e9a20bef52da27cbc4b0fc482_222425_2560x1440_fit_box_3.png" data-gallery="" title="Nginx configurado con compresión GZIP"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/nginx-gzip_hu6d61388e9a20bef52da27cbc4b0fc482_222425_300x200_fit_box_3.png" width="300" height="148" alt="Nginx configurado con compresión GZIP" title="Nginx configurado con compresión GZIP"  class="lozad "></a></p>
<figcaption>Nginx configurado sin y con compresión GZIP</figcaption>
</figure>
</div>
<h3 id="apache-httpd">Apache HTTPD</h3>
<p>Activado el módulo para realizar la compresión al igual que el caso de Nginx podemos establecer la cantidad de memoria reservada para la compresión, el nivel de compresión y los <em>mimetypes</em> del contenido a comprimir. Con las <a href="http://httpd.apache.org/docs/current/mod/mod_deflate.html">directivas adicionales de la documentación</a> se puede personalizar aún más el proceso de compresión.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-apache" data-lang="apache"><span class="line"><span class="cl"><span class="nb">LoadModule</span> deflate_module modules/mod_deflate.so&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">ServerName</span> localhost&#10;</span></span><span class="line"><span class="cl">   <span class="nb">DocumentRoot</span> <span class="sx">/usr/local/apache2/htdocs</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">   <span class="nb">SetOutputFilter</span> DEFLATE&#10;</span></span><span class="line"><span class="cl">   <span class="nb">DeflateBufferSize</span> <span class="m">8096</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">DeflateCompressionLevel</span> <span class="m">6</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">AddOutputFilterByType</span> DEFLATE text/html text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>httpd.conf</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm --name apache -p 80:80 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro -v /home/picodotdev/Software/personal/git/blog-bitix/public:/usr/local/apache2/htdocs:ro httpd&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-httpd.sh</span>
    </div>
</div>
<p>Vemos una reducción en la transferencia similar a la conseguida en Nginx. En Apache el recurso a servir ha de tener cierto tamaño siendo de unos pocos bytes opta por servirlo sin comprimir ya que considerará que no producirá un ahorro significativo.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/apache-httpd-no-gzip_hu8937ef9644c64bbe4571ad5847c2a7f4_257645_2560x1440_fit_box_3.png" data-gallery="" title="Apache HTTPD configurado sin compresión GZIP"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/apache-httpd-no-gzip_hu8937ef9644c64bbe4571ad5847c2a7f4_257645_300x200_fit_box_3.png" width="300" height="156" alt="Apache HTTPD configurado sin compresión GZIP" title="Apache HTTPD configurado sin compresión GZIP"  class="lozad "></a>
<a href="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/apache-httpd-gzip_huea7aac62a38b9e8894414b3f64502c54_273448_2560x1440_fit_box_3.png" data-gallery="" title="Apache HTTPD configurado con compresión GZIP"><img src="https://picodotdev.github.io/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/images/apache-httpd-gzip_huea7aac62a38b9e8894414b3f64502c54_273448_300x200_fit_box_3.png" width="300" height="156" alt="Apache HTTPD configurado con compresión GZIP" title="Apache HTTPD configurado con compresión GZIP"  class="lozad "></a></p>
<figcaption>Apache HTTPD configurado sin y con compresión GZIP</figcaption>
</figure>
</div>
<p>La compresión se hace en cada petición que se hace al servidor que con los avanzados procesadores actuales con eficientes instrucciones específicas para la tarea implementadas en el hardware salvo un tráfico muy elevado no tiene por que notarse en gran medida el procesado de cada recurso. Si el tráfico fuese elevado y la carga de compresión se notase Nginx y Apache ofrecen la posibilidad de <a href="http://nginx.org/en/docs/http/ngx_http_gzip_static_module.html">precomprimir los recursos</a> y de forma similar <a href="http://httpd.apache.org/docs/current/mod/mod_deflate.html#precompressed">precomprimir los recursos en apache</a>.</p>
<p>La compresión es otra de las configuraciones básicas aconsejable hacer en un servidor web junto con:</p>
<ul>
<li>Añadir cifrado y autenticación con TLS/SSL.</li>
<li>Añadir el soporte para el protocolo HTTP/2 que ya incluyen los navegadores.</li>
<li>Redirigir el tráfico del dominio raíz al subdominio www.</li>
<li>Redirigir el tráfico de HTTP a HTTPS.</li>
</ul>
<p>Estas funcionalidades las puedes consultar en el resto de artículos de la <a href="https://picodotdev.github.io/blog-bitix/series/web/">serie web</a>.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/WebServerCompresionGzip">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./docker-nginx.sh o ./docker-httpd.sh</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html">Module ngx_http_gzip_module</a></li>
<li><a href="http://httpd.apache.org/docs/current/mod/mod_deflate.html">Apache Module mod_deflate</a></li>
<li><a href="http://betterexplained.com/articles/how-to-optimize-your-site-with-gzip-compression/">How To Optimize Your Site With GZIP Compression</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/</id>
        <title>Cómo redirigir peticiones de HTTP a HTTPS en Nginx, Apache, Tomcat, Jetty y WildFly</title>
        <updated>2016-06-18T13:00:00+02:00</updated>
        <published>2016-06-18T13:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Usar el protocolo seguro HTTPS proporciona confidencialidad en la comunicación entre el navegador del usuario y el servidor, es una forma de mejorar la seguridad y privacidad. Por ello el buscador de Google lo tiene en cuenta como un parámetro que afecta al SEO siendo mejor usar el protocolo seguro. Sin embargo, el usuario puede estar accediendo por el protocolo no seguro a la página web al poner la dirección en la barra de direcciones o hay enlaces hacia nuestro sitio en otros que hacen uso del protocolo HTTP. Si queremos que nuestro sitio sea accedido únicamente usando el protocolo seguro deberemos hacer una redirección en el servidor.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx"  class=""></p>
</div>
<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/apache.svg" width="150" height="264" alt="Apache HTTPD" title="Apache HTTPD"  class=""></p>
</div>
<p>Si tenemos una aplicación o una bitácora que hasta el momento era accedido por el protocolo no cifrado <abbr title="Hypertext Transfer Protocol">HTTP</abbr> ahora que Google tiene en cuenta para el <abbr title="Search engine optimization">SEO</abbr> que usar el protocolo seguro es un parámetro que tiene en cuenta el algoritmo de posicionamiento en el buscador quizá queramos redirigir todo el tráfico de HTTP al protocolo cifrado <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr>.</p>
<p>Para usar HTTPS deberemos primero <a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">configurar el protocolo TLS/SSL en el servidor web o de aplicaciones</a> usando un certificado SSL que podemos obtener ahora con <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> de forma gratuita  o <a href="https://picodotdev.github.io/blog-bitix/2014/02/generar-y-convertir-claves-y-certificados-con-openssl/">generar un certificado</a> nosotros y que sea firmado por una autoridad de confianza. Una vez que el servidor es capaz de servir el tráfico por el protocolo HTTPS estamos en condiciones de realizar la redirección al protocolo cifrado HTTPS en el puerto 443 cuando sea accedido por el protocolo no cifrado HTTP en el puerto 80.</p>
<p>Dependiendo del servidor web o de aplicaciones que usemos la configuración será distinta, incluso lo podemos hacer a nivel de aplicación con la ayuda del <em>framework</em> web si este ofrece algún soporte para ello. A continuación incluiré la configuración necesaria para los servidores web y de aplicaciones más populares como son <a href="https://nginx.org/">Nginx</a>, <a href="https://httpd.apache.org/">Apache HTTPD</a>, <a href="https://tomcat.apache.org/">Tomcat</a>, <a href="https://eclipse.org/jetty/">Jetty</a> y <a href="https://wildfly.org/">WildFly</a> y finalmente el caso haciendo la redirección a nivel de aplicación con el <em>framework</em> <a href="https://tapestry.apache.org/">Apache Tapestry</a> para desarrollar aplicaciones web con el lenguaje Java.</p>
<div class="alert alert-warning pt-0 pb-0 tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="redirigir-de-http-a-https-en-nginx">Redirigir de HTTP a HTTPS en Nginx</h3>
<p>Usando <a href="https://www.docker.com/">Docker</a> nos resultará más sencillo hacer la prueba que teniendo que instalar el paquete de Nginx en nuestra distribución. Puedes consultar <a href="https://picodotdev.github.io/blog-bitix/series/docker/">varios artículos sobre Docker</a> que he escrito a modo introducción y para empezar a usarlo.</p>
<p>En la sección del servidor que escucha en el puerto HTTP (80) realizamos la redirección permanente con el código de estado 301 hacia el protocolo HTTPS. En la sección del servidor que escucha en el puerto HTTPS (443) activa el uso de TLS/SSL usando varias directivas y sirve los documentos de <em>/usr/share/nginx/html</em> en la ruta <em>/</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span>&nbsp;&nbsp;&nbsp;&nbsp;   <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s">localhost.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate_key</span>  <span class="s">localhost.key</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_protocols</span>  <span class="s">SSLv2</span> <span class="s">SSLv3</span> <span class="s">TLSv1</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_prefer_server_ciphers</span>   <span class="no">on</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm --name nginx -p 80:80 -p 443:443 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/nginx.conf:/etc/nginx/conf.d/default.conf:ro -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/localhost.key:/etc/nginx/localhost.key:ro -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/localhost.pem:/etc/nginx/localhost.pem:ro nginx&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-nginx.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/images/nginx-https_hue63bd68d6da26158af47489fff3f4633_39049_2560x1440_fit_box_3.png" data-gallery="" title="Redirección de HTTP a HTTPS en Nginx"><img src="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/images/nginx-https_hue63bd68d6da26158af47489fff3f4633_39049_300x200_fit_box_3.png" width="300" height="193" alt="Redirección de HTTP a HTTPS en Nginx" title="Redirección de HTTP a HTTPS en Nginx"  class="lozad "></a></p>
<figcaption>Redirección de HTTP a HTTPS en Nginx</figcaption>
</figure>
</div>
<h3 id="redirigir-de-http-a-https-en-apache-httpd">Redirigir de HTTP a HTTPS en Apache HTTPD</h3>
<p>La configuración para Apache HTTPD es similar simplemente cambian las directivas según su propia configuración. Se activan los módulos para usar TLS/SSL y el que permite hacer reescrituras de las URL.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-apache" data-lang="apache"><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">LoadModule</span> ssl_module modules/mod_ssl.so&#10;</span></span><span class="line"><span class="cl"><span class="nb">LoadModule</span> rewrite_module modules/mod_rewrite.so&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">ServerName</span> localhost&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteEngine</span> <span class="k">On</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteCond</span> %{HTTPS} <span class="k">off</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">RewriteRule</span> (.*) https://%{SERVER_NAME}$1 [R,L] &#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:443</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">ServerName</span> localhost&#10;</span></span><span class="line"><span class="cl">   <span class="nb">DocumentRoot</span> <span class="sx">/usr/local/apache2/htdocs</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">SSLEngine</span> <span class="k">On</span>&#10;</span></span><span class="line"><span class="cl">   <span class="nb">SSLCertificateFile</span> conf/localhost.crt&#10;</span></span><span class="line"><span class="cl">   <span class="nb">SSLCertificateKeyFile</span> conf/localhost.key&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>httpd.conf</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm --name apache -p 80:80 -p 443:443 -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/localhost.key:/usr/local/apache2/conf/localhost.key:ro -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/localhost.crt:/usr/local/apache2/conf/localhost.crt:ro httpd&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-httpd.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/images/apache-httpd-https_hubf9e456f70a86242ec4ea551d624d414_17136_2560x1440_fit_box_3.png" data-gallery="" title="Redirección de HTTP a HTTPS en Apache HTTPD"><img src="https://picodotdev.github.io/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/images/apache-httpd-https_hubf9e456f70a86242ec4ea551d624d414_17136_300x200_fit_box_3.png" width="300" height="193" alt="Redirección de HTTP a HTTPS en Apache HTTPD" title="Redirección de HTTP a HTTPS en Apache HTTPD"  class="lozad "></a></p>
<figcaption>Redirección de HTTP a HTTPS en Apache HTTPD</figcaption>
</figure>
</div>
<h3 id="redirigir-de-http-a-https-en-tomcat-jetty-y-wildfly">Redirigir de HTTP a HTTPS en Tomcat, Jetty y WildFly</h3>
<p>Es muy habitual que los servidores de aplicaciones como Tomcat, Jetty o WildFly sean accedidos no directamente por el navegador del usuario sino a través de un servidor web como Nginx o Apache haciendo de <em>proxy</em>. Cuando hay un servidor web que actúa de <em>proxy</em> para el servidor de aplicaciones es posible decidir que el establecimiento de la conexión cifrada TLS/SSL del protocolo HTTPS se realice en el servidor web y la comunicación cifrada termine al mismo tiempo en él, la comunicación entre el servidor web y el servidor de aplicaciones se realizaría usando el protocolo HTTP. Esto descarga del servidor de aplicaciones la tarea algo costosa del establecimiento de la conexión cifrada y tener que cifrar el tráfico.</p>
<p>Para el caso de Tomcat, Jetty y WildFly habiendo configurado la posibilidad de usar el protocolo seguro la configuración para hacer la redirección es la misma para los tres, habría que añadir al archivo descriptor <em>web.xml</em> de la aplicación el siguiente fragmento XML. Esto hace que el servidor fuerce la conexión segura para los recursos indicados, en este caso todos al usar el patrón <em>/*</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-XML" data-lang="XML"><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;security-constraint&gt;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nt">&lt;web-resource-collection&gt;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="nt">&lt;web-resource-name&gt;</span>Confidential URLs<span class="nt">&lt;/web-resource-name&gt;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/web-resource-collection&gt;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nt">&lt;user-data-constraint&gt;</span>&#10;</span></span><span class="line"><span class="cl">	<span class="nt">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="nt">&lt;/transport-guarantee&gt;</span>&#10;</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/user-data-constraint&gt;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nt">&lt;/security-constraint&gt;</span>&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>web.xml</span>
    </div>
</div>
<h3 id="redirigir-de-http-a-https-en-en-una-aplicación-java">Redirigir de HTTP a HTTPS en en una aplicación Java</h3>
<p>Con algún mecanismo propio que empleemos al programar la aplicación (en Java por ejemplo con un filtro) o el <em>framework</em> web que usemos para desarrollar la aplicación web quizá nos ofrezca algún mecanismo para redirigir las peticiones al puerto seguro cuando sea accedida por el puerto inseguro, por ejemplo, para que la redirección la haga la aplicación en vez del servidor con el <em>framework</em> Apache Tapestry basta añadir la siguiente configuración en el módulo de la aplicación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">contributeMetaDataLocator</span><span class="o">(</span><span class="n">MappedConfiguration</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">configuration</span><span class="o">)</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">	<span class="n">configuration</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">MetaDataConstants</span><span class="o">.</span><span class="na">SECURE_PAGE</span><span class="o">,</span> <span class="s">&#34;true&#34;</span><span class="o">);</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppModule.java</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/WebServerRedirectHTTPtoHTTPS">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./docker-nginx.sh o ./docker-httpd.sh</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://wiki.apache.org/httpd/RedirectSSL">Redirect Request to SSL</a></li>
<li><a href="https://confluence.atlassian.com/stashkb/redirect-http-requests-to-https-333810132.html">Redirect HTTP Requests to HTTPS (in Tomcat)</a></li>
<li><a href="http://www.eclipse.org/jetty/documentation/current/configuring-ssl.html">Configuring SSL/TLS (in Jetty)</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="seguridad"/>
            
                <category term="software"/>
            
                <category term="software-libre"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/</id>
        <title>Configurar HTTP/2 en Nginx, Apache HTTPD, WildFly o Jetty</title>
        <updated>2016-02-26T19:00:00+01:00</updated>
        <published>2016-02-26T19:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>HTTP/2 se puede usar ya, los principales navegadores web, servidores web y de aplicaciones ya han añadido el soporte necesario ofreciendo varias ventajas para los usuarios, desarrolladores, dispositivos cliente y los servidores. En varios de los servidores más populares la configuración necesaria no es complicada.</strong></p>]]>
        <![CDATA[<p>HTTP/2 es el protocolo que ha surgido para mejorar la experiencia de navegación de la web, proporcionará menos latencia y más velocidad siendo más eficiente. En la <a href="https://picodotdev.github.io/blog-bitix/2016/02/introduccion-al-protocolo-http-2/">introducción al protocolo HTTP/2</a> comentaba de que necesidad surge, sus ventajas, alguna diferencia con HTTP 1.1, varias cosas que los desarrolladores hacíamos que quedarán obsoletas y otras varias que deberemos seguir haciendo. Se pubicó oficialmente en 2015 y los principales navegadores como <a href="https://www.mozilla.org/es-ES/firefox/new/">Mozilla Firefox</a>, <a href="https://www.google.es/chrome/browser/desktop/">Google Chrome</a> y <a href="https://www.microsoft.com/es-es/windows/microsoft-edge/">Microsoft Edge</a> ya lo soportan.</p>
<p>En el lado del servidor varios servidores web también han incluido el soporte para HTTP/2, entre ellos <a href="https://nginx.org/">Nginx</a>, <a href="https://httpd.apache.org/">Apache HTTPD</a>, <a href="https://wildfly.org/">WildFly</a> y <a href="https://eclipse.org/jetty/">Jetty</a>. Tomcat añadirá el soporte en la versión 9 cuando se publique las especificación de Servlets 4.0 con el soporte de HTTP/2, este soporte necesitará de ALPN que se incluirá en la versión 9 del JDK con lo que en el momento de publicar este artículo todavía quedarán varios meses. Para usar HTTP/2 en Nginx, Apache HTTPD, WildFly y Jetty debemos hacer algunos cambios en sus configuraciones.</p>
<p>Para usar HTTP/2 los navegadores Mozilla Firefox, Google Chrome y Microsoft Edge han anunciado que se necesitará cifrado, por lo tanto deberemos añadir el <a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">soporte para TLS/SSL en el servidor</a> previamente.</p>
<div class="alert alert-warning pt-0 pb-0 tableofcontents"><h2>Contenido del artículo</h2><toc></toc></div>
<h3 id="configurar-http2-en-nginx">Configurar HTTP/2 en Nginx</h3>
<p>En Nginx es muy sencillo, deberemos modificar el archivo de configuración <em>default.conf</em> para que quede de forma similar a la siguiente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">server {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;   80;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;server_name  localhost;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;location / {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 301 https://$host$request_uri;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">server {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;listen 443 ssl http2 default_server;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ssl_certificate&nbsp;&nbsp;&nbsp;&nbsp;localhost.crt;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ssl_certificate_key localhost.key;&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;location / {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root   /usr/share/nginx/html;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index  index.html index.htm;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;# redirect server error pages to the static page /50x.html&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;#&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;error_page   500 502 503 504  /50x.html;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;location = /50x.html {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root   /usr/share/nginx/html;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>default.conf</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-nginx_hu9389785edf4602afc757d66aceb16de8_86825_2560x1440_fit_box_3.png" data-gallery="" title="HTTP/2 en Nginx"><img src="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-nginx_hu9389785edf4602afc757d66aceb16de8_86825_300x200_fit_box_3.png" width="244" height="200" alt="HTTP/2 en Nginx" title="HTTP/2 en Nginx"  class="lozad "></a></p>
</figure>
</div>
<h3 id="configurar-http2-en-apache-httpd">Configurar HTTP/2 en Apache HTTPD</h3>
<p>En Apache HTTPD deberemos instalar el <a href="https://www.archlinux.org/packages/extra/x86_64/nghttp2/">paquete nghttp2</a> de nuestra distribución. y usar el módulo <em>mod_http2.so</em> junto con <em>mod_ssl.so</em> para el cifrado.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">LoadModule http2_module modules/mod_http2.so&#10;</span></span><span class="line"><span class="cl">LoadModule ssl_module modules/mod_ssl.so&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Listen 443&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&lt;VirtualHost *:443&gt;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ServerName localhost&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;SSLEngine on&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;SSLCertificateFile localhost.crt&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;SSLCertificateKeyFile localhost.key&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;Protocols h2 http/1.1&#10;</span></span><span class="line"><span class="cl">&lt;/VirtualHost&gt;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>httpd-default.conf</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-httpd_huf92d904a434046ad27c310f0fe53e325_72029_2560x1440_fit_box_3.png" data-gallery="" title="HTTP/2 en Apache HTTPD"><img src="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-httpd_huf92d904a434046ad27c310f0fe53e325_72029_300x200_fit_box_3.png" width="248" height="200" alt="HTTP/2 en Apache HTTPD" title="HTTP/2 en Apache HTTPD"  class="lozad "></a></p>
</figure>
</div>
<h3 id="configurar-http2-en-wildfly">Configurar HTTP/2 en WildFly</h3>
<p>El WildFly deberemos descargar un archivo jar que ofrece el soporte para la negociación de protocolo,
<abbr title="Application-Layer Protocol Negotiation">ALPN</abbr>, según la versión del JDK que usemos de <a href="http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/">Maven Central</a>. Modificamos el archivo de configuración <em>bin/standalone.conf</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">if [ &#34;x$JAVA_OPTS&#34; = &#34;x&#34; ]; then&#10;</span></span><span class="line"><span class="cl">   JAVA_OPTS=&#34;-Xms64m -Xmx512m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true -Xbootclasspath/p:./alpn-boot-8.1.7.v20160121.jar&#34;&#10;</span></span><span class="line"><span class="cl">   JAVA_OPTS=&#34;$JAVA_OPTS -Djboss.modules.system.pkgs=$JBOSS_MODULES_SYSTEM_PKGS -Djava.awt.headless=true&#34;&#10;</span></span><span class="line"><span class="cl">else&#10;</span></span><span class="line"><span class="cl">   echo &#34;JAVA_OPTS already set in environment; overriding default settings with values: $JAVA_OPTS&#34;&#10;</span></span><span class="line"><span class="cl">fi</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>standalone.conf</span>
    </div>
</div>
<p>Y el archivo <em>standalone/configuration/standalone.xml</em> añadimos un nuevo listener para el subsistema de <a href="https://undertow.io/">undertow</a> con HTTP/2 habilitado y un Realm asociado para usar TLS/SSL.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-XML" data-lang="XML"><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">&#34;urn:jboss:domain:undertow:3.0&#34;</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;buffer-cache</span> <span class="na">name=</span><span class="s">&#34;default&#34;</span><span class="nt">/&gt;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">&#34;default-server&#34;</span><span class="nt">&gt;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;http-listener</span> <span class="na">name=</span><span class="s">&#34;default&#34;</span> <span class="na">socket-binding=</span><span class="s">&#34;http&#34;</span> <span class="na">redirect-socket=</span><span class="s">&#34;https&#34;</span><span class="nt">/&gt;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;https-listener</span> <span class="na">name=</span><span class="s">&#34;default-https&#34;</span> <span class="na">socket-binding=</span><span class="s">&#34;https&#34;</span> <span class="na">security-realm=</span><span class="s">&#34;ApplicationRealm&#34;</span> <span class="na">enable-http2=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>standalone.xml</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-wildfly_hu22f901619a918dd5dbb507157638c0f8_171255_2560x1440_fit_box_3.png" data-gallery="" title="HTTP/2 en WildFly"><img src="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-wildfly_hu22f901619a918dd5dbb507157638c0f8_171255_300x200_fit_box_3.png" width="189" height="200" alt="HTTP/2 en WildFly" title="HTTP/2 en WildFly"  class="lozad "></a></p>
</figure>
</div>
<h3 id="configurar-http2-en-jetty">Configurar HTTP/2 en Jetty</h3>
<p>Dependiendo de la versión de Java, usaremos el módulo alpn adecuado, en el momento de escribir este artículo con la versión 1.8.0_74 del <a href="https://openjdk.java.net/">OpenJDK</a>, <em>modules/alpn-impl/alpn-1.8.0_74.mod</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[name]&#10;</span></span><span class="line"><span class="cl">protonego-boot&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">[files]&#10;</span></span><span class="line"><span class="cl">http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/8.1.7.v20160121/alpn-boot-8.1.7.v20160121.jar|lib/alpn/alpn-boot-8.1.7.v20160121.jar&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">[exec]&#10;</span></span><span class="line"><span class="cl">-Xbootclasspath/p:lib/alpn/alpn-boot-8.1.7.v20160121.jar</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>alpn-1.8.0_74.mod</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ java -jar start.jar --add-to-startd<span class="o">=</span>https,http2&#10;</span></span><span class="line"><span class="cl">$ java -jar start.jar&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>jetty.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-jetty_hucb49276491e26346854b521f5ae95467_83310_2560x1440_fit_box_3.png" data-gallery="" title="HTTP/2 en Jetty"><img src="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/images/http2-jetty_hucb49276491e26346854b521f5ae95467_83310_300x200_fit_box_3.png" width="300" height="200" alt="HTTP/2 en Jetty" title="HTTP/2 en Jetty"  class="lozad "></a></p>
</figure>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.nginx.com/blog/nginx-1-9-5/">NGINX Open Source 1.9.5 Released with HTTP/2 Support</a></li>
<li><a href="http://www.eclipse.org/jetty/documentation/current/alpn-chapter.html">Jetty ALPN</a></li>
<li><a href="http://central.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/8.1.7.v20160121/">Maven ALPN</a></li>
<li><a href="http://undertow.io/blog/2015/03/26/HTTP2-In-Wildfly.html">Using HTTP2 With Wildfly 9.0.0.Beta1</a></li>
<li><a href="https://docs.jboss.org/author/display/WFLY10/Security&#43;Realms">WildFly Security Realms</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2016/02/introduccion-al-protocolo-http-2/</id>
        <title>Introducción al protocolo HTTP/2</title>
        <updated>2016-02-26T21:10:00+01:00</updated>
        <published>2016-02-20T20:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/02/introduccion-al-protocolo-http-2/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>La tecnología avanza inexorablemente respondiendo a nuevas necesidades o mejor a las existentes. El protocolo HTTP se ha mantenido sin grandes cambios durante más de 15 años, sin embargo, para reducir las latencias en la carga de las páginas y ser más eficiente se ha desarrollado una nueva especificación que ya promete reducir estos problemas. HTTP/2 no es compatible hacia atrás pero se puede usar junto con HTTP 1.1 y los dispositivos que usen aprovecharse de sus ventajas. Los navegadores más populares ya lo han implementado y los servidores web o de aplicaciones ya ofrecen soporte para ser usado.</strong></p>]]>
        <![CDATA[<p>La velocidad de carga de una web en el navegador es importante, tanto que añadir unos pocos cientos de milisegundos en un sitio de comercio electrónico afecta en un porcentaje significativo el abandono, la conversión y en definitiva las compras que se realizan. Un tiempo de más de 100ms ya es percibido por los usuarios. Por este motivo además Google lo tiene en cuenta a la hora del posicionamiento en su buscador, con lo que mejorar y tener un tiempo de carga bajo de las páginas producirá más compras y más visitas por tráfico orgánico que se traducirá también en más compras.</p>
<p>Desde hace quince años el protocolo usado para la transferencia desde el servidor al navegador del HTML, CSS, JavaScript, imágenes y demás recursos de la página ha sido el <a href="https://es.wikipedia.org/wiki/Hypertext_Transfer_Protocol">protocolo de transferencia de hypertexto</a> o HTTP. Con el cada vez mayor ancho de banda que ofrece mayores velocidades de transferencia de los dispositivos conectados a internet el tiempo de carga de una página ha dejado de estar tan limitado por la velocidad de transferencia a ser la latencia una parte importante del tiempo. Con el objetivo de disminuir la latencia y el tiempo de carga de las páginas se publicó primero el protocolo <a href="https://es.wikipedia.org/wiki/SPDY">SPDY</a> y posteriormente basado en él HTTP/2 en mayo de 2015 con varias mejoras.</p>
<p>HTTP/2 no mofidifica la semántica de protocolo HTTP con lo que los conceptos de métodos HTTP, códigos de estado, URIs y cabeceras siguen siendo los mismos. Algunas de las mejoras que ofrece son:</p>
<ul>
<li>Multiplexación y concurrencia: solo es necesaria una conexión <abbr title="Transmission Control Protocol">TCP</abbr> para enviar todos los recursos de la página, además la transmisión de varios recursos es posible que sea simultánea sin necesidad de que termine una para iniciar otra lo que evita el problema <em>head-of-line blocking</em> de HTTP 1.1 que era ordenado y bloqueante.</li>
<li>Descarga de dependencias: el cliente puede priorizar los recursos.</li>
<li>Compresión de cabeceras: para reducir la sobrecarga de las cabeceras en cada petición se consigue de dos formas, usando un algoritmo de compresión y evitando enviarlas según los valores anteriores transmitidos.</li>
<li>Envío desde el servidor: el servidor proactivamente puede enviar recursos al cliente para que sean cacheados.</li>
</ul>
<p>Una diferencia que lo hace incompatible hacia atrás es que es binario pero se puede usar junto con la versión anterior y cuando se establezca la conexión negociando el protocolo elegir el mejor según las características de ambas partes, los protocolos binarios son más eficientes de procesar, más compactos e igual de importante menos propensos a errores comparados los los basados en texto.</p>
<p>Establecer una conexión TCP requiere 3 paquetes entre el cliente y servidor reduciendo el número de ellas la latencia baja. Si la distancia entre el cliente y el servidor es lejana simplemente por cuestiones físicas de la velocidad a la que viaja la luz o los impulsos eléctricos, la latencia entre ellos estando situados en las antípodas es de unos 300-400ms (por paquete). Simplemente con la multiplexación y la concurrencia se reduce considerablemente esta sobrecarga en la transmisión al evitar tener que establecer varias conexiones. Además, tiene otras mejoras para los desarrolladores y hace innecesarias algunas de las optimizaciones que se realizaban con HTTP 1.1, como:</p>
<ul>
<li>Ya no es necesario concatenar ficheros eliminado el problema <em>head-of-line blocking</em> y pudiendo transmitir varios ficheros simultáneamente.</li>
<li>Ya no es necesario incluir el contenido de estilos, imágenes y JavaScript junto con el HTML para evitar conexiones TCP adicionales, igual que en la concatenación de ficheros.</li>
<li>Ya no es necesario usar múltiples dominios para paralelizar la descarga.</li>
</ul>
<p>Algunas prácticas de optimización siguen siendo utilizables:</p>
<ul>
<li>Reducir consultas <abbr title="Domain Name System">DNS</abbr> por la latencia de envío de paquetes.</li>
<li>Seguir usando redes de descarga de contenido o <abbr title="Content Delivery Network">CDN</abbr>, cuanto más cercano esté el servidor del cliente menor será la latencia impuesta por las leyes físicas.</li>
<li>Seguir usando la caché del cliente evitando retransmitir el recurso.</li>
<li>Minimizar el contenido de los recursos, menor será las cantidad de datos a transmitir y procesar.</li>
<li>Eliminar redirecciones innecesarias.</li>
</ul>
<p>Aunque para usar HTTP/2 no es necesario usar cifrado <abbr title="Transport Layer Security ">TLS</abbr> los navegadores <a href="https://www.mozilla.org/es-ES/firefox/new/">Firefox</a>, <a href="https://www.microsoft.com/es-es/windows/microsoft-edge/">Microsoft Edge</a> y <a href="https://www.google.es/chrome/browser/desktop/">Google Chrome</a> han anunciado que en sus implementaciones solo lo soportarán si se usa con cifrado TLS.</p>
<p>En un capítulo del libro  <a href="http://chimera.labs.oreilly.com/books/1230000000545/ch12.html">High Performance Browser Networking</a>, en <a href="https://bagder.gitbooks.io/http2-explained/content/es/index.html">HTTP/2 explicado</a> y en la sección de referencia del final del artículo se detallan más los conceptos del protocolo HTTP/2.</p>
<p>En definitiva el protocolo HTTP/2 supone una mejora de rendimiento para los clientes y optimización de recursos tanto para los clientes como para los servidores. Ya está implementado por los navegadores más populares y añadiendo el soporte en lado del servidor los clientes compatibles se beneficiarán de él.</p>
<p>En el siguiente artículo comentaré cómo poner esto en práctica y <a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/">configurar HTTP/2 con el servidor web Nginx, Apache HTTPD y el servidor de aplicaciones Java WildFly o Jetty</a>.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://en.wikipedia.org/wiki/HTTP/2">HTTP/2</a></li>
<li><a href="https://es.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a></li>
<li><a href="https://http2.github.io/faq/">HTTP/2 FAQ</a></li>
<li><a href="http://chimera.labs.oreilly.com/books/1230000000545/ch12.html">High Performance Browser Networking - HTTP/2</a></li>
<li><a href="https://bagder.gitbooks.io/http2-explained/content/es/index.html">Libro HTTP/2 explicado</a></li>
<li><a href="https://blog.cloudflare.com/introducing-http2/">Introducing HTTP/2</a></li>
<li><a href="https://www.cloudflare.com/http2/">CloudFlare HTTP/2</a></li>
<li><a href="https://blog.cloudflare.com/http-2-for-web-developers/">HTTP/2 For Web Developers</a></li>
<li><a href="https://blog.cloudflare.com/tools-for-debugging-testing-and-using-http-2/">Tools for debugging, testing and using HTTP/2</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/12/como-buscar-los-enlaces-rotos-de-un-sitio-web/</id>
        <title>Cómo buscar los enlaces rotos de un sitio web</title>
        <updated>2015-12-18T18:00:00+01:00</updated>
        <published>2015-12-18T18:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/12/como-buscar-los-enlaces-rotos-de-un-sitio-web/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Ya tengamos un sitio web, una bitácora, o una aplicación web es recomendable comprobar cada cierto tiempo los enlaces rotos. Las páginas pueden desaparecer o cambiar de dirección y esto provocará páginas no encontradas en los enlaces que las referenciasen. Usando herramientas que automaticen la tarea podemos encontrar enlaces rotos de forma efectiva y rápida.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p><img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/html.svg" width="200" height="200" alt="HTML" title="HTML"  class=""></p>
</div>
<p>La web se basa en un conjunto de páginas donde unas hacen referencia a otras a través de enlaces. Unido a que las páginas que están bajo el control de los sitios referenciados pudiendo desaparecer o cambiar de dirección hace que las referencias puedan dejar de funcionar o necesitar una redirección, el mensaje que nos indicará el navegador es el conocido <em>Página no encontrada</em> o <a href="https://es.wikipedia.org/wiki/Error_404">error 404</a> para indicar lo mismo. Que un sitio web contenga referencias a páginas ya no existentes hace que el usuario no encuentre lo que busque empeorando su experiencia de usuario y que los buscadores tienen en cuenta en el posicionamiento de los resultados de búsqueda. Por estos motivos es recomendable de vez en cuando rastrear los enlaces de un sitio web para buscar <a href="https://en.wikipedia.org/wiki/Link_rot">enlaces rotos</a> cambiándolos por otros nuevos o eliminarlos, ya sean enlaces internos (hacia nuestro propio sitio) o enlaces externos (a otros sitios).</p>
<p>Otras tareas útiles para mejorar un sitio web es utilizar <a href="https://picodotdev.github.io/blog-bitix/2021/05/herramientas-para-mejorar-una-pagina-web-en-seo-conformidad-estandares-y-rendimiento/">herramientas para mejorar una página web en SEO, conformidad estándares y rendimiento</a> y hacer las modificaciones detectadas.</p>
<h3 id="comprobar-enlaces-rotos-con-herramientas-web">Comprobar enlaces rotos con herramientas web</h3>
<p>Por enlaces o referencias consideramos tanto a páginas como a recursos de imágenes, estilos CSS, JavaScript u otros. Con que un sitio web contenga unas pocas decenas de páginas comprobar manualmente los enlaces se hace una tarea tediosa, que necesita mucho tiempo además de posiblemente no conseguir descubrir todos los enlaces rotos. Hay herramientas disponibles para comprobar los enlaces de forma automatizada. Algunas de estas que he usado recientemente en esta bitácora y con las que he encontrado numerosos enlaces han sido:</p>
<ul>
<li><a href="https://validator.w3.org/checklink">W3 Check Link</a></li>
<li><a href="http://www.drlinkcheck.com">Dr. Link Check</a></li>
<li><a href="http://www.deadlinkchecker.com/website-dead-link-checker.asp">Deadlink Checker</a></li>
</ul>
<p>Después de introducir la dirección del sitio web, que con estas herramientas ha de estar accesible en internet, cada una de ellas nos informará de los enlaces rotos que encuentre indicándonos el enlace roto, el texto del enlace y en qué página está. Con esta información podemos corregir esos enlaces del sitio web, bitácora o aplicación. Después de usarlas hubiera dicho que no tenía tantos en está bitácora, me sirvieron para corregirlos.</p>
<p>Las ventajas de estas herramientas web sobre las siguientes con wget y LinkChecker es que no requieren instalar ningún software, las desventajas son que suelen tener una limitación en el número de páginas máximo que rastrean y número errores de los que informan, sin embargo, no son excluyentes y utilizando varias da oportunidad de descubrir más enlaces rotos y errores.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2015/12/como-buscar-los-enlaces-rotos-de-un-sitio-web/images/w3c-linkchecker_hu291b0b61a136c1cb5589c25a3cbbb5b5_37370_2560x1440_fit_box_3.png" data-gallery="" title="W3C Link Checker"><img src="https://picodotdev.github.io/blog-bitix/2015/12/como-buscar-los-enlaces-rotos-de-un-sitio-web/images/w3c-linkchecker_hu291b0b61a136c1cb5589c25a3cbbb5b5_37370_300x200_fit_box_3.png" width="259" height="200" alt="W3C Link Checker" title="W3C Link Checker"  class="lozad "></a></p>
<figcaption>W3C Link Checker</figcaption>
</figure>
</div>
<h3 id="comprobar-enlaces-rotos-con-wget">Comprobar enlaces rotos con wget</h3>
<p>Si el sitio web no está accesible en internet o queremos encontrar enlaces rotos en el momento de desarrollo podemos usar el comando <code>wget</code> para que nos rastree los enlaces, cada petición que devuelva un código 404 será un enlace roto. En el archivo <em>wget.log</em> tendremos los resultados del rastreo.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ wget –spider -o wget.log -e <span class="nv">robots</span><span class="o">=</span>off -r -p https://picodotdev.github.io/blog-bitix/&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>wget.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">--2020-01-15 21:00:06--  http://xn--spider-vg0c/&#10;</span></span><span class="line"><span class="cl">Resolviendo xn--spider-vg0c (xn--spider-vg0c)... falló: Nombre o servicio desconocido.&#10;</span></span><span class="line"><span class="cl">wget: no se pudo resolver la dirección del equipo “xn--spider-vg0c”&#10;</span></span><span class="line"><span class="cl">--2020-01-15 21:00:06--  https://picodotdev.github.io/blog-bitix/&#10;</span></span><span class="line"><span class="cl">Cargado certificado CA &#39;/etc/ssl/certs/ca-certificates.crt&#39;&#10;</span></span><span class="line"><span class="cl">Resolviendo picodotdev.github.io (picodotdev.github.io)... 185.199.108.153, 185.199.109.153, 185.199.111.153, ...&#10;</span></span><span class="line"><span class="cl">Conectando con picodotdev.github.io (picodotdev.github.io)[185.199.108.153]:443... conectado.&#10;</span></span><span class="line"><span class="cl">Petición HTTP enviada, esperando respuesta... 200 OK&#10;</span></span><span class="line"><span class="cl">Longitud: 31602 (31K) [text/html]&#10;</span></span><span class="line"><span class="cl">Grabando a: “picodotdev.github.io/blog-bitix/index.html”&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; 0K .......... .......... ..........&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  100% 37,1M=0,001s&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">2020-01-15 21:00:07 (37,1 MB/s) - “picodotdev.github.io/blog-bitix/index.html” guardado [31602/31602]&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">--2020-01-15 21:00:07--  https://picodotdev.github.io/blog-bitix/assets/favicon.ico&#10;</span></span><span class="line"><span class="cl">Reutilizando la conexión con picodotdev.github.io:443.&#10;</span></span><span class="line"><span class="cl">Petición HTTP enviada, esperando respuesta... 200 OK&#10;</span></span><span class="line"><span class="cl">Longitud: 9662 (9,4K) [image/vnd.microsoft.icon]&#10;</span></span><span class="line"><span class="cl">Grabando a: “picodotdev.github.io/blog-bitix/assets/favicon.ico”&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; 0K .........&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 100% 80,6M=0s&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">2020-01-15 21:00:07 (80,6 MB/s) - “picodotdev.github.io/blog-bitix/assets/favicon.ico” guardado [9662/9662]&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">--2020-01-15 21:00:07--  https://picodotdev.github.io/blog-bitix/assets/apple-touch-icon-144-precomposed.png&#10;</span></span><span class="line"><span class="cl">Reutilizando la conexión con picodotdev.github.io:443.&#10;</span></span><span class="line"><span class="cl">Petición HTTP enviada, esperando respuesta... 200 OK&#10;</span></span><span class="line"><span class="cl">Longitud: 4443 (4,3K) [image/png]&#10;</span></span><span class="line"><span class="cl">Grabando a: “picodotdev.github.io/blog-bitix/assets/apple-touch-icon-144-precomposed.png”&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp; 0K ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  100% 40,1M=0s&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">2020-01-15 21:00:07 (40,1 MB/s) - “picodotdev.github.io/blog-bitix/assets/apple-touch-icon-144-precomposed.png” guardado [4443/4443]&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>wget.log</span>
    </div>
</div>
<p><code>wget</code> es una herramienta con múltiples usos, otro uso que tiene es la de [descargar el contenido de un sitio web completo]</p>
<h3 id="comprobar-enlaces-rotos-con-linkchecker">Comprobar enlaces rotos con LinkChecker</h3>
<p>Otra opción es <a href="https://github.com/linkchecker/linkchecker">LinkChecker</a> que además de comprobar los enlaces internos de un sitio web también tiene la opción de comprobar los enlaces del sitio web hacia a los externos. Un modo de ejecución es utilizando <a href="https://www.docker.com/">Docker</a> con lo que no hace falta instalar nada localmente salvo Docker.</p>
<p>El siguiente comando comprueba los enlaces internos de un sitio web y los externos que contenga generando un archivo de trazas, <em>linkchecker.log</em>, con las comprobaciones de resultado correcto y erróneas. Con el registro de las erróneas es fácil corregirlas.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -it linkchecker/linkchecker --verbose --check-extern https://picodotdev.github.io/blog-bitix/ &gt; linkchecker.log&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>linkchecker.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">LinkChecker 9.4.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Copyright (C) 2000-2014 Bastian Kleineidam&#10;</span></span><span class="line"><span class="cl">LinkChecker comes with ABSOLUTELY NO WARRANTY!&#10;</span></span><span class="line"><span class="cl">This is free software, and you are welcome to redistribute it&#10;</span></span><span class="line"><span class="cl">under certain conditions. Look at the file `LICENSE&#39; within this&#10;</span></span><span class="line"><span class="cl">distribution.&#10;</span></span><span class="line"><span class="cl">Get the newest version at https://linkchecker.github.io/linkchecker/&#10;</span></span><span class="line"><span class="cl">Write comments and bugs to https://github.com/linkchecker/linkchecker/issues&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Start checking at 2020-01-15 20:06:36+000&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">URL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`https://picodotdev.github.io/blog-bitix/&#39;&#10;</span></span><span class="line"><span class="cl">Real URL   https://picodotdev.github.io/blog-bitix/&#10;</span></span><span class="line"><span class="cl">Check time 0.586 seconds&#10;</span></span><span class="line"><span class="cl">D/L time   0.002 seconds&#10;</span></span><span class="line"><span class="cl">Size&nbsp;&nbsp;&nbsp;&nbsp;   30.86KB&#10;</span></span><span class="line"><span class="cl">Result&nbsp;&nbsp;&nbsp;&nbsp; Valid: 200 OK&#10;</span></span><span class="line"><span class="cl">10 threads active,&nbsp;&nbsp;&nbsp;&nbsp;54 links queued,&nbsp;&nbsp;&nbsp;&nbsp;1 link in  65 URLs checked, runtime 1 seconds&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">URL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`/blog-bitix/assets/favicon.ico&#39;&#10;</span></span><span class="line"><span class="cl">Parent URL https://picodotdev.github.io/blog-bitix/, line 19, col 3&#10;</span></span><span class="line"><span class="cl">Real URL   https://picodotdev.github.io/blog-bitix/assets/favicon.ico&#10;</span></span><span class="line"><span class="cl">Check time 0.632 seconds&#10;</span></span><span class="line"><span class="cl">Size&nbsp;&nbsp;&nbsp;&nbsp;   9KB&#10;</span></span><span class="line"><span class="cl">Result&nbsp;&nbsp;&nbsp;&nbsp; Valid: 200 OK&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">URL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`https://picodotdev.github.io/blog-bitix/sitemap.xml&#39;&#10;</span></span><span class="line"><span class="cl">Parent URL https://picodotdev.github.io/blog-bitix/, line 16&#10;</span></span><span class="line"><span class="cl">Real URL   https://picodotdev.github.io/blog-bitix/sitemap.xml&#10;</span></span><span class="line"><span class="cl">Check time 0.912 seconds&#10;</span></span><span class="line"><span class="cl">D/L time   0.051 seconds&#10;</span></span><span class="line"><span class="cl">Size&nbsp;&nbsp;&nbsp;&nbsp;   90.27KB&#10;</span></span><span class="line"><span class="cl">Result&nbsp;&nbsp;&nbsp;&nbsp; Valid: 200 OK&#10;</span></span><span class="line"><span class="cl">...&#10;</span></span><span class="line"><span class="cl">URL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`http://barrapunto.com/&#39;&#10;</span></span><span class="line"><span class="cl">Name&nbsp;&nbsp;&nbsp;&nbsp;   `Barrapunto&#39;&#10;</span></span><span class="line"><span class="cl">Parent URL https://picodotdev.github.io/blog-bitix/pages/links/, line 262, col 5&#10;</span></span><span class="line"><span class="cl">Real URL   http://barrapunto.com/&#10;</span></span><span class="line"><span class="cl">Check time 0.260 seconds&#10;</span></span><span class="line"><span class="cl">Result&nbsp;&nbsp;&nbsp;&nbsp; Error: ConnectionError: HTTPConnectionPool(host=&#39;barrapunto.com&#39;, port=80): Max retries exceeded with url: / (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f45343fac10&gt;: Failed to establish a new connection: [Errno ...&#10;</span></span><span class="line"><span class="cl">...</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>linkchecker.log</span>
    </div>
</div>
<h3 id="comprobar-enlaces-rotos-de-otros-sitios-web-hacia-el-nuestro">Comprobar enlaces rotos de otros sitios web hacia el nuestro</h3>
<p>Lo anterior nos sirve para detectar los enlaces rotos que tenemos en nuestro sitio hacia otros, seguramente también nos interesará conocer los enlaces rotos que tienen otros sitios hacia el nuestro. Podemos saber a que páginas no encontradas están accediendo los usuarios de nuestro sitio web lanzando un evento personalizado de <a href="https://www.google.es/intl/es/analytics/">Google Analytics</a> en la página para el error 404 que mostremos. Dado que los enlaces hacia nuestro sitio incluidos en otros no podemos modificarlos si se tratase de alguno especialmente importante al menos podremos hacer una redirección para que los usuarios lleguen al contenido más apropiado en vez de a una página no encontrada:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;404&#39;</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>analytics.js</span>
    </div>
</div>
<p>Al mismo tiempo <a href="https://validator.w3.org/">validar el HTML</a> y <a href="http://jigsaw.w3.org/css-validator/">validar los estilos CSS</a> respecto a su especificación también mejorarán el código del sitio web.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://stackoverflow.com/questions/65515/how-to-find-broken-links-on-a-website">How to find broken links on a website</a></li>
<li><a href="http://www.commandlinefu.com/commands/view/8234/check-broken-links-using-wget-as-a-spider">Check broken links using wget as a spider</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="planeta-codigo"/>
            
                <category term="web"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/</id>
        <title>Certificado SSL, de empresa, «wildcard» y de validación extendida</title>
        <updated>2015-04-25T12:00:00+02:00</updated>
        <published>2015-04-25T10:07:04+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        
        <![CDATA[<p>Usar un protocolo seguro garantiza de que los datos intercambiados entre el cliente y el servidor no son leídos ni modificados por una tercera parte además de verificar que la comunicación se está realizando entre las partes que dicen ser. Para usar un <a href="https://es.wikipedia.org/wiki/Transport_Layer_Security">protocolo seguro como SSL/TLS</a> debemos disponer de con certificado, <a href="https://picodotdev.github.io/blog-bitix/2014/02/generar-y-convertir-claves-y-certificados-con-openssl/">con OpenSSL podemos generar y convertirlo al formato que deseemos</a>, sin embargo, para que el usuario tenga garantía de que el certificado es válido este se debe estar firmado por una <a href="https://es.wikipedia.org/wiki/Autoridad_de_certificaci%C3%B3n">autoridad de certificación</a> (CA) en la que confíe, generalmente con una de las autoridades de certificación cuyos certificados están preinstalados en el navegador web (en Firefox podemos verlos en <em>Preferencias&gt; Avanzado&gt; Certificados&gt; Ver certificados</em>), los certificados autofirmados son útiles para hacer pruebas pero no son válidos para los usuarios. En este artículo comentaré que tipos de certificados hay y donde podemos obtener o comprar un certificado digital firmado por una CA que sea de confianza para el usuario.</p>
<p>Los navegadores suelen indicar que se está usando una comunicación segura cuando en la barra de direcciones se muestra un candado y se está usando el protocolo https. Además, haciendo clic en el candado se pueden ver los detalles del certificado usado por el servidor para la comunicación cifrada.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado-validacion-dominio_hu3ead136fee4806f49d1d45776bc8ef97_25875_2560x1440_fit_box_3.png" data-gallery="" title="Certificado SSL con validación de dominio"><img src="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado-validacion-dominio_hu3ead136fee4806f49d1d45776bc8ef97_25875_300x200_fit_box_3.png" width="300" height="178" alt="Certificado SSL con validación de dominio" title="Certificado SSL con validación de dominio"  class="lozad "></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado_hu1fc8da173a78ce962f9a0b69e89ae629_72928_2560x1440_fit_box_3.png" data-gallery="" title="Datos de certificado de GitHub"><img src="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado_hu1fc8da173a78ce962f9a0b69e89ae629_72928_300x200_fit_box_3.png" width="194" height="200" alt="Datos de certificado de GitHub" title="Datos de certificado de GitHub"  class="lozad "></a></p>
</figure>
</div>
<p>Sin embargo, para proporcionar más seguridad y garantía de que como usuarios nos estamos comunicando con el servidor que creemos sin examinar el certificado algunos certificados permiten mostrar también en la barra de direcciones un recuadro verde con el nombre de la entidad, el recuadro verde que solemos ver también en la barra de direcciones al acceder a algunos dominios y que es proporcionado por certificados de validación extendida.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado-validacion-extendida_hu47082fe35f414a709473879b0c3e3482_31382_2560x1440_fit_box_3.png" data-gallery="" title="Certificado SSL con validación extendida"><img src="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificado-validacion-extendida_hu47082fe35f414a709473879b0c3e3482_31382_300x200_fit_box_3.png" width="253" height="200" alt="Certificado SSL con validación extendida" title="Certificado SSL con validación extendida"  class="lozad "></a></p>
</figure>
</div>
<p>Por otra parte los certificados SSL se generan para un dominio en concreto con lo que en principio se debería comprar un certificado por cada dominio en el que deseemos usar una comunicación segura. Sin embargo, para evitar comprar múltiples certificados para los diferentes dominios o subdominios podemos comprar un certificado <em>wildcard</em> que nos servirá para los subdominios (*.ejemplo.com) o un certificado multidominio (ejemplo.com, ejemplo.net, &hellip;) para como su nombre indica varios dominios. En los certificados de empresa se solicitan datos datos adicionales al adquirirlo y en los detalles del certificado aparece el nombre de la empresa (campo Organización (O) como en el caso de GitHub).</p>
<p>Los certificados <em>wildcard</em> y que muestran el recuadro verde son más caros pero pueden ser útiles sobre todo para una página de comercio electrónico, el recuadro verde añade más seguridad, seguramente mejore los ratios de conversión y evite <a href="https://es.wikipedia.org/wiki/Phishing">suplantaciones de identidad o <em>phishing</em></a>. Además, utilizar un protocolo seguro es un nuevo criterio que utiliza el buscador Google en su algoritmo para establecer el posicionamiento en la página de resultados. Con las instrucciones que incorporan los procesadores modernos el cifrado y descifrado de los datos no tiene por que significar un aumento de carga considerable para el servidor ni el cliente ni en dispositivos móviles.</p>
<p>¿Cómo obtener un certificado SSL firmado por una entidad raíz de certificación? Las entidades de registro de dominios aparte de dominios, <em>hosting</em> virtual o privado algunos permiten comprar certificados SSL. Uno de los que conozco que permite comprar certificados SSL, de empresa, con recuadro verde o <em>wildcard</em> es <a href="http://www.dondominio.com/products/ssl/">DonDominio</a>, otro es <a href="http://www.arsys.es/certificados-seguridad-ssl">Arsys</a>.</p>
<div class="media">
<figure>
<p><a href="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificados-dondominio_hu359d5d89a42606ae5b6d3ad51c6a3fa0_216371_2560x1440_fit_box_3.png" data-gallery="" title="Certificados DonDominio"><img src="https://picodotdev.github.io/blog-bitix/2015/04/certificado-ssl-de-empresa-wildcard-y-de-validacion-extendida/images/certificados-dondominio_hu359d5d89a42606ae5b6d3ad51c6a3fa0_216371_300x200_fit_box_3.png" width="149" height="200" alt="Certificados DonDominio" title="Certificados DonDominio"  class="lozad "></a></p>
</figure>
</div>
<p>En el caso de DonDominio dependiendo de la entidad emisora del certificado que deseemos variará el precio, también si queremos que tenga validación extendida o sea <em>wildcard</em>. En el caso de un certificado SSL simple que valide solo el dominio es de unos 5 €, de validación de empresa unos 28 €, un certificado de validación extendida con recuadro verde desde unos 126 € y un <em>certificado wildcard</em> de desde unos 75 €. Estos son precios desde, diferentes opciones pueden salir bastante más caras y hay que tener en cuenta que son para una validez de una año, al igual que los dominios hay que renovar su uso.</p>
<p>Si no necesitamos el recuadro verde ni un certificado <em>wildcard</em> una opción interesante es obtener uno gratis a través de <a href="https://letsencrypt.org/">Lets Encrypt</a>. Esta nueva entidad de certificación nos permitirá obtener uno sin coste, de forma sencilla y automatizada, detrás de esta entidad están organizaciones como <a href="https://www.linuxfoundation.org/">Linux Foundation</a>, <a href="https://www.mozilla.org/">Mozilla</a> o <a href="https://www.cisco.com/">CISCO</a>.</p>
<p>Una vez obtenido el certificado debemos instalarlo en el servidor, en el artículo <a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">Configurar SSL en un servidor Tomcat JBoss, Wildfly, Lighttpd, Nginx o Apache</a> comento como usar un certificado en los principales servidores web y de aplicaciones. Si necesitamos un formato concreto podemos <a href="https://picodotdev.github.io/blog-bitix/2014/02/generar-y-convertir-claves-y-certificados-con-openssl/">convertir el certificado con OpenSSL</a>.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.genbeta.com/seguridad/que-es-un-certificado-ssl-y-por-que-deberia-importarte">Qué es un certificado SSL y por qué debería importarte</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="programacion"/>
            
                <category term="seguridad"/>
            
                <category term="planeta-codigo"/>
            
                <category term="web"/>
            
        
    </entry>
    
</feed>