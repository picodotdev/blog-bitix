





<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="base" href="/blog-bitix/">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="picodotdev">
  <meta name="keywords" content="java, programacion, software, hardware, tapestry, software libre, gnu, linux, gnu/linux, unix, arch, arch linux, web, html, css, javascript, tutorial, guía, básico, avanzado, análisis, tecnología, juegos, productos">
  <meta name="description" content="Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker. &hellip;">
  <meta name="theme-color" content="#FFFFFF"/>

  <title>Configurar Nginx como balanceador de carga</title>

  <link rel="shortcut icon" href="/blog-bitix/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog-bitix/assets/apple-touch-icon-144-precomposed.png">
  <link rel="canonical" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/" hreflang="es">
  <link rel="alternate" type="application/rss&#43;xml" href="https://picodotdev.github.io/blog-bitix/index.xml" hreflang="es" title="Blog Bitix">
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/" hreflang="es" title="Configurar Nginx como balanceador de carga">
  
  <link rel="amphtml" type="text/html" href="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/index-amp.html" hreflang="es" title="Configurar Nginx como balanceador de carga">
  
  <link rel="humans" type="text/plain" href="/blog-bitix/humans.txt">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel="stylesheet">

  

  <!-- Social -->
<meta property="og:title" content="Configurar Nginx como balanceador de carga">
<meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/">
<meta property="og:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/nginx-750.png">

<meta property="og:site_name" content="Blog Bitix">
<meta property="og:description" content="Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker. &hellip;">
<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/nginx-750.png">

<meta name="twitter:site" content="@picodotdev">
<meta name="twitter:title" content="Configurar Nginx como balanceador de carga">
<meta name="twitter:description" content="Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker. &hellip;">
<meta name="twitter:creator" content="@picodotdev">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://picodotdev.github.io/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/"
    },
    "headline": "Configurar Nginx como balanceador de carga",
    "image": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/structured-data/nginx-750.png"
        
      },
    "datePublished": "2016-07-08T17:00:00+02:00",
    "dateModified": "2016-07-09T11:00:00+02:00",
    "inLanguage": "es",
    
    "wordCount": "849",
    "license": "https://creativecommons.org/licenses/by-sa/4.0/",
    "author": {
        "@type": "Person",
        "name": "picodotdev",
        "description": "Ingeniero de software. I ♥ Java, GNU/Linux and libre software.",
        "url": "https://twitter.com/picodotdev/"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog Bitix",
        "logo": {
            "@type": "ImageObject",
            "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
        }
    },
    "description": "Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker."
}
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Blog Bitix",
    "description": "Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.",
    "url": "https://picodotdev.github.io/blog-bitix/",
    "logo": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
    }
}
  </script>

  <!-- css -->
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-icons-1.6.1/font/bootstrap-icons.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" media="all">
  <!-- theme -->
  <link rel="preload" href="/blog-bitix/assets/css/syntax.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/main.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/cookieconsent.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/syntax.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/main.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/cookieconsent.min.css" media="all">

  <!-- javascript -->
  <link rel="preload" href="/blog-bitix/assets/js/require-config.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/libs/require.js" as="script">
  <link rel="preload" href="/blog-bitix/assets/js/main.js" as="script">
  <script type="text/javascript" src="/blog-bitix/assets/js/require-config.js" defer></script>
  <script type="text/javascript" src="/blog-bitix/assets/libs/require.js" data-main="/blog-bitix/assets/js/main" defer></script>

  <script type="text/javascript">
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-12874075-4', 'picodotdev.github.io');
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  <script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" defer></script>
<script type="text/javascript" defer>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: 'ca-pub-3533636310991304',
    enable_page_level_ads: true
  });
</script>

  
  <script type="text/javascript" src="/blog-bitix/assets/js/app.js" defer></script>
</head>
<body>  
  <div class="container">
    <div class="row">
      <div class="col-12">
        





<header>
  <div class="row">
    <div class="col-12 col-lg-4"></div>
    <div class="col-12 col-lg-4">
      <span class="title"><a href="https://picodotdev.github.io/blog-bitix/">Blog Bitix</a></span>
      <div class="links">
        
          <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
        
        
          <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
        
        
          <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
        
        
        
      </div>
    </div>
    <div class="col-12 col-lg-4 text-center">
      <form name="query" class="form-inline search" onsubmit="return false;">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Buscar en Blog Bitix" aria-label="Buscar en Blog Bitix">
        </div>
      </form>
      <form name="search" action="https://duckduckgo.com/" method="get" class="hidden" data-site="https://picodotdev.github.io/blog-bitix/">
        <input type="hidden" name="q" value="">
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      
<nav class="nav nav-pills nav-fill">
  <a href="/blog-bitix/tags/java/" class="nav-item nav-link">Java</a>
  <a href="/blog-bitix/tags/gnu-linux/" class="nav-item nav-link">GNU/Linux</a>
  <a href="/blog-bitix/tags/javascript/" class="nav-item nav-link">JavaScript</a>
  <a href="/blog-bitix/tags/tapestry/" class="nav-item nav-link">Tapestry</a>
  <a href="/blog-bitix/archive/" class="nav-item nav-link">Archivo y hemeroteca</a>
  <a href="/blog-bitix/pages/links/" class="nav-item nav-link">Enlaces</a>
  <a href="/blog-bitix/pages/about/" class="nav-item nav-link">Acerca de...</a>
  
</nav>

    </div>
  </div>
</header> 
      </div>
    </div>
    <div class="row">
      <div class="col-12 adblock-container-billboard">
        <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <div class="adblock-sidebar-container">
          <div class="adblock-sidebar-container-left"></div>
          <div class="adblock-sidebar-container-right">
            <div class="adsense adsense-vertical">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="7450235768"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
<article>
    <h1>Configurar Nginx como balanceador de carga</h1>
    <p class="information">
      
        Escrito por
       
      <span>picodotdev</span> el <time>08/07/2016</time>, actualizado el <time>09/07/2016</time>.
      
        <br>
        
          <a href="/blog-bitix/tags/planeta-codigo/">planeta-codigo</a>
        
          <a href="/blog-bitix/tags/software/">software</a>
        
          <a href="/blog-bitix/tags/software-libre/">software-libre</a>
        
          <a href="/blog-bitix/tags/web/">web</a>
        
      
      <br>
      <a href="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/">Enlace permanente</a>
      
        <a href="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/#comments">Comentarios</a>
      
    </p>

    
      <p class="summary">Para escalar horizontalmente los servidores de aplicaciones, aumentar el rendimiento, disminuir la latencia, conseguir tolerancia a fallos y aumentar la disponibilidad podemos usar el servidor web Nginx como balanceador de carga entre varios servidores de aplicaciones. En este ejemplo muestro la configuración necesaria para añadir la funcionalidad de balanceador de carga a Nginx entre varios servidores de aplicaciones Tomcat usando además Docker.</p>
    
    

    
      <div class="adblock-container-leaderboard">
      <div class="adsense adsense-leaderboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="8238629013"
        data-full-width-responsive="true"></ins>
</div>
      </div>
    

    <div class="content">
      


      <div class="logotypes">
<p>
<img src="/blog-bitix/assets/images/logotypes/nginx.svg" width="300" height="64" alt="Nginx" title="Nginx" class="" loading="false"></p>
</div>
<p>Un balanceador de carga distribuye las peticiones que llegan al servidor entre varios servidores para que las atiendan consiguiendo optimizar el uso de los recursos, aumentar el número de peticiones atendidas por unidad de tiempo, reducir la latencia y proporcionar tolerancia a fallos. Escalar un servidor que deba procesar un gran número de peticiones llegado un límite es más barato escalar horizontalmente añadiendo más servidores que escalar verticalmente usando servidores más potentes.</p>
<p>Distribuir las peticiones ha de hacerse eficientemente para que un servidor no reciba todas las peticiones pesadas y se sature mientras hay servidores que tienen poca carga. Usando varios servidores para atender las peticiones evita que haya un único punto de fallo en la aplicación proporcionando tolerancia a fallos, si un servidor sufre un fallo el resto de servidores se encargarán de atender las peticiones. Una mejor tolerancia a fallos aumentará la disponibilidad del servicio sin que haya caídas de servicio.</p>
<p>Hay soluciones específicas para balancear la carga como <a href="https://www.haproxy.org/">HAProxy</a> pero para los casos sencillos que son los más habituales y para no añadir una pieza más a la arquitectura de la aplicación <a href="https://nginx.org/">Nginx</a> es capaz de hacer las funciones de balanceo de carga entre varios servidores de aplicaciones.</p>
<p>Hay tres estrategias para balancear o distribuir la carga:</p>
<ul>
<li><em>round-robin</em>: las peticiones son distribuidas entre los servidores de forma cíclica. Cabe la posibilidad de que las peticiones más pesadas sean procesadas por el mismo servidor, distribuye las peticiones de forma ecuánime pero la carga no.</li>
<li><em>least-connected</em>: la siguiente petición es atendida por el servidor con menos conexiones activas.</li>
<li><em>ip-hash</em>: se selecciona el servidor que atenderá la petición en base a algún dato como la dirección IP, de esta forma todas las peticiones de un usuario son atendidas por el mismo servidor.</li>
</ul>
<p>Esta es la configuración básica con la estrategia <em>round-robin</em>. Los servidores balanceados se definen con la directiva <em>upstream</em> a los que se hace de <em>proxy</em> inverso con la directiva <em>proxy_pass</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">upstream</span> <span class="s">app</span> <span class="p">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app1</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app2</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">app3</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>&#10;<span class="p">}</span>&#10;&#10;<span class="k">server</span> <span class="p">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_pass</span> <span class="s">http://app</span><span class="p">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">add_header</span> <span class="s">X-Upstream</span> <span class="nv">$upstream_addr</span><span class="p">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;<span class="p">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx.conf</span>
    </div>
</div>
<p>Para usar la estrategia <em>least-connected</em> hay que indicar la directiva <em>least_conn</em> en la directiva <em>upstream</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain">upstream app {&#10;&nbsp;&nbsp;&nbsp;&nbsp;least_conn;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;}</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-least_conn.conf</span>
    </div>
</div>
<p>Hay que tener en cuenta que en las estrategias <em>round-robin</em> y <em>least-connected</em> cada petición probablemente sea atendida por un servidor diferente de modo que si los servidores no comparten las sesiones se producirán comportamientos erráticos. Usando la estrategia <em>ip_hash</em> se usará la dirección IP para redirigir todas las peticiones al mismo servidor que se conoce como <em>sticky session</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain">upstream app {&#10;&nbsp;&nbsp;&nbsp;&nbsp;ip_hash;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;}</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-ip_hash.conf</span>
    </div>
</div>
<p>Para que los servidores compartan la sesión y evitar usar <em>sticky session</em> podemos <a href="https://picodotdev.github.io/blog-bitix/2015/03/datos-de-sesion-externalizados-con-spring-session/">usar Redis como sistema de información para guardar las sesiones de los servidores</a>, si un servidor de aplicaciones deja de funcionar las sesiones que mantuviese no se perderán y las peticiones podrán ser atendida por cualquier servidor. Si hay un servidor que queremos procese más peticiones porque tiene más capacidad podemos dar más peso a este. En esta configuración de cada 5 peticiones 3 serán atendidas por el servidor <em>app1</em>, 1 por el <em>app2</em> y otra por <em>app3</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain">upstream app {&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080 weight=3;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;}</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-weight.conf</span>
    </div>
</div>
<p>Cuando un servidor falla al servir una petición Nginx lo marca como en estado erróneo y deja de enviarle peticiones, las comprobaciones de salud se hacen de forma pasiva según el resultado de las peticiones que se envían. Con <em>max_fails</em> se establece el máximo número de fallos antes de considerar un servidor con estado erróneo, tiene un valor por defecto de 1. Con <em>fail_timeout</em> se establece el tiempo que un servidor se considera que está en estado erróneo antes de enviar una nueva petición, si enviada una nueva petición responde correctamente se vuelve a considerar en estado correcto. Con la directiva <em>health_check</em> se puede configurar las comprobaciones de estado que hace Nginx para determinar si el servidor de aplicaciones está funcionando correctamente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain">upstream app {&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app1:8080 max_fails=5 fail_timeout=30s;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app2:8080 max_fails=1 fail_timeout=60s;&#10;&nbsp;&nbsp;&nbsp;&nbsp;server app3:8080;&#10;}</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nginx-misc.conf</span>
    </div>
</div>
<p>Si queremos que el cliente conozca que servidor atendió la petición podemos añadir la <a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header">directiva <em>add_header</em></a> usando una de las <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#variables">variables añadidas por el módulo  <em>ngx_http_upstream</em></a>, nos servirá para depurar la aplicación en tiempo de desarrollo.</p>
<div class="media">
<figure>
<p>
<a href="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-1_hu01e6c56ef6a522eb9411df6425aed444_172831_2560x1440_fit_box_3.png" data-gallery="data-gallery" title="Servidor balanceado 172.17.0.2:8080"><img src="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-1_hu01e6c56ef6a522eb9411df6425aed444_172831_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.2:8080" title="Servidor balanceado 172.17.0.2:8080" class="" loading="lazy"></a>

<a href="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-2_hu01e6c56ef6a522eb9411df6425aed444_173087_2560x1440_fit_box_3.png" data-gallery="data-gallery" title="Servidor balanceado 172.17.0.3:8080"><img src="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-2_hu01e6c56ef6a522eb9411df6425aed444_173087_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.3:8080" title="Servidor balanceado 172.17.0.3:8080" class="" loading="lazy"></a></p>
</figure>
</div>
<div class="media">
<figure>
<p>
<a href="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-3_hu01e6c56ef6a522eb9411df6425aed444_172434_2560x1440_fit_box_3.png" data-gallery="data-gallery" title="Servidor balanceado 172.17.0.4:8080"><img src="/blog-bitix/2016/07/configurar-nginx-como-balanceador-de-carga/images/nginx-load-balancer-3_hu01e6c56ef6a522eb9411df6425aed444_172434_300x200_fit_box_3.png" width="224" height="200" alt="Servidor balanceado 172.17.0.4:8080" title="Servidor balanceado 172.17.0.4:8080" class="" loading="lazy"></a></p>
<figcaption>Nginx balanceando la carga entre 3 servidores de aplicaciones Tomcat</figcaption>
</figure>
</div>
<p>En el ejemplo de configuración usaré <a href="https://www.docker.com/">Docker</a> para crear un servidor web Nginx que haga de balanceador de carga entre tres servidores de aplicaciones Tomcat. Con Docker hacer esta prueba es mucho más sencilla que instalar tres Tomcats y un servidor Nginx a través de los paquetes del sistema o descargando binarios, puedes leer los <a href="https://picodotdev.github.io/blog-bitix/series/docker/">artículos de la serie Docker</a> que he escrito para conocer como usarlo y que ofrece esta útil herramienta. El archivo de <em>docker-compose.yml</em> completo es el siguiente:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">app1</span><span class="p">:</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span><span class="w">&#10;</span><span class="w"></span><span class="nt">app2</span><span class="p">:</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span><span class="w">&#10;</span><span class="w"></span><span class="nt">app3</span><span class="p">:</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tomcat</span><span class="w">&#10;</span><span class="w">&#10;</span><span class="w"></span><span class="nt">nginx</span><span class="p">:</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:alpine</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">./nginx.conf:/etc/nginx/conf.d/default.conf:ro</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">links</span><span class="p">:</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app1</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app2</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="l">app3</span><span class="w">&#10;</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span>- <span class="s2">&#34;80:80&#34;</span><span class="w">&#10;</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>docker-compose.yml</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/NginxLoadBalancer">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>docker-compose up</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="http://nginx.org/en/docs/http/load_balancing.html">Using NGINX as HTTP load balancer</a></li>
<li><a href="https://www.nginx.com/blog/load-balancing-with-nginx-plus/">Load Balancing with NGINX and NGINX Plus, Part 1</a></li>
<li><a href="https://www.nginx.com/blog/load-balancing-with-nginx-plus-part2/">Load Balancing with NGINX and NGINX Plus, Part 2</a></li>
<li><a href="https://www.nginx.com/resources/admin-guide/load-balancer/">NGINX Load Balancing - HTTP Load Balancer</a></li>
</ul>
</div>

    </div>

    <p class="information">
      
    </p>

    
  </article>
        <div>
          <hr>
        </div>
        

        
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-text">
      Comparte el artículo:
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-inline-share-buttons"></div>
  </div>
</div>


        
    
    
    <div class="row related"><div class="col-12"><p>Artículos relacionados:</p></div></div>
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/07/como-optimizar-un-sitio-web-con-compresion-gzip-en-nginx-y-apache-httpd/">
                <img src="/blog-bitix/assets/images/logotypes/nginx.svg" width="326" height="125" alt="Cómo optimizar un sitio web con compresión GZIP en Nginx y Apache HTTPD" title="Cómo optimizar un sitio web con compresión GZIP en Nginx y Apache HTTPD" class="" loading="lazy">
                <h3>Cómo optimizar un sitio web con compresión GZIP en Nginx y Apache HTTPD</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/07/hemeroteca-9/">
                <img src="/blog-bitix/assets/images/logotypes/blogbitix.svg" width="326" height="125" alt="Hemeroteca #9" title="Hemeroteca #9" class="" loading="lazy">
                <h3>Hemeroteca #9</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/06/como-redirigir-peticiones-de-http-a-https-en-nginx-apache-tomcat-jetty-y-wildfly/">
                <img src="/blog-bitix/assets/images/logotypes/nginx.svg" width="326" height="125" alt="Cómo redirigir peticiones de HTTP a HTTPS en Nginx, Apache, Tomcat, Jetty y WildFly" title="Cómo redirigir peticiones de HTTP a HTTPS en Nginx, Apache, Tomcat, Jetty y WildFly" class="" loading="lazy">
                <h3>Cómo redirigir peticiones de HTTP a HTTPS en Nginx, Apache, Tomcat, Jetty y WildFly</h3>
                </a>
                
            </div>
        </div>
    </div>
    
    
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/06/ofrecer-contenido-personalizado-al-usuario-basado-en-su-ubicacion/">
                <img src="/blog-bitix/assets/images/logotypes/linux.svg" width="326" height="125" alt="Ofrecer contenido personalizado al usuario basado en su ubicación" title="Ofrecer contenido personalizado al usuario basado en su ubicación" class="" loading="lazy">
                <h3>Ofrecer contenido personalizado al usuario basado en su ubicación</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/05/4-opciones-ofimaticas-alternativas-gratuitas-a-microsoft-office/">
                <img src="/blog-bitix/assets/images/logotypes/microsoft.svg" width="326" height="125" alt="4 opciones ofimáticas alternativas gratuitas a Microsoft Office" title="4 opciones ofimáticas alternativas gratuitas a Microsoft Office" class="" loading="lazy">
                <h3>4 opciones ofimáticas alternativas gratuitas a Microsoft Office</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/">
                <img src="/blog-bitix/assets/images/logotypes/openssl.svg" width="326" height="125" alt="Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache" title="Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache" class="" loading="lazy">
                <h3>Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache</h3>
                </a>
                
            </div>
        </div>
    </div>
    

        <div class="row">
          <div class="col-12 adblock-container-billboard">
            <span id="pageBottom"></span>
            <div class="adsense adsense-billboard">
    <ins class="adsbygoogle"
        data-ad-client="ca-pub-3533636310991304"
        data-ad-slot="4052324337"
        data-full-width-responsive="true"></ins>
</div>
          </div>
        </div>
        
  <div class="row">
    <div class="col-md-12">
      <span id="comments"></span>
      <div id="disqus_thread"></div>
    </div>
  </div>

  <script type="text/javascript" async>
    var disqus_shortname = 'blog-bitix';
    var disqus_identifier = 'blog-bitix-157';
    var disqus_url = 'https:\/\/picodotdev.github.io\/blog-bitix\/2016\/07\/configurar-nginx-como-balanceador-de-carga\/';
    var disqus_script = 'embed.js';
  </script>

      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    





<footer>
  <div class="row">
    <div class="col-12 col-sm-4">
      <p><strong>Blog Bitix</strong></p>
      <p>Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</p>
      <p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p>
    </div>
    <div class="col-12 col-sm-4 text-center menu">
      <ul class="list-unstyled">
        <li><a href="/blog-bitix/tags/java/">Java</a></li>
        <li><a href="/blog-bitix/tags/gnu-linux/">GNU/Linux</a></li>
        <li><a href="/blog-bitix/tags/javascript/">JavaScript</a></li>
        <li><a href="/blog-bitix/tags/tapestry/">Tapestry</a></li>
        <li><a href="/blog-bitix/archive/">Archivo y hemeroteca</a></li>
        <li><a href="/blog-bitix/pages/links/">Enlaces</a></li>
        <li><a href="/blog-bitix/pages/advertising/">Publicidad</a></li>
        <li><a href="/blog-bitix/pages/donate/">Donaciones</a></li>
        <li><a href="/blog-bitix/pages/about/">Acerca de...</a></li>
        
      </ul>
    </div>
    <div class="col-12 col-sm-4 text-center links">
      
        <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
      
      
        <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
      
      
      
        <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
      
      
      
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      Copyleft <span class="copyleft">&copy;</span> 2022 - <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" width="80" height="15" alt="Creative Commons License" title="Creative Commons License"></a><br />
      <a href="https://www.planetacodigo.com/" rel="nofollow"><img src="/blog-bitix/assets/images/planeta-codigo.png" width="80" height="15" alt="Planeta código" title="Planeta código"></a>
      <br/>
      <a href="https://picodotdev.github.io/blog-bitix/" rel="nofollow">Blog Bitix</a> by <a href="https://picodotdev.github.io/blog-bitix/">pico.dev</a> is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.
      <br/>
      <span class="credit">Powered by <a href="https://gohugo.io/" rel="nofollow" title="A fast and modern static website engine">Hugo</a> and <a href="https://pages.github.com/" title="Websites for you and your projects">GitHub Pages</a>.</span>
      <span class="credit">Background patterns from <a href="https://www.toptal.com/designers/subtlepatterns/" rel="nofollow">Subtle Patterns</a>.</span>
    </div>
  </div>
</footer>

  </div>
  
<div
  id="blueimp-gallery"
  class="blueimp-gallery blueimp-gallery-controls"
  aria-label="image gallery"
  aria-modal="true"
  role="dialog"
>
  <div class="slides" aria-live="polite"></div>
  <h3 class="title"></h3>
  <span
    class="prev"
    aria-controls="blueimp-gallery"
    aria-label="previous slide"
    aria-keyshortcuts="ArrowLeft"
  ></span>
  <span
    class="next"
    aria-controls="blueimp-gallery"
    aria-label="next slide"
    aria-keyshortcuts="ArrowRight"
  ></span>
  <span
    class="close"
    aria-controls="blueimp-gallery"
    aria-label="close"
    aria-keyshortcuts="Escape"
  ></span>
  <span
    class="play-pause"
    aria-controls="blueimp-gallery"
    aria-label="play slideshow"
    aria-keyshortcuts="Space"
    aria-pressed="false"
    role="button"
  ></span>
  <ol class="indicator"></ol>
</div>

  
  
</body>
</html>