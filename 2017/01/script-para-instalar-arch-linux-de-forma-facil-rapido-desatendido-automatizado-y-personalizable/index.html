<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="base" href="/blog-bitix/">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="picodotdev">
  <meta name="keywords" content="java, programacion, software, hardware, tapestry, software libre, gnu, linux, gnu/linux, unix, arch, arch linux, web, html, css, javascript, tutorial, guía, básico, avanzado, análisis, tecnología, juegos, productos">
  <meta name="description" content="Arch Linux es una de las distribuciones más personalizables de GNU/Linux pero cuya instalación requiere leer una buena cantidad de documentación, guías o manuales para saber que comandos ejecutar paso a paso en el prompt del sistema en el que te deja se medio de instalación. Algunos usuarios eligen una distribución como Antergos, KaOS o Manjaro con un instalalador gráfico y guiado simplemente por el hecho de no enfrentarse a la instalación de Arch Linux desde la línea de comandos. Aún así, ejecutar un comando y esperar a que termine para introducir otro es lento y requiere de atención. &hellip;">
  <meta name="theme-color" content="#FFFFFF"/>

  <title>Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable</title>

  <link rel="shortcut icon" href="/blog-bitix/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog-bitix/assets/apple-touch-icon-144-precomposed.png">
  <link rel="canonical" type="text/html" href="https://picodotdev.github.io/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/" hreflang="es">
  <link rel="alternate" type="application/rss&#43;xml" href="https://picodotdev.github.io/blog-bitix/index.xml" hreflang="es" title="Blog Bitix">
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/" hreflang="es" title="Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable">
  
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2017/01/script-to-install-arch-linux-easy-fast-unattended-automated-and-customizable-way/" hreflang="en" title="Script to install Arch Linux easy, fast, unattended, automated and customizable way">
  
  
  <link rel="humans" type="text/plain" href="/blog-bitix/humans.txt">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel="stylesheet">

  

  <!-- Social -->
<meta property="og:title" content="Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable">
<meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/">
<meta property="og:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/archlinux-750.webp">

<meta property="og:site_name" content="Blog Bitix">
<meta property="og:description" content="Arch Linux es una de las distribuciones más personalizables de GNU/Linux pero cuya instalación requiere leer una buena cantidad de documentación, guías o manuales para saber que comandos ejecutar paso a paso en el prompt del sistema en el que te deja se medio de instalación. Algunos usuarios eligen una distribución como Antergos, KaOS o Manjaro con un instalalador gráfico y guiado simplemente por el hecho de no enfrentarse a la instalación de Arch Linux desde la línea de comandos. Aún así, ejecutar un comando y esperar a que termine para introducir otro es lento y requiere de atención. &hellip;">
<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://picodotdev.github.io/blog-bitix/assets/images/structured-data/archlinux-750.webp">

<meta name="twitter:site" content="@picodotdev">
<meta name="twitter:title" content="Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable">
<meta name="twitter:description" content="Arch Linux es una de las distribuciones más personalizables de GNU/Linux pero cuya instalación requiere leer una buena cantidad de documentación, guías o manuales para saber que comandos ejecutar paso a paso en el prompt del sistema en el que te deja se medio de instalación. Algunos usuarios eligen una distribución como Antergos, KaOS o Manjaro con un instalalador gráfico y guiado simplemente por el hecho de no enfrentarse a la instalación de Arch Linux desde la línea de comandos. Aún así, ejecutar un comando y esperar a que termine para introducir otro es lento y requiere de atención. &hellip;">
<meta name="twitter:creator" content="@picodotdev">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://picodotdev.github.io/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/"
    },
    "headline": "Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable",
    "image": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/structured-data/archlinux-750.webp"
        
      },
    "datePublished": "2017-01-13T00:00:00+01:00",
    "dateModified": "2020-06-20T20:30:00+02:00",
    "inLanguage": "es",
    
    "wordCount": "7237",
    "license": "https://creativecommons.org/licenses/by-sa/4.0/",
    "author": {
        "@type": "Person",
        "name": "",
        "description": "",
        "url": "https://twitter.com/picodotdev/"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog Bitix",
        "logo": {
            "@type": "ImageObject",
            "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
        }
    },
    "description": "Arch Linux es una de las distribuciones más personalizables de GNU/Linux pero cuya instalación requiere leer una buena cantidad de documentación, guías o manuales para saber que comandos ejecutar paso a paso en el prompt del sistema en el que te deja se medio de instalación. Algunos usuarios eligen una distribución como Antergos, KaOS o Manjaro con un instalalador gráfico y guiado simplemente por el hecho de no enfrentarse a la instalación de Arch Linux desde la línea de comandos. Aún así, ejecutar un comando y esperar a que termine para introducir otro es lento y requiere de atención."
}
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Blog Bitix",
    "description": "Blog sobre el lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.",
    "url": "https://picodotdev.github.io/blog-bitix/",
    "logo": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
    }
}
  </script>

  <!-- css -->
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-5.3.2-dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/bootstrap-icons-1.11.3/font/bootstrap-icons.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-5.3.2-dist/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/bootstrap-icons-1.11.3/font/bootstrap-icons.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/libs/Gallery-3.4.0/css/blueimp-gallery.min.css" media="all">
  <!-- theme -->
  <link rel="preload" href="/blog-bitix/assets/css/syntax.css" as="style">
  <link rel="preload" href="/blog-bitix/assets/css/main.css" as="style">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/syntax.css" media="all">
  <link rel="stylesheet" type="text/css" href="/blog-bitix/assets/css/main.css" media="all">

  <!-- javascript -->
  <link rel="preload" href="/blog-bitix/assets/js/main.js" as="script">
  <script type="text/javascript" src="/blog-bitix/assets/js/require-config.js" defer></script>
  <script type="text/javascript" src="/blog-bitix/assets/libs/require.js" data-main="/blog-bitix/assets/js/main" defer></script>

  
  
  <script type="text/javascript" src="https://securepubads.g.doubleclick.net/tag/js/gpt.js" async></script>

  
  <script type="text/javascript" src="/blog-bitix/assets/js/app.js" defer></script>

</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-12">
        





<header>
  <div class="row">
    <div class="col-12 col-lg-4"></div>
    <div class="col-12 col-lg-4">
      <span class="title"><a href="https://picodotdev.github.io/blog-bitix/">Blog Bitix</a></span>
      <div class="links">
        
          <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
        
        
          <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
        
        
          <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
        
        
        
      </div>
    </div>
    <div class="col-12 col-lg-4 text-center">
      <form name="query" class="form-inline search" onsubmit="return false;">
        <div class="input-group">
          <input type="text" name="q" class="form-control" placeholder="Buscar en Blog Bitix" aria-label="Buscar en Blog Bitix">
        </div>
      </form>
      <form name="search" action="https://duckduckgo.com/" method="get" class="hidden" data-site="https://picodotdev.github.io/blog-bitix/">
        <input type="hidden" name="q" value="">
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      
<nav class="nav nav-pills nav-fill">
  <a href="/blog-bitix/tags/java/" class="nav-item nav-link">Java</a>
  <a href="/blog-bitix/tags/gnu-linux/" class="nav-item nav-link">GNU/Linux</a>
  <a href="/blog-bitix/tags/javascript/" class="nav-item nav-link">JavaScript</a>
  <a href="/blog-bitix/tags/tapestry/" class="nav-item nav-link">Tapestry</a>
  <a href="/blog-bitix/archive/" class="nav-item nav-link">Archivo y hemeroteca</a>
  <a href="/blog-bitix/pages/links/" class="nav-item nav-link">Enlaces</a>
  <a href="/blog-bitix/pages/about/" class="nav-item nav-link">Acerca de...</a>
  
</nav>

    </div>
  </div>
</header> 
      </div>
    </div>
    <div class="row">
      <div class="col-12 adblock-container-billboard mt-3 mb-3 p-0">
        
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <div class="adblock-container-sidebar">
          <div class="adblock-container-sidebar-left"></div>
          <div class="adblock-container-sidebar-right">
            
          </div>
        </div>
        


<article>
    <h1>Script para instalar Arch Linux de forma fácil, rápido, desatendido, automatizado y personalizable</h1>
    <p class="information">
      
        Escrito por
       
      <span></span> el <time>13/01/2017</time>, actualizado el <time>20/06/2020</time>.
      
        <br>
        
          <a href="/blog-bitix/tags/gnu-linux/">gnu-linux</a>
        
          <a href="/blog-bitix/tags/planeta-codigo/">planeta-codigo</a>
        
          <a href="/blog-bitix/tags/software-libre/">software-libre</a>
        
      
      <br>
      <a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/">Enlace permanente</a>
      
        <a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/#comments">Comentarios</a>
      
    </p>

    
      <p class="summary">Arch Linux es una de las distribuciones más personalizables de GNU/Linux pero cuya instalación requiere leer una buena cantidad de documentación, guías o manuales para saber que comandos ejecutar paso a paso en el <em>prompt</em> del sistema en el que te deja se medio de instalación. Algunos usuarios eligen una distribución como Antergos, KaOS o Manjaro con un instalalador gráfico y guiado simplemente por el hecho de no enfrentarse a la instalación de Arch Linux desde la línea de comandos. Aún así, ejecutar un comando y esperar a que termine para introducir otro es lento y requiere de atención.</p>
    
    

    
      <div class="adblock-container-leaderboard mt-3 mb-3 p-0">
      
      </div>
    

    <div class="content">
      


      
        
        
      
      <div class="logotypes">
<p><img src="/blog-bitix/assets/images/logotypes/archlinux.svg" width="250" height="186" alt="Arch Linux" title="Arch Linux" class="" loading="false&#34;"></p>
</div>
<div class="logotypes">
<p><img src="/blog-bitix/assets/images/logotypes/linux.svg" width="200" height="232" alt="Linux" title="Linux" class="" loading="false&#34;"></p>
</div>
<p>Hace tiempo que instalar una distribución <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> no tiene más dificultad que instalar un sistema operativo como <a href="https://www.microsoft.com/es-es/windows/">Windows</a>, que consiste en descargar la imagen ISO del CD o DVD, grabarla en un CD, DVD o memoria USB e iniciar el sistema con el medio. Las <a href="https://picodotdev.github.io/blog-bitix/2016/10/elegir-una-distribucion-gnu-linux-segun-el-usuario-uso-o-equipo/">distribuciones aconsejadas para usuarios que provienen de Windows o macOS</a> o no tiene muchos conocimientos informáticos poseen instaladores gráficos o basados en texto y guiados en varios pasos hasta completar la instalación en menos de media hora. Distribuciones como <a href="https://www.ubuntu.com/">Ubuntu</a>, <a href="https://elementary.io/es/">elementary OS</a> o <a href="https://www.linuxmint.com/">Linux Mint</a> hacen que la instalación no requiera conocimientos y sea completada con éxito por cualquier usuario.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/debian-installer-text_hu24823266aaadbd5ea03f13734b295699_7331_2560x1440_fit_q90_h2_box_3.webp" data-gallery="" title="Instalador de Debian en modo texto"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/debian-installer-text_hu24823266aaadbd5ea03f13734b295699_7331_300x200_fit_q90_h2_box_3.webp" width="267" height="200" alt="Instalador de Debian en modo texto" title="Instalador de Debian en modo texto" class="&#34; " loading="lazy"></a>
<a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/debian-installer-graphics_hu57b39c5df8bb0f15d502613ed89fe1b4_28647_2560x1440_fit_q90_h2_box_3.webp" data-gallery="" title="Instalador de Debian en modo gráfico"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/debian-installer-graphics_hu57b39c5df8bb0f15d502613ed89fe1b4_28647_300x200_fit_q90_h2_box_3.webp" width="267" height="200" alt="Instalador de Debian en modo gráfico" title="Instalador de Debian en modo gráfico" class="&#34; " loading="lazy"></a></p>
<figcaption>Instalación guíada de Debian basada en texto y gráfica</figcaption>
</figure>
</div>
<p>Otras distribuciones basadas en principios diferentes y usuarios a los que está destinadas con otras necesidades o preferencias puede que requieran algo más de conocimientos a cambio de realizar configuraciones más avanzadas como el particionado del disco, cifrado del disco o software que se instala. Algunas distribuciones como <a href="https://www.archlinux.org/">Arch Linux</a> incluso no proporcionan ningún instalador.</p>
<blockquote>
<p>It is targeted at the proficient GNU/Linux user, or anyone with a do-it-yourself attitude who is
willing to read the documentation, and solve their own problems.</p>
</blockquote>
<div class="row toc"><div class="col-12 col-lg-6"><div class="alert alert-warning pt-0 pb-0 tableofcontents"><p class="fs-5 fw-bold mt-3">Contenido del artículo</p><nav id="TableOfContents">
  <ol>
    <li><a href="#la-instalación-del-sistena-con-arch-linux">La instalación del sistena con Arch Linux</a></li>
    <li><a href="#el-instalador-alis-y-características-soportadas">El instalador alis y características soportadas</a>
      <ol>
        <li><a href="#capturas-de-diferentes-entornos-de-escritorio-soportados"> Capturas de diferentes entornos de escritorio soportados</a></li>
      </ol>
    </li>
    <li><a href="#vídeo-de-instalación-del-sistema-base-con-alis">Vídeo de instalación del sistema base con alis</a></li>
    <li><a href="#código-fuente-de-alis">Código fuente de alis</a></li>
  </ol>
</nav></div> </div><div class="col-12 col-lg-6"><div class="videoo">
    <script defer id="videoo-library" data-id="7f85ad782c7554f1b30d1496af3608d5e0484ccc25f7450c72c0c1412bf140e0" src="https://static.videoo.tv/7f85ad782c7554f1b30d1496af3608d5e0484ccc25f7450c72c0c1412bf140e0.js"></script>
</div></div></div>
<h2 id="la-instalación-del-sistena-con-arch-linux">La instalación del sistena con Arch Linux</h2>
<p>En Arch Linux con su <a href="https://wiki.archlinux.org/index.php/Arch_Linux">forma de hacer las cosas</a> deja al usuario el poder de personalizar el sistema completamente a sus necesidades y preferencias únicamente limitado por su determinación de conseguirlo. Solo proporciona <a href="https://www.archlinux.org/download/">el medio con el que iniciar la instalación</a> que comienza con una terminal y un <em>prompt</em> del sistema, una <a href="https://wiki.archlinux.org/index.php/Installation_guide">guía de instalación</a> junto con las <a href="https://wiki.archlinux.org/index.php/General_recommendations">recomendaciones generales</a> y <a href="https://wiki.archlinux.org/">una de las mejores fuentes de información en GNU/Linux</a> además de completa de cada aspecto que necesitemos en la instalación. Después de haber leído las páginas relevantes de la wiki de Arch Linux, seguramente más de una y dos veces, hasta comprenderla en su mayor parte se empieza a realizar la receta que contenga los comandos necesarios hasta completar la instalación.</p>
<p>En multitud de blogs y vídeos de YouTube hay guías que contienen los comandos y las explicaciones necesarias. Cualquier usuario de Arch Linux con un blog seguramente ha publicado un artículo con su guía de instalación (sí, <a href="https://picodotdev.github.io/blog-bitix/2014/05/anexo-a-la-guia-de-instalacion-y-del-principiante-de-arch-linux/">yo también publiqué la mía</a>). Un usuario que quiera instalar Arch Linux debe leer varios de esos artículos además de la guía oficial de instalación. Según la filosofía de Arch Linux este proceso de aprendizaje se considera necesario y permite una mayor comprensión del sistema.</p>
<p>Pero saber los comandos que hay que introducir para realizar la instalación de Arch Linux no evita tener que teclearlos uno de tras de otro y esperar a que termine el anterior para introducir el siguiente. Tampoco todas las personas tienen el tiempo para realizarlo. Varias <a href="https://wiki.archlinux.org/index.php/Arch-based_distributions">distribuciones derivadas de Arch Linux</a> como <a href="https://antergos.com/">Antergos</a>, <a href="https://kaosx.us/">KaOS</a> o <a href="https://manjaro.org/">Manjaro</a> ofrecen los instaladores gráficos y guiados más amigables que atraen a algunos usuarios buscando usar Arch Linux pero no pasar por su poco amigable proceso de instalación. Por fortuna al ser una distribución <em>rolling release</em> (en constante actualización) solo hay que hacer una única instalación por equipo en principio durante toda su vida de uso. Pero incluso para los usuarios de Arch Linux realizar una segunda instalación en un nuevo equipo es cansina.</p>
<p>Hace unos meses conocí <a href="https://arch-anywhere.org/">arch-anywhere</a> que básicamente es un <em>script</em> de bash, con un instalador guiado y basado en texto que hace menos laboriosa la instalación de Arch Linux de forma similar a las existentes en otras distribuciones más amigables. Sin embargo, hay un dos cosas que no me convencen de <em>arch-anywhere</em>, una es que no es desatendido requiriendo contestar a varias preguntas de forma interactiva, esperar a que termine ejecute algún comando según la contestación anterior y contestar a la siguiente pregunta. Otra cosa que no me convence es que usa una imagen ISO propia y no la original de Arch Linux. Por lo demás, ofrece un buen nivel de personalización cubriendo las necesidades más comunes de los usuarios como personalizar el particionado, elegir el sistema de archivos, si se quiere LVM, cifrado, el entorno de escritorio (GNOME, KDE, XFCE, &hellip;), kernel, cargador de arranque (GRUB) y programas a instalar.</p>
<h2 id="el-instalador-alis-y-características-soportadas">El instalador alis y características soportadas</h2>
<p>Basándome en la idea de <em>arch-anywhere</em> y dedicando un poco de tiempo he creado un <em>script</em> en <a href="https://es.wikipedia.org/wiki/Bash">bash</a> para instalar Arch Linux de forma automatizada, desatendida y personalizable hasta cierto punto aunque siendo útil para los casos de configuraciones más comunes, sin ser imprescindible leer unas decenas de páginas de la wiki de Arch Linux ni seguir ninguna guía o tutorial paso a paso. Algunas de las funcionalidades que soporta son:</p>
<ul>
<li><strong>Sistema</strong>: UEFI, BIOS</li>
<li><strong>Almacenamiento</strong>: SATA, NVMe i MMC</li>
<li><strong>Cifrado</strong>: partición root cifrada y no cifrada</li>
<li><strong>Particionamiento</strong>: no LVM, LVM, LVM on LUKS, GPT on UEFI, MBR on BIOS</li>
<li><strong>Sistema de archivos</strong>: ext4, btrfs (with subvols), xfs, f2fs, reiserfs</li>
<li><strong>Kernels</strong>: linux, linux-lts, linux-hardened, linux-zen</li>
<li><strong>Entorno de escritorio</strong>: GNOME, KDE, XFCE, Mate, Cinnamon, LXDE, i3-wm, i3-gaps</li>
<li><strong>Gestor de inicio de sesión</strong>: GDM, SDDM, Lightdm, lxdm</li>
<li><strong>Controlador gráfico</strong>: intel, nvidia y amd con opcionalmente inicio KMS. Con intel opcionalmente fastboot, aceleración de vídeo por hardware y compresión de framebuffer.</li>
<li><strong>Cargador de arranque</strong>: GRUB, rEFInd, systemd-boot</li>
<li><strong>Shell personalizado</strong>: bash, zsh, dash, fish</li>
<li><strong>Red inalámbrica WIFI</strong> en la instalación</li>
<li><strong>TRIM periódico</strong> para almacenamiento SSD</li>
<li><strong>Microcódigo de procesador</strong> para Intel y AMD</li>
<li><strong>Archivo swap</strong> opcional</li>
<li><strong>VirtualBox guest additions</strong></li>
<li><strong>Conpresión del Kernel compression</strong> y <strong>parámetros personalizados</strong></li>
<li><strong>Creación de usuarios</strong> y <strong>adición a grupo sudoers</strong></li>
<li><strong>Habilitar y deshabilitar units de systemd</strong></li>
<li>Soporte <strong>Multilib</strong></li>
<li><strong>Instalación de paquetes</strong></li>
<li>Instalación de utilidad Flatpak e <strong>instalación de paquetes Flatpak</strong></li>
<li>Instalación de utilidad SDKMAN e <strong>installation de paquetes SDKMAN</strong></li>
<li>Instalación de utilidad AUR (paru, yay, aurman) e <strong>installation de paquetes AUR</strong></li>
<li><strong>Instalación de paquetes después de la inatalación del sistema base</strong> (forma preferida para la instalación de paquetes)</li>
<li>Script para la descarga, <strong>scripts de recuperación</strong> y archivos de configuración</li>
<li><strong>Reintento de descarga de paquetes</strong> al haber errores de conexión on espejo</li>
<li><strong>Soporte Packer</strong> para pruebas en VirtualBox</li>
<li><strong>Tradas de instalación</strong> con todos los comandos ejecutados y su salida en un archivo o <strong>vídeo de asciinema</strong></li>
<li>Espera después de la instalación para un <strong>reinicio abortable</strong></li>
<li>Posibilidad de crear un <em>fork</em> y <strong>usar configuración propia</strong></li>
</ul>
<p>La forma aconsejada de instalar Arch Linux es aprendiendo cuales son los comandos a ejecutar y que hace cada uno de ellos, primero lee la guía oficial de instalación de Arch Linux y comprende que hacen los comandos del <em>script</em>. Este <em>script</em> no es oficial y por ello en el <a href="https://foros.archlinux-es.org/">foro de Arch Linux en español</a> o <a href="https://bbs.archlinux.org/">en inglés</a> no podrán darte soporte aunque yo en los comentarios de este artículo te ayudaré si preguntas. Ten en cuenta que este <em>script</em> elimina toda la información del dispositivo de instalación. Si lo pruebas deja un comentario al final de artículo.</p>
<p>Iniciado el sistema con la imagen ISO de Arch Linux de instalación, hay que descargar el <em>script</em>, editar algunas variables de entorno para la configuración de alis e iniciar el proceso de instalación. Dependiendo del entorno de escritorio preferido, si se desea LVM, el tipo del sistema de archivos, si se desea cifrar el sistema de archivos y paquetes a instalar los valores de las variables variarán según las preferencias que inicialmente tienes unos valores comunes. Dos variables que hay que modificar al menos son <em>USER_NAME</em> y <em>USER_PASSWORD</em> con el nombre del usuario y su contraseña que vaya a utilizar el sistema.</p>
<p>El tiempo requerido de instalación varía según el ancho de banda de la conexión a internet y del tipo de almacenamiento, en mi caso con ADSL con una descarga de 1.2 MiB/s y SSD la instalación del sistema base sin entorno de escritorio me tarda aproximandamente 10 minutos. Con una conexión de fibra tardará sensiblemente menos tiempo. El <em>script</em> de instalación contiene con los mismos comandos que serían necesarios para realizar la instalación manualmente de forma interactiva.</p>
<p>Aunque no se utilice alis, el código bash del <em>script</em> puede verse como documentación ejecutable o como referencia si se opta por hacer la instalación manualmente. Contiene los mismos comandos que un usuario ejecutaría manualmente uno detrás de otro en una instalación interactiva. <a href="https://github.com/picodotdev/alis/">alis</a> es un <em>script</em> que permite hacer la instalación de Arch Linux de forma desatendida, automatizada y personalizable de Arch Linux.</p>
<p>Estos son los comandos de uso de alis y su archivo de configuración con el que personalizar la instalación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># loadkeys es</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># curl -sL https://bit.ly/2F3CATp | bash</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># vim alis.conf</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># ./alis.sh</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>alis-install.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Arch Linux Install Script (alis) configuration file</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Some variables values are preceded by a ! character, this means that the value is ignored.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Some variables accept a single value others accept multiple values as annotated in the comments.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Some variables are boolean with a value of true or false.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Read the Arch Linux wiki pages to learn more about the variables values.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># https://github.com/picodotdev/alis/blob/master/README.md</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># init</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## KEYS sets keyboard layout.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## LOG generates a log file with the commands executed and output generated during installation.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### The log file is saved to /var/log/alis.log.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYS</span><span class="o">=</span><span class="s2">&#34;es&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LOG</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># partition</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## DEVICE sets which is the device for the installation.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## DEVICE_TRIM sets if the DEVICE device supports TRIM feature.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## LVM sets if the DEVICE is partitioned with LVM partition scheme.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## LUKS_PASSWORD and LUKS_PASSWORD_RETYPE if set is the password for encrypt the device. With LVM, LVM on LUKS is used. If &#34;ask&#34; password alis asks for a secure password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## FILE_SYSTEM_TYPE root device is formatted with this file system type.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## SWAP_SIZE swap file size with a size of the value in megabytes. If no value no swap file is created.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## PARTITION_MODE how partition is performed on DEVICE.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### &#34;auto&#34; value deletes all existing partitions and creates a boot partition and a root partition using disk full size.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### Warning! all disk data will be lost, so backup existing data before.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### &#34;custom&#34; value allows to use a custom parted partition script.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### &#34;manual&#34; allows to specify which existing partitions are used for boot partition and root partition.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE</span><span class="o">=</span><span class="s2">&#34;/dev/sda !/dev/nvme0n1 !/dev/mmcblk0&#34;</span> <span class="c1"># sata nvme mmc (single)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_TRIM</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LVM</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LUKS_PASSWORD</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LUKS_PASSWORD_RETYPE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">FILE_SYSTEM_TYPE</span><span class="o">=</span><span class="s2">&#34;ext4 !btrfs !xfs !f2fs !reiserfs&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SWAP_SIZE</span><span class="o">=</span><span class="s2">&#34;!2048 !4096 !8192&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_MODE</span><span class="o">=</span><span class="s2">&#34;auto !custom !manual&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_CUSTOM_PARTED_UEFI</span><span class="o">=</span><span class="s2">&#34;mklabel gpt mkpart ESP fat32 1MiB 512MiB mkpart root </span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2"> 512MiB 100% set 1 esp on&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_CUSTOM_PARTED_BIOS</span><span class="o">=</span><span class="s2">&#34;mklabel msdos mkpart primary ext4 4MiB 512MiB mkpart primary </span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2"> 512MiB 100% set 1 boot on&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_CUSTOMMANUAL_BOOT</span><span class="o">=</span><span class="s2">&#34;!/dev/sda1 !/dev/nvme0n1p1 !/dev/mmcblk0p1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_CUSTOMMANUAL_ROOT</span><span class="o">=</span><span class="s2">&#34;!/dev/sda2 !/dev/nvme0n1p2 !/dev/mmcblk0p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># network_install</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## Variables to setup the WIFI connection to internet.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## The WIFI interface, WIFI ESSID identifier and WIFI password must be specified. If &#34;ask&#34; password alis asks for a secure password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## PING_HOSTNAME is the host to check the internet connection.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">WIFI_INTERFACE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">WIFI_ESSID</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">WIFI_KEY</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">WIFI_KEY_RETYPE</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PING_HOSTNAME</span><span class="o">=</span><span class="s2">&#34;mirrors.kernel.org&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># install</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## REFLECTOR allows to use reflector utility to use the best mirrors for packages download.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## REFLECTOR_COUNTRIES is an array of countries to select mirrors from.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## PACMAN_MIRROR if reflector is not used this specific mirror is used.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## KERNELS additional kernels and headers to install.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## KERNELS_COMPRESSION selects de algorithm for kernel compression.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## KERNELS_PARAMETERS specific kernel parameters to set on boot. eg. iommu=soft</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">REFLECTOR</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">REFLECTOR_COUNTRIES</span><span class="o">=(</span><span class="s2">&#34;Spain&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PACMAN_MIRROR</span><span class="o">=</span><span class="s2">&#34;https://mirrors.kernel.org/archlinux/\$repo/os/\$arch&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KERNELS</span><span class="o">=</span><span class="s2">&#34;!linux-lts !linux-lts-headers !linux-hardened !linux-hardened-headers !linux-zen !linux-zen-headers&#34;</span> <span class="c1"># (multiple)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KERNELS_COMPRESSION</span><span class="o">=</span><span class="s2">&#34;!gzip !bzip2 !lzma !xz !lzop !lz4 zstd&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KERNELS_PARAMETERS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># display driver</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## DISPLAY_DRIVER installs a specific display driver, you must know which brand is the graphics hardware.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## Other variables activates some features if are supported for the DISPLAY_DRIVER.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DISPLAY_DRIVER</span><span class="o">=</span><span class="s2">&#34;!intel !amdgpu !ati !nvidia !nvidia-lts !nvidia-dkms !nvidia-390xx !nvidia-390xx-lts !nvidia-390xx-dkms !nouveau&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KMS</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">FASTBOOT</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">FRAMEBUFFER_COMPRESSION</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DISPLAY_DRIVER_DDX</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">VULKAN</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DISPLAY_DRIVER_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span><span class="o">=</span><span class="s2">&#34;intel-media-driver !libva-intel-driver&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># config</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## Some variables for system configuration, from timezone, locale and keyboard to the root password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## ROOT_PASSWORD root user password. If &#34;ask&#34; password alis asks for a secure password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">TIMEZONE</span><span class="o">=</span><span class="s2">&#34;/usr/share/zoneinfo/Europe/Madrid&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LOCALES</span><span class="o">=(</span><span class="s2">&#34;es_ES.UTF-8 UTF-8&#34;</span> <span class="s2">&#34;en_US.UTF-8 UTF-8&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LOCALE_CONF</span><span class="o">=(</span><span class="s2">&#34;LANG=es_ES.UTF-8&#34;</span> <span class="s2">&#34;LANGUAGE=es_ES:es:en_US:en&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYMAP</span><span class="o">=</span><span class="s2">&#34;KEYMAP=es&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYLAYOUT</span><span class="o">=</span><span class="s2">&#34;es&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYMODEL</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYVARIANT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">KEYOPTIONS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">FONT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">FONT_MAP</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">HOSTNAME</span><span class="o">=</span><span class="s2">&#34;archlinux&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ROOT_PASSWORD_RETYPE</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># user</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## USER_NAME, USER_PASSWORD Regular user to create in the system. A password must be specified, if &#34;ask&#34; password alis asks for a secure password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## ADDITIONAL_USERS is an array of additional users to create in the system, if &#34;ask&#34; password alis asks for a secure password.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">USER_NAME</span><span class="o">=</span><span class="s2">&#34;picodotdev&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">USER_PASSWORD</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">USER_PASSWORD_RETYPE</span><span class="o">=</span><span class="s2">&#34;ask&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ADDITIONAL_USERS</span><span class="o">=()</span> <span class="c1"># eg. (&#34;user1=password1&#34; &#34;user2=password2&#34;)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1">## systemd-homed (experimental feature)</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### SYSTEMD_HOMED &#34;true&#34; value requires interactivity to set user password</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SYSTEMD_HOMED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SYSTEMD_HOMED_STORAGE</span><span class="o">=</span><span class="s2">&#34;directory !fscrypt !luks !cifs !subvolume&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SYSTEMD_HOMED_CIFS_DOMAIN</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SYSTEMD_HOMED_CIFS_SERVICE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># mkinitcpio</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## HOOKS are the system hooks to execute to build the initial ramdisk.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### Generally, it is not necessary to modify, alis enables or disables some hooks</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### taking in account other variables values like bootloader or device encryption.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">HOOKS</span><span class="o">=</span><span class="s2">&#34;base !udev !usr !resume !systemd !btrfs keyboard autodetect modconf block !net !dmraid !mdadm !mdadm_udev !keymap !consolefont !sd-vconsole !encrypt !lvm2 !sd-encrypt !sd-lvm2 fsck filesystems&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># bootloader</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## BOOTLOADER system boot loader.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">BOOTLOADER</span><span class="o">=</span><span class="s2">&#34;!grub !refind systemd&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># shell</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## CUSTOM_SHELL configures an alternative custom shell interpreter.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">CUSTOM_SHELL</span><span class="o">=</span><span class="s2">&#34;bash !zsh !dash !fish&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># desktop</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## DESKTOP_ENVIRONMENT installs a desktop environment.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DESKTOP_ENVIRONMENT</span><span class="o">=</span><span class="s2">&#34;!gnome !kde !xfce !mate !cinnamon !lxde !i3-wm !i3-gaps&#34;</span> <span class="c1"># (single)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># packages (all multiple)</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## PACKAGES_MULTILIB configures multilib repository for pacman and install multilib packages for display driver</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## PACKAGES_INSTALL installs packages on system installation, edit alis-packages.conf to select packages.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### It is recommended to install packages after base installation and reboot.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PACKAGES_MULTILIB</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PACKAGES_INSTALL</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># misc</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## VAGRANT for build a VirtualBox OVA with Packer</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">VAGRANT</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># systemd</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## SYSTEMD_UNITS systemd units to enable or disable.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### If preceded with a &#34;+&#34; unit is enabled, if preceded with &#34;-&#34; unit is disabled, if preceded with &#34;!&#34; unit is ignored (no action is performed).</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">### eg. &#34;+ufw.service&#34; to enable, &#34;-ufw.service&#34; to disable, &#34;!ufw.service&#34; to ignore</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SYSTEMD_UNITS</span><span class="o">=</span><span class="s2">&#34;!ufw.service !docker.service&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># reboot</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">## REBOOT on installation end reboots the system automatically. If &#34;false&#34; no reboot is performed and the user must do it explicitly.</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">REBOOT</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>alis.conf</span>
    </div>
</div>
<h3 id="capturas-de-diferentes-entornos-de-escritorio-soportados"> Capturas de diferentes entornos de escritorio soportados</h3>
<p>Estas son algunas capturas de pantalla con diferentes entornos de escritorio que he probado con VirtualBox.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-gnome_hu9b320e0da9c3f7b53e055de7bd0dea05_59051_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="GNOME"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-gnome_hu9b320e0da9c3f7b53e055de7bd0dea05_59051_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="GNOME" title="GNOME" class="&#34; " loading="lazy"></a>
<a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-kde_huc1033173311b1fe983324c1eed546025_77308_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="KDE"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-kde_huc1033173311b1fe983324c1eed546025_77308_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="KDE" title="KDE" class="&#34; " loading="lazy"></a></p>
<figcaption>Entornos de escritorio GNOME y KDE</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-xfce_hu207a5cc7835aaa368efdd5626136b4e2_50488_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="XFCE"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-xfce_hu207a5cc7835aaa368efdd5626136b4e2_50488_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="XFCE" title="XFCE" class="&#34; " loading="lazy"></a>
<a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-cinnamon_huada952b2201e9040ea05142b38c6dec4_57971_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="Cinnamon"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-cinnamon_huada952b2201e9040ea05142b38c6dec4_57971_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="Cinnamon" title="Cinnamon" class="&#34; " loading="lazy"></a></p>
<figcaption>Entornos de escritorio Xfce y Cinnamon</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-lxde_huafe9060d5dbd54d661872c90b35b3c3e_60009_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="LXDE"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-lxde_huafe9060d5dbd54d661872c90b35b3c3e_60009_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="LXDE" title="LXDE" class="&#34; " loading="lazy"></a>
<a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-mate_huc99153c03fd4a5e1c154432239083495_26705_2560x1440_fit_q90_h2_box.webp" data-gallery="" title="Mate"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-mate_huc99153c03fd4a5e1c154432239083495_26705_300x200_fit_q90_h2_box.webp" width="267" height="200" alt="Mate" title="Mate" class="&#34; " loading="lazy"></a></p>
<figcaption>Entornos de escritorio LXDE y Mate</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-root-password_hubb5350839af640196e4dc7ade488175e_3831_2560x1440_fit_q90_h2_box_3.webp" data-gallery="" title="Solicitud de contraseña para descifrar partición root"><img src="/blog-bitix/2017/01/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable/images/archlinux-root-password_hubb5350839af640196e4dc7ade488175e_3831_300x200_fit_q90_h2_box_3.webp" width="267" height="200" alt="Solicitud de contraseña para descifrar partición root" title="Solicitud de contraseña para descifrar partición root" class="&#34; " loading="lazy"></a></p>
<figcaption>Solicitud de contraseña para descifrar partición root</figcaption>
</figure>
</div>
<h2 id="vídeo-de-instalación-del-sistema-base-con-alis">Vídeo de instalación del sistema base con alis</h2>
<p>El siguiente vídeo capturado con <a href="https://asciinema.org/">asciinema</a> muestra como utilizando alis se instala Arch Linux en una computadora con el proceso completo de la instalación base del sistema.</p>
<div class="media">
<script type="text/javascript" src="https://asciinema.org/a/418524.js" id="asciicast-418524" async></script>
<noscript><a href="https://asciinema.org/a/418524" target="_blank"><img src="https://asciinema.org/a/418524.png" width="650" height="450"></a></noscript>
</div>
<h2 id="código-fuente-de-alis">Código fuente de alis</h2>
<p>El código del instalador no es muy complicado y mucho más sencillo que otros <em>scripts</em> interactivos similares, al no mezclar los comandos de la instalación con los mensajes interactivos que hacen preguntas y esperan respuestas, además después de configurar las variables e iniciado el proceso de instalación la misma se realiza de forma desatendida hasta completarse sin requerir que el usuario introduzca más datos de forma interactiva.</p>
<p>Los comandos que he recopilado de la receta son los que ejecutaríamos uno detrás de otro partiendo el medio de instalación original de Arch Linux. La función <em>main</em> contiene los pasos en los que consiste la instalación, desde el particionado y cifrado del disco hasta el reinicio una vez completada la instalación, el resto de las funciones los comandos de ese paso de la instalación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">   1&#10;</span><span class="lnt">   2&#10;</span><span class="lnt">   3&#10;</span><span class="lnt">   4&#10;</span><span class="lnt">   5&#10;</span><span class="lnt">   6&#10;</span><span class="lnt">   7&#10;</span><span class="lnt">   8&#10;</span><span class="lnt">   9&#10;</span><span class="lnt">  10&#10;</span><span class="lnt">  11&#10;</span><span class="lnt">  12&#10;</span><span class="lnt">  13&#10;</span><span class="lnt">  14&#10;</span><span class="lnt">  15&#10;</span><span class="lnt">  16&#10;</span><span class="lnt">  17&#10;</span><span class="lnt">  18&#10;</span><span class="lnt">  19&#10;</span><span class="lnt">  20&#10;</span><span class="lnt">  21&#10;</span><span class="lnt">  22&#10;</span><span class="lnt">  23&#10;</span><span class="lnt">  24&#10;</span><span class="lnt">  25&#10;</span><span class="lnt">  26&#10;</span><span class="lnt">  27&#10;</span><span class="lnt">  28&#10;</span><span class="lnt">  29&#10;</span><span class="lnt">  30&#10;</span><span class="lnt">  31&#10;</span><span class="lnt">  32&#10;</span><span class="lnt">  33&#10;</span><span class="lnt">  34&#10;</span><span class="lnt">  35&#10;</span><span class="lnt">  36&#10;</span><span class="lnt">  37&#10;</span><span class="lnt">  38&#10;</span><span class="lnt">  39&#10;</span><span class="lnt">  40&#10;</span><span class="lnt">  41&#10;</span><span class="lnt">  42&#10;</span><span class="lnt">  43&#10;</span><span class="lnt">  44&#10;</span><span class="lnt">  45&#10;</span><span class="lnt">  46&#10;</span><span class="lnt">  47&#10;</span><span class="lnt">  48&#10;</span><span class="lnt">  49&#10;</span><span class="lnt">  50&#10;</span><span class="lnt">  51&#10;</span><span class="lnt">  52&#10;</span><span class="lnt">  53&#10;</span><span class="lnt">  54&#10;</span><span class="lnt">  55&#10;</span><span class="lnt">  56&#10;</span><span class="lnt">  57&#10;</span><span class="lnt">  58&#10;</span><span class="lnt">  59&#10;</span><span class="lnt">  60&#10;</span><span class="lnt">  61&#10;</span><span class="lnt">  62&#10;</span><span class="lnt">  63&#10;</span><span class="lnt">  64&#10;</span><span class="lnt">  65&#10;</span><span class="lnt">  66&#10;</span><span class="lnt">  67&#10;</span><span class="lnt">  68&#10;</span><span class="lnt">  69&#10;</span><span class="lnt">  70&#10;</span><span class="lnt">  71&#10;</span><span class="lnt">  72&#10;</span><span class="lnt">  73&#10;</span><span class="lnt">  74&#10;</span><span class="lnt">  75&#10;</span><span class="lnt">  76&#10;</span><span class="lnt">  77&#10;</span><span class="lnt">  78&#10;</span><span class="lnt">  79&#10;</span><span class="lnt">  80&#10;</span><span class="lnt">  81&#10;</span><span class="lnt">  82&#10;</span><span class="lnt">  83&#10;</span><span class="lnt">  84&#10;</span><span class="lnt">  85&#10;</span><span class="lnt">  86&#10;</span><span class="lnt">  87&#10;</span><span class="lnt">  88&#10;</span><span class="lnt">  89&#10;</span><span class="lnt">  90&#10;</span><span class="lnt">  91&#10;</span><span class="lnt">  92&#10;</span><span class="lnt">  93&#10;</span><span class="lnt">  94&#10;</span><span class="lnt">  95&#10;</span><span class="lnt">  96&#10;</span><span class="lnt">  97&#10;</span><span class="lnt">  98&#10;</span><span class="lnt">  99&#10;</span><span class="lnt"> 100&#10;</span><span class="lnt"> 101&#10;</span><span class="lnt"> 102&#10;</span><span class="lnt"> 103&#10;</span><span class="lnt"> 104&#10;</span><span class="lnt"> 105&#10;</span><span class="lnt"> 106&#10;</span><span class="lnt"> 107&#10;</span><span class="lnt"> 108&#10;</span><span class="lnt"> 109&#10;</span><span class="lnt"> 110&#10;</span><span class="lnt"> 111&#10;</span><span class="lnt"> 112&#10;</span><span class="lnt"> 113&#10;</span><span class="lnt"> 114&#10;</span><span class="lnt"> 115&#10;</span><span class="lnt"> 116&#10;</span><span class="lnt"> 117&#10;</span><span class="lnt"> 118&#10;</span><span class="lnt"> 119&#10;</span><span class="lnt"> 120&#10;</span><span class="lnt"> 121&#10;</span><span class="lnt"> 122&#10;</span><span class="lnt"> 123&#10;</span><span class="lnt"> 124&#10;</span><span class="lnt"> 125&#10;</span><span class="lnt"> 126&#10;</span><span class="lnt"> 127&#10;</span><span class="lnt"> 128&#10;</span><span class="lnt"> 129&#10;</span><span class="lnt"> 130&#10;</span><span class="lnt"> 131&#10;</span><span class="lnt"> 132&#10;</span><span class="lnt"> 133&#10;</span><span class="lnt"> 134&#10;</span><span class="lnt"> 135&#10;</span><span class="lnt"> 136&#10;</span><span class="lnt"> 137&#10;</span><span class="lnt"> 138&#10;</span><span class="lnt"> 139&#10;</span><span class="lnt"> 140&#10;</span><span class="lnt"> 141&#10;</span><span class="lnt"> 142&#10;</span><span class="lnt"> 143&#10;</span><span class="lnt"> 144&#10;</span><span class="lnt"> 145&#10;</span><span class="lnt"> 146&#10;</span><span class="lnt"> 147&#10;</span><span class="lnt"> 148&#10;</span><span class="lnt"> 149&#10;</span><span class="lnt"> 150&#10;</span><span class="lnt"> 151&#10;</span><span class="lnt"> 152&#10;</span><span class="lnt"> 153&#10;</span><span class="lnt"> 154&#10;</span><span class="lnt"> 155&#10;</span><span class="lnt"> 156&#10;</span><span class="lnt"> 157&#10;</span><span class="lnt"> 158&#10;</span><span class="lnt"> 159&#10;</span><span class="lnt"> 160&#10;</span><span class="lnt"> 161&#10;</span><span class="lnt"> 162&#10;</span><span class="lnt"> 163&#10;</span><span class="lnt"> 164&#10;</span><span class="lnt"> 165&#10;</span><span class="lnt"> 166&#10;</span><span class="lnt"> 167&#10;</span><span class="lnt"> 168&#10;</span><span class="lnt"> 169&#10;</span><span class="lnt"> 170&#10;</span><span class="lnt"> 171&#10;</span><span class="lnt"> 172&#10;</span><span class="lnt"> 173&#10;</span><span class="lnt"> 174&#10;</span><span class="lnt"> 175&#10;</span><span class="lnt"> 176&#10;</span><span class="lnt"> 177&#10;</span><span class="lnt"> 178&#10;</span><span class="lnt"> 179&#10;</span><span class="lnt"> 180&#10;</span><span class="lnt"> 181&#10;</span><span class="lnt"> 182&#10;</span><span class="lnt"> 183&#10;</span><span class="lnt"> 184&#10;</span><span class="lnt"> 185&#10;</span><span class="lnt"> 186&#10;</span><span class="lnt"> 187&#10;</span><span class="lnt"> 188&#10;</span><span class="lnt"> 189&#10;</span><span class="lnt"> 190&#10;</span><span class="lnt"> 191&#10;</span><span class="lnt"> 192&#10;</span><span class="lnt"> 193&#10;</span><span class="lnt"> 194&#10;</span><span class="lnt"> 195&#10;</span><span class="lnt"> 196&#10;</span><span class="lnt"> 197&#10;</span><span class="lnt"> 198&#10;</span><span class="lnt"> 199&#10;</span><span class="lnt"> 200&#10;</span><span class="lnt"> 201&#10;</span><span class="lnt"> 202&#10;</span><span class="lnt"> 203&#10;</span><span class="lnt"> 204&#10;</span><span class="lnt"> 205&#10;</span><span class="lnt"> 206&#10;</span><span class="lnt"> 207&#10;</span><span class="lnt"> 208&#10;</span><span class="lnt"> 209&#10;</span><span class="lnt"> 210&#10;</span><span class="lnt"> 211&#10;</span><span class="lnt"> 212&#10;</span><span class="lnt"> 213&#10;</span><span class="lnt"> 214&#10;</span><span class="lnt"> 215&#10;</span><span class="lnt"> 216&#10;</span><span class="lnt"> 217&#10;</span><span class="lnt"> 218&#10;</span><span class="lnt"> 219&#10;</span><span class="lnt"> 220&#10;</span><span class="lnt"> 221&#10;</span><span class="lnt"> 222&#10;</span><span class="lnt"> 223&#10;</span><span class="lnt"> 224&#10;</span><span class="lnt"> 225&#10;</span><span class="lnt"> 226&#10;</span><span class="lnt"> 227&#10;</span><span class="lnt"> 228&#10;</span><span class="lnt"> 229&#10;</span><span class="lnt"> 230&#10;</span><span class="lnt"> 231&#10;</span><span class="lnt"> 232&#10;</span><span class="lnt"> 233&#10;</span><span class="lnt"> 234&#10;</span><span class="lnt"> 235&#10;</span><span class="lnt"> 236&#10;</span><span class="lnt"> 237&#10;</span><span class="lnt"> 238&#10;</span><span class="lnt"> 239&#10;</span><span class="lnt"> 240&#10;</span><span class="lnt"> 241&#10;</span><span class="lnt"> 242&#10;</span><span class="lnt"> 243&#10;</span><span class="lnt"> 244&#10;</span><span class="lnt"> 245&#10;</span><span class="lnt"> 246&#10;</span><span class="lnt"> 247&#10;</span><span class="lnt"> 248&#10;</span><span class="lnt"> 249&#10;</span><span class="lnt"> 250&#10;</span><span class="lnt"> 251&#10;</span><span class="lnt"> 252&#10;</span><span class="lnt"> 253&#10;</span><span class="lnt"> 254&#10;</span><span class="lnt"> 255&#10;</span><span class="lnt"> 256&#10;</span><span class="lnt"> 257&#10;</span><span class="lnt"> 258&#10;</span><span class="lnt"> 259&#10;</span><span class="lnt"> 260&#10;</span><span class="lnt"> 261&#10;</span><span class="lnt"> 262&#10;</span><span class="lnt"> 263&#10;</span><span class="lnt"> 264&#10;</span><span class="lnt"> 265&#10;</span><span class="lnt"> 266&#10;</span><span class="lnt"> 267&#10;</span><span class="lnt"> 268&#10;</span><span class="lnt"> 269&#10;</span><span class="lnt"> 270&#10;</span><span class="lnt"> 271&#10;</span><span class="lnt"> 272&#10;</span><span class="lnt"> 273&#10;</span><span class="lnt"> 274&#10;</span><span class="lnt"> 275&#10;</span><span class="lnt"> 276&#10;</span><span class="lnt"> 277&#10;</span><span class="lnt"> 278&#10;</span><span class="lnt"> 279&#10;</span><span class="lnt"> 280&#10;</span><span class="lnt"> 281&#10;</span><span class="lnt"> 282&#10;</span><span class="lnt"> 283&#10;</span><span class="lnt"> 284&#10;</span><span class="lnt"> 285&#10;</span><span class="lnt"> 286&#10;</span><span class="lnt"> 287&#10;</span><span class="lnt"> 288&#10;</span><span class="lnt"> 289&#10;</span><span class="lnt"> 290&#10;</span><span class="lnt"> 291&#10;</span><span class="lnt"> 292&#10;</span><span class="lnt"> 293&#10;</span><span class="lnt"> 294&#10;</span><span class="lnt"> 295&#10;</span><span class="lnt"> 296&#10;</span><span class="lnt"> 297&#10;</span><span class="lnt"> 298&#10;</span><span class="lnt"> 299&#10;</span><span class="lnt"> 300&#10;</span><span class="lnt"> 301&#10;</span><span class="lnt"> 302&#10;</span><span class="lnt"> 303&#10;</span><span class="lnt"> 304&#10;</span><span class="lnt"> 305&#10;</span><span class="lnt"> 306&#10;</span><span class="lnt"> 307&#10;</span><span class="lnt"> 308&#10;</span><span class="lnt"> 309&#10;</span><span class="lnt"> 310&#10;</span><span class="lnt"> 311&#10;</span><span class="lnt"> 312&#10;</span><span class="lnt"> 313&#10;</span><span class="lnt"> 314&#10;</span><span class="lnt"> 315&#10;</span><span class="lnt"> 316&#10;</span><span class="lnt"> 317&#10;</span><span class="lnt"> 318&#10;</span><span class="lnt"> 319&#10;</span><span class="lnt"> 320&#10;</span><span class="lnt"> 321&#10;</span><span class="lnt"> 322&#10;</span><span class="lnt"> 323&#10;</span><span class="lnt"> 324&#10;</span><span class="lnt"> 325&#10;</span><span class="lnt"> 326&#10;</span><span class="lnt"> 327&#10;</span><span class="lnt"> 328&#10;</span><span class="lnt"> 329&#10;</span><span class="lnt"> 330&#10;</span><span class="lnt"> 331&#10;</span><span class="lnt"> 332&#10;</span><span class="lnt"> 333&#10;</span><span class="lnt"> 334&#10;</span><span class="lnt"> 335&#10;</span><span class="lnt"> 336&#10;</span><span class="lnt"> 337&#10;</span><span class="lnt"> 338&#10;</span><span class="lnt"> 339&#10;</span><span class="lnt"> 340&#10;</span><span class="lnt"> 341&#10;</span><span class="lnt"> 342&#10;</span><span class="lnt"> 343&#10;</span><span class="lnt"> 344&#10;</span><span class="lnt"> 345&#10;</span><span class="lnt"> 346&#10;</span><span class="lnt"> 347&#10;</span><span class="lnt"> 348&#10;</span><span class="lnt"> 349&#10;</span><span class="lnt"> 350&#10;</span><span class="lnt"> 351&#10;</span><span class="lnt"> 352&#10;</span><span class="lnt"> 353&#10;</span><span class="lnt"> 354&#10;</span><span class="lnt"> 355&#10;</span><span class="lnt"> 356&#10;</span><span class="lnt"> 357&#10;</span><span class="lnt"> 358&#10;</span><span class="lnt"> 359&#10;</span><span class="lnt"> 360&#10;</span><span class="lnt"> 361&#10;</span><span class="lnt"> 362&#10;</span><span class="lnt"> 363&#10;</span><span class="lnt"> 364&#10;</span><span class="lnt"> 365&#10;</span><span class="lnt"> 366&#10;</span><span class="lnt"> 367&#10;</span><span class="lnt"> 368&#10;</span><span class="lnt"> 369&#10;</span><span class="lnt"> 370&#10;</span><span class="lnt"> 371&#10;</span><span class="lnt"> 372&#10;</span><span class="lnt"> 373&#10;</span><span class="lnt"> 374&#10;</span><span class="lnt"> 375&#10;</span><span class="lnt"> 376&#10;</span><span class="lnt"> 377&#10;</span><span class="lnt"> 378&#10;</span><span class="lnt"> 379&#10;</span><span class="lnt"> 380&#10;</span><span class="lnt"> 381&#10;</span><span class="lnt"> 382&#10;</span><span class="lnt"> 383&#10;</span><span class="lnt"> 384&#10;</span><span class="lnt"> 385&#10;</span><span class="lnt"> 386&#10;</span><span class="lnt"> 387&#10;</span><span class="lnt"> 388&#10;</span><span class="lnt"> 389&#10;</span><span class="lnt"> 390&#10;</span><span class="lnt"> 391&#10;</span><span class="lnt"> 392&#10;</span><span class="lnt"> 393&#10;</span><span class="lnt"> 394&#10;</span><span class="lnt"> 395&#10;</span><span class="lnt"> 396&#10;</span><span class="lnt"> 397&#10;</span><span class="lnt"> 398&#10;</span><span class="lnt"> 399&#10;</span><span class="lnt"> 400&#10;</span><span class="lnt"> 401&#10;</span><span class="lnt"> 402&#10;</span><span class="lnt"> 403&#10;</span><span class="lnt"> 404&#10;</span><span class="lnt"> 405&#10;</span><span class="lnt"> 406&#10;</span><span class="lnt"> 407&#10;</span><span class="lnt"> 408&#10;</span><span class="lnt"> 409&#10;</span><span class="lnt"> 410&#10;</span><span class="lnt"> 411&#10;</span><span class="lnt"> 412&#10;</span><span class="lnt"> 413&#10;</span><span class="lnt"> 414&#10;</span><span class="lnt"> 415&#10;</span><span class="lnt"> 416&#10;</span><span class="lnt"> 417&#10;</span><span class="lnt"> 418&#10;</span><span class="lnt"> 419&#10;</span><span class="lnt"> 420&#10;</span><span class="lnt"> 421&#10;</span><span class="lnt"> 422&#10;</span><span class="lnt"> 423&#10;</span><span class="lnt"> 424&#10;</span><span class="lnt"> 425&#10;</span><span class="lnt"> 426&#10;</span><span class="lnt"> 427&#10;</span><span class="lnt"> 428&#10;</span><span class="lnt"> 429&#10;</span><span class="lnt"> 430&#10;</span><span class="lnt"> 431&#10;</span><span class="lnt"> 432&#10;</span><span class="lnt"> 433&#10;</span><span class="lnt"> 434&#10;</span><span class="lnt"> 435&#10;</span><span class="lnt"> 436&#10;</span><span class="lnt"> 437&#10;</span><span class="lnt"> 438&#10;</span><span class="lnt"> 439&#10;</span><span class="lnt"> 440&#10;</span><span class="lnt"> 441&#10;</span><span class="lnt"> 442&#10;</span><span class="lnt"> 443&#10;</span><span class="lnt"> 444&#10;</span><span class="lnt"> 445&#10;</span><span class="lnt"> 446&#10;</span><span class="lnt"> 447&#10;</span><span class="lnt"> 448&#10;</span><span class="lnt"> 449&#10;</span><span class="lnt"> 450&#10;</span><span class="lnt"> 451&#10;</span><span class="lnt"> 452&#10;</span><span class="lnt"> 453&#10;</span><span class="lnt"> 454&#10;</span><span class="lnt"> 455&#10;</span><span class="lnt"> 456&#10;</span><span class="lnt"> 457&#10;</span><span class="lnt"> 458&#10;</span><span class="lnt"> 459&#10;</span><span class="lnt"> 460&#10;</span><span class="lnt"> 461&#10;</span><span class="lnt"> 462&#10;</span><span class="lnt"> 463&#10;</span><span class="lnt"> 464&#10;</span><span class="lnt"> 465&#10;</span><span class="lnt"> 466&#10;</span><span class="lnt"> 467&#10;</span><span class="lnt"> 468&#10;</span><span class="lnt"> 469&#10;</span><span class="lnt"> 470&#10;</span><span class="lnt"> 471&#10;</span><span class="lnt"> 472&#10;</span><span class="lnt"> 473&#10;</span><span class="lnt"> 474&#10;</span><span class="lnt"> 475&#10;</span><span class="lnt"> 476&#10;</span><span class="lnt"> 477&#10;</span><span class="lnt"> 478&#10;</span><span class="lnt"> 479&#10;</span><span class="lnt"> 480&#10;</span><span class="lnt"> 481&#10;</span><span class="lnt"> 482&#10;</span><span class="lnt"> 483&#10;</span><span class="lnt"> 484&#10;</span><span class="lnt"> 485&#10;</span><span class="lnt"> 486&#10;</span><span class="lnt"> 487&#10;</span><span class="lnt"> 488&#10;</span><span class="lnt"> 489&#10;</span><span class="lnt"> 490&#10;</span><span class="lnt"> 491&#10;</span><span class="lnt"> 492&#10;</span><span class="lnt"> 493&#10;</span><span class="lnt"> 494&#10;</span><span class="lnt"> 495&#10;</span><span class="lnt"> 496&#10;</span><span class="lnt"> 497&#10;</span><span class="lnt"> 498&#10;</span><span class="lnt"> 499&#10;</span><span class="lnt"> 500&#10;</span><span class="lnt"> 501&#10;</span><span class="lnt"> 502&#10;</span><span class="lnt"> 503&#10;</span><span class="lnt"> 504&#10;</span><span class="lnt"> 505&#10;</span><span class="lnt"> 506&#10;</span><span class="lnt"> 507&#10;</span><span class="lnt"> 508&#10;</span><span class="lnt"> 509&#10;</span><span class="lnt"> 510&#10;</span><span class="lnt"> 511&#10;</span><span class="lnt"> 512&#10;</span><span class="lnt"> 513&#10;</span><span class="lnt"> 514&#10;</span><span class="lnt"> 515&#10;</span><span class="lnt"> 516&#10;</span><span class="lnt"> 517&#10;</span><span class="lnt"> 518&#10;</span><span class="lnt"> 519&#10;</span><span class="lnt"> 520&#10;</span><span class="lnt"> 521&#10;</span><span class="lnt"> 522&#10;</span><span class="lnt"> 523&#10;</span><span class="lnt"> 524&#10;</span><span class="lnt"> 525&#10;</span><span class="lnt"> 526&#10;</span><span class="lnt"> 527&#10;</span><span class="lnt"> 528&#10;</span><span class="lnt"> 529&#10;</span><span class="lnt"> 530&#10;</span><span class="lnt"> 531&#10;</span><span class="lnt"> 532&#10;</span><span class="lnt"> 533&#10;</span><span class="lnt"> 534&#10;</span><span class="lnt"> 535&#10;</span><span class="lnt"> 536&#10;</span><span class="lnt"> 537&#10;</span><span class="lnt"> 538&#10;</span><span class="lnt"> 539&#10;</span><span class="lnt"> 540&#10;</span><span class="lnt"> 541&#10;</span><span class="lnt"> 542&#10;</span><span class="lnt"> 543&#10;</span><span class="lnt"> 544&#10;</span><span class="lnt"> 545&#10;</span><span class="lnt"> 546&#10;</span><span class="lnt"> 547&#10;</span><span class="lnt"> 548&#10;</span><span class="lnt"> 549&#10;</span><span class="lnt"> 550&#10;</span><span class="lnt"> 551&#10;</span><span class="lnt"> 552&#10;</span><span class="lnt"> 553&#10;</span><span class="lnt"> 554&#10;</span><span class="lnt"> 555&#10;</span><span class="lnt"> 556&#10;</span><span class="lnt"> 557&#10;</span><span class="lnt"> 558&#10;</span><span class="lnt"> 559&#10;</span><span class="lnt"> 560&#10;</span><span class="lnt"> 561&#10;</span><span class="lnt"> 562&#10;</span><span class="lnt"> 563&#10;</span><span class="lnt"> 564&#10;</span><span class="lnt"> 565&#10;</span><span class="lnt"> 566&#10;</span><span class="lnt"> 567&#10;</span><span class="lnt"> 568&#10;</span><span class="lnt"> 569&#10;</span><span class="lnt"> 570&#10;</span><span class="lnt"> 571&#10;</span><span class="lnt"> 572&#10;</span><span class="lnt"> 573&#10;</span><span class="lnt"> 574&#10;</span><span class="lnt"> 575&#10;</span><span class="lnt"> 576&#10;</span><span class="lnt"> 577&#10;</span><span class="lnt"> 578&#10;</span><span class="lnt"> 579&#10;</span><span class="lnt"> 580&#10;</span><span class="lnt"> 581&#10;</span><span class="lnt"> 582&#10;</span><span class="lnt"> 583&#10;</span><span class="lnt"> 584&#10;</span><span class="lnt"> 585&#10;</span><span class="lnt"> 586&#10;</span><span class="lnt"> 587&#10;</span><span class="lnt"> 588&#10;</span><span class="lnt"> 589&#10;</span><span class="lnt"> 590&#10;</span><span class="lnt"> 591&#10;</span><span class="lnt"> 592&#10;</span><span class="lnt"> 593&#10;</span><span class="lnt"> 594&#10;</span><span class="lnt"> 595&#10;</span><span class="lnt"> 596&#10;</span><span class="lnt"> 597&#10;</span><span class="lnt"> 598&#10;</span><span class="lnt"> 599&#10;</span><span class="lnt"> 600&#10;</span><span class="lnt"> 601&#10;</span><span class="lnt"> 602&#10;</span><span class="lnt"> 603&#10;</span><span class="lnt"> 604&#10;</span><span class="lnt"> 605&#10;</span><span class="lnt"> 606&#10;</span><span class="lnt"> 607&#10;</span><span class="lnt"> 608&#10;</span><span class="lnt"> 609&#10;</span><span class="lnt"> 610&#10;</span><span class="lnt"> 611&#10;</span><span class="lnt"> 612&#10;</span><span class="lnt"> 613&#10;</span><span class="lnt"> 614&#10;</span><span class="lnt"> 615&#10;</span><span class="lnt"> 616&#10;</span><span class="lnt"> 617&#10;</span><span class="lnt"> 618&#10;</span><span class="lnt"> 619&#10;</span><span class="lnt"> 620&#10;</span><span class="lnt"> 621&#10;</span><span class="lnt"> 622&#10;</span><span class="lnt"> 623&#10;</span><span class="lnt"> 624&#10;</span><span class="lnt"> 625&#10;</span><span class="lnt"> 626&#10;</span><span class="lnt"> 627&#10;</span><span class="lnt"> 628&#10;</span><span class="lnt"> 629&#10;</span><span class="lnt"> 630&#10;</span><span class="lnt"> 631&#10;</span><span class="lnt"> 632&#10;</span><span class="lnt"> 633&#10;</span><span class="lnt"> 634&#10;</span><span class="lnt"> 635&#10;</span><span class="lnt"> 636&#10;</span><span class="lnt"> 637&#10;</span><span class="lnt"> 638&#10;</span><span class="lnt"> 639&#10;</span><span class="lnt"> 640&#10;</span><span class="lnt"> 641&#10;</span><span class="lnt"> 642&#10;</span><span class="lnt"> 643&#10;</span><span class="lnt"> 644&#10;</span><span class="lnt"> 645&#10;</span><span class="lnt"> 646&#10;</span><span class="lnt"> 647&#10;</span><span class="lnt"> 648&#10;</span><span class="lnt"> 649&#10;</span><span class="lnt"> 650&#10;</span><span class="lnt"> 651&#10;</span><span class="lnt"> 652&#10;</span><span class="lnt"> 653&#10;</span><span class="lnt"> 654&#10;</span><span class="lnt"> 655&#10;</span><span class="lnt"> 656&#10;</span><span class="lnt"> 657&#10;</span><span class="lnt"> 658&#10;</span><span class="lnt"> 659&#10;</span><span class="lnt"> 660&#10;</span><span class="lnt"> 661&#10;</span><span class="lnt"> 662&#10;</span><span class="lnt"> 663&#10;</span><span class="lnt"> 664&#10;</span><span class="lnt"> 665&#10;</span><span class="lnt"> 666&#10;</span><span class="lnt"> 667&#10;</span><span class="lnt"> 668&#10;</span><span class="lnt"> 669&#10;</span><span class="lnt"> 670&#10;</span><span class="lnt"> 671&#10;</span><span class="lnt"> 672&#10;</span><span class="lnt"> 673&#10;</span><span class="lnt"> 674&#10;</span><span class="lnt"> 675&#10;</span><span class="lnt"> 676&#10;</span><span class="lnt"> 677&#10;</span><span class="lnt"> 678&#10;</span><span class="lnt"> 679&#10;</span><span class="lnt"> 680&#10;</span><span class="lnt"> 681&#10;</span><span class="lnt"> 682&#10;</span><span class="lnt"> 683&#10;</span><span class="lnt"> 684&#10;</span><span class="lnt"> 685&#10;</span><span class="lnt"> 686&#10;</span><span class="lnt"> 687&#10;</span><span class="lnt"> 688&#10;</span><span class="lnt"> 689&#10;</span><span class="lnt"> 690&#10;</span><span class="lnt"> 691&#10;</span><span class="lnt"> 692&#10;</span><span class="lnt"> 693&#10;</span><span class="lnt"> 694&#10;</span><span class="lnt"> 695&#10;</span><span class="lnt"> 696&#10;</span><span class="lnt"> 697&#10;</span><span class="lnt"> 698&#10;</span><span class="lnt"> 699&#10;</span><span class="lnt"> 700&#10;</span><span class="lnt"> 701&#10;</span><span class="lnt"> 702&#10;</span><span class="lnt"> 703&#10;</span><span class="lnt"> 704&#10;</span><span class="lnt"> 705&#10;</span><span class="lnt"> 706&#10;</span><span class="lnt"> 707&#10;</span><span class="lnt"> 708&#10;</span><span class="lnt"> 709&#10;</span><span class="lnt"> 710&#10;</span><span class="lnt"> 711&#10;</span><span class="lnt"> 712&#10;</span><span class="lnt"> 713&#10;</span><span class="lnt"> 714&#10;</span><span class="lnt"> 715&#10;</span><span class="lnt"> 716&#10;</span><span class="lnt"> 717&#10;</span><span class="lnt"> 718&#10;</span><span class="lnt"> 719&#10;</span><span class="lnt"> 720&#10;</span><span class="lnt"> 721&#10;</span><span class="lnt"> 722&#10;</span><span class="lnt"> 723&#10;</span><span class="lnt"> 724&#10;</span><span class="lnt"> 725&#10;</span><span class="lnt"> 726&#10;</span><span class="lnt"> 727&#10;</span><span class="lnt"> 728&#10;</span><span class="lnt"> 729&#10;</span><span class="lnt"> 730&#10;</span><span class="lnt"> 731&#10;</span><span class="lnt"> 732&#10;</span><span class="lnt"> 733&#10;</span><span class="lnt"> 734&#10;</span><span class="lnt"> 735&#10;</span><span class="lnt"> 736&#10;</span><span class="lnt"> 737&#10;</span><span class="lnt"> 738&#10;</span><span class="lnt"> 739&#10;</span><span class="lnt"> 740&#10;</span><span class="lnt"> 741&#10;</span><span class="lnt"> 742&#10;</span><span class="lnt"> 743&#10;</span><span class="lnt"> 744&#10;</span><span class="lnt"> 745&#10;</span><span class="lnt"> 746&#10;</span><span class="lnt"> 747&#10;</span><span class="lnt"> 748&#10;</span><span class="lnt"> 749&#10;</span><span class="lnt"> 750&#10;</span><span class="lnt"> 751&#10;</span><span class="lnt"> 752&#10;</span><span class="lnt"> 753&#10;</span><span class="lnt"> 754&#10;</span><span class="lnt"> 755&#10;</span><span class="lnt"> 756&#10;</span><span class="lnt"> 757&#10;</span><span class="lnt"> 758&#10;</span><span class="lnt"> 759&#10;</span><span class="lnt"> 760&#10;</span><span class="lnt"> 761&#10;</span><span class="lnt"> 762&#10;</span><span class="lnt"> 763&#10;</span><span class="lnt"> 764&#10;</span><span class="lnt"> 765&#10;</span><span class="lnt"> 766&#10;</span><span class="lnt"> 767&#10;</span><span class="lnt"> 768&#10;</span><span class="lnt"> 769&#10;</span><span class="lnt"> 770&#10;</span><span class="lnt"> 771&#10;</span><span class="lnt"> 772&#10;</span><span class="lnt"> 773&#10;</span><span class="lnt"> 774&#10;</span><span class="lnt"> 775&#10;</span><span class="lnt"> 776&#10;</span><span class="lnt"> 777&#10;</span><span class="lnt"> 778&#10;</span><span class="lnt"> 779&#10;</span><span class="lnt"> 780&#10;</span><span class="lnt"> 781&#10;</span><span class="lnt"> 782&#10;</span><span class="lnt"> 783&#10;</span><span class="lnt"> 784&#10;</span><span class="lnt"> 785&#10;</span><span class="lnt"> 786&#10;</span><span class="lnt"> 787&#10;</span><span class="lnt"> 788&#10;</span><span class="lnt"> 789&#10;</span><span class="lnt"> 790&#10;</span><span class="lnt"> 791&#10;</span><span class="lnt"> 792&#10;</span><span class="lnt"> 793&#10;</span><span class="lnt"> 794&#10;</span><span class="lnt"> 795&#10;</span><span class="lnt"> 796&#10;</span><span class="lnt"> 797&#10;</span><span class="lnt"> 798&#10;</span><span class="lnt"> 799&#10;</span><span class="lnt"> 800&#10;</span><span class="lnt"> 801&#10;</span><span class="lnt"> 802&#10;</span><span class="lnt"> 803&#10;</span><span class="lnt"> 804&#10;</span><span class="lnt"> 805&#10;</span><span class="lnt"> 806&#10;</span><span class="lnt"> 807&#10;</span><span class="lnt"> 808&#10;</span><span class="lnt"> 809&#10;</span><span class="lnt"> 810&#10;</span><span class="lnt"> 811&#10;</span><span class="lnt"> 812&#10;</span><span class="lnt"> 813&#10;</span><span class="lnt"> 814&#10;</span><span class="lnt"> 815&#10;</span><span class="lnt"> 816&#10;</span><span class="lnt"> 817&#10;</span><span class="lnt"> 818&#10;</span><span class="lnt"> 819&#10;</span><span class="lnt"> 820&#10;</span><span class="lnt"> 821&#10;</span><span class="lnt"> 822&#10;</span><span class="lnt"> 823&#10;</span><span class="lnt"> 824&#10;</span><span class="lnt"> 825&#10;</span><span class="lnt"> 826&#10;</span><span class="lnt"> 827&#10;</span><span class="lnt"> 828&#10;</span><span class="lnt"> 829&#10;</span><span class="lnt"> 830&#10;</span><span class="lnt"> 831&#10;</span><span class="lnt"> 832&#10;</span><span class="lnt"> 833&#10;</span><span class="lnt"> 834&#10;</span><span class="lnt"> 835&#10;</span><span class="lnt"> 836&#10;</span><span class="lnt"> 837&#10;</span><span class="lnt"> 838&#10;</span><span class="lnt"> 839&#10;</span><span class="lnt"> 840&#10;</span><span class="lnt"> 841&#10;</span><span class="lnt"> 842&#10;</span><span class="lnt"> 843&#10;</span><span class="lnt"> 844&#10;</span><span class="lnt"> 845&#10;</span><span class="lnt"> 846&#10;</span><span class="lnt"> 847&#10;</span><span class="lnt"> 848&#10;</span><span class="lnt"> 849&#10;</span><span class="lnt"> 850&#10;</span><span class="lnt"> 851&#10;</span><span class="lnt"> 852&#10;</span><span class="lnt"> 853&#10;</span><span class="lnt"> 854&#10;</span><span class="lnt"> 855&#10;</span><span class="lnt"> 856&#10;</span><span class="lnt"> 857&#10;</span><span class="lnt"> 858&#10;</span><span class="lnt"> 859&#10;</span><span class="lnt"> 860&#10;</span><span class="lnt"> 861&#10;</span><span class="lnt"> 862&#10;</span><span class="lnt"> 863&#10;</span><span class="lnt"> 864&#10;</span><span class="lnt"> 865&#10;</span><span class="lnt"> 866&#10;</span><span class="lnt"> 867&#10;</span><span class="lnt"> 868&#10;</span><span class="lnt"> 869&#10;</span><span class="lnt"> 870&#10;</span><span class="lnt"> 871&#10;</span><span class="lnt"> 872&#10;</span><span class="lnt"> 873&#10;</span><span class="lnt"> 874&#10;</span><span class="lnt"> 875&#10;</span><span class="lnt"> 876&#10;</span><span class="lnt"> 877&#10;</span><span class="lnt"> 878&#10;</span><span class="lnt"> 879&#10;</span><span class="lnt"> 880&#10;</span><span class="lnt"> 881&#10;</span><span class="lnt"> 882&#10;</span><span class="lnt"> 883&#10;</span><span class="lnt"> 884&#10;</span><span class="lnt"> 885&#10;</span><span class="lnt"> 886&#10;</span><span class="lnt"> 887&#10;</span><span class="lnt"> 888&#10;</span><span class="lnt"> 889&#10;</span><span class="lnt"> 890&#10;</span><span class="lnt"> 891&#10;</span><span class="lnt"> 892&#10;</span><span class="lnt"> 893&#10;</span><span class="lnt"> 894&#10;</span><span class="lnt"> 895&#10;</span><span class="lnt"> 896&#10;</span><span class="lnt"> 897&#10;</span><span class="lnt"> 898&#10;</span><span class="lnt"> 899&#10;</span><span class="lnt"> 900&#10;</span><span class="lnt"> 901&#10;</span><span class="lnt"> 902&#10;</span><span class="lnt"> 903&#10;</span><span class="lnt"> 904&#10;</span><span class="lnt"> 905&#10;</span><span class="lnt"> 906&#10;</span><span class="lnt"> 907&#10;</span><span class="lnt"> 908&#10;</span><span class="lnt"> 909&#10;</span><span class="lnt"> 910&#10;</span><span class="lnt"> 911&#10;</span><span class="lnt"> 912&#10;</span><span class="lnt"> 913&#10;</span><span class="lnt"> 914&#10;</span><span class="lnt"> 915&#10;</span><span class="lnt"> 916&#10;</span><span class="lnt"> 917&#10;</span><span class="lnt"> 918&#10;</span><span class="lnt"> 919&#10;</span><span class="lnt"> 920&#10;</span><span class="lnt"> 921&#10;</span><span class="lnt"> 922&#10;</span><span class="lnt"> 923&#10;</span><span class="lnt"> 924&#10;</span><span class="lnt"> 925&#10;</span><span class="lnt"> 926&#10;</span><span class="lnt"> 927&#10;</span><span class="lnt"> 928&#10;</span><span class="lnt"> 929&#10;</span><span class="lnt"> 930&#10;</span><span class="lnt"> 931&#10;</span><span class="lnt"> 932&#10;</span><span class="lnt"> 933&#10;</span><span class="lnt"> 934&#10;</span><span class="lnt"> 935&#10;</span><span class="lnt"> 936&#10;</span><span class="lnt"> 937&#10;</span><span class="lnt"> 938&#10;</span><span class="lnt"> 939&#10;</span><span class="lnt"> 940&#10;</span><span class="lnt"> 941&#10;</span><span class="lnt"> 942&#10;</span><span class="lnt"> 943&#10;</span><span class="lnt"> 944&#10;</span><span class="lnt"> 945&#10;</span><span class="lnt"> 946&#10;</span><span class="lnt"> 947&#10;</span><span class="lnt"> 948&#10;</span><span class="lnt"> 949&#10;</span><span class="lnt"> 950&#10;</span><span class="lnt"> 951&#10;</span><span class="lnt"> 952&#10;</span><span class="lnt"> 953&#10;</span><span class="lnt"> 954&#10;</span><span class="lnt"> 955&#10;</span><span class="lnt"> 956&#10;</span><span class="lnt"> 957&#10;</span><span class="lnt"> 958&#10;</span><span class="lnt"> 959&#10;</span><span class="lnt"> 960&#10;</span><span class="lnt"> 961&#10;</span><span class="lnt"> 962&#10;</span><span class="lnt"> 963&#10;</span><span class="lnt"> 964&#10;</span><span class="lnt"> 965&#10;</span><span class="lnt"> 966&#10;</span><span class="lnt"> 967&#10;</span><span class="lnt"> 968&#10;</span><span class="lnt"> 969&#10;</span><span class="lnt"> 970&#10;</span><span class="lnt"> 971&#10;</span><span class="lnt"> 972&#10;</span><span class="lnt"> 973&#10;</span><span class="lnt"> 974&#10;</span><span class="lnt"> 975&#10;</span><span class="lnt"> 976&#10;</span><span class="lnt"> 977&#10;</span><span class="lnt"> 978&#10;</span><span class="lnt"> 979&#10;</span><span class="lnt"> 980&#10;</span><span class="lnt"> 981&#10;</span><span class="lnt"> 982&#10;</span><span class="lnt"> 983&#10;</span><span class="lnt"> 984&#10;</span><span class="lnt"> 985&#10;</span><span class="lnt"> 986&#10;</span><span class="lnt"> 987&#10;</span><span class="lnt"> 988&#10;</span><span class="lnt"> 989&#10;</span><span class="lnt"> 990&#10;</span><span class="lnt"> 991&#10;</span><span class="lnt"> 992&#10;</span><span class="lnt"> 993&#10;</span><span class="lnt"> 994&#10;</span><span class="lnt"> 995&#10;</span><span class="lnt"> 996&#10;</span><span class="lnt"> 997&#10;</span><span class="lnt"> 998&#10;</span><span class="lnt"> 999&#10;</span><span class="lnt">1000&#10;</span><span class="lnt">1001&#10;</span><span class="lnt">1002&#10;</span><span class="lnt">1003&#10;</span><span class="lnt">1004&#10;</span><span class="lnt">1005&#10;</span><span class="lnt">1006&#10;</span><span class="lnt">1007&#10;</span><span class="lnt">1008&#10;</span><span class="lnt">1009&#10;</span><span class="lnt">1010&#10;</span><span class="lnt">1011&#10;</span><span class="lnt">1012&#10;</span><span class="lnt">1013&#10;</span><span class="lnt">1014&#10;</span><span class="lnt">1015&#10;</span><span class="lnt">1016&#10;</span><span class="lnt">1017&#10;</span><span class="lnt">1018&#10;</span><span class="lnt">1019&#10;</span><span class="lnt">1020&#10;</span><span class="lnt">1021&#10;</span><span class="lnt">1022&#10;</span><span class="lnt">1023&#10;</span><span class="lnt">1024&#10;</span><span class="lnt">1025&#10;</span><span class="lnt">1026&#10;</span><span class="lnt">1027&#10;</span><span class="lnt">1028&#10;</span><span class="lnt">1029&#10;</span><span class="lnt">1030&#10;</span><span class="lnt">1031&#10;</span><span class="lnt">1032&#10;</span><span class="lnt">1033&#10;</span><span class="lnt">1034&#10;</span><span class="lnt">1035&#10;</span><span class="lnt">1036&#10;</span><span class="lnt">1037&#10;</span><span class="lnt">1038&#10;</span><span class="lnt">1039&#10;</span><span class="lnt">1040&#10;</span><span class="lnt">1041&#10;</span><span class="lnt">1042&#10;</span><span class="lnt">1043&#10;</span><span class="lnt">1044&#10;</span><span class="lnt">1045&#10;</span><span class="lnt">1046&#10;</span><span class="lnt">1047&#10;</span><span class="lnt">1048&#10;</span><span class="lnt">1049&#10;</span><span class="lnt">1050&#10;</span><span class="lnt">1051&#10;</span><span class="lnt">1052&#10;</span><span class="lnt">1053&#10;</span><span class="lnt">1054&#10;</span><span class="lnt">1055&#10;</span><span class="lnt">1056&#10;</span><span class="lnt">1057&#10;</span><span class="lnt">1058&#10;</span><span class="lnt">1059&#10;</span><span class="lnt">1060&#10;</span><span class="lnt">1061&#10;</span><span class="lnt">1062&#10;</span><span class="lnt">1063&#10;</span><span class="lnt">1064&#10;</span><span class="lnt">1065&#10;</span><span class="lnt">1066&#10;</span><span class="lnt">1067&#10;</span><span class="lnt">1068&#10;</span><span class="lnt">1069&#10;</span><span class="lnt">1070&#10;</span><span class="lnt">1071&#10;</span><span class="lnt">1072&#10;</span><span class="lnt">1073&#10;</span><span class="lnt">1074&#10;</span><span class="lnt">1075&#10;</span><span class="lnt">1076&#10;</span><span class="lnt">1077&#10;</span><span class="lnt">1078&#10;</span><span class="lnt">1079&#10;</span><span class="lnt">1080&#10;</span><span class="lnt">1081&#10;</span><span class="lnt">1082&#10;</span><span class="lnt">1083&#10;</span><span class="lnt">1084&#10;</span><span class="lnt">1085&#10;</span><span class="lnt">1086&#10;</span><span class="lnt">1087&#10;</span><span class="lnt">1088&#10;</span><span class="lnt">1089&#10;</span><span class="lnt">1090&#10;</span><span class="lnt">1091&#10;</span><span class="lnt">1092&#10;</span><span class="lnt">1093&#10;</span><span class="lnt">1094&#10;</span><span class="lnt">1095&#10;</span><span class="lnt">1096&#10;</span><span class="lnt">1097&#10;</span><span class="lnt">1098&#10;</span><span class="lnt">1099&#10;</span><span class="lnt">1100&#10;</span><span class="lnt">1101&#10;</span><span class="lnt">1102&#10;</span><span class="lnt">1103&#10;</span><span class="lnt">1104&#10;</span><span class="lnt">1105&#10;</span><span class="lnt">1106&#10;</span><span class="lnt">1107&#10;</span><span class="lnt">1108&#10;</span><span class="lnt">1109&#10;</span><span class="lnt">1110&#10;</span><span class="lnt">1111&#10;</span><span class="lnt">1112&#10;</span><span class="lnt">1113&#10;</span><span class="lnt">1114&#10;</span><span class="lnt">1115&#10;</span><span class="lnt">1116&#10;</span><span class="lnt">1117&#10;</span><span class="lnt">1118&#10;</span><span class="lnt">1119&#10;</span><span class="lnt">1120&#10;</span><span class="lnt">1121&#10;</span><span class="lnt">1122&#10;</span><span class="lnt">1123&#10;</span><span class="lnt">1124&#10;</span><span class="lnt">1125&#10;</span><span class="lnt">1126&#10;</span><span class="lnt">1127&#10;</span><span class="lnt">1128&#10;</span><span class="lnt">1129&#10;</span><span class="lnt">1130&#10;</span><span class="lnt">1131&#10;</span><span class="lnt">1132&#10;</span><span class="lnt">1133&#10;</span><span class="lnt">1134&#10;</span><span class="lnt">1135&#10;</span><span class="lnt">1136&#10;</span><span class="lnt">1137&#10;</span><span class="lnt">1138&#10;</span><span class="lnt">1139&#10;</span><span class="lnt">1140&#10;</span><span class="lnt">1141&#10;</span><span class="lnt">1142&#10;</span><span class="lnt">1143&#10;</span><span class="lnt">1144&#10;</span><span class="lnt">1145&#10;</span><span class="lnt">1146&#10;</span><span class="lnt">1147&#10;</span><span class="lnt">1148&#10;</span><span class="lnt">1149&#10;</span><span class="lnt">1150&#10;</span><span class="lnt">1151&#10;</span><span class="lnt">1152&#10;</span><span class="lnt">1153&#10;</span><span class="lnt">1154&#10;</span><span class="lnt">1155&#10;</span><span class="lnt">1156&#10;</span><span class="lnt">1157&#10;</span><span class="lnt">1158&#10;</span><span class="lnt">1159&#10;</span><span class="lnt">1160&#10;</span><span class="lnt">1161&#10;</span><span class="lnt">1162&#10;</span><span class="lnt">1163&#10;</span><span class="lnt">1164&#10;</span><span class="lnt">1165&#10;</span><span class="lnt">1166&#10;</span><span class="lnt">1167&#10;</span><span class="lnt">1168&#10;</span><span class="lnt">1169&#10;</span><span class="lnt">1170&#10;</span><span class="lnt">1171&#10;</span><span class="lnt">1172&#10;</span><span class="lnt">1173&#10;</span><span class="lnt">1174&#10;</span><span class="lnt">1175&#10;</span><span class="lnt">1176&#10;</span><span class="lnt">1177&#10;</span><span class="lnt">1178&#10;</span><span class="lnt">1179&#10;</span><span class="lnt">1180&#10;</span><span class="lnt">1181&#10;</span><span class="lnt">1182&#10;</span><span class="lnt">1183&#10;</span><span class="lnt">1184&#10;</span><span class="lnt">1185&#10;</span><span class="lnt">1186&#10;</span><span class="lnt">1187&#10;</span><span class="lnt">1188&#10;</span><span class="lnt">1189&#10;</span><span class="lnt">1190&#10;</span><span class="lnt">1191&#10;</span><span class="lnt">1192&#10;</span><span class="lnt">1193&#10;</span><span class="lnt">1194&#10;</span><span class="lnt">1195&#10;</span><span class="lnt">1196&#10;</span><span class="lnt">1197&#10;</span><span class="lnt">1198&#10;</span><span class="lnt">1199&#10;</span><span class="lnt">1200&#10;</span><span class="lnt">1201&#10;</span><span class="lnt">1202&#10;</span><span class="lnt">1203&#10;</span><span class="lnt">1204&#10;</span><span class="lnt">1205&#10;</span><span class="lnt">1206&#10;</span><span class="lnt">1207&#10;</span><span class="lnt">1208&#10;</span><span class="lnt">1209&#10;</span><span class="lnt">1210&#10;</span><span class="lnt">1211&#10;</span><span class="lnt">1212&#10;</span><span class="lnt">1213&#10;</span><span class="lnt">1214&#10;</span><span class="lnt">1215&#10;</span><span class="lnt">1216&#10;</span><span class="lnt">1217&#10;</span><span class="lnt">1218&#10;</span><span class="lnt">1219&#10;</span><span class="lnt">1220&#10;</span><span class="lnt">1221&#10;</span><span class="lnt">1222&#10;</span><span class="lnt">1223&#10;</span><span class="lnt">1224&#10;</span><span class="lnt">1225&#10;</span><span class="lnt">1226&#10;</span><span class="lnt">1227&#10;</span><span class="lnt">1228&#10;</span><span class="lnt">1229&#10;</span><span class="lnt">1230&#10;</span><span class="lnt">1231&#10;</span><span class="lnt">1232&#10;</span><span class="lnt">1233&#10;</span><span class="lnt">1234&#10;</span><span class="lnt">1235&#10;</span><span class="lnt">1236&#10;</span><span class="lnt">1237&#10;</span><span class="lnt">1238&#10;</span><span class="lnt">1239&#10;</span><span class="lnt">1240&#10;</span><span class="lnt">1241&#10;</span><span class="lnt">1242&#10;</span><span class="lnt">1243&#10;</span><span class="lnt">1244&#10;</span><span class="lnt">1245&#10;</span><span class="lnt">1246&#10;</span><span class="lnt">1247&#10;</span><span class="lnt">1248&#10;</span><span class="lnt">1249&#10;</span><span class="lnt">1250&#10;</span><span class="lnt">1251&#10;</span><span class="lnt">1252&#10;</span><span class="lnt">1253&#10;</span><span class="lnt">1254&#10;</span><span class="lnt">1255&#10;</span><span class="lnt">1256&#10;</span><span class="lnt">1257&#10;</span><span class="lnt">1258&#10;</span><span class="lnt">1259&#10;</span><span class="lnt">1260&#10;</span><span class="lnt">1261&#10;</span><span class="lnt">1262&#10;</span><span class="lnt">1263&#10;</span><span class="lnt">1264&#10;</span><span class="lnt">1265&#10;</span><span class="lnt">1266&#10;</span><span class="lnt">1267&#10;</span><span class="lnt">1268&#10;</span><span class="lnt">1269&#10;</span><span class="lnt">1270&#10;</span><span class="lnt">1271&#10;</span><span class="lnt">1272&#10;</span><span class="lnt">1273&#10;</span><span class="lnt">1274&#10;</span><span class="lnt">1275&#10;</span><span class="lnt">1276&#10;</span><span class="lnt">1277&#10;</span><span class="lnt">1278&#10;</span><span class="lnt">1279&#10;</span><span class="lnt">1280&#10;</span><span class="lnt">1281&#10;</span><span class="lnt">1282&#10;</span><span class="lnt">1283&#10;</span><span class="lnt">1284&#10;</span><span class="lnt">1285&#10;</span><span class="lnt">1286&#10;</span><span class="lnt">1287&#10;</span><span class="lnt">1288&#10;</span><span class="lnt">1289&#10;</span><span class="lnt">1290&#10;</span><span class="lnt">1291&#10;</span><span class="lnt">1292&#10;</span><span class="lnt">1293&#10;</span><span class="lnt">1294&#10;</span><span class="lnt">1295&#10;</span><span class="lnt">1296&#10;</span><span class="lnt">1297&#10;</span><span class="lnt">1298&#10;</span><span class="lnt">1299&#10;</span><span class="lnt">1300&#10;</span><span class="lnt">1301&#10;</span><span class="lnt">1302&#10;</span><span class="lnt">1303&#10;</span><span class="lnt">1304&#10;</span><span class="lnt">1305&#10;</span><span class="lnt">1306&#10;</span><span class="lnt">1307&#10;</span><span class="lnt">1308&#10;</span><span class="lnt">1309&#10;</span><span class="lnt">1310&#10;</span><span class="lnt">1311&#10;</span><span class="lnt">1312&#10;</span><span class="lnt">1313&#10;</span><span class="lnt">1314&#10;</span><span class="lnt">1315&#10;</span><span class="lnt">1316&#10;</span><span class="lnt">1317&#10;</span><span class="lnt">1318&#10;</span><span class="lnt">1319&#10;</span><span class="lnt">1320&#10;</span><span class="lnt">1321&#10;</span><span class="lnt">1322&#10;</span><span class="lnt">1323&#10;</span><span class="lnt">1324&#10;</span><span class="lnt">1325&#10;</span><span class="lnt">1326&#10;</span><span class="lnt">1327&#10;</span><span class="lnt">1328&#10;</span><span class="lnt">1329&#10;</span><span class="lnt">1330&#10;</span><span class="lnt">1331&#10;</span><span class="lnt">1332&#10;</span><span class="lnt">1333&#10;</span><span class="lnt">1334&#10;</span><span class="lnt">1335&#10;</span><span class="lnt">1336&#10;</span><span class="lnt">1337&#10;</span><span class="lnt">1338&#10;</span><span class="lnt">1339&#10;</span><span class="lnt">1340&#10;</span><span class="lnt">1341&#10;</span><span class="lnt">1342&#10;</span><span class="lnt">1343&#10;</span><span class="lnt">1344&#10;</span><span class="lnt">1345&#10;</span><span class="lnt">1346&#10;</span><span class="lnt">1347&#10;</span><span class="lnt">1348&#10;</span><span class="lnt">1349&#10;</span><span class="lnt">1350&#10;</span><span class="lnt">1351&#10;</span><span class="lnt">1352&#10;</span><span class="lnt">1353&#10;</span><span class="lnt">1354&#10;</span><span class="lnt">1355&#10;</span><span class="lnt">1356&#10;</span><span class="lnt">1357&#10;</span><span class="lnt">1358&#10;</span><span class="lnt">1359&#10;</span><span class="lnt">1360&#10;</span><span class="lnt">1361&#10;</span><span class="lnt">1362&#10;</span><span class="lnt">1363&#10;</span><span class="lnt">1364&#10;</span><span class="lnt">1365&#10;</span><span class="lnt">1366&#10;</span><span class="lnt">1367&#10;</span><span class="lnt">1368&#10;</span><span class="lnt">1369&#10;</span><span class="lnt">1370&#10;</span><span class="lnt">1371&#10;</span><span class="lnt">1372&#10;</span><span class="lnt">1373&#10;</span><span class="lnt">1374&#10;</span><span class="lnt">1375&#10;</span><span class="lnt">1376&#10;</span><span class="lnt">1377&#10;</span><span class="lnt">1378&#10;</span><span class="lnt">1379&#10;</span><span class="lnt">1380&#10;</span><span class="lnt">1381&#10;</span><span class="lnt">1382&#10;</span><span class="lnt">1383&#10;</span><span class="lnt">1384&#10;</span><span class="lnt">1385&#10;</span><span class="lnt">1386&#10;</span><span class="lnt">1387&#10;</span><span class="lnt">1388&#10;</span><span class="lnt">1389&#10;</span><span class="lnt">1390&#10;</span><span class="lnt">1391&#10;</span><span class="lnt">1392&#10;</span><span class="lnt">1393&#10;</span><span class="lnt">1394&#10;</span><span class="lnt">1395&#10;</span><span class="lnt">1396&#10;</span><span class="lnt">1397&#10;</span><span class="lnt">1398&#10;</span><span class="lnt">1399&#10;</span><span class="lnt">1400&#10;</span><span class="lnt">1401&#10;</span><span class="lnt">1402&#10;</span><span class="lnt">1403&#10;</span><span class="lnt">1404&#10;</span><span class="lnt">1405&#10;</span><span class="lnt">1406&#10;</span><span class="lnt">1407&#10;</span><span class="lnt">1408&#10;</span><span class="lnt">1409&#10;</span><span class="lnt">1410&#10;</span><span class="lnt">1411&#10;</span><span class="lnt">1412&#10;</span><span class="lnt">1413&#10;</span><span class="lnt">1414&#10;</span><span class="lnt">1415&#10;</span><span class="lnt">1416&#10;</span><span class="lnt">1417&#10;</span><span class="lnt">1418&#10;</span><span class="lnt">1419&#10;</span><span class="lnt">1420&#10;</span><span class="lnt">1421&#10;</span><span class="lnt">1422&#10;</span><span class="lnt">1423&#10;</span><span class="lnt">1424&#10;</span><span class="lnt">1425&#10;</span><span class="lnt">1426&#10;</span><span class="lnt">1427&#10;</span><span class="lnt">1428&#10;</span><span class="lnt">1429&#10;</span><span class="lnt">1430&#10;</span><span class="lnt">1431&#10;</span><span class="lnt">1432&#10;</span><span class="lnt">1433&#10;</span><span class="lnt">1434&#10;</span><span class="lnt">1435&#10;</span><span class="lnt">1436&#10;</span><span class="lnt">1437&#10;</span><span class="lnt">1438&#10;</span><span class="lnt">1439&#10;</span><span class="lnt">1440&#10;</span><span class="lnt">1441&#10;</span><span class="lnt">1442&#10;</span><span class="lnt">1443&#10;</span><span class="lnt">1444&#10;</span><span class="lnt">1445&#10;</span><span class="lnt">1446&#10;</span><span class="lnt">1447&#10;</span><span class="lnt">1448&#10;</span><span class="lnt">1449&#10;</span><span class="lnt">1450&#10;</span><span class="lnt">1451&#10;</span><span class="lnt">1452&#10;</span><span class="lnt">1453&#10;</span><span class="lnt">1454&#10;</span><span class="lnt">1455&#10;</span><span class="lnt">1456&#10;</span><span class="lnt">1457&#10;</span><span class="lnt">1458&#10;</span><span class="lnt">1459&#10;</span><span class="lnt">1460&#10;</span><span class="lnt">1461&#10;</span><span class="lnt">1462&#10;</span><span class="lnt">1463&#10;</span><span class="lnt">1464&#10;</span><span class="lnt">1465&#10;</span><span class="lnt">1466&#10;</span><span class="lnt">1467&#10;</span><span class="lnt">1468&#10;</span><span class="lnt">1469&#10;</span><span class="lnt">1470&#10;</span><span class="lnt">1471&#10;</span><span class="lnt">1472&#10;</span><span class="lnt">1473&#10;</span><span class="lnt">1474&#10;</span><span class="lnt">1475&#10;</span><span class="lnt">1476&#10;</span><span class="lnt">1477&#10;</span><span class="lnt">1478&#10;</span><span class="lnt">1479&#10;</span><span class="lnt">1480&#10;</span><span class="lnt">1481&#10;</span><span class="lnt">1482&#10;</span><span class="lnt">1483&#10;</span><span class="lnt">1484&#10;</span><span class="lnt">1485&#10;</span><span class="lnt">1486&#10;</span><span class="lnt">1487&#10;</span><span class="lnt">1488&#10;</span><span class="lnt">1489&#10;</span><span class="lnt">1490&#10;</span><span class="lnt">1491&#10;</span><span class="lnt">1492&#10;</span><span class="lnt">1493&#10;</span><span class="lnt">1494&#10;</span><span class="lnt">1495&#10;</span><span class="lnt">1496&#10;</span><span class="lnt">1497&#10;</span><span class="lnt">1498&#10;</span><span class="lnt">1499&#10;</span><span class="lnt">1500&#10;</span><span class="lnt">1501&#10;</span><span class="lnt">1502&#10;</span><span class="lnt">1503&#10;</span><span class="lnt">1504&#10;</span><span class="lnt">1505&#10;</span><span class="lnt">1506&#10;</span><span class="lnt">1507&#10;</span><span class="lnt">1508&#10;</span><span class="lnt">1509&#10;</span><span class="lnt">1510&#10;</span><span class="lnt">1511&#10;</span><span class="lnt">1512&#10;</span><span class="lnt">1513&#10;</span><span class="lnt">1514&#10;</span><span class="lnt">1515&#10;</span><span class="lnt">1516&#10;</span><span class="lnt">1517&#10;</span><span class="lnt">1518&#10;</span><span class="lnt">1519&#10;</span><span class="lnt">1520&#10;</span><span class="lnt">1521&#10;</span><span class="lnt">1522&#10;</span><span class="lnt">1523&#10;</span><span class="lnt">1524&#10;</span><span class="lnt">1525&#10;</span><span class="lnt">1526&#10;</span><span class="lnt">1527&#10;</span><span class="lnt">1528&#10;</span><span class="lnt">1529&#10;</span><span class="lnt">1530&#10;</span><span class="lnt">1531&#10;</span><span class="lnt">1532&#10;</span><span class="lnt">1533&#10;</span><span class="lnt">1534&#10;</span><span class="lnt">1535&#10;</span><span class="lnt">1536&#10;</span><span class="lnt">1537&#10;</span><span class="lnt">1538&#10;</span><span class="lnt">1539&#10;</span><span class="lnt">1540&#10;</span><span class="lnt">1541&#10;</span><span class="lnt">1542&#10;</span><span class="lnt">1543&#10;</span><span class="lnt">1544&#10;</span><span class="lnt">1545&#10;</span><span class="lnt">1546&#10;</span><span class="lnt">1547&#10;</span><span class="lnt">1548&#10;</span><span class="lnt">1549&#10;</span><span class="lnt">1550&#10;</span><span class="lnt">1551&#10;</span><span class="lnt">1552&#10;</span><span class="lnt">1553&#10;</span><span class="lnt">1554&#10;</span><span class="lnt">1555&#10;</span><span class="lnt">1556&#10;</span><span class="lnt">1557&#10;</span><span class="lnt">1558&#10;</span><span class="lnt">1559&#10;</span><span class="lnt">1560&#10;</span><span class="lnt">1561&#10;</span><span class="lnt">1562&#10;</span><span class="lnt">1563&#10;</span><span class="lnt">1564&#10;</span><span class="lnt">1565&#10;</span><span class="lnt">1566&#10;</span><span class="lnt">1567&#10;</span><span class="lnt">1568&#10;</span><span class="lnt">1569&#10;</span><span class="lnt">1570&#10;</span><span class="lnt">1571&#10;</span><span class="lnt">1572&#10;</span><span class="lnt">1573&#10;</span><span class="lnt">1574&#10;</span><span class="lnt">1575&#10;</span><span class="lnt">1576&#10;</span><span class="lnt">1577&#10;</span><span class="lnt">1578&#10;</span><span class="lnt">1579&#10;</span><span class="lnt">1580&#10;</span><span class="lnt">1581&#10;</span><span class="lnt">1582&#10;</span><span class="lnt">1583&#10;</span><span class="lnt">1584&#10;</span><span class="lnt">1585&#10;</span><span class="lnt">1586&#10;</span><span class="lnt">1587&#10;</span><span class="lnt">1588&#10;</span><span class="lnt">1589&#10;</span><span class="lnt">1590&#10;</span><span class="lnt">1591&#10;</span><span class="lnt">1592&#10;</span><span class="lnt">1593&#10;</span><span class="lnt">1594&#10;</span><span class="lnt">1595&#10;</span><span class="lnt">1596&#10;</span><span class="lnt">1597&#10;</span><span class="lnt">1598&#10;</span><span class="lnt">1599&#10;</span><span class="lnt">1600&#10;</span><span class="lnt">1601&#10;</span><span class="lnt">1602&#10;</span><span class="lnt">1603&#10;</span><span class="lnt">1604&#10;</span><span class="lnt">1605&#10;</span><span class="lnt">1606&#10;</span><span class="lnt">1607&#10;</span><span class="lnt">1608&#10;</span><span class="lnt">1609&#10;</span><span class="lnt">1610&#10;</span><span class="lnt">1611&#10;</span><span class="lnt">1612&#10;</span><span class="lnt">1613&#10;</span><span class="lnt">1614&#10;</span><span class="lnt">1615&#10;</span><span class="lnt">1616&#10;</span><span class="lnt">1617&#10;</span><span class="lnt">1618&#10;</span><span class="lnt">1619&#10;</span><span class="lnt">1620&#10;</span><span class="lnt">1621&#10;</span><span class="lnt">1622&#10;</span><span class="lnt">1623&#10;</span><span class="lnt">1624&#10;</span><span class="lnt">1625&#10;</span><span class="lnt">1626&#10;</span><span class="lnt">1627&#10;</span><span class="lnt">1628&#10;</span><span class="lnt">1629&#10;</span><span class="lnt">1630&#10;</span><span class="lnt">1631&#10;</span><span class="lnt">1632&#10;</span><span class="lnt">1633&#10;</span><span class="lnt">1634&#10;</span><span class="lnt">1635&#10;</span><span class="lnt">1636&#10;</span><span class="lnt">1637&#10;</span><span class="lnt">1638&#10;</span><span class="lnt">1639&#10;</span><span class="lnt">1640&#10;</span><span class="lnt">1641&#10;</span><span class="lnt">1642&#10;</span><span class="lnt">1643&#10;</span><span class="lnt">1644&#10;</span><span class="lnt">1645&#10;</span><span class="lnt">1646&#10;</span><span class="lnt">1647&#10;</span><span class="lnt">1648&#10;</span><span class="lnt">1649&#10;</span><span class="lnt">1650&#10;</span><span class="lnt">1651&#10;</span><span class="lnt">1652&#10;</span><span class="lnt">1653&#10;</span><span class="lnt">1654&#10;</span><span class="lnt">1655&#10;</span><span class="lnt">1656&#10;</span><span class="lnt">1657&#10;</span><span class="lnt">1658&#10;</span><span class="lnt">1659&#10;</span><span class="lnt">1660&#10;</span><span class="lnt">1661&#10;</span><span class="lnt">1662&#10;</span><span class="lnt">1663&#10;</span><span class="lnt">1664&#10;</span><span class="lnt">1665&#10;</span><span class="lnt">1666&#10;</span><span class="lnt">1667&#10;</span><span class="lnt">1668&#10;</span><span class="lnt">1669&#10;</span><span class="lnt">1670&#10;</span><span class="lnt">1671&#10;</span><span class="lnt">1672&#10;</span><span class="lnt">1673&#10;</span><span class="lnt">1674&#10;</span><span class="lnt">1675&#10;</span><span class="lnt">1676&#10;</span><span class="lnt">1677&#10;</span><span class="lnt">1678&#10;</span><span class="lnt">1679&#10;</span><span class="lnt">1680&#10;</span><span class="lnt">1681&#10;</span><span class="lnt">1682&#10;</span><span class="lnt">1683&#10;</span><span class="lnt">1684&#10;</span><span class="lnt">1685&#10;</span><span class="lnt">1686&#10;</span><span class="lnt">1687&#10;</span><span class="lnt">1688&#10;</span><span class="lnt">1689&#10;</span><span class="lnt">1690&#10;</span><span class="lnt">1691&#10;</span><span class="lnt">1692&#10;</span><span class="lnt">1693&#10;</span><span class="lnt">1694&#10;</span><span class="lnt">1695&#10;</span><span class="lnt">1696&#10;</span><span class="lnt">1697&#10;</span><span class="lnt">1698&#10;</span><span class="lnt">1699&#10;</span><span class="lnt">1700&#10;</span><span class="lnt">1701&#10;</span><span class="lnt">1702&#10;</span><span class="lnt">1703&#10;</span><span class="lnt">1704&#10;</span><span class="lnt">1705&#10;</span><span class="lnt">1706&#10;</span><span class="lnt">1707&#10;</span><span class="lnt">1708&#10;</span><span class="lnt">1709&#10;</span><span class="lnt">1710&#10;</span><span class="lnt">1711&#10;</span><span class="lnt">1712&#10;</span><span class="lnt">1713&#10;</span><span class="lnt">1714&#10;</span><span class="lnt">1715&#10;</span><span class="lnt">1716&#10;</span><span class="lnt">1717&#10;</span><span class="lnt">1718&#10;</span><span class="lnt">1719&#10;</span><span class="lnt">1720&#10;</span><span class="lnt">1721&#10;</span><span class="lnt">1722&#10;</span><span class="lnt">1723&#10;</span><span class="lnt">1724&#10;</span><span class="lnt">1725&#10;</span><span class="lnt">1726&#10;</span><span class="lnt">1727&#10;</span><span class="lnt">1728&#10;</span><span class="lnt">1729&#10;</span><span class="lnt">1730&#10;</span><span class="lnt">1731&#10;</span><span class="lnt">1732&#10;</span><span class="lnt">1733&#10;</span><span class="lnt">1734&#10;</span><span class="lnt">1735&#10;</span><span class="lnt">1736&#10;</span><span class="lnt">1737&#10;</span><span class="lnt">1738&#10;</span><span class="lnt">1739&#10;</span><span class="lnt">1740&#10;</span><span class="lnt">1741&#10;</span><span class="lnt">1742&#10;</span><span class="lnt">1743&#10;</span><span class="lnt">1744&#10;</span><span class="lnt">1745&#10;</span><span class="lnt">1746&#10;</span><span class="lnt">1747&#10;</span><span class="lnt">1748&#10;</span><span class="lnt">1749&#10;</span><span class="lnt">1750&#10;</span><span class="lnt">1751&#10;</span><span class="lnt">1752&#10;</span><span class="lnt">1753&#10;</span><span class="lnt">1754&#10;</span><span class="lnt">1755&#10;</span><span class="lnt">1756&#10;</span><span class="lnt">1757&#10;</span><span class="lnt">1758&#10;</span><span class="lnt">1759&#10;</span><span class="lnt">1760&#10;</span><span class="lnt">1761&#10;</span><span class="lnt">1762&#10;</span><span class="lnt">1763&#10;</span><span class="lnt">1764&#10;</span><span class="lnt">1765&#10;</span><span class="lnt">1766&#10;</span><span class="lnt">1767&#10;</span><span class="lnt">1768&#10;</span><span class="lnt">1769&#10;</span><span class="lnt">1770&#10;</span><span class="lnt">1771&#10;</span><span class="lnt">1772&#10;</span><span class="lnt">1773&#10;</span><span class="lnt">1774&#10;</span><span class="lnt">1775&#10;</span><span class="lnt">1776&#10;</span><span class="lnt">1777&#10;</span><span class="lnt">1778&#10;</span><span class="lnt">1779&#10;</span><span class="lnt">1780&#10;</span><span class="lnt">1781&#10;</span><span class="lnt">1782&#10;</span><span class="lnt">1783&#10;</span><span class="lnt">1784&#10;</span><span class="lnt">1785&#10;</span><span class="lnt">1786&#10;</span><span class="lnt">1787&#10;</span><span class="lnt">1788&#10;</span><span class="lnt">1789&#10;</span><span class="lnt">1790&#10;</span><span class="lnt">1791&#10;</span><span class="lnt">1792&#10;</span><span class="lnt">1793&#10;</span><span class="lnt">1794&#10;</span><span class="lnt">1795&#10;</span><span class="lnt">1796&#10;</span><span class="lnt">1797&#10;</span><span class="lnt">1798&#10;</span><span class="lnt">1799&#10;</span><span class="lnt">1800&#10;</span><span class="lnt">1801&#10;</span><span class="lnt">1802&#10;</span><span class="lnt">1803&#10;</span><span class="lnt">1804&#10;</span><span class="lnt">1805&#10;</span><span class="lnt">1806&#10;</span><span class="lnt">1807&#10;</span><span class="lnt">1808&#10;</span><span class="lnt">1809&#10;</span><span class="lnt">1810&#10;</span><span class="lnt">1811&#10;</span><span class="lnt">1812&#10;</span><span class="lnt">1813&#10;</span><span class="lnt">1814&#10;</span><span class="lnt">1815&#10;</span><span class="lnt">1816&#10;</span><span class="lnt">1817&#10;</span><span class="lnt">1818&#10;</span><span class="lnt">1819&#10;</span><span class="lnt">1820&#10;</span><span class="lnt">1821&#10;</span><span class="lnt">1822&#10;</span><span class="lnt">1823&#10;</span><span class="lnt">1824&#10;</span><span class="lnt">1825&#10;</span><span class="lnt">1826&#10;</span><span class="lnt">1827&#10;</span><span class="lnt">1828&#10;</span><span class="lnt">1829&#10;</span><span class="lnt">1830&#10;</span><span class="lnt">1831&#10;</span><span class="lnt">1832&#10;</span><span class="lnt">1833&#10;</span><span class="lnt">1834&#10;</span><span class="lnt">1835&#10;</span><span class="lnt">1836&#10;</span><span class="lnt">1837&#10;</span><span class="lnt">1838&#10;</span><span class="lnt">1839&#10;</span><span class="lnt">1840&#10;</span><span class="lnt">1841&#10;</span><span class="lnt">1842&#10;</span><span class="lnt">1843&#10;</span><span class="lnt">1844&#10;</span><span class="lnt">1845&#10;</span><span class="lnt">1846&#10;</span><span class="lnt">1847&#10;</span><span class="lnt">1848&#10;</span><span class="lnt">1849&#10;</span><span class="lnt">1850&#10;</span><span class="lnt">1851&#10;</span><span class="lnt">1852&#10;</span><span class="lnt">1853&#10;</span><span class="lnt">1854&#10;</span><span class="lnt">1855&#10;</span><span class="lnt">1856&#10;</span><span class="lnt">1857&#10;</span><span class="lnt">1858&#10;</span><span class="lnt">1859&#10;</span><span class="lnt">1860&#10;</span><span class="lnt">1861&#10;</span><span class="lnt">1862&#10;</span><span class="lnt">1863&#10;</span><span class="lnt">1864&#10;</span><span class="lnt">1865&#10;</span><span class="lnt">1866&#10;</span><span class="lnt">1867&#10;</span><span class="lnt">1868&#10;</span><span class="lnt">1869&#10;</span><span class="lnt">1870&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Arch Linux Install Script (alis) installs unattended, automated</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># and customized Arch Linux system.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Copyright (C) 2021 picodotdev</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># This program is free software: you can redistribute it and/or modify</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># it under the terms of the GNU General Public License as published by</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># (at your option) any later version.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># This program is distributed in the hope that it will be useful,</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># GNU General Public License for more details.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># You should have received a copy of the GNU General Public License</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># This script is hosted at https://github.com/picodotdev/alis. For new features,</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># improvements and bugs fill an issue in GitHub or make a pull request.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Pull Request are welcome!</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># If you test it in real hardware please send me an email to pico.dev@gmail.com with</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># the machine description and tell me if somethig goes wrong or all works fine.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Please, don&#39;t ask for support for this script in Arch Linux forums, first read</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># the Arch Linux wiki [1], the Installation Guide [2] and the General</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Recomendations [3], later compare the commands with those of this script.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># [1] https://wiki.archlinux.org</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># [2] https://wiki.archlinux.org/index.php/Installation_guide</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># [3] https://wiki.archlinux.org/index.php/General_recommendations</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># Usage:</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># # loadkeys es</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># # iwctl --passphrase &#34;[WIFI_KEY]&#34; station [WIFI_INTERFACE] connect &#34;[WIFI_ESSID]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  # (Optional) Connect to WIFI network. _ip link show_ to know WIFI_INTERFACE.</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># # curl https://raw.githubusercontent.com/picodotdev/alis/master/download.sh | bash, curl https://raw.githubusercontent.com/picodotdev/alis/master/download.sh | bash -s -- -u [github user], or with URL shortener curl -sL https://bit.ly/2F3CATp | bash</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># # vim alis.conf</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># # ./alis.sh</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="c1"># global variables (no configuration, don&#39;t edit)</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ASCIINEMA</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">BIOS_TYPE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_BOOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTITION_ROOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_LVM</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LUKS_DEVICE_NAME</span><span class="o">=</span><span class="s2">&#34;cryptroot&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LVM_VOLUME_GROUP</span><span class="o">=</span><span class="s2">&#34;vg&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LVM_VOLUME_LOGICAL</span><span class="o">=</span><span class="s2">&#34;root&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">SWAPFILE</span><span class="o">=</span><span class="s2">&#34;/swapfile&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">BOOT_DIRECTORY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ESP_DIRECTORY</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#PARTITION_BOOT_NUMBER=0</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">UUID_BOOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">UUID_ROOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTUUID_BOOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">PARTUUID_ROOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_SATA</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_NVME</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">DEVICE_MMC</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">CPU_VENDOR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">VIRTUALBOX</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">CMDLINE_LINUX_ROOT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nv">CONF_FILE</span><span class="o">=</span><span class="s2">&#34;alis.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">GLOBALS_FILE</span><span class="o">=</span><span class="s2">&#34;alis-globals.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&#34;alis.log&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">ASCIINEMA_FILE</span><span class="o">=</span><span class="s2">&#34;alis.asciinema&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">LIGHT_BLUE</span><span class="o">=</span><span class="s1">&#39;\033[1;34m&#39;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> configuration_install<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">source</span> <span class="s2">&#34;</span><span class="nv">$CONF_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> sanitize_variables<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$DEVICE</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_MODE</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_CUSTOM_PARTED_UEFI</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_UEFI</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_CUSTOM_PARTED_BIOS</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_BIOS</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_CUSTOMMANUAL_BOOT</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_BOOT</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_CUSTOMMANUAL_ROOT</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_ROOT</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FILE_SYSTEM_TYPE</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SWAP_SIZE</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$SWAP_SIZE</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">KERNELS</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$KERNELS</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">KERNELS_COMPRESSION</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_HOMED_STORAGE</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BOOTLOADER</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$BOOTLOADER</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$CUSTOM_SHELL</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DESKTOP_ENVIRONMENT</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$DESKTOP_ENVIRONMENT</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DISPLAY_DRIVER</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_UNITS</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$SYSTEMD_UNITS</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> sanitize_variable<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VARIABLE</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VARIABLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$VARIABLE</span> <span class="p">|</span> sed <span class="s2">&#34;s/![^ ]*//g&#34;</span><span class="k">)</span> <span class="c1"># remove disabled</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VARIABLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$VARIABLE</span> <span class="p">|</span> sed <span class="s2">&#34;s/ {2,}/ /g&#34;</span><span class="k">)</span> <span class="c1"># remove unnecessary white spaces</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VARIABLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$VARIABLE</span> <span class="p">|</span> sed <span class="s1">&#39;s/^[[:space:]]*//&#39;</span><span class="k">)</span> <span class="c1"># trim leading</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VARIABLE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$VARIABLE</span> <span class="p">|</span> sed <span class="s1">&#39;s/[[:space:]]*$//&#39;</span><span class="k">)</span> <span class="c1"># trim trailing</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$VARIABLE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;KEYS&#34;</span> <span class="s2">&#34;</span><span class="nv">$KEYS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;LOG&#34;</span> <span class="s2">&#34;</span><span class="nv">$LOG</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;DEVICE&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;DEVICE_TRIM&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_TRIM</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;LVM&#34;</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_equals <span class="s2">&#34;LUKS_PASSWORD&#34;</span> <span class="s2">&#34;LUKS_PASSWORD_RETYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD_RETYPE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;FILE_SYSTEM_TYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="s2">&#34;ext4 btrfs xfs f2fs reiserfs&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;PARTITION_MODE&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="s2">&#34;auto custom manual&#34;</span> <span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;custom&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PARTITION_CUSTOM_PARTED_UEFI&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_UEFI</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PARTITION_CUSTOM_PARTED_BIOS&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_BIOS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;custom&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;manual&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PARTITION_CUSTOMMANUAL_BOOT&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_BOOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PARTITION_CUSTOMMANUAL_ROOT&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;PARTITION_MODE&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="s2">&#34;auto&#34;</span> <span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_equals <span class="s2">&#34;WIFI_KEY&#34;</span> <span class="s2">&#34;WIFI_KEY_RETYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$WIFI_KEY</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$WIFI_KEY_RETYPE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PING_HOSTNAME&#34;</span> <span class="s2">&#34;</span><span class="nv">$PING_HOSTNAME</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PACMAN_MIRROR&#34;</span> <span class="s2">&#34;</span><span class="nv">$PACMAN_MIRROR</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;KERNELS&#34;</span> <span class="s2">&#34;</span><span class="nv">$KERNELS</span><span class="s2">&#34;</span> <span class="s2">&#34;linux-lts linux-lts-headers linux-hardened linux-hardened-headers linux-zen linux-zen-headers&#34;</span> <span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;KERNELS_COMPRESSION&#34;</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="s2">&#34;gzip bzip2 lzma xz lzop lz4 zstd&#34;</span> <span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;DISPLAY_DRIVER&#34;</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> <span class="s2">&#34;intel amdgpu ati nvidia nvidia-lts nvidia-dkms nvidia-390xx nvidia-390xx-lts nvidia-390xx-dkms nouveau&#34;</span> <span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;KMS&#34;</span> <span class="s2">&#34;</span><span class="nv">$KMS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;FASTBOOT&#34;</span> <span class="s2">&#34;</span><span class="nv">$FASTBOOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;FRAMEBUFFER_COMPRESSION&#34;</span> <span class="s2">&#34;</span><span class="nv">$FRAMEBUFFER_COMPRESSION</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;DISPLAY_DRIVER_DDX&#34;</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_DDX</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;DISPLAY_DRIVER_HARDWARE_ACCELERATION&#34;</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL&#34;</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span><span class="s2">&#34;</span> <span class="s2">&#34;intel-media-driver libva-intel-driver&#34;</span> <span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;TIMEZONE&#34;</span> <span class="s2">&#34;</span><span class="nv">$TIMEZONE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;REFLECTOR&#34;</span> <span class="s2">&#34;</span><span class="nv">$REFLECTOR</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;PACMAN_MIRROR&#34;</span> <span class="s2">&#34;</span><span class="nv">$PACMAN_MIRROR</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;LOCALES&#34;</span> <span class="s2">&#34;</span><span class="nv">$LOCALES</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;LOCALE_CONF&#34;</span> <span class="s2">&#34;</span><span class="nv">$LOCALE_CONF</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;LANG&#34;</span> <span class="s2">&#34;</span><span class="nv">$LANG</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;KEYMAP&#34;</span> <span class="s2">&#34;</span><span class="nv">$KEYMAP</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;HOSTNAME&#34;</span> <span class="s2">&#34;</span><span class="nv">$HOSTNAME</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;USER_NAME&#34;</span> <span class="s2">&#34;</span><span class="nv">$USER_NAME</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;USER_PASSWORD&#34;</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_equals <span class="s2">&#34;ROOT_PASSWORD&#34;</span> <span class="s2">&#34;ROOT_PASSWORD_RETYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD_RETYPE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_equals <span class="s2">&#34;USER_PASSWORD&#34;</span> <span class="s2">&#34;USER_PASSWORD_RETYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD_RETYPE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;SYSTEMD_HOMED&#34;</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;SYSTEMD_HOMED_STORAGE&#34;</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="s2">&#34;directory fscrypt luks cifs subvolume&#34;</span> <span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;fscrypt&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;FILE_SYSTEM_TYPE&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="s2">&#34;ext4 f2fs&#34;</span> <span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;cifs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;SYSTEMD_HOMED_CIFS_DOMAIN&#34;</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_CIFS_DOMAIN</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;SYSTEMD_HOMED_CIFS_SERVICE&#34;</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_CIFS_SERVICE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;HOOKS&#34;</span> <span class="s2">&#34;</span><span class="nv">$HOOKS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;BOOTLOADER&#34;</span> <span class="s2">&#34;</span><span class="nv">$BOOTLOADER</span><span class="s2">&#34;</span> <span class="s2">&#34;grub refind systemd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;CUSTOM_SHELL&#34;</span> <span class="s2">&#34;</span><span class="nv">$CUSTOM_SHELL</span><span class="s2">&#34;</span> <span class="s2">&#34;bash zsh dash fish&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;DESKTOP_ENVIRONMENT&#34;</span> <span class="s2">&#34;</span><span class="nv">$DESKTOP_ENVIRONMENT</span><span class="s2">&#34;</span> <span class="s2">&#34;gnome kde xfce mate cinnamon lxde i3-wm i3-gaps&#34;</span> <span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;PACKAGES_MULTILIB&#34;</span> <span class="s2">&#34;</span><span class="nv">$PACKAGES_MULTILIB</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;PACKAGES_INSTALL&#34;</span> <span class="s2">&#34;</span><span class="nv">$PACKAGES_INSTALL</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;VAGRANT&#34;</span> <span class="s2">&#34;</span><span class="nv">$VAGRANT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_boolean <span class="s2">&#34;REBOOT&#34;</span> <span class="s2">&#34;</span><span class="nv">$REBOOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables_value<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$VALUE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$NAME</span><span class="s2"> environment variable must have a value.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables_boolean<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;</span><span class="nv">$NAME</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$VALUE</span><span class="s2">&#34;</span> <span class="s2">&#34;true false&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables_list<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUES</span><span class="o">=</span><span class="nv">$3</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REQUIRED</span><span class="o">=</span><span class="nv">$4</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$REQUIRED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$REQUIRED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_value <span class="s2">&#34;</span><span class="nv">$NAME</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$VALUE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VALUE</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;&#34;</span> -a -z <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$VALUES</span><span class="s2">&#34;</span> <span class="p">|</span> grep -F -w <span class="s2">&#34;</span><span class="nv">$VALUE</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$NAME</span><span class="s2"> environment variable value [</span><span class="nv">$VALUE</span><span class="s2">] must be in [</span><span class="nv">$VALUES</span><span class="s2">].&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables_equals<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME1</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME2</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE1</span><span class="o">=</span><span class="nv">$3</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE2</span><span class="o">=</span><span class="nv">$4</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VALUE1</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$VALUE2</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$NAME1</span><span class="s2"> and </span><span class="nv">$NAME2</span><span class="s2"> must be equal [</span><span class="nv">$VALUE1</span><span class="s2">, </span><span class="nv">$VALUE2</span><span class="s2">].&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_variables_size<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">NAME</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SIZE_EXPECT</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SIZE</span><span class="o">=</span><span class="nv">$3</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SIZE_EXPECT</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$SIZE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$NAME</span><span class="s2"> array size [</span><span class="nv">$SIZE</span><span class="s2">] must be [</span><span class="nv">$SIZE_EXPECT</span><span class="s2">].&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> warning<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LIGHT_BLUE</span><span class="si">}</span><span class="s2">Welcome to Arch Linux Install Script</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Warning&#34;</span><span class="s1">&#39;!&#39;</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">This script deletes all partitions of the persistent</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">storage and continuing all your data in it will be lost.</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -p <span class="s2">&#34;Do you want to continue? [y/N] &#34;</span> yn&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="nv">$yn</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[</span>Yy<span class="o">]</span>* <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[</span>Nn<span class="o">]</span>* <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> init<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;init()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;init_log&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;loadkeys <span class="nv">$KEYS</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> init_log<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LOG</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exec</span> &gt; &gt;<span class="o">(</span>tee -a <span class="nv">$LOG_FILE</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exec</span> 2&gt; &gt;<span class="o">(</span>tee -a <span class="nv">$LOG_FILE</span> &gt;<span class="p">&amp;</span>2<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> -o xtrace&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> facts<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;facts()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -d /sys/firmware/efi <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BIOS_TYPE</span><span class="o">=</span><span class="s2">&#34;uefi&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BIOS_TYPE</span><span class="o">=</span><span class="s2">&#34;bios&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$ASCIINEMA_FILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ASCIINEMA</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ASCIINEMA</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_SATA</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_NVME</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_MMC</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$DEVICE</span> <span class="p">|</span> grep <span class="s2">&#34;^/dev/[a-z]d[a-z]&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_SATA</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$DEVICE</span> <span class="p">|</span> grep <span class="s2">&#34;^/dev/nvme&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_NVME</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$DEVICE</span> <span class="p">|</span> grep <span class="s2">&#34;^/dev/mmc&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_MMC</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span>lscpu <span class="p">|</span> grep GenuineIntel<span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CPU_VENDOR</span><span class="o">=</span><span class="s2">&#34;intel&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span>lscpu <span class="p">|</span> grep AuthenticAMD<span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CPU_VENDOR</span><span class="o">=</span><span class="s2">&#34;amd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="k">$(</span>lspci <span class="p">|</span> grep -i virtualbox<span class="k">)</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VIRTUALBOX</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> checks<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;checks()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;check_facts&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> check_facts<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bios&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check_variables_list <span class="s2">&#34;BOOTLOADER&#34;</span> <span class="s2">&#34;</span><span class="nv">$BOOTLOADER</span><span class="s2">&#34;</span> <span class="s2">&#34;grub&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> prepare<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;prepare()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;configure_reflector&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;configure_time&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;prepare_partition&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ask_passwords&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;configure_network&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> configure_reflector<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$REFLECTOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;false&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;systemctl stop reflector.service&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> configure_time<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;timedatectl set-ntp <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> prepare_partition<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -d /mnt/boot <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umount /mnt/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umount /mnt&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -e <span class="s2">&#34;/dev/mapper/</span><span class="nv">$LVM_VOLUME_GROUP</span><span class="s2">-</span><span class="nv">$LVM_VOLUME_LOGICAL</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umount <span class="s2">&#34;/dev/mapper/</span><span class="nv">$LVM_VOLUME_GROUP</span><span class="s2">-</span><span class="nv">$LVM_VOLUME_LOGICAL</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -e <span class="s2">&#34;/dev/mapper/</span><span class="nv">$LUKS_DEVICE_NAME</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cryptsetup close <span class="nv">$LUKS_DEVICE_NAME</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> ask_passwords<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;ask&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_TYPED</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Type LUKS password: &#39;</span> LUKS_PASSWORD&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Retype LUKS password: &#39;</span> LUKS_PASSWORD_RETYPE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD_RETYPE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;LUKS password don&#39;t match. Please, type again.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$WIFI_INTERFACE</span><span class="s2">&#34;</span> -a <span class="s2">&#34;</span><span class="nv">$WIFI_KEY</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;ask&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_TYPED</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Type WIFI key: &#39;</span> WIFI_KEY&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Retype WIFI key: &#39;</span> WIFI_KEY_RETYPE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$WIFI_KEY</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$WIFI_KEY_RETYPE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;WIFI key don&#39;t match. Please, type again.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;ask&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_TYPED</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Type root password: &#39;</span> ROOT_PASSWORD&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Retype root password: &#39;</span> ROOT_PASSWORD_RETYPE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD_RETYPE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Root password don&#39;t match. Please, type again.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;ask&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_TYPED</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Type user password: &#39;</span> USER_PASSWORD&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s1">&#39;Retype user password: &#39;</span> USER_PASSWORD_RETYPE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD_RETYPE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;User password don&#39;t match. Please, type again.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> I in <span class="si">${</span><span class="p">!ADDITIONAL_USERS[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">VALUE</span><span class="o">=</span><span class="si">${</span><span class="nv">ADDITIONAL_USERS</span><span class="p">[</span><span class="si">${</span><span class="nv">I</span><span class="si">}</span><span class="p">]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;=&#39;</span> <span class="nv">S</span><span class="o">=(</span><span class="nv">$VALUE</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="si">${</span><span class="nv">S</span><span class="p">[0]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD</span><span class="o">=</span><span class="si">${</span><span class="nv">S</span><span class="p">[1]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_RETYPE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;ask&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_TYPED</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s2">&#34;Type user (</span><span class="nv">$USER</span><span class="s2">) password: &#34;</span> PASSWORD&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -sp <span class="s2">&#34;Retype user (</span><span class="nv">$USER</span><span class="s2">) password: &#34;</span> PASSWORD_RETYPE&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD_RETYPE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD_TYPED</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADDITIONAL_USERS<span class="o">[</span><span class="si">${</span><span class="nv">I</span><span class="si">}</span><span class="o">]=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">=</span><span class="si">${</span><span class="nv">PASSWORD</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;User (</span><span class="nv">$USER</span><span class="s2">) password don&#39;t match. Please, type again.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> configure_network<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$WIFI_INTERFACE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iwctl --passphrase <span class="s2">&#34;</span><span class="nv">$WIFI_KEY</span><span class="s2">&#34;</span> station <span class="nv">$WIFI_INTERFACE</span> connect <span class="s2">&#34;</span><span class="nv">$WIFI_ESSID</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep <span class="m">10</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># only one ping -c 1, ping gets stuck if -c 5</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;ping -c <span class="m">1</span> -i <span class="m">2</span> -W <span class="m">5</span> -w <span class="m">30</span> <span class="nv">$PING_HOSTNAME</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Network ping check failed. Cannot continue.&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> partition<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;partition()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;partprobe <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># setup</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;auto&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_FILE_SYSTEM_TYPE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_PARTED_FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;f2fs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_FILE_SYSTEM_TYPE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_UEFI</span><span class="o">=</span><span class="s2">&#34;mklabel gpt mkpart ESP fat32 1MiB 512MiB mkpart root </span><span class="nv">$PARTITION_PARTED_FILE_SYSTEM_TYPE</span><span class="s2"> 512MiB 100% set 1 esp on&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_BIOS</span><span class="o">=</span><span class="s2">&#34;mklabel msdos mkpart primary ext4 4MiB 512MiB mkpart primary </span><span class="nv">$PARTITION_PARTED_FILE_SYSTEM_TYPE</span><span class="s2"> 512MiB 100% set 1 boot on&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;uefi&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_SATA</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_NVME</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_MMC</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bios&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_SATA</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_NVME</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_MMC</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2">p2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;custom&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_UEFI</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_UEFI</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_PARTED_BIOS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOM_PARTED_BIOS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;custom&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;manual&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_BOOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_CUSTOMMANUAL_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_ROOT</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_BOOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_BOOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">sda</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_BOOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">nvme0n1p</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_BOOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_BOOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">mmcblk0p</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_ROOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">sda</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_ROOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">nvme0n1p</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_ROOT_NUMBER</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">PARTITION_ROOT_NUMBER</span><span class="p">//</span><span class="se">\/</span><span class="nv">dev</span><span class="se">\/</span><span class="nv">mmcblk0p</span><span class="p">/</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># partition</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;auto&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sgdisk --zap-all <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wipefs -a -f <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partprobe <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;auto&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$PARTITION_MODE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;custom&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;uefi&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parted -s <span class="nv">$DEVICE</span> <span class="nv">$PARTITION_PARTED_UEFI</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sgdisk -t<span class="o">=</span><span class="nv">$PARTITION_ROOT_NUMBER</span>:8309 <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sgdisk -t<span class="o">=</span><span class="nv">$PARTITION_ROOT_NUMBER</span>:8e00 <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bios&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parted -s <span class="nv">$DEVICE</span> <span class="nv">$PARTITION_PARTED_BIOS</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partprobe <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># luks and lvm</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="p">|</span> cryptsetup --key-size<span class="o">=</span><span class="m">512</span> --key-file<span class="o">=</span>- luksFormat --type luks2 <span class="nv">$PARTITION_ROOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="p">|</span> cryptsetup --key-file<span class="o">=</span>- open <span class="nv">$PARTITION_ROOT</span> <span class="nv">$LUKS_DEVICE_NAME</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep <span class="m">5</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_LVM</span><span class="o">=</span><span class="s2">&#34;/dev/mapper/</span><span class="nv">$LUKS_DEVICE_NAME</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_LVM</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pvcreate <span class="nv">$DEVICE_LVM</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vgcreate <span class="nv">$LVM_VOLUME_GROUP</span> <span class="nv">$DEVICE_LVM</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lvcreate -l 100%FREE -n <span class="nv">$LVM_VOLUME_LOGICAL</span> <span class="nv">$LVM_VOLUME_GROUP</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;/dev/mapper/</span><span class="nv">$LUKS_DEVICE_NAME</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">DEVICE_ROOT</span><span class="o">=</span><span class="s2">&#34;/dev/mapper/</span><span class="nv">$LVM_VOLUME_GROUP</span><span class="s2">-</span><span class="nv">$LVM_VOLUME_LOGICAL</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># format</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;wipefs -a -f <span class="nv">$PARTITION_BOOT</span> <span class="o">||</span> <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;wipefs -a -f <span class="nv">$DEVICE_ROOT</span> <span class="o">||</span> <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;uefi&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.fat -n ESP -F32 <span class="nv">$PARTITION_BOOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bios&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.ext4 -L boot <span class="nv">$PARTITION_BOOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;f2fs&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;reiserfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.<span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> -l root <span class="nv">$DEVICE_ROOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkfs.<span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> -L root <span class="nv">$DEVICE_ROOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># options</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_OPTIONS_BOOT</span><span class="o">=</span><span class="s2">&#34;defaults&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_OPTIONS_ROOT</span><span class="o">=</span><span class="s2">&#34;defaults&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_TRIM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_OPTIONS_BOOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_BOOT</span><span class="s2">,noatime&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_OPTIONS_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">,noatime&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;f2fs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTITION_OPTIONS_ROOT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">,nodiscard&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># mount</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;btrfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btrfs subvolume create /mnt/root&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btrfs subvolume create /mnt/home&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btrfs subvolume create /mnt/var&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btrfs subvolume create /mnt/snapshots&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umount /mnt&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;subvol=root,</span><span class="nv">$PARTITION_OPTIONS</span><span class="s2">,compress=zstd&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir /mnt/<span class="o">{</span>boot,home,var,snapshots<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_BOOT</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_BOOT</span><span class="s2">&#34;</span> /mnt/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;subvol=home,</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">,compress=zstd&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt/home&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;subvol=var,</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">,compress=zstd&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt/var&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;subvol=snapshots,</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">,compress=zstd&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt/snapshots&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_ROOT</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span> /mnt&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir /mnt/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mount -o <span class="s2">&#34;</span><span class="nv">$PARTITION_OPTIONS_BOOT</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$PARTITION_BOOT</span><span class="s2">&#34;</span> /mnt/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># swap</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SWAP_SIZE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;btrfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truncate -s <span class="m">0</span> /mnt<span class="nv">$SWAPFILE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chattr +C /mnt<span class="nv">$SWAPFILE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btrfs property <span class="nb">set</span> /mnt<span class="nv">$SWAPFILE</span> compression none&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/mnt<span class="nv">$SWAPFILE</span> <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="nv">$SWAP_SIZE</span> <span class="nv">status</span><span class="o">=</span>progress&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod <span class="m">600</span> /mnt<span class="nv">$SWAPFILE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkswap /mnt<span class="nv">$SWAPFILE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># set variables</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BOOT_DIRECTORY</span><span class="o">=</span>/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ESP_DIRECTORY</span><span class="o">=</span>/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UUID_BOOT</span><span class="o">=</span><span class="k">$(</span>blkid -s UUID -o value <span class="nv">$PARTITION_BOOT</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UUID_ROOT</span><span class="o">=</span><span class="k">$(</span>blkid -s UUID -o value <span class="nv">$PARTITION_ROOT</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTUUID_BOOT</span><span class="o">=</span><span class="k">$(</span>blkid -s PARTUUID -o value <span class="nv">$PARTITION_BOOT</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PARTUUID_ROOT</span><span class="o">=</span><span class="k">$(</span>blkid -s PARTUUID -o value <span class="nv">$PARTITION_ROOT</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> install<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;install()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$PACMAN_MIRROR</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Server = </span><span class="nv">$PACMAN_MIRROR</span><span class="s2">&#34;</span> &gt; /etc/pacman.d/mirrorlist&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$REFLECTOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">COUNTRIES</span><span class="o">=()</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> COUNTRY in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">REFLECTOR_COUNTRIES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">COUNTRIES</span><span class="o">+=(</span>--country <span class="s2">&#34;</span><span class="si">${</span><span class="nv">COUNTRY</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman -Sy --noconfirm reflector&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflector <span class="s2">&#34;</span><span class="si">${</span><span class="nv">COUNTRIES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span> --latest <span class="m">25</span> --age <span class="m">24</span> --protocol https --completion-percent <span class="m">100</span> --sort rate --save /etc/pacman.d/mirrorlist&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/#Color/Color/&#39;</span> /etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/#ParallelDownloads/ParallelDownloads/&#39;</span> /etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacstrap /mnt base base-devel linux linux-firmware&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/#Color/Color/&#39;</span> /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/#ParallelDownloads/ParallelDownloads/&#39;</span> /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PACKAGES_MULTILIB</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;[multilib]&#34;</span> &gt;&gt; /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Include = /etc/pacman.d/mirrorlist&#34;</span> &gt;&gt; /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; /mnt/etc/pacman.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> configuration<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;configuration()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;genfstab -U /mnt &gt;&gt; /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SWAP_SIZE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;# swap&#34;</span> &gt;&gt; /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$SWAPFILE</span><span class="s2"> none swap defaults 0 0&#34;</span> &gt;&gt; /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_TRIM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;f2fs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/relatime/noatime,nodiscard/&#39;</span> /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s1">&#39;s/relatime/noatime/&#39;</span> /mnt/etc/fstab&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> fstrim.timer&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt ln -s -f <span class="nv">$TIMEZONE</span> /etc/localtime&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt hwclock --systohc&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> LOCALE in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LOCALES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/#</span><span class="nv">$LOCALE</span><span class="s2">/</span><span class="nv">$LOCALE</span><span class="s2">/&#34;</span> /etc/locale.gen&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/#</span><span class="nv">$LOCALE</span><span class="s2">/</span><span class="nv">$LOCALE</span><span class="s2">/&#34;</span> /mnt/etc/locale.gen&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> VARIABLE in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LOCALE_CONF</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">#localectl set-locale &#34;$VARIABLE&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="nv">$VARIABLE</span><span class="s2">&#34;</span> &gt;&gt; /mnt/etc/locale.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;locale-gen&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt locale-gen&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="nv">$KEYMAP</span><span class="s2">\n</span><span class="nv">$FONT</span><span class="s2">\n</span><span class="nv">$FONT_MAP</span><span class="s2">&#34;</span> &gt; /mnt/etc/vconsole.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="nv">$HOSTNAME</span> &gt; /mnt/etc/hostname&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KEYLAYOUT</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span><span class="s1">$&#39;\n&#39;</span><span class="s2">&#34;&nbsp;&nbsp;&nbsp;&nbsp;Option \&#34;XkbLayout\&#34; \&#34;</span><span class="nv">$KEYLAYOUT</span><span class="s2">\&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KEYMODEL</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span><span class="s1">$&#39;\n&#39;</span><span class="s2">&#34;&nbsp;&nbsp;&nbsp;&nbsp;Option \&#34;XkbModel\&#34; \&#34;</span><span class="nv">$KEYMODEL</span><span class="s2">\&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KEYVARIANT</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span><span class="s1">$&#39;\n&#39;</span><span class="s2">&#34;&nbsp;&nbsp;&nbsp;&nbsp;Option \&#34;XkbVariant\&#34; \&#34;</span><span class="nv">$KEYVARIANT</span><span class="s2">\&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KEYOPTIONS</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span><span class="s1">$&#39;\n&#39;</span><span class="s2">&#34;&nbsp;&nbsp;&nbsp;&nbsp;Option \&#34;XkbOptions\&#34; \&#34;</span><span class="nv">$KEYOPTIONS</span><span class="s2">\&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt mkdir -p <span class="s2">&#34;/etc/X11/xorg.conf.d/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; /mnt/etc/X11/xorg.conf.d/00-keyboard.conf&#10;</span></span></span><span class="line"><span class="cl"><span class="s"># Written by systemd-localed(8), read by systemd-localed and Xorg. It&#39;s&#10;</span></span></span><span class="line"><span class="cl"><span class="s"># probably wise not to edit this file manually. Use localectl(1) to&#10;</span></span></span><span class="line"><span class="cl"><span class="s"># instruct systemd-localed to update it.&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Section &#34;InputClass&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;Identifier &#34;system-keyboard&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;MatchIsKeyboard &#34;on&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;$OPTIONS&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EndSection&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SWAP_SIZE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;vm.swappiness=10&#34;</span> &gt; /mnt/etc/sysctl.d/99-sysctl.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">printf</span> <span class="s2">&#34;</span><span class="nv">$ROOT_PASSWORD</span><span class="s2">\n</span><span class="nv">$ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="p">|</span> arch-chroot /mnt passwd&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> mkinitcpio_configuration<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;mkinitcpio_configuration()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KMS</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;intel&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;i915&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-lts&#34;</span>  <span class="p">|</span> <span class="s2">&#34;nvidia-dkms&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-390xx&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-390xx-lts&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-390xx-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;nvidia nvidia_modeset nvidia_uvm nvidia_drm&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;amdgpu&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;amdgpu&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;ati&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;radeon&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nouveau&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">MODULES</span><span class="o">=</span><span class="s2">&#34;nouveau&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s2">&#34;s/^MODULES=()/MODULES=(</span><span class="nv">$MODULES</span><span class="s2">)/&#34;</span> /etc/mkinitcpio.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;intel&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FASTBOOT</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2"> fastboot=1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FRAMEBUFFER_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2"> enable_fbc=1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span><span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options i915 </span><span class="nv">$OPTIONS</span><span class="s2">&#34;</span> &gt; /mnt/etc/modprobe.d/i915.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;lvm2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;btrfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;btrfs-progs&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;f2fs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;f2fs-tools&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;reiserfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;reiserfsprogs&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BOOTLOADER</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;systemd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!systemd/systemd/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!sd-vconsole/sd-vconsole/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!sd-lvm2/sd-lvm2/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!sd-encrypt/sd-encrypt/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!udev/udev/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!usr/usr/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!keymap/keymap/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!consolefont/consolefont/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!lvm2/lvm2/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$HOOKS</span> <span class="p">|</span> sed <span class="s1">&#39;s/!encrypt/encrypt/&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOOKS</span><span class="o">=</span><span class="k">$(</span>sanitize_variable <span class="s2">&#34;</span><span class="nv">$HOOKS</span><span class="s2">&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s2">&#34;s/^HOOKS=(.*)</span>$<span class="s2">/HOOKS=(</span><span class="nv">$HOOKS</span><span class="s2">)/&#34;</span> /etc/mkinitcpio.conf&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/^#COMPRESSION=&#34;&#39;</span><span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span><span class="s1">&#39;&#34;/COMPRESSION=&#34;&#39;</span><span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span><span class="s1">&#39;&#34;/&#39;</span> /etc/mkinitcpio.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bzip2&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;bzip2&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;lzma&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;xz&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;xz&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;lzop&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;lzop&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;lz4&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;lz4&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KERNELS_COMPRESSION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;zstd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;zstd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> display_driver<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;display_driver()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DDX</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;intel&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-mesa&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;amdgpu&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-mesa&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;ati&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-mesa&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia-lts&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia-dkms&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia-390xx&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia-390xx-lts&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER</span><span class="o">=</span><span class="s2">&#34;nvidia-390xx-dkms&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nouveau&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DRIVER_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-mesa&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_DDX</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;intel&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DDX</span><span class="o">=</span><span class="s2">&#34;xf86-video-intel&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;amdgpu&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DDX</span><span class="o">=</span><span class="s2">&#34;xf86-video-amdgpu&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;ati&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DDX</span><span class="o">=</span><span class="s2">&#34;xf86-video-ati&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nouveau&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_DDX</span><span class="o">=</span><span class="s2">&#34;xf86-video-nouveau&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VULKAN</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;intel&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;vulkan-icd-loader vulkan-intel&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-vulkan-icd-loader lib32-vulkan-intel&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;amdgpu&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;vulkan-radeon&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-vulkan-radeon&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;ati&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;vulkan-radeon&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-vulkan-radeon&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;nvidia-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nouveau&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_VULKAN_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;intel&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="nv">$DISPLAY_DRIVER_HARDWARE_ACCELERATION_INTEL</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;amdgpu&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;ati&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;mesa-vdpau&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-mesa-vdpau&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia-390xx-dkms&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nouveau&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION</span><span class="o">=</span><span class="s2">&#34;libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="o">=</span><span class="s2">&#34;lib32-libva-mesa-driver&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;mesa </span><span class="nv">$PACKAGES_DRIVER</span><span class="s2"> </span><span class="nv">$PACKAGES_DDX</span><span class="s2"> </span><span class="nv">$PACKAGES_VULKAN</span><span class="s2"> </span><span class="nv">$PACKAGES_HARDWARE_ACCELERATION</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PACKAGES_MULTILIB</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;</span><span class="nv">$PACKAGES_DRIVER_MULTILIB</span><span class="s2"> </span><span class="nv">$PACKAGES_VULKAN_MULTILIB</span><span class="s2"> </span><span class="nv">$PACKAGES_HARDWARE_ACCELERATION_MULTILIB</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> kernels<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;kernels()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;linux-headers&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KERNELS</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;</span><span class="nv">$KERNELS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> mkinitcpio<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;mkinitcpio()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt mkinitcpio -P&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> network<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;network()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;networkmanager&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> NetworkManager.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> virtualbox<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;virtualbox()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$KERNELS</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;virtualbox-guest-utils&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;virtualbox-guest-utils virtualbox-guest-dkms&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> users<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;users()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;create_user <span class="s2">&#34;</span><span class="nv">$USER_NAME</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$USER_PASSWORD</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> U in <span class="si">${</span><span class="nv">ADDITIONAL_USERS</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;=&#39;</span> <span class="nv">S</span><span class="o">=(</span><span class="si">${</span><span class="nv">U</span><span class="si">}</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="si">${</span><span class="nv">S</span><span class="p">[0]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD</span><span class="o">=</span><span class="si">${</span><span class="nv">S</span><span class="p">[1]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_user <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">PASSWORD</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">	arch-chroot /mnt sed -i <span class="s1">&#39;s/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/&#39;</span> /etc/sudoers&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;xdg-user-dirs&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; &#34;/mnt/etc/pam.d/nss-auth&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">#%PAM-1.0&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp; sufficient pam_unix.so try_first_pass nullok&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp; sufficient pam_systemd_home.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp; required   pam_deny.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account  sufficient pam_unix.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account  sufficient pam_systemd_home.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account  required   pam_deny.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">password sufficient pam_unix.so try_first_pass nullok sha512 shadow&#10;</span></span></span><span class="line"><span class="cl"><span class="s">password sufficient pam_systemd_home.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">password required   pam_deny.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; &#34;/mnt/etc/pam.d/system-auth&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">#%PAM-1.0&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp;  substack   nss-auth&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp;  optional   pam_permit.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">auth&nbsp;&nbsp;&nbsp;&nbsp;  required   pam_env.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account   substack   nss-auth&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account   optional   pam_permit.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">account   required   pam_time.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">password  substack   nss-auth&#10;</span></span></span><span class="line"><span class="cl"><span class="s">password  optional   pam_permit.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">session   required  pam_limits.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">session   optional  pam_systemd_home.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">session   required  pam_unix.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">session   optional  pam_permit.so&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> create_user<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> systemd-homed.service&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_user_homectl <span class="nv">$USER</span> <span class="nv">$PASSWORD</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1">#&nbsp;&nbsp;&nbsp;&nbsp;   create_user_useradd $USER $PASSWORD</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_user_useradd <span class="nv">$USER</span> <span class="nv">$PASSWORD</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> create_user_homectl<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STORAGE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_DOMAIN</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_USERNAME</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_SERVICE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">TZ</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">TIMEZONE</span><span class="si">}</span> <span class="p">|</span> sed <span class="s2">&#34;s/\/usr\/share\/zoneinfo\///g&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">L</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">LOCALE_CONF</span><span class="p">[0]</span><span class="si">}</span> <span class="p">|</span> sed <span class="s2">&#34;s/LANG=//g&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IMAGE_PATH</span><span class="o">=</span><span class="s2">&#34;/home/</span><span class="nv">$USER</span><span class="s2">.homedir&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">HOME_PATH</span><span class="o">=</span><span class="s2">&#34;/home/</span><span class="nv">$USER</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STORAGE</span><span class="o">=</span><span class="s2">&#34;--storage=</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;cifs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_DOMAIN</span><span class="o">=</span><span class="s2">&#34;--cifs-domain=</span><span class="nv">$SYSTEMD_HOMED_CIFS_DOMAIN</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_USERNAME</span><span class="o">=</span><span class="s2">&#34;--cifs-user-name=</span><span class="nv">$USER</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CIFS_SERVICE</span><span class="o">=</span><span class="s2">&#34;--cifs-service=</span><span class="nv">$SYSTEMD_HOMED_CIFS_SERVICE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED_STORAGE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;luks&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IMAGE_PATH</span><span class="o">=</span><span class="s2">&#34;/home/</span><span class="nv">$USER</span><span class="s2">.home&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">### something missing, inside alis this not works, after install the user is in state infixated</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">### after install and reboot this commands work</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;systemctl start systemd-homed.service&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> +e&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;homectl create <span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span> --enforce-password-policy<span class="o">=</span>no --timezone<span class="o">=</span><span class="nv">$TZ</span> --language<span class="o">=</span><span class="nv">$L</span> <span class="nv">$STORAGE</span> <span class="nv">$CIFS_DOMAIN</span> <span class="nv">$CIFS_USERNAME</span> <span class="nv">$CIFS_SERVICE</span> -G wheel,storage,optical&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;homectl activate <span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cp -a <span class="s2">&#34;</span><span class="nv">$IMAGE_PATH</span><span class="s2">/.&#34;</span> <span class="s2">&#34;/mnt</span><span class="nv">$IMAGE_PATH</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cp -a <span class="s2">&#34;</span><span class="nv">$HOME_PATH</span><span class="s2">/.&#34;</span> <span class="s2">&#34;/mnt</span><span class="nv">$HOME_PATH</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cp -a <span class="s2">&#34;/var/lib/systemd/home/.&#34;</span> <span class="s2">&#34;/mnt/var/lib/systemd/home/&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> create_user_useradd<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">PASSWORD</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt useradd -m -G wheel,storage,optical -s /bin/bash <span class="nv">$USER</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">printf</span> <span class="s2">&#34;</span><span class="nv">$PASSWORD</span><span class="s2">\n</span><span class="nv">$PASSWORD</span><span class="s2">&#34;</span> <span class="p">|</span> arch-chroot /mnt passwd <span class="nv">$USER</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> bootloader<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;bootloader()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BOOTLOADER_ALLOW_DISCARDS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;intel&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;intel-ucode&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;amd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;amd-ucode&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$LVM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX_ROOT</span><span class="o">=</span><span class="s2">&#34;root=</span><span class="nv">$DEVICE_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX_ROOT</span><span class="o">=</span><span class="s2">&#34;root=PARTUUID=</span><span class="nv">$PARTUUID_ROOT</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$DEVICE_TRIM</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">BOOTLOADER_ALLOW_DISCARDS</span><span class="o">=</span><span class="s2">&#34;:allow-discards&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;cryptdevice=PARTUUID=</span><span class="nv">$PARTUUID_ROOT</span><span class="s2">:</span><span class="nv">$LUKS_DEVICE_NAME$BOOTLOADER_ALLOW_DISCARDS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$FILE_SYSTEM_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;btrfs&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> rootflags=subvol=root&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$KMS</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;nvidia&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-390xx&#34;</span> <span class="p">|</span> <span class="s2">&#34;nvidia-390xx-lts&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> nvidia-drm.modeset=1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$KERNELS_PARAMETERS</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$KERNELS_PARAMETERS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$BOOTLOADER</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;grub&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bootloader_grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;refind&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bootloader_refind&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;systemd&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bootloader_systemd&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl set-default multi-user.target&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> bootloader_grub<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;grub dosfstools&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/&#39;</span> /etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/#GRUB_SAVEDEFAULT=&#34;true&#34;/GRUB_SAVEDEFAULT=&#34;true&#34;/&#39;</span> /etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i -E <span class="s1">&#39;s/GRUB_CMDLINE_LINUX_DEFAULT=&#34;(.*) quiet&#34;/GRUB_CMDLINE_LINUX_DEFAULT=&#34;\1&#34;/&#39;</span> /etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/GRUB_CMDLINE_LINUX=&#34;&#34;/GRUB_CMDLINE_LINUX=&#34;&#39;</span><span class="s2">&#34;</span><span class="nv">$CMDLINE_LINUX</span><span class="s2">&#34;</span><span class="s1">&#39;&#34;/&#39;</span> /etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; /mnt/etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;# alis&#34;</span> &gt;&gt; /mnt/etc/default/grub&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;GRUB_DISABLE_SUBMENU=y&#34;</span> &gt;&gt; /mnt/etc/default/grub&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;uefi&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;efibootmgr&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt grub-install --target<span class="o">=</span>x86_64-efi --bootloader-id<span class="o">=</span>grub --efi-directory<span class="o">=</span><span class="nv">$ESP_DIRECTORY</span> --recheck&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">#arch-chroot /mnt efibootmgr --create --disk $DEVICE --part $PARTITION_BOOT_NUMBER --loader /EFI/grub/grubx64.efi --label &#34;GRUB Boot Manager&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$BIOS_TYPE</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;bios&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt grub-install --target<span class="o">=</span>i386-pc --recheck <span class="nv">$DEVICE</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt grub-mkconfig -o <span class="s2">&#34;</span><span class="nv">$BOOT_DIRECTORY</span><span class="s2">/grub/grub.cfg&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -n <span class="s2">&#34;\EFI\grub\grubx64.efi&#34;</span> &gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/startup.nsh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> bootloader_refind<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;refind&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt refind-install&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt rm /boot/refind_linux.conf&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/^timeout.*/timeout 5/&#39;</span> <span class="s2">&#34;</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/EFI/refind/refind.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sed -i <span class="s1">&#39;s/^#scan_all_linux_kernels.*/scan_all_linux_kernels false/&#39;</span> <span class="s2">&#34;</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/EFI/refind/refind.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">#arch-chroot /mnt sed -i &#39;s/^#default_selection &#34;+,bzImage,vmlinuz&#34;/default_selection &#34;+,bzImage,vmlinuz&#34;/&#39; &#34;$ESP_DIRECTORY/EFI/refind/refind.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REFIND_MICROCODE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;intel&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REFIND_MICROCODE</span><span class="o">=</span><span class="s2">&#34;initrd=/intel-ucode.img&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;amd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REFIND_MICROCODE</span><span class="o">=</span><span class="s2">&#34;initrd=/amd-ucode.img&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt;&gt; &#34;/mnt$ESP_DIRECTORY/EFI/refind/refind.conf&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s"># alis&#10;</span></span></span><span class="line"><span class="cl"><span class="s">menuentry &#34;Arch Linux&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;volume   $PARTUUID_BOOT&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;loader   /vmlinuz-linux&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;initrd   /initramfs-linux.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;icon&nbsp;&nbsp;&nbsp;&nbsp; /EFI/refind/icons/os_arch.png&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;options  &#34;$REFIND_MICROCODE $CMDLINE_LINUX_ROOT rw $CMDLINE_LINUX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot using fallback initramfs&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  initrd /initramfs-linux-fallback.img&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot to terminal&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  add_options &#34;systemd.unit=multi-user.target&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-lts.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt;&gt; &#34;/mnt$ESP_DIRECTORY/EFI/refind/refind.conf&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">menuentry &#34;Arch Linux (lts)&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;volume   $PARTUUID_BOOT&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;loader   /vmlinuz-linux-lts&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;initrd   /initramfs-linux-lts.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;icon&nbsp;&nbsp;&nbsp;&nbsp; /EFI/refind/icons/os_arch.png&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;options  &#34;$REFIND_MICROCODE $CMDLINE_LINUX_ROOT rw $CMDLINE_LINUX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot using fallback initramfs&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  initrd /initramfs-linux-lts-fallback.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot to terminal&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  add_options &#34;systemd.unit=multi-user.target&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-hardened.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt;&gt; &#34;/mnt$ESP_DIRECTORY/EFI/refind/refind.conf&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">menuentry &#34;Arch Linux (hardened)&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;volume   $PARTUUID_BOOT&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;loader   /vmlinuz-linux-hardened&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;initrd   /initramfs-linux-hardened.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;icon&nbsp;&nbsp;&nbsp;&nbsp; /EFI/refind/icons/os_arch.png&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;options  &#34;$REFIND_MICROCODE $CMDLINE_LINUX_ROOT rw $CMDLINE_LINUX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot using fallback initramfs&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  initrd /initramfs-linux-lts-fallback.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot to terminal&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  add_options &#34;systemd.unit=multi-user.target&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-zen.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt;&gt; &#34;/mnt$ESP_DIRECTORY/EFI/refind/refind.conf&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">menuentry &#34;Arch Linux (zen)&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;volume   $PARTUUID_BOOT&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;loader   /vmlinuz-linux-zen&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;initrd   /initramfs-linux-zen.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;icon&nbsp;&nbsp;&nbsp;&nbsp; /EFI/refind/icons/os_arch.png&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;options  &#34;$REFIND_MICROCODE $CMDLINE_LINUX_ROOT rw $CMDLINE_LINUX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot using fallback initramfs&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  initrd /initramfs-linux-lts-fallback.img&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;submenuentry &#34;Boot to terminal&#34; {&#10;</span></span></span><span class="line"><span class="cl"><span class="s">	&nbsp;&nbsp;&nbsp;&nbsp;  add_options &#34;systemd.unit=multi-user.target&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">}&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -n <span class="s2">&#34;\EFI\refind\refind_x64.efi&#34;</span> &gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/startup.nsh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> bootloader_systemd<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemd-machine-id-setup&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt bootctl --path<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">&#34;</span> install&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt mkdir -p <span class="s2">&#34;</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt mkdir -p <span class="s2">&#34;</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; &#34;/mnt$ESP_DIRECTORY/loader/loader.conf&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s"># alis&#10;</span></span></span><span class="line"><span class="cl"><span class="s">timeout 5&#10;</span></span></span><span class="line"><span class="cl"><span class="s">default archlinux&#10;</span></span></span><span class="line"><span class="cl"><span class="s">editor 0&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt mkdir -p <span class="s2">&#34;/etc/pacman.d/hooks/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; &#34;/mnt/etc/pacman.d/hooks/systemd-boot.hook&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">[Trigger]&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Type = Package&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Operation = Upgrade&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Target = systemd&#10;</span></span></span><span class="line"><span class="cl"><span class="s">&#10;</span></span></span><span class="line"><span class="cl"><span class="s">[Action]&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Description = Updating systemd-boot&#10;</span></span></span><span class="line"><span class="cl"><span class="s">When = PostTransaction&#10;</span></span></span><span class="line"><span class="cl"><span class="s">Exec = /usr/bin/bootctl update&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_MICROCODE</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_OPTIONS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;intel&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_MICROCODE</span><span class="o">=</span><span class="s2">&#34;/intel-ucode.img&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_VENDOR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;amd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SYSTEMD_MICROCODE</span><span class="o">=</span><span class="s2">&#34;/amd-ucode.img&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;   <span class="nv">SYSTEMD_OPTIONS</span><span class="o">=</span><span class="s2">&#34;luks.name=</span><span class="nv">$UUID_ROOT</span><span class="s2">=</span><span class="nv">$LUKS_DEVICE_NAME</span><span class="s2"> luks.options=discard&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (terminal)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> systemd.unit=multi-user.target </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (fallback)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-fallback.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-fallback.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-lts.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (lts)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-lts&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-lts.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-lts.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (lts, terminal)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-lts&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-lts.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-lts.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> systemd.unit=multi-user.target </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (lts-fallback)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-lts&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$CPU_INTEL</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> -a <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-lts-fallback.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-lts-fallback.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-lts-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-hardened.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (hardened)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-hardened&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-hardened.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-hardened.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (hardened, terminal)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-hardened&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-hardened.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-hardened.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> systemd.unit=multi-user.target </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (hardened-fallback)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-hardened&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-hardened-fallback.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-hardened-fallback.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-hardened-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$KERNELS</span> <span class="o">=</span>~ .*linux-zen.* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (zen)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-zen&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-zen.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-zen.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (zen, terminal)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-zen&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-zen.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-zen.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> systemd.unit=multi-user.target </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-terminal.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;title Arch Linux (zen-fallback)&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;efi /vmlinuz-linux-zen&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd </span><span class="nv">$SYSTEMD_MICROCODE</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;initrd /initramfs-linux-zen-fallback.img&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;options initrd=initramfs-linux-zen-fallback.img </span><span class="nv">$CMDLINE_LINUX_ROOT</span><span class="s2"> rw </span><span class="nv">$CMDLINE_LINUX</span><span class="s2"> </span><span class="nv">$SYSTEMD_OPTIONS</span><span class="s2">&#34;</span> &gt;&gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/loader/entries/archlinux-zen-fallback.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -n <span class="s2">&#34;\EFI\systemd\systemd-bootx64.efi&#34;</span> &gt; <span class="s2">&#34;/mnt</span><span class="nv">$ESP_DIRECTORY</span><span class="s2">/startup.nsh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> custom_shell<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;custom_shell()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL_PATH</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$CUSTOM_SHELL</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;zsh&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;zsh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL_PATH</span><span class="o">=</span><span class="s2">&#34;/usr/bin/zsh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;dash&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;dash&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL_PATH</span><span class="o">=</span><span class="s2">&#34;/usr/bin/dash&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;fish&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;fish&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL_PATH</span><span class="o">=</span><span class="s2">&#34;/usr/bin/fish&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$CUSTOM_SHELL_PATH</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;custom_shell_user <span class="s2">&#34;root&#34;</span> <span class="nv">$CUSTOM_SHELL_PATH</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;custom_shell_user <span class="s2">&#34;</span><span class="nv">$USER_NAME</span><span class="s2">&#34;</span> <span class="nv">$CUSTOM_SHELL_PATH</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> U in <span class="si">${</span><span class="nv">ADDITIONAL_USERS</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;=&#39;</span> <span class="nv">S</span><span class="o">=(</span><span class="si">${</span><span class="nv">U</span><span class="si">}</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="si">${</span><span class="nv">S</span><span class="p">[0]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;custom_shell_user <span class="s2">&#34;</span><span class="nv">$USER</span><span class="s2">&#34;</span> <span class="nv">$CUSTOM_SHELL_PATH</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> custom_shell_user<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">USER</span><span class="o">=</span><span class="nv">$1</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">CUSTOM_SHELL_PATH</span><span class="o">=</span><span class="nv">$2</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$SYSTEMD_HOMED</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;homectl update --shell<span class="o">=</span><span class="nv">$CUSTOM_SHELL_PATH</span> <span class="nv">$USER</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt chsh -s <span class="nv">$CUSTOM_SHELL_PATH</span> <span class="nv">$USER</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;print_step <span class="s2">&#34;desktop_environment()&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$DESKTOP_ENVIRONMENT</span><span class="s2">&#34;</span> in&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;gnome&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_gnome&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;kde&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_kde&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;xfce&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_xfce&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;mate&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_mate&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;cinnamon&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_cinnamon&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;lxde&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_lxde&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;i3-wm&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_i3_wm&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&#34;i3-gaps&#34;</span> <span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desktop_environment_i3_gaps&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">;;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">esac</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl set-default graphical.target&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_gnome<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;gnome&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> gdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_kde<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;plasma-meta plasma-wayland-session kde-applications-meta&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> sddm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_xfce<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;xfce4 xfce4-goodies lightdm lightdm-gtk-greeter xorg-server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lightdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_mate<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;mate mate-extra lightdm lightdm-gtk-greeter xorg-server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lightdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_cinnamon<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;cinnamon lightdm lightdm-gtk-greeter xorg-server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lightdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_lxde<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;lxde lxdm&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lxdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_i3_wm<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;i3-wm i3blocks i3lock i3status dmenu rxvt-unicode lightdm lightdm-gtk-greeter xorg-server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lightdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> desktop_environment_i3_gaps<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;i3-gaps i3blocks i3lock i3status dmenu rxvt-unicode lightdm lightdm-gtk-greeter xorg-server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> lightdm.service&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> packages<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$PACKAGES_INSTALL</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">(</span><span class="nv">USER_NAME</span><span class="o">=</span><span class="nv">$USER_NAME</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="nv">USER_PASSWORD</span><span class="o">=</span><span class="nv">$USER_PASSWORD</span> <span class="se">\&#10;</span></span></span><span class="line"><span class="cl"><span class="se"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./alis-packages.sh<span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> vagrant<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;pacman_install <span class="s2">&#34;openssh&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;create_user <span class="s2">&#34;vagrant&#34;</span> <span class="s2">&#34;vagrant&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nb">enable</span> sshd.service&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt ssh-keygen -A&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt sshd -t&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> systemd_units<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39; &#39;</span> <span class="nv">UNITS</span><span class="o">=(</span><span class="nv">$SYSTEMD_UNITS</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> U in <span class="si">${</span><span class="nv">UNITS</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ACTION</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UNIT</span><span class="o">=</span><span class="si">${</span><span class="nv">U</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="nv">$UNIT</span> <span class="o">==</span> -* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ACTION</span><span class="o">=</span><span class="s2">&#34;disable&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UNIT</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$UNIT</span> <span class="p">|</span> sed <span class="s2">&#34;s/^-//g&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[[</span> <span class="nv">$UNIT</span> <span class="o">==</span> +* <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ACTION</span><span class="o">=</span><span class="s2">&#34;enable&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UNIT</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$UNIT</span> <span class="p">|</span> sed <span class="s2">&#34;s/^+//g&#34;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">elif</span> <span class="o">[[</span> <span class="nv">$UNIT</span> <span class="o">=</span>~ ^<span class="o">[</span>a-zA-Z0-9<span class="o">]</span>+ <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ACTION</span><span class="o">=</span><span class="s2">&#34;enable&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">UNIT</span><span class="o">=</span><span class="nv">$UNIT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ACTION</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt systemctl <span class="nv">$ACTION</span> <span class="nv">$UNIT</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> end<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Arch Linux installed successfully&#34;</span><span class="s1">&#39;!&#39;</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$REBOOT</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REBOOT</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> +e&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="o">((</span> <span class="nv">i</span> <span class="o">=</span> 15<span class="p">;</span> i &gt;<span class="o">=</span> 1<span class="p">;</span> i-- <span class="o">))</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">read</span> -r -s -n <span class="m">1</span> -t <span class="m">1</span> -p <span class="s2">&#34;Rebooting in </span><span class="nv">$i</span><span class="s2"> seconds... Press any key to abort.&#34;</span><span class="s1">$&#39;\n&#39;</span> KEY&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">REBOOT</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">break</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$REBOOT</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Rebooting...&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy_logs&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_reboot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ASCIINEMA</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Reboot aborted. You will must terminate asciinema recording and do a explicit reboot (exit, ./alis-reboot.sh).&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Reboot aborted. You will must do a explicit reboot (./alis-reboot.sh).&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ASCIINEMA</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;No reboot. You will must terminate asciinema recording and do a explicit reboot (exit, ./alis-reboot.sh).&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;No reboot. You will must do a explicit reboot (./alis-reboot.sh).&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> pacman_install<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ERROR</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> +e&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39; &#39;</span> <span class="nv">PACKAGES</span><span class="o">=(</span><span class="nv">$1</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> VARIABLE in <span class="o">{</span>1..5<span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arch-chroot /mnt pacman -Syu --noconfirm --needed <span class="si">${</span><span class="nv">PACKAGES</span><span class="p">[@]</span><span class="si">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ERROR</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">break</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep <span class="m">10</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ERROR</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">exit</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> copy_logs<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ESCAPED_LUKS_PASSWORD</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LUKS_PASSWORD</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> sed <span class="s1">&#39;s/[.[\*^$()+?{|]/[\\&amp;]/g&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ESCAPED_ROOT_PASSWORD</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">ROOT_PASSWORD</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> sed <span class="s1">&#39;s/[.[\*^$()+?{|]/[\\&amp;]/g&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ESCAPED_USER_PASSWORD</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">USER_PASSWORD</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> sed <span class="s1">&#39;s/[.[\*^$()+?{|]/[\\&amp;]/g&#39;</span><span class="k">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$CONF_FILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SOURCE_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$CONF_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FILE</span><span class="o">=</span><span class="s2">&#34;/mnt/var/log/alis/</span><span class="nv">$CONF_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir -p /mnt/var/log/alis&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp <span class="s2">&#34;</span><span class="nv">$SOURCE_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chown root:root <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod <span class="m">600</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_LUKS_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_ROOT_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_USER_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_USER_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$LOG_FILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SOURCE_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LOG_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FILE</span><span class="o">=</span><span class="s2">&#34;/mnt/var/log/alis/</span><span class="nv">$LOG_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir -p /mnt/var/log/alis&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp <span class="s2">&#34;</span><span class="nv">$SOURCE_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chown root:root <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod <span class="m">600</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_LUKS_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_ROOT_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_USER_PASWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_USER_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$ASCIINEMA_FILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">SOURCE_FILE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$ASCIINEMA_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FILE</span><span class="o">=</span><span class="s2">&#34;/mnt/var/log/alis/</span><span class="nv">$ASCIINEMA_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir -p /mnt/var/log/alis&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp <span class="s2">&#34;</span><span class="nv">$SOURCE_FILE</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chown root:root <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod <span class="m">600</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_LUKS_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_LUKS_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_ROOT_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_ROOT_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$ESCAPED_USER_PASSWORD</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sed -i <span class="s2">&#34;s/</span><span class="si">${</span><span class="nv">ESCAPED_USER_PASSWORD</span><span class="si">}</span><span class="s2">/******/g&#34;</span> <span class="s2">&#34;</span><span class="nv">$FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> do_reboot<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;umount -R /mnt/boot&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;umount -R /mnt&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;reboot&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> print_step<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEP</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="si">${</span><span class="nv">LIGHT_BLUE</span><span class="si">}</span><span class="s2"># </span><span class="si">${</span><span class="nv">STEP</span><span class="si">}</span><span class="s2"> step</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> execute_step<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEP</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEPS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34; </span><span class="nv">$STEPS</span><span class="s2"> &#34;</span> <span class="o">=</span>~ <span class="s2">&#34; </span><span class="nv">$STEP</span><span class="s2"> &#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">eval</span> <span class="nv">$STEP</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;save_globals&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Skipping </span><span class="nv">$STEP</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> load_globals<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$GLOBALS_FILE</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">source</span> <span class="s2">&#34;</span><span class="nv">$GLOBALS_FILE</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> save_globals<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;cat <span class="s">&lt;&lt;EOT &gt; $GLOBALS_FILE&#10;</span></span></span><span class="line"><span class="cl"><span class="s">ASCIINEMA=&#34;$ASCIINEMA&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">BIOS_TYPE=&#34;$BIOS_TYPE&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTITION_BOOT=&#34;$PARTITION_BOOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTITION_ROOT=&#34;$PARTITION_ROOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTITION_BOOT_NUMBER=&#34;$PARTITION_BOOT_NUMBER&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTITION_ROOT_NUMBER=&#34;$PARTITION_ROOT_NUMBER&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">DEVICE_ROOT=&#34;$DEVICE_ROOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">DEVICE_LVM=&#34;$DEVICE_LVM&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">LUKS_DEVICE_NAME=&#34;$LUKS_DEVICE_NAME&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">LVM_VOLUME_GROUP=&#34;$LVM_VOLUME_GROUP&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">LVM_VOLUME_LOGICAL=&#34;$LVM_VOLUME_LOGICAL&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">SWAPFILE=&#34;$SWAPFILE&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">BOOT_DIRECTORY=&#34;$BOOT_DIRECTORY&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">ESP_DIRECTORY=&#34;$ESP_DIRECTORY&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">UUID_BOOT=&#34;$UUID_BOOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">UUID_ROOT=&#34;$UUID_ROOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTUUID_BOOT=&#34;$PARTUUID_BOOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">PARTUUID_ROOT=&#34;$PARTUUID_ROOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">DEVICE_SATA=&#34;$DEVICE_SATA&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">DEVICE_NVME=&#34;$DEVICE_NVME&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">DEVICE_MMC=&#34;$DEVICE_MMC&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">CPU_VENDOR=&#34;$CPU_VENDOR&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">VIRTUALBOX=&#34;$VIRTUALBOX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">CMDLINE_LINUX_ROOT=&#34;$CMDLINE_LINUX_ROOT&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">CMDLINE_LINUX=&#34;$CMDLINE_LINUX&#34;&#10;</span></span></span><span class="line"><span class="cl"><span class="s">EOT</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">function</span> main<span class="o">()</span> <span class="o">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">ALL_STEPS</span><span class="o">=(</span><span class="s2">&#34;configuration_install&#34;</span> <span class="s2">&#34;sanitize_variables&#34;</span> <span class="s2">&#34;check_variables&#34;</span> <span class="s2">&#34;warning&#34;</span> <span class="s2">&#34;init&#34;</span> <span class="s2">&#34;facts&#34;</span> <span class="s2">&#34;checks&#34;</span> <span class="s2">&#34;prepare&#34;</span> <span class="s2">&#34;partition&#34;</span> <span class="s2">&#34;install&#34;</span> <span class="s2">&#34;configuration&#34;</span> <span class="s2">&#34;mkinitcpio_configuration&#34;</span> <span class="s2">&#34;display_driver&#34;</span> <span class="s2">&#34;kernels&#34;</span> <span class="s2">&#34;mkinitcpio&#34;</span> <span class="s2">&#34;network&#34;</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="s2">&#34;users&#34;</span> <span class="s2">&#34;bootloader&#34;</span> <span class="s2">&#34;custom_shell&#34;</span> <span class="s2">&#34;desktop_environment&#34;</span> <span class="s2">&#34;packages&#34;</span> <span class="s2">&#34;vagrant&#34;</span> <span class="s2">&#34;systemd_units&#34;</span> <span class="s2">&#34;end&#34;</span><span class="o">)</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEP</span><span class="o">=</span><span class="s2">&#34;configuration_install&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEP</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$STEP</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;steps&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">echo</span> <span class="s2">&#34;Steps: </span><span class="nv">$ALL_STEPS</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="m">0</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># get step execute from</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FOUND</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEPS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> S in <span class="si">${</span><span class="nv">ALL_STEPS</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="nv">$FOUND</span> <span class="o">=</span> <span class="s2">&#34;true&#34;</span> -o <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEP</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">S</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">FOUND</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nv">STEPS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$STEPS</span><span class="s2"> </span><span class="nv">$S</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">done</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1"># execute steps</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;load_globals&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;configuration_install&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;sanitize_variables&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;check_variables&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;warning&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;init&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;facts&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;checks&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;prepare&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;partition&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;install&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;configuration&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;mkinitcpio_configuration&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$DISPLAY_DRIVER</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;display_driver&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;kernels&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;mkinitcpio&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;network&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VIRTUALBOX</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;virtualbox&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;users&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;bootloader&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$CUSTOM_SHELL</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;custom_shell&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$DESKTOP_ENVIRONMENT</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;desktop_environment&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;packages&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$VAGRANT</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;vagrant&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;systemd_units&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;execute_step <span class="s2">&#34;end&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">STEPS</span><span class="si">}</span><span class="s2">&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">main <span class="nv">$@</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>alis.sh</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode fs-6">
    <img src="/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/alis/tree/master/">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub.</p>
</div>

    </div>

    <p class="information">
      
    </p>

    
  </article>
        <div>
          <hr>
        </div>
        

        
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-text">
      Comparte el artículo:
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-inline-share-buttons"></div>
  </div>
</div>


        
        
    
    
    <div class="row related"><div class="col-12"><p>Artículos relacionados:</p></div></div>
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/12/hemeroteca-10/">
                <img src="/blog-bitix/assets/images/logotypes/blogbitix.svg" width="326" height="125" alt="Hemeroteca #10" title="Hemeroteca #10" class="" loading="lazy">
                <h3>Hemeroteca #10</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/10/elegir-una-distribucion-gnu-linux-segun-el-usuario-uso-o-equipo/">
                <img src="/blog-bitix/assets/images/logotypes/gnu.svg" width="326" height="125" alt="Elegir una distribución GNU/Linux según el usuario, uso o equipo" title="Elegir una distribución GNU/Linux según el usuario, uso o equipo" class="" loading="lazy">
                <h3>Elegir una distribución GNU/Linux según el usuario, uso o equipo</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/07/guia-basica-del-interprete-de-comandos-bash/">
                <img src="/blog-bitix/assets/images/logotypes/gnu.svg" width="326" height="125" alt="Guía básica del intérprete de comandos Bash" title="Guía básica del intérprete de comandos Bash" class="" loading="lazy">
                <h3>Guía básica del intérprete de comandos Bash</h3>
                </a>
                
            </div>
        </div>
    </div>
    
    
    <div class="row related">
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/07/hemeroteca-9/">
                <img src="/blog-bitix/assets/images/logotypes/blogbitix.svg" width="326" height="125" alt="Hemeroteca #9" title="Hemeroteca #9" class="" loading="lazy">
                <h3>Hemeroteca #9</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/06/combinacion-de-teclas-para-copiar-y-pegar-en-la-terminal/">
                <img src="/blog-bitix/assets/images/logotypes/gnu.svg" width="326" height="125" alt="Combinación de teclas para copiar y pegar en la terminal" title="Combinación de teclas para copiar y pegar en la terminal" class="" loading="lazy">
                <h3>Combinación de teclas para copiar y pegar en la terminal</h3>
                </a>
                
            </div>
        </div>
    
    
    
    
        <div class="col-12 col-sm-4">
            <div class="related-article">
                
                <a href="/blog-bitix/2016/06/atajos-de-teclado-basicos-de-la-terminal-en-gnu-linux/">
                <img src="/blog-bitix/assets/images/logotypes/gnu.svg" width="326" height="125" alt="Atajos de teclado básicos de la terminal en GNU/Linux" title="Atajos de teclado básicos de la terminal en GNU/Linux" class="" loading="lazy">
                <h3>Atajos de teclado básicos de la terminal en GNU/Linux</h3>
                </a>
                
            </div>
        </div>
    </div>
    

        <div class="row">
          <div class="col-12 adblock-container-billboard mt-3 mb-3 p-0">
            <span id="pageBottom"></span>
            
          </div>
        </div>
        
  <div class="row">
    <div class="col-md-12">
      <span id="comments"></span>
      <div id="disqus_thread"></div>
    </div>
  </div>

  <script type="text/javascript" async>
    var disqus_shortname = 'blog-bitix';
    var disqus_identifier = 'blog-bitix-204';
    var disqus_url = 'https:\/\/picodotdev.github.io\/blog-bitix\/2017\/01\/script-para-instalar-arch-linux-de-forma-facil-rapido-desatendido-automatizado-y-personalizable\/';
    var disqus_script = 'embed.js';
  </script>

      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    





<footer>
  <div class="row">
    <div class="col-12 col-sm-4">
      <p><strong>Blog Bitix</strong></p>
      <p>Blog sobre el lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</p>
      <p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p>
    </div>
    <div class="col-12 col-sm-4 text-center menu">
      <ul class="list-unstyled">
        <li><a href="/blog-bitix/tags/java/">Java</a></li>
        <li><a href="/blog-bitix/tags/gnu-linux/">GNU/Linux</a></li>
        <li><a href="/blog-bitix/tags/javascript/">JavaScript</a></li>
        <li><a href="/blog-bitix/tags/tapestry/">Tapestry</a></li>
        <li><a href="/blog-bitix/archive/">Archivo y hemeroteca</a></li>
        <li><a href="/blog-bitix/pages/links/">Enlaces</a></li>
        <li><a href="/blog-bitix/pages/advertising/">Advertising</a></li>
        <li><a href="/blog-bitix/pages/advertising/">Publicidad</a></li>
        <li><a href="/blog-bitix/pages/donate/">Donaciones</a></li>
        <li><a href="/blog-bitix/pages/privacy/">Política de privacidad</a></li>
        <li><a href="/blog-bitix/pages/about/">Acerca de...</a></li>
        
      </ul>
    </div>
    <div class="col-12 col-sm-4 text-center links">
      
        <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></a>
      
      
        <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></a>
      
      
      
        <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></a>
      
      
      
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      Copyleft <span class="copyleft">&copy;</span> 2024 - <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" width="80" height="15" alt="Creative Commons License" title="Creative Commons License"></a><br />
      <a href="https://www.planetacodigo.com/" rel="nofollow"><img src="/blog-bitix/assets/images/planeta-codigo.png" width="80" height="15" alt="Planeta código" title="Planeta código"></a>
      <br/>
      <a href="https://picodotdev.github.io/blog-bitix/" rel="nofollow">Blog Bitix</a> by <a href="https://picodotdev.github.io/blog-bitix/">pico.dev</a> is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.
      <br/>
      <span class="credit">Powered by <a href="https://gohugo.io/" rel="nofollow" title="A fast and modern static website engine">Hugo</a> and <a href="https://pages.github.com/" title="Websites for you and your projects">GitHub Pages</a>.</span>
      <span class="credit">Background patterns from <a href="https://www.toptal.com/designers/subtlepatterns/" rel="nofollow">Subtle Patterns</a>.</span>
    </div>
  </div>
</footer>

  </div>
  
<div
  id="blueimp-gallery"
  class="blueimp-gallery blueimp-gallery-controls"
  aria-label="image gallery"
  aria-modal="true"
  role="dialog"
>
  <div class="slides" aria-live="polite"></div>
  <h3 class="title"></h3>
  <span
    class="prev"
    aria-controls="blueimp-gallery"
    aria-label="previous slide"
    aria-keyshortcuts="ArrowLeft"
  ></span>
  <span
    class="next"
    aria-controls="blueimp-gallery"
    aria-label="next slide"
    aria-keyshortcuts="ArrowRight"
  ></span>
  <span
    class="close"
    aria-controls="blueimp-gallery"
    aria-label="close"
    aria-keyshortcuts="Escape"
  ></span>
  <span
    class="play-pause"
    aria-controls="blueimp-gallery"
    aria-label="play slideshow"
    aria-keyshortcuts="Space"
    aria-pressed="false"
    role="button"
  ></span>
  <ol class="indicator"></ol>
</div>

  
  
</body>
</html>