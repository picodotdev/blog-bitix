<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title type="text">Blog Bitix</title>
    <subtitle type="text">Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</subtitle>
    <link rel="self" href="https://picodotdev.github.io/blog-bitix/index.xml"/>
    <link href="https://picodotdev.github.io/blog-bitix/" />
    <id>https://picodotdev.github.io/blog-bitix/series/jooq/</id>
    <updated>2019-05-31T18:00:00+02:00</updated>
    <author><name>picodotdev</name></author>
    <generator>Hugo</generator>
    <icon>https://picodotdev.github.io/blog-bitix/assets/favicon.ico</icon>
    <logo>https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg</logo>
    <rights>https://creativecommons.org/licenses/by-sa/4.0/</rights>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2019/05/implementar-la-paginacion-eficientemente-en-consultas-sql-con-seek/</id>
        <title>Implementar la paginación eficientemente en consultas SQL con seek</title>
        <updated>2019-05-31T18:00:00+02:00</updated>
        <published>2019-05-31T18:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2019/05/implementar-la-paginacion-eficientemente-en-consultas-sql-con-seek/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Las aplicaciones que muestran listados probablemente necesiten mostrarlos paginados. Sin embargo, implementar la paginación correctamente para que sea eficiente no pasa por emplear las clausulas <em>limit</em> ni <em>offset</em> que habitualmente se utilizan sino con <em>seek</em>. Además de que <em>limit</em> y <em>offset</em> da lugar a resultados no deseados si entre obtención de página y página se insertan filas en páginas anteriores.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png" width="200" height="200" alt="jOOQ" title="jOOQ"  class=""></p>
</div>
<div class="logotypes">
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java"  class=""></p>
</div>
<p>La paginación habitualmente se implementa con las palabras reservadas <em>limit</em> y <em>offset</em> del lenguaje SQL pero esto es ineficiente ya que para llegar los resultados de las últimas páginas la base de datos ha de recuperar antes todos los resultados anteriores. Cuando hay varios cientos de miles o millones de filas en una tabla esto es ineficiente y hace que las consultas sean lentas y añadan una importante carga al servidor de base de datos que al final afecta al rendimiento de la aplicación o su capacidad para atender a gran número de peticiones.</p>
<p>Además del rendimiento, otro problema de la paginación con <em>limit</em> y <em>offset</em> es que si se insertan filas en una página anterior mientras se están recorriendo los resultados, uno o varios resultados al avanzar por las páginas en la típica tabla de resultados en una aplicación web podría aparecer dos veces, en un proceso automatizado sería aún peor ya que un resultado podría procesarse dos veces.</p>
<p>La paginación con <em>limit</em> y <em>offset</em> permite ir a una página directamente en una búsqueda pero en los casos que hay miles de resultados realmente a un usuario no le interesa ir a una determinada página cuando hay cientos de páginas, en un proceso automatizado ir a una página en concreto tampoco suele ser un requerimiento.</p>
<p><a href="https://www.jooq.org/">jOOQ</a> con la cláusula <a href="https://www.jooq.org/javadoc/latest/org/jooq/SelectSeekStep1.html">seek</a> permite hacer la paginación eficiente de una forma cómoda. La técnica se basa en ordenar los resultados por unas determinadas columnas y filtrar por condición <em>where</em> sobre las mismas columnas los resultados anteriores, los valores por los que se filtra en la condición son los obtenidos de la última página.</p>
<p>Haciendo <em>seek</em> la paginación es más eficiente ya que la base de datos no necesita recuperar los datos de las páginas anteriores ya que los descarta utilizando la cláusula <em>where</em> que al final es en lo que se traduce la clausula <em>seek</em>. Y se elimina el problema de que se inserten datos en páginas anteriores y alguno se pudiese aparecer dos veces en los resultados ya que manteniendo la ordenación de la consulta si se insertan filas en páginas anteriores no afectarán a las páginas siguientes.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span><span class="lnt">7&#10;</span><span class="lnt">8&#10;</span><span class="lnt">9&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="o">...</span>&#10;<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;<span class="o">...</span>&#10;<span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">PRODUCTO</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">PRODUCTO</span><span class="o">.</span><span class="na">CANTIDAD</span><span class="o">,</span> <span class="n">PRODUCTO</span><span class="o">.</span><span class="na">ID</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">seek</span><span class="o">(</span><span class="n">3l</span><span class="o">,</span> <span class="n">2l</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="n">10</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">Producto</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Seek.java</span>
    </div>
</div>
<p>La SQL generada por jOOQ es la siguiente donde la clausula <em>seek</em> se añade como una condición en la cláusula <em>where</em>. El campo de la clausula <em>seek</em> coincide con el campo del criterio de ordenación, el operador mayor que en la condición coincide también con el orden ascendente del <em>order by</em>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-Sql" data-lang="Sql"><span class="w">   </span><span class="k">select</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;NOMBRE&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;DESCRIPCION&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;CANTIDAD&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;FECHA&#34;</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="k">from</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="w">&#10;</span><span class="w">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;CANTIDAD&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;ID&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="o">?</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">bigint</span><span class="p">),</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="o">?</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">bigint</span><span class="p">))</span><span class="w">&#10;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;CANTIDAD&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PRODUCTO&#34;</span><span class="p">.</span><span class="s2">&#34;ID&#34;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="o">?</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Seek.sql</span>
    </div>
</div>
<p>Para que el <em>seek</em> sea correcto los valores de las filas para los campos que forman parte del <em>seek</em> han de ser únicos por eso entre los campos de los ejemplos se incluye el identificativo de la fila, que siempre se incluye como último campo si hubiese más criterios de ordenación y valores para el <em>seek</em>.</p>
<p>Si además se tiene un índice para los campos que forman parte del <em>seek</em> el rendimiento será muy alto y la diferencia entre la primera y la última página mínimo, además se puede considerar independiente del número de filas de la tabla. Son varias las ventajas perdiendo solo la capacidad de navegar a cierta página pero en la mayoría de los casos esto es asumible.</p>
<p>En los siguientes interesantes artículos se comenta detalladamente como implementar la paginación eficientemente y se dan más detalles.</p>
<ul>
<li><a href="https://wiki.postgresql.org/images/3/35/Pagination_Done_the_PostgreSQL_Way.pdf">Pagination Done the PostgreSQL Way</a></li>
<li><a href="https://blog.jooq.org/2016/08/10/why-most-programmers-get-pagination-wrong/">Why Most Programmers Get Pagination Wrong</a></li>
<li><a href="https://dba.stackexchange.com/questions/73175/pagination-with-postgresql-9-3-counting-number-of-pages">Pagination with PostgreSQL 9.3: counting number of pages</a></li>
</ul>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2019/05/log-de-sentencias-sql-sentencias-lentas-y-otra-informacion-en-jooq/</id>
        <title>Log de sentencias SQL, sentencias lentas y otra información en jOOQ</title>
        <updated>2019-05-24T18:00:00+02:00</updated>
        <published>2019-05-24T18:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2019/05/log-de-sentencias-sql-sentencias-lentas-y-otra-informacion-en-jooq/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Algunas de las causas del bajo rendimiento de una aplicación que utiliza una base de datos son el número de sentencias que se realizan junto con las sentencias lentas por su coste de ejecución. Cada ejecución de una sentencia significa una comunicación por la red y ejecutar muchas de ellas significa un considerable y perceptible tiempo para el usuario. Por ello es conveniente saber que sentencias se ejecutan, si hay algún problema de 1+N o sentencias innecesarias que se repiten. Un <em>log</em> de las sentencias que se ejecutan es muy útil para detectar ineficiencias en la aplicación y corregirlas.</strong></p>]]>
        <![CDATA[<div class="logotypes">
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png" width="200" height="200" alt="jOOQ" title="jOOQ"  class=""></p>
</div>
<div class="logotypes">
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java"  class=""></p>
</div>
<p>La librería <a href="https://www.jooq.org/">jOOQ</a> devuelve al lenguaje SQL de consultas para bases de datos relacionales al primer plano en una aplicación Java. En vez de crear una capa de abstracción como realiza la popular librería <a href="https://hibernate.org/">Hibernate</a> del modelo relacional al modelo orientado a objetos de Java permite construir con un DSL mediante su API fluída avanzadas sentencias SQL que soportan las versiones recientes de <a href="https://www.postgresql.org/">PostgreSQL</a> y <a href="https://www.mysql.com/">MySQL</a>.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">Alternativa a Hibernate u ORM y ejemplo de jOOQ</a></li>
</ul>
<p>En Hibernate la configuración de <em>statistics</em>, el <em>logger</em> <em>org.hibernate.SQL</em> y con el parámetro <em>show_sql</em> permiten visualizar que sentencias SQL se están lanzando, útil para conocer si algún <a href="https://picodotdev.github.io/blog-bitix/2014/05/detectar-problema-n-plus-1-y-obtener-estadisticas-de-hibernate-con-grails/">problema de 1+N al navegar relaciones</a> que ocasionalmente se producen si no son tenidas en cuenta. Además de que sentencias se están lanzando es también interesante conocer que tiempo de ejecución está tomando cada sentencia para conseguir que el rendimiento de la aplicación no sea lento, para detectar sentencias lentas.</p>
<p>Usando <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> y la dependencia de jOOQ hay que proporcionar una instancia que implemente la interfaz <a href="https://www.jooq.org/javadoc/latest/org/jooq/ExecuteListener.html">ExecuteListener</a> o crear una instancia de <a href="https://www.jooq.org/javadoc/latest/org/jooq/impl/DefaultExecuteListener.html">DefaultExecuteListener</a>. Esta clase contiene numerosos métodos que permiten conocer y realizar acciones, en este caso emitir trazas. Dos de los métodos son <a href="https://www.jooq.org/javadoc/latest/org/jooq/impl/DefaultExecuteListener.html#executeStart-org.jooq.ExecuteContext-">executeStart()</a> y <a href="https://www.jooq.org/javadoc/latest/org/jooq/impl/DefaultExecuteListener.html#executeEnd-org.jooq.ExecuteContext-">executeEnd()</a> invocados por jOOQ antes y después de cada sentencia que lanza. Usando <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html#nanoTime%28%29">System.nanoTime()</a> se mide el tiempo de ejecución.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.plugintapestry.spring</span><span class="o">;</span>&#10;&#10;<span class="o">...</span>&#10;&#10;<span class="nd">@Configuration</span>&#10;<span class="nd">@ComponentScan</span><span class="o">({</span> <span class="s">&#34;io.github.picodotdev.plugintapestry&#34;</span> <span class="o">})</span>&#10;<span class="nd">@EnableTransactionManagement</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfiguration</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&#34;close&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">BasicDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="n">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getCanonicalName</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&#34;jdbc:h2:./misc/database/app&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">ds</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">...</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ConnectionProvider</span> <span class="nf">connectionProvider</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceConnectionProvider</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ExecuteListenerProvider</span> <span class="nf">executeListenerProvider</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">ExecuteListenerProvider</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ExecuteListener</span> <span class="nf">provide</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">JooqExecuteListener</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">};</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="nf">config</span><span class="o">(</span><span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span><span class="o">,</span> <span class="n">ExecuteListenerProvider</span> <span class="n">executeListenerProvider</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">DefaultConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConfiguration</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SQLDialect</span><span class="o">.</span><span class="na">H2</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">executeListenerProvider</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">config</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">DSLContext</span> <span class="nf">dsl</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">DSL</span><span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">...</span>&#10;<span class="o">}</span>&#10;</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppConfiguration.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.plugintapestry.misc</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.logging.log4j.LogManager</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.apache.logging.log4j.Logger</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.ExecuteContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DefaultExecuteListener</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.math.MathContext</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JooqExecuteListener</span> <span class="kd">extends</span> <span class="n">DefaultExecuteListener</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">JooqExecuteListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kt">long</span> <span class="n">start</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="kt">long</span> <span class="n">end</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">executeStart</span><span class="o">(</span><span class="n">ExecuteContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">executeEnd</span><span class="o">(</span><span class="n">ExecuteContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;{} ({}ms)&#34;</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">sql</span><span class="o">(),</span> <span class="n">getTime</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">String</span> <span class="nf">getTime</span><span class="o">(</span><span class="kt">long</span> <span class="n">start</span><span class="o">,</span> <span class="kt">long</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">,</span> <span class="k">new</span> <span class="n">MathContext</span><span class="o">(</span><span class="n">4</span><span class="o">)).</span><span class="na">divide</span><span class="o">(</span><span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="s">&#34;1000000&#34;</span><span class="o">)).</span><span class="na">toString</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>JooqExecuteListener.java</span>
    </div>
</div>
<p>En las siguientes trazas de ejecución de sentencias se observa una inserción de un registro (1), una posterior muestra del listado para lo que se realizan dos sentencias una que cuenta el número de elementos en la tabla con un <em>select count(*)</em> que junto con el número de elementos por página permite conocer cuantas páginas hay y un <em>select</em> con un <em>limit ?</em> para recuperar los datos de la primera página (2). Con el suficiente número de elementos en la tabla se hace una consulta con un <em>limit ?</em> y un <em>offset ?</em> para los elementos de una página posterior a la primera (3). Al eliminar un elemento de la tabla se ejecuta una sentencia <em>delete</em> con el identificativo de la fila a eliminar en la clausula <em>where</em> (4), finalmente si se utiliza el botón <em>Eliminar todos</em> se elimina todas las filas con otra sentencia <em>delete</em> pero sin especificar la clausula <em>where</em> (5). En cada sentencia se muestra el tiempo que ha tardado.</p>
<p>Estas sentencias se ejecutan en unos pocos milisegundos, en una aplicación con tablas de algún millón de registros, varios <em>joins</em>, condiciones <em>where</em> complejas, ordenación y paginación las sentencias SQL pueden tardar varias segundos y decenas de segundos, conocer sus tiempos de ejecución es importante.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext">// (1)&#10;2019-05-24 19:00:00,829 ... INFO  ...JooqExecuteListener insert into &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; (&#34;ID&#34;, &#34;NOMBRE&#34;, &#34;DESCRIPCION&#34;, &#34;CANTIDAD&#34;, &#34;FECHA&#34;) values (cast(? as bigint), cast(? as varchar), cast(? as varchar), cast(? as bigint), cast(? as timestamp)) (1.887ms)&#10;&#10;// (2)&#10;2019-05-24 19:01:00,843 ... INFO  ...JooqExecuteListener select count(*) from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; (0.1474ms)&#10;2019-05-24 19:01:00,879 ... INFO  ...JooqExecuteListener select &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;ID&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;NOMBRE&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;DESCRIPCION&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;CANTIDAD&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;FECHA&#34; from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; limit ? (0.2915ms)&#10;&#10;// (3)&#10;2019-05-24 19:02:00,289 ... INFO  ...JooqExecuteListener select count(*) from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; (0.1092ms)&#10;2019-05-24 19:02:00,291 ... INFO  ...JooqExecuteListener select &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;ID&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;NOMBRE&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;DESCRIPCION&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;CANTIDAD&#34;, &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;FECHA&#34; from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; limit ? offset ? (0.1623ms)&#10;&#10;// (4)&#10;2019-05-24 19:03:00,224 ... INFO  ...JooqExecuteListener delete from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; where &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34;.&#34;ID&#34; = cast(? as bigint) (1.19ms)&#10;&#10;// (5)&#10;2019-05-24 19:04:00,037 ... INFO  ...JooqExecuteListener delete from &#34;PLUGINTAPESTRY&#34;.&#34;PRODUCTO&#34; (0.391ms)&#10;</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>System.out</span>
    </div>
</div>
<div class="media">
<figure>
<p>
<a href="https://picodotdev.github.io/blog-bitix/2019/05/log-de-sentencias-sql-sentencias-lentas-y-otra-informacion-en-jooq/images/pagina-listado_hu3ecc29f36cbb587ee4f6a50927c3fc02_37205_2560x1440_fit_box_3.png" data-gallery="data-gallery" title="Listado de elementos"><img src="https://picodotdev.github.io/blog-bitix/2019/05/log-de-sentencias-sql-sentencias-lentas-y-otra-informacion-en-jooq/images/pagina-listado_hu3ecc29f36cbb587ee4f6a50927c3fc02_37205_650x450_fit_box_3.png" width="611" height="450" alt="Listado de elementos" title="Listado de elementos"  class="lozad "></a></p>
<figcaption>Listado de elementos</figcaption>
</figure>
</div>
<p>La clase <a href="https://www.jooq.org/javadoc/latest/org/jooq/ExecuteContext.html">ExecuteContext</a> proporciona numerosa información sobre la ejecución de la sentencia como número de filas afectadas, si se ha producido una excepción, el tipo de sentencia (<em>READ</em>, <em>WRITE</em>, <em>DDL</em>, <em>BATCH</em>, <em>ROUTINE</em> u <em>OTHER</em>), sentencias <em>batch</em> u obtener los parámetros a través del objeto <a href="https://www.jooq.org/javadoc/latest/org/jooq/Query.html">Query</a>.</p>
<p>Simplemente mostrando las trazas de sentencias me ha permitido detectar que en el ejemplo se estaba realizando una pequeña ineficiencia. La sentencia <em>select count(*)</em> se lanzaba dos veces en la página de listado, una al querer saber si hay alguna fila y otra usada por el <a href="https://tapestry.apache.org/current/apidocs/org/apache/tapestry5/corelib/components/Grid.html">componente Grid</a> de <a href="https://tapestry.apache.org/">Tapestry</a>. Para resolverlo se cachea el resultado en la clase anónima <em>JooqGridDataSource</em> con el siguiente código.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.plugintapestry.pages.admin</span><span class="o">;</span>&#10;&#10;<span class="o">...</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductoAdmin</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">...</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasProductos</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">source</span><span class="o">.</span><span class="na">getAvailableRows</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">...</span>&#10;&#10;	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">setModo</span><span class="o">(</span><span class="n">Modo</span> <span class="n">modo</span><span class="o">,</span> <span class="n">Producto</span> <span class="n">producto</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">switch</span> <span class="o">(</span><span class="n">modo</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">...</span>&#10;			<span class="k">case</span> <span class="n">LISTA</span><span class="o">:</span>&#10;				<span class="k">this</span><span class="o">.</span><span class="na">producto</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;				<span class="k">this</span><span class="o">.</span><span class="na">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JooqGridDataSource</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">Producto</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>&#10;&#10;					<span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>&#10;					<span class="kd">private</span> <span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;&#10;					<span class="nd">@Override</span>&#10;					<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAvailableRows</span><span class="o">()</span> <span class="o">{</span>&#10;						<span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">{</span>&#10;							<span class="n">count</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">dao</span><span class="o">.</span><span class="na">countAll</span><span class="o">();</span>&#10;						<span class="o">}</span>&#10;						<span class="k">return</span> <span class="n">count</span><span class="o">;</span>&#10;					<span class="o">}</span>&#10;&#10;					<span class="nd">@Override</span>&#10;					<span class="kd">public</span> <span class="n">List</span> <span class="nf">find</span><span class="o">(</span><span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;						<span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;							<span class="n">list</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pagination</span><span class="o">);</span>&#10;						<span class="o">}</span>&#10;						<span class="k">return</span> <span class="n">list</span><span class="o">;</span>&#10;					<span class="o">}</span>&#10;				<span class="o">};</span>&#10;				<span class="k">break</span><span class="o">;</span>&#10;&#10;		<span class="o">}</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">modo</span> <span class="o">=</span> <span class="n">modo</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ProductoAdmin.java</span>
    </div>
</div>
<p>Las bases de datos MySQL y PostgreSQL también ofrecen la posibilidad de <a href="https://picodotdev.github.io/blog-bitix/2019/02/log-de-sqls-y-de-sqls-lentas-en-myql-y-postgresql/">emitir en las sentencias en un <em>log</em></a> incluidas las sentencias lentas. Otra posibilidad es <a href="https://picodotdev.github.io/blog-bitix/2018/11/formatear-con-color-sentencias-sql-o-codigo-fuente-en-la-terminal-con-java-y-jansi/">resaltar la sintaxis de las sentencias en la salida a la terminal</a> para una mejor lectura dando color a las palabras claves.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/PlugInTapestry">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./gradlew run</code></p>
</div>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/11/validar-objetos-con-spring-validation-ejemplo-registros-de-jooq/</id>
        <title>Validar objetos con Spring Validation, ejemplo registros de jOOQ</title>
        <updated>2015-11-17T19:20:00+01:00</updated>
        <published>2015-11-17T19:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/11/validar-objetos-con-spring-validation-ejemplo-registros-de-jooq/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>jOOQ es una alternativa a Hibernate que devuelve la base de datos a primer plano en una aplicación. Por la importancia en cualquier aplicación de los datos propone que la base de datos sea la única fuente de la verdad. Para los modelos es patente al generarse a partir del esquema de la base de datos para las validaciones se puede hacer con restricciones de integridad pero si queremos conocer los errores detalladamente que se produzcan puede que deseemos usar Spring Validation.</strong></p>]]>
        <![CDATA[<div class="logotypes"> 
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java"  class=""></p>
</div>
<p>En la documentación de <a href="https://www.jooq.org/">jOOQ</a> no he encontrado nada referente a cómo realizar validaciones antes de guardar los datos en la base de datos. Pero con la herramienta de generación se puede indicar que las clases Java generadas se anoten con las anotaciones de validación de la especificación JSR-303 según las restricciones encontradas en la base de datos. Las clases contendrán validaciones básicas como <a href="https://docs.oracle.com/javaee/7/api/javax/validation/constraints/NotNull.html">@NotNull</a> o <a href="https://docs.oracle.com/javaee/7/api/javax/validation/constraints/Size.html">@Size</a> pero no he visto nada más allá de estas simples validaciones. Si tenemos validaciones dependientes entre campos o más complejas como una expresión regular necesitaremos algo más.</p>
<p>Si queremos ser puristas las validaciones deberíamos hacerlas en la base de datos usando <em>constraints</em> impidiendo de esta manera que se guarden datos inválidos independientemente de la aplicación o microservicio que intente guardar algo en la base de datos. Sin embargo, realizando solo las validaciones en la base de datos puede que perdamos qué campo o campos son erróneos y los motivos por los que son erróneos, información que seguramente nos interese para indicar detalladamente los datos no válidos al usuario permitiéndole corregirlos.</p>
<p>Usando <a href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">jOOQ como alternativa a Hibernate</a> deberemos realizar las validaciones nosotros de alguna forma. jOOQ aboga por que la base de datos sea la única fuente de la verdad, claramente es así para los modelos o <em>records</em> de datos que se generan a partir de las tablas y la relaciones entre ellas. Deberemos tener en cuenta los problemas de tener dos fuentes de la verdad o de realizar las validaciones a nivel de la aplicación en vez de en la base de datos pero si así lo deseamos podemos usar <a href="https://spring.io/guides/gs/validating-form-input/">Spring Validation</a>.</p>
<p>Con Spring Validation tenemos diferentes formas de realizar las validaciones, dos de ellas son con las anotaciones de la <a href="http://beanvalidation.org/">especificación de validación</a> JSR-303 o implementando una clase de la interfaz <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Validator.html">Validator</a>. En el siguiente ejemplo se muestra una combinación de ambos, un Validator que valida primeramente las anotaciones de JSR-303 para una clase <em>record</em> de jOOQ y posteriormente unas validaciones adicionales propias de la aplicación u en otro caso para campos campos dependientes. A través de las clases <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/DataBinder.html">DataBinder</a> y el <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/beanvalidation/SpringValidatorAdapter.html">SpringValidationAdapter</a> validaremos un objeto con las anotaciones de <a href="https://docs.oracle.com/javaee/7/api/javax/validation/package-summary.html">javax.validation</a> y las propias de Spring además de adaptar los errores a la interfaz <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Errors.html">Errors</a> con la que inspeccionaremos los errores. Perfectamente podemos usar únicamente los <em>Validator</em> de Spring sin tener en cuenta las anotaciones de <em>javax.validation</em>, nótese también que podemos implementar múltiples validadores de Spring con diferentes criterios de validación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.validator</span><span class="o">;</span>&#10; &#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Validator</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.interfaces.IEmployee</span><span class="o">;</span>&#10;&#10;<span class="nd">@Component</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeValidator</span> <span class="kd">implements</span> <span class="n">Validator</span> <span class="o">{</span>&#10; &#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">IEmployee</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10; &#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Object</span> <span class="n">target</span><span class="o">,</span> <span class="n">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="k">if</span> <span class="o">(!</span><span class="n">supports</span><span class="o">(</span><span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">()))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="k">return</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="n">IEmployee</span> <span class="n">o</span> <span class="o">=</span> <span class="o">(</span><span class="n">IEmployee</span><span class="o">)</span> <span class="n">target</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="k">if</span> <span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">o</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">().</span><span class="na">isAfter</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()))</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="n">errors</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">&#34;birthday&#34;</span><span class="o">,</span> <span class="s">&#34;invalid&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span> <span class="n">o</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">()</span> <span class="o">},</span> <span class="s">&#34;birthday cannot be after now&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>EmployeeValidator.java</span>
    </div>
</div>
<p>En un determinado servicio donde implementaremos la lógica de negocio realizaremos la validación de forma explícita antes de guardar el registro, para ello inyectaremos en el servicio la referencia al validador de Spring con la <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">anotación Autowired</a> y usaremos uno de sus métodos sobrecargados <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/beanvalidation/SpringValidatorAdapter.html#validate-java.lang.Object-org.springframework.validation.Errors-"><em>validate</em></a> para que compruebe las validaciones que haya definidas para ese registro.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span><span class="lnt">72&#10;</span><span class="lnt">73&#10;</span><span class="lnt">74&#10;</span><span class="lnt">75&#10;</span><span class="lnt">76&#10;</span><span class="lnt">77&#10;</span><span class="lnt">78&#10;</span><span class="lnt">79&#10;</span><span class="lnt">80&#10;</span><span class="lnt">81&#10;</span><span class="lnt">82&#10;</span><span class="lnt">83&#10;</span><span class="lnt">84&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.Record</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.DataBinder</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Validator</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.beanvalidation.SpringValidatorAdapter</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.DepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.misc.RecordContainer</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.validator.EmployeeValidator</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultAppService</span> <span class="kd">implements</span> <span class="n">AppService</span> <span class="o">{</span>&#10;&#10;		<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;		<span class="kd">private</span> <span class="n">javax</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">Validator</span> <span class="n">validator</span><span class="o">;</span>&#10;		<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;</span> <span class="n">validators</span><span class="o">;</span>&#10;&#10;		<span class="kd">public</span> <span class="nf">DefaultAppService</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">javax</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">Validator</span> <span class="n">validator</span><span class="o">,</span> <span class="n">EmployeeValidator</span> <span class="n">employeeValidator</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validators</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;();</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validators</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">employeeValidator</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countEmployees</span><span class="o">()</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countDepartments</span><span class="o">()</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">DepartmentRecord</span> <span class="nf">findDepartment</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;		&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">)).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">Errors</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">List</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;</span> <span class="n">supportedValidators</span> <span class="o">=</span> <span class="n">validators</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">((</span><span class="n">Validator</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;				<span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="na">supports</span><span class="o">(</span><span class="n">object</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>&#10;			<span class="o">}).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>&#10;&#10;			<span class="n">DataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataBinder</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="k">new</span> <span class="n">SpringValidatorAdapter</span><span class="o">(</span><span class="n">validator</span><span class="o">));</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="n">supportedValidators</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Validator</span><span class="o">[</span><span class="n">0</span><span class="o">]));</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">validate</span><span class="o">();</span>&#10;			<span class="k">return</span> <span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="nf">findDepartmentEmployees</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">)).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">((</span><span class="n">Record</span> <span class="n">record</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;					<span class="n">RecordContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecordContainer</span><span class="o">();</span>&#10;					<span class="n">container</span><span class="o">.</span><span class="na">setEmployee</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">EmployeeRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;					<span class="n">container</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;					<span class="k">return</span> <span class="n">container</span><span class="o">;</span>&#10;			<span class="o">});</span>&#10;		<span class="o">}</span>&#10;		&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="nf">findDepartmentsEmployees</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">fetch</span><span class="o">((</span><span class="n">Record</span> <span class="n">record</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">RecordContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecordContainer</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">container</span><span class="o">.</span><span class="na">setEmployee</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">EmployeeRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">container</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">container</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>DefaultAppService.java</span>
    </div>
</div>
<p>Realmente aunque el ejemplo muestra como validar un objeto de tipo <a href="http://www.jooq.org/javadoc/latest/org/jooq/Record.html">Record</a> de jOOQ lo mismo puede ser aplicado para validar cualquier otro tipo de objeto Java con Spring Validation. Las clases <em>record</em> generadas por jOOQ implementan una interfaz en la que se exponen los métodos <em>get</em> y <em>set</em> con las columnas de la tabla.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span><span class="lnt">72&#10;</span><span class="lnt">73&#10;</span><span class="lnt">74&#10;</span><span class="lnt">75&#10;</span><span class="lnt">76&#10;</span><span class="lnt">77&#10;</span><span class="lnt">78&#10;</span><span class="lnt">79&#10;</span><span class="lnt">80&#10;</span><span class="lnt">81&#10;</span><span class="lnt">82&#10;</span><span class="lnt">83&#10;</span><span class="lnt">84&#10;</span><span class="lnt">85&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ&#10;</span><span class="cm"> */</span>&#10;<span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.interfaces</span><span class="o">;</span>&#10;&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.annotation.Generated</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="o">;</span>&#10;&#10;&#10;<span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ.&#10;</span><span class="cm"> */</span>&#10;<span class="nd">@Generated</span><span class="o">(</span>&#10;	<span class="n">value</span> <span class="o">=</span> <span class="o">{</span>&#10;		<span class="s">&#34;http://www.jooq.org&#34;</span><span class="o">,</span>&#10;		<span class="s">&#34;jOOQ version:3.7.0&#34;</span>&#10;	<span class="o">},</span>&#10;	<span class="n">comments</span> <span class="o">=</span> <span class="s">&#34;This class is generated by jOOQ&#34;</span>&#10;<span class="o">)</span>&#10;<span class="nd">@SuppressWarnings</span><span class="o">({</span> <span class="s">&#34;all&#34;</span><span class="o">,</span> <span class="s">&#34;unchecked&#34;</span><span class="o">,</span> <span class="s">&#34;rawtypes&#34;</span> <span class="o">})</span>&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IEmployee</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;JOOQ.EMPLOYEE.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;JOOQ.EMPLOYEE.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@NotNull</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;JOOQ.EMPLOYEE.NAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;JOOQ.EMPLOYEE.NAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@NotNull</span>&#10;	<span class="nd">@Size</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="n">256</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;JOOQ.EMPLOYEE.SURNAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSurname</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;JOOQ.EMPLOYEE.SURNAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@Size</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="n">256</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getSurname</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;JOOQ.EMPLOYEE.BIRTHDAY&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBirthday</span><span class="o">(</span><span class="n">LocalDateTime</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;JOOQ.EMPLOYEE.BIRTHDAY&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">LocalDateTime</span> <span class="nf">getBirthday</span><span class="o">();</span>&#10;&#10;	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>	<span class="c1">// FROM and INTO&#10;</span><span class="c1"></span>	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Load data from another generated Record/POJO implementing the common interface IEmployee&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">from</span><span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">springboot</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IEmployee</span> <span class="n">from</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Copy data into another generated Record/POJO implementing the common interface IEmployee&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">springboot</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IEmployee</span><span class="o">&gt;</span> <span class="n">E</span> <span class="nf">into</span><span class="o">(</span><span class="n">E</span> <span class="n">into</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>IEmployee.java</span>
    </div>
</div>
<p>En la salida en al terminal de la <a href="https://picodotdev.github.io/blog-bitix/2015/10/aplicacion-java-autocontenida-con-spring-boot/">aplicación de ejemplo con Spring Boot</a> se observa que se producen varios errores de validación para un objeto empleado, al validarlo le falta un valor para los campos <em>id</em>, <em>name</em> por restricciones de base de datos detectadas con las anotaciones @NotNull y al tener una fecha posterior a la actual también falla una validación propia de la aplicación. El campo <em>id</em> lo asignará jOOQ cuando se guarde en base de datos por lo que esta validación no deberemos tenerla en cuenta al guardar registros nuevos.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.web.context.support.AnnotationConfigWebApplicationContext</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Keys</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.DepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeDepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.misc.RecordContainer</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.service.AppService</span><span class="o">;</span>&#10;&#10;<span class="nd">@SpringBootApplication</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Autowired</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Autowired</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">AppService</span> <span class="n">service</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number employees: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countEmployees</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number departments: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countDepartments</span><span class="o">());</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Relations (with 1+N problem)&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">DepartmentRecord</span> <span class="n">department</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartment</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">List</span><span class="o">&lt;</span><span class="n">EmployeeDepartmentRecord</span><span class="o">&gt;</span> <span class="n">eds</span> <span class="o">=</span> <span class="n">department</span><span class="o">.</span><span class="na">fetchChildren</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">eds</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">ed</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">EmployeeRecord</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="na">fetchParent</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">employee</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">department</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Multipletables (no 1+N)&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartmentEmployees</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">RecordContainer</span> <span class="n">c</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">c</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Validation&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">EmployeeRecord</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">employee</span><span class="o">.</span><span class="na">setBirthday</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">plusDays</span><span class="o">(</span><span class="n">1</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Errors</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">errors</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s, %s, %s%n&#34;</span><span class="o">,</span> <span class="n">error</span><span class="o">.</span><span class="na">getField</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getArguments</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getRejectedValue</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">errors</span><span class="o">.</span><span class="na">getGlobalErrors</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s, %s, %s%n&#34;</span><span class="o">,</span> <span class="n">error</span><span class="o">.</span><span class="na">getObjectName</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getArguments</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">SpringApplication</span> <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// application.setApplicationContextClass(AnnotationConfigApplicationContext.class);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">application</span><span class="o">.</span><span class="na">setApplicationContextClass</span><span class="o">(</span><span class="n">AnnotationConfigWebApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext">Number employees: 2&#10;Number departments: 2&#10;&#10;# Relations (1+N)&#10;Epi IT&#10;Blas IT&#10;&#10;# Multipletables (no 1+N)&#10;Epi IT&#10;Blas IT&#10;&#10;# Validation&#10;id, NotNull, [Ljava.lang.Object;@4052c8c2&#10;name, NotNull, [Ljava.lang.Object;@181b8c4b&#10;birthday, invalid, [Ljava.lang.Object;@38eb0f4d</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>System.out</span>
    </div>
</div>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/SpringBoot">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./gradlew updateDatabase, ./gradlew generateModels, ./gradlew run</code></p>
</div>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/11/obtener-datos-de-multiples-tablas-con-jooq/</id>
        <title>Obtener datos de múltiples tablas con jOOQ</title>
        <updated>2015-11-17T19:20:00+01:00</updated>
        <published>2015-11-14T19:00:00+01:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/11/obtener-datos-de-multiples-tablas-con-jooq/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>jOOQ no proporciona la misma transparencia de acceso a una base de datos relacional que un ORM. Para validar los datos podemos usar Spring Validation y para obtener datos de múltiples tablas lo que comento en este artículo. Usando jOOQ podemos exprimir todo el potencial del lenguaje SQL, comprobación de tipos por el compilador de argumentos y resultados, usar la base de datos como única fuente de la verdad, diferentes formas de acceso a la base de datos usando el patrón Active Record, directamente SQL, &hellip;</strong></p>]]>
        <![CDATA[<div class="logotypes"> 
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java"  class=""></p>
</div>
<p>Una de las facilidades que proporciona la librería de persistencia <a href="https://hibernate.org/">Hibernate</a> usada ampliamente en aplicaciones Java como buen <abbr title="Object/Relational Mapping">ORM</abbr> es la navegación de las relaciones a través de los métodos del modelo de objetos de forma transparente a las consultas SQL que se necesiten lanzar a la base de datos para ir obteniendo los resultados. Sin embargo, pensar únicamente en este modelo orientado a objetos o abusar de él sin tener en cuenta el número de consultas SQL que estamos realizando al modelo relacional provocará que la aplicación sea lenta, poco eficiente y sobrecargue el servidor de base de datos. Como ejemplo usando un ORM es habitual provocar un <a href="https://picodotdev.github.io/blog-bitix/2014/05/detectar-problema-n-plus-1-y-obtener-estadisticas-de-hibernate-con-grails/">problema de N+1 o 1+N que deberemos detectar</a> y corregir.</p>
<p>Por el contrario <a href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">jOOQ se postula como alternativa a Hibernate</a> para proporcionar persistencia en base de datos relacionales. Se basa en proporcionar un acceso usando un DSL más cercano al lenguaje SQL de la base de datos en vez de proporcionar una capa de abstracción para el modelo de objetos, la forma de acceder a la base de datos es muy flexible pudiéndose emplear para generar consultas SQL en forma de <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">String</a> que lanzaremos con <abbr title="Java Database Connectivity">JDBC</abbr> o con la clase <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jdbc/core/JdbcTemplate.html">JdbcTemplate</a> de <a href="https://spring.io/">Spring</a>. Las SQL son construidas con una <abbr title="Application Programming Interface">API</abbr> en forma de <abbr title="Domain-specific language">DSL</abbr> o usando el patrón ActiveRecord con la posibilidad de que el compilador realice la validación de tipos tanto para los parámetros como para los resultados.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Main.java&#10;</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number employees: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countEmployees</span><span class="o">());</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number departments: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countDepartments</span><span class="o">());</span>&#10;&#10;<span class="c1">// DefaultServiceImpl.java&#10;</span><span class="c1"></span><span class="nd">@Override</span>&#10;<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countEmployees</span><span class="o">()</span> <span class="o">{</span>&#10;	<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;<span class="o">}</span>&#10;&#10;<span class="nd">@Override</span>&#10;<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countDepartments</span><span class="o">()</span> <span class="o">{</span>&#10;	<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>SnippetQueries.java</span>
    </div>
</div>
<p>Sin embargo, aunque jOOQ permite también navegar las relaciones entre las entidades implementadas con el patrón ActiveRecord puede sucedernos que se nos presente el mismo problema 1+N de Hibernate si por ejemplo obtenemos una lista departamentos con 1 SQL y posteriormente 1 consulta más para obtener los empleados según se itera cada departamento en un bucle, en total 1+N consultas para los departamentos y sus empleados. Como sería el siguiente caso.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Main.java&#10;</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Relations (1+N)&#34;</span><span class="o">);</span>&#10;<span class="n">DepartmentRecord</span> <span class="n">department</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartment</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;<span class="n">List</span><span class="o">&lt;</span><span class="n">EmployeeDepartmentRecord</span><span class="o">&gt;</span> <span class="n">eds</span> <span class="o">=</span> <span class="n">department</span><span class="o">.</span><span class="na">fetchChildren</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">);</span>&#10;<span class="k">for</span> <span class="o">(</span><span class="n">EmployeeDepartmentRecord</span> <span class="n">ed</span> <span class="o">:</span> <span class="n">eds</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">EmployeeRecord</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="na">fetchParent</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">employee</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">department</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>&#10;<span class="o">}</span>&#10;&#10;<span class="c1">// DefaultAppService.java&#10;</span><span class="c1"></span><span class="nd">@Override</span>&#10;<span class="kd">public</span> <span class="n">DepartmentRecord</span> <span class="nf">findDepartment</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">)).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>SnippetRelations.java</span>
    </div>
</div>
<p>Si sabemos que vamos a necesitar una entidad y las relacionadas, como en un departamento y sus empleados, es mejor obtener todos los datos en una única consulta. Una de las formas en que jOOQ devuelve resultados es a través de objetos <em>Record</em> que representa a los datos de resultado de la SQL, por otro lado jOOQ genera un objeto <em>Record</em> por cada tabla de la base de datos. Si en una consulta necesitamos únicamente los datos de una tabla podemos obtener los datos en el ActiveRecord que jOOQ genera para esa tabla. Si queremos obtener datos de múltiples tablas deberemos emplear otra forma, por ejemplo, podemos recoger los resultados en un objeto de tipo <em>Record</em> genérico y posteriormente extraer los datos a los diferentes <em>Record</em> concretos de la aplicación.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Main.java&#10;</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Multipletables (no 1+N)&#34;</span><span class="o">);</span>&#10;<span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartmentEmployees</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;<span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">RecordContainer</span> <span class="n">c</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">c</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>&#10;<span class="o">});</span>&#10;&#10;<span class="c1">// DefaultAppService.java&#10;</span><span class="c1"></span><span class="nd">@Override</span>&#10;<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="nf">findDepartmentEmployees</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;	<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">))</span>&#10;		<span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">)).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>&#10;		<span class="o">.</span><span class="na">fetch</span><span class="o">((</span><span class="n">Record</span> <span class="n">record</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;			<span class="n">RecordContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecordContainer</span><span class="o">();</span>&#10;			<span class="n">container</span><span class="o">.</span><span class="na">setEmployee</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">EmployeeRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;			<span class="n">container</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;			<span class="k">return</span> <span class="n">container</span><span class="o">;</span>&#10;	<span class="o">});</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>SnippetMultipletables.java</span>
    </div>
</div>
<p>El objeto <em>RecordContainer</em> es el siguiente, con una propiedad por cada posible <em>Record</em> que pudiese recuperar. Solo necesitaremos crear uno que incluya una propiedad con todos los posibles <em>Record</em> que necesitemos.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.misc</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.DepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeRecord</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RecordContainer</span> <span class="o">{</span>&#10;&#10;	<span class="kd">private</span> <span class="n">EmployeeRecord</span> <span class="n">employee</span><span class="o">;</span>&#10;	<span class="kd">private</span> <span class="n">DepartmentRecord</span> <span class="n">department</span><span class="o">;</span>&#10;&#10;	<span class="kd">public</span> <span class="nf">RecordContainer</span><span class="o">()</span> <span class="o">{</span>		&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="n">EmployeeRecord</span> <span class="nf">getEmployee</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">employee</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmployee</span><span class="o">(</span><span class="n">EmployeeRecord</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">employee</span> <span class="o">=</span> <span class="n">employee</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmployeeName</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">employee</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">DepartmentRecord</span> <span class="nf">getDepartment</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">department</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDepartment</span><span class="o">(</span><span class="n">DepartmentRecord</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDepartmentName</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">department</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>RecordContainer.java</span>
    </div>
</div>
<p>Las clases completas <em>Main.java</em> y <em>AppServiceImpl.java</em> son las siguientes.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.web.context.support.AnnotationConfigWebApplicationContext</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Keys</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.DepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeDepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.misc.RecordContainer</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.service.AppService</span><span class="o">;</span>&#10;&#10;<span class="nd">@SpringBootApplication</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>&#10;&#10;	<span class="nd">@Autowired</span>&#10;	<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;	&#10;	<span class="nd">@Autowired</span>&#10;	<span class="kd">private</span> <span class="n">AppService</span> <span class="n">service</span><span class="o">;</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number employees: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countEmployees</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Number departments: %d%n&#34;</span><span class="o">,</span> <span class="n">service</span><span class="o">.</span><span class="na">countDepartments</span><span class="o">());</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Relations (with 1+N problem)&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">DepartmentRecord</span> <span class="n">department</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartment</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">List</span><span class="o">&lt;</span><span class="n">EmployeeDepartmentRecord</span><span class="o">&gt;</span> <span class="n">eds</span> <span class="o">=</span> <span class="n">department</span><span class="o">.</span><span class="na">fetchChildren</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="o">(</span><span class="n">EmployeeDepartmentRecord</span> <span class="n">ed</span> <span class="o">:</span> <span class="n">eds</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">EmployeeRecord</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="na">fetchParent</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">employee</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">department</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Multipletables (no 1+N)&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">findDepartmentEmployees</span><span class="o">(</span><span class="n">1l</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">data</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">RecordContainer</span> <span class="n">c</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s %s%n&#34;</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">c</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;# Validation&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">EmployeeRecord</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">employee</span><span class="o">.</span><span class="na">setBirthday</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">plusDays</span><span class="o">(</span><span class="n">1</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Errors</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">errors</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s, %s, %s%n&#34;</span><span class="o">,</span> <span class="n">error</span><span class="o">.</span><span class="na">getField</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getArguments</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getRejectedValue</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">errors</span><span class="o">.</span><span class="na">getGlobalErrors</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;%s, %s, %s%n&#34;</span><span class="o">,</span> <span class="n">error</span><span class="o">.</span><span class="na">getObjectName</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">error</span><span class="o">.</span><span class="na">getArguments</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>&#10;		<span class="n">SpringApplication</span> <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//application.setApplicationContextClass(AnnotationConfigApplicationContext.class);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">application</span><span class="o">.</span><span class="na">setApplicationContextClass</span><span class="o">(</span><span class="n">AnnotationConfigWebApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span><span class="lnt">72&#10;</span><span class="lnt">73&#10;</span><span class="lnt">74&#10;</span><span class="lnt">75&#10;</span><span class="lnt">76&#10;</span><span class="lnt">77&#10;</span><span class="lnt">78&#10;</span><span class="lnt">79&#10;</span><span class="lnt">80&#10;</span><span class="lnt">81&#10;</span><span class="lnt">82&#10;</span><span class="lnt">83&#10;</span><span class="lnt">84&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.Record</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.DataBinder</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.Validator</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.validation.beanvalidation.SpringValidatorAdapter</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.DepartmentRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.jooq.tables.records.EmployeeRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.misc.RecordContainer</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.springboot.validator.EmployeeValidator</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultAppService</span> <span class="kd">implements</span> <span class="n">AppService</span> <span class="o">{</span>&#10;&#10;		<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;		<span class="kd">private</span> <span class="n">javax</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">Validator</span> <span class="n">validator</span><span class="o">;</span>&#10;		<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;</span> <span class="n">validators</span><span class="o">;</span>&#10;&#10;		<span class="kd">public</span> <span class="nf">DefaultAppService</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">javax</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">Validator</span> <span class="n">validator</span><span class="o">,</span> <span class="n">EmployeeValidator</span> <span class="n">employeeValidator</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validators</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;();</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">validators</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">employeeValidator</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countEmployees</span><span class="o">()</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="kt">long</span> <span class="nf">countDepartments</span><span class="o">()</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">DepartmentRecord</span> <span class="nf">findDepartment</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;		&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">)).</span><span class="na">fetchOneInto</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">Errors</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">List</span><span class="o">&lt;</span><span class="n">Validator</span><span class="o">&gt;</span> <span class="n">supportedValidators</span> <span class="o">=</span> <span class="n">validators</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">((</span><span class="n">Validator</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;				<span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="na">supports</span><span class="o">(</span><span class="n">object</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>&#10;			<span class="o">}).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>&#10;&#10;			<span class="n">DataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataBinder</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="k">new</span> <span class="n">SpringValidatorAdapter</span><span class="o">(</span><span class="n">validator</span><span class="o">));</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="n">supportedValidators</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">Validator</span><span class="o">[</span><span class="n">0</span><span class="o">]));</span>&#10;			<span class="n">binder</span><span class="o">.</span><span class="na">validate</span><span class="o">();</span>&#10;			<span class="k">return</span> <span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="nd">@Override</span>&#10;		<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="nf">findDepartmentEmployees</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">)).</span><span class="na">where</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">((</span><span class="n">Record</span> <span class="n">record</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;					<span class="n">RecordContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecordContainer</span><span class="o">();</span>&#10;					<span class="n">container</span><span class="o">.</span><span class="na">setEmployee</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">EmployeeRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;					<span class="n">container</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;					<span class="k">return</span> <span class="n">container</span><span class="o">;</span>&#10;			<span class="o">});</span>&#10;		<span class="o">}</span>&#10;		&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecordContainer</span><span class="o">&gt;</span> <span class="nf">findDepartmentsEmployees</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">DEPARTMENT</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">DEPARTMENT_ID</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">EMPLOYEE_DEPARTMENT</span><span class="o">.</span><span class="na">EMPLOYEE_ID</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">fetch</span><span class="o">((</span><span class="n">Record</span> <span class="n">record</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">RecordContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecordContainer</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">container</span><span class="o">.</span><span class="na">setEmployee</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">EmployeeRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">container</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">DepartmentRecord</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">container</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">});</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>DefaultAppService.java</span>
    </div>
</div>
<p>La salida en la terminal de esta aplicación al iniciarse es la siguiente:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext">Number employees: 2&#10;Number departments: 2&#10;&#10;# Relations (1+N)&#10;Epi IT&#10;Blas IT&#10;&#10;# Multipletables (no 1+N)&#10;Epi IT&#10;Blas IT&#10;&#10;# Validation&#10;id, NotNull, [Ljava.lang.Object;@4052c8c2&#10;name, NotNull, [Ljava.lang.Object;@181b8c4b&#10;birthday, invalid, [Ljava.lang.Object;@38eb0f4d&#10;</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>System.out</span>
    </div>
</div>
<p>jOOQ presenta varias cosas interesantes sobre Hibernate, ya es en una alternativa con un enfoque diferente, con ideas interesantes, algunas ventajas y el tiempo dirá si se convierte en el nuevo estándar para la persistencia en las aplicaciones Java. Otra de las cosas comunes que necesitaremos en una aplicación es validar los objetos <em>Record</em>, una posibilidad es usando Spring Validation.</p>
<div class="alert alert-secondary sourcecode">
    <img src="https://picodotdev.github.io/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon">
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/SpringBoot">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./gradlew updateDatabase, ./gradlew generateModels, ./gradlew run</code></p>
</div>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/10/multiples-esquemas-o-bases-de-datos-con-jooq-y-spring-en-java/</id>
        <title>Múltiples esquemas o bases de datos con jOOQ y Spring en Java</title>
        <updated>2015-11-10T19:00:00+01:00</updated>
        <published>2015-10-27T19:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/10/multiples-esquemas-o-bases-de-datos-con-jooq-y-spring-en-java/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Aún en las aplicaciones monolíticas que comparten una única base de datos tratamos de dividirla en varios servicios que manejen cierto nicho de información con la intención de que un cambio en una parte sea transparente para las otras partes. Cada servicio de la aplicación monolítica podría potencialmente convertirse en un microservicio y en este caso para que cada microservicio tenga un ciclo de vida independiente compartir la base de datos es algo a evitar. Incluso en las aplicaciones monolíticas podemos querer guardar cada nicho de información en su propio esquema para evitar acoplamiento entre las diferentes partes o también como forma de tener varios servidores de bases de datos y escalar la aplicación en cierta forma. En estos casos necesitaremos que la aplicación acceda a varios esquemas o bases de datos simultáneamente, con jOOQ y Spring es bastante sencillo.</strong></p>]]>
        <![CDATA[<div class="logotypes"> 
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/java.svg" width="200" height="366" alt="Java" title="Java"  class=""></p>
</div>
<p>En el libro <a href="https://amzn.to/35lNGzX">Building Microservices</a> se pone de manifiesto que cada microservicio gira alrededor de un concepto que denomina <em>seam</em>, nicho o área de negocio. Este <em>seam</em> es el nicho de información que va a manejar el microservicio. Para hacer que los múltiples microservicios sean independientes y tengan su propio ciclo de vida este nicho de información se guarda en una base de datos o esquema propio de cada uno de modo que un cambio en el sistema en que guarda la información no afecte a otros microservicios como ocurriría si compartiesen la base de datos. Si un microservicio necesita información de otro la solicita mediante una API ya sea <a href="https://es.wikipedia.org/wiki/Representational_State_Transfer">REST</a>, <a href="https://picodotdev.github.io/blog-bitix/2015/03/introduccion-y-ejemplo-de-api-rpc-con-apache-thrift/">usando Apache Thift</a>, <a href="https://grpc.io/">gRPC</a> o de otro tipo evitando el acoplamiento a través de la base de datos y evitando que un microservicio conozca detalles internos de otro.</p>
<p>Imaginemos el caso de una empresa dedicada al comercio electrónico que ofrece productos a través de internet, un nicho de información podría ser el inventario formado por los productos ofrecidos y sus existencias, otro podría ser las compras. Los nichos podrían ser otros distintos, más numerosos o incluso los comentados más subdivididos, si una aplicación o proceso necesita acceder a todos estos nichos de información simultáneamente o tenemos una aplicación monolítica pero queremos tener cada nicho de información en varios esquemas o bases de datos, con <a href="https://www.jooq.org/">jOOQ</a> y <a href="https://spring.io/">Spring</a> podemos acceder simultáneamente a múltiples esquemas o bases de datos de una forma bastante sencilla. Es importante tener en cuenta que con varios esquemas podremos mantener la integridad referencial de los datos a través de las claves externas, con varias bases de datos no.</p>
<p>Siguiendo el ejemplo de la empresa expuesta tendríamos dos bases de datos: <em>inventory</em> y <em>purchases</em>. Podemos tener un servicio que sea <em>InventoryService</em> y otro servicio que sea <em>PurchasesService</em> que contengan la lógica de negocio de cada área de negocio.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.interfaces.IItem</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.records.ItemRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.spring.AppConfiguration</span><span class="o">;</span>&#10;&#10;<span class="nd">@Transactional</span><span class="o">(</span><span class="n">transactionManager</span> <span class="o">=</span> <span class="n">AppConfiguration</span><span class="o">.</span><span class="na">INVENTORY_TXM</span><span class="o">)</span>&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">InventoryService</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Transactional</span><span class="o">(</span><span class="n">transactionManager</span> <span class="o">=</span> <span class="n">AppConfiguration</span><span class="o">.</span><span class="na">INVENTORY_TXM</span><span class="o">,</span> <span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Long</span> <span class="nf">count</span><span class="o">();</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ItemRecord</span> <span class="nf">create</span><span class="o">(</span><span class="n">IItem</span> <span class="n">item</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">void</span> <span class="nf">changeStock</span><span class="o">(</span><span class="n">ItemRecord</span> <span class="n">item</span><span class="o">,</span> <span class="n">Long</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoStockException</span><span class="o">;</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>InventoryService.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.interfaces.IItem</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.records.ItemRecord</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultInventoryService</span> <span class="kd">implements</span> <span class="n">InventoryService</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="nf">InventoryServiceImpl</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">Long</span> <span class="nf">count</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">ITEM</span><span class="o">).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ItemRecord</span> <span class="nf">create</span><span class="o">(</span><span class="n">IItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ItemRecord</span> <span class="n">record</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">ITEM</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">insert</span><span class="o">();</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">record</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">changeStock</span><span class="o">(</span><span class="n">ItemRecord</span> <span class="n">item</span><span class="o">,</span> <span class="n">Long</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoStockException</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Long</span> <span class="n">stock</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">-</span> <span class="n">quantity</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">(</span><span class="n">stock</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="k">new</span> <span class="n">NoStockException</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">item</span><span class="o">.</span><span class="na">setStock</span><span class="o">(</span><span class="n">stock</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">item</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>DefaultInventoryService.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.records.ItemRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.purchases.tables.records.PurchaseRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.spring.AppConfiguration</span><span class="o">;</span>&#10;&#10;<span class="nd">@Transactional</span><span class="o">(</span><span class="n">transactionManager</span> <span class="o">=</span> <span class="n">AppConfiguration</span><span class="o">.</span><span class="na">PURCHASES_TXM</span><span class="o">)</span>&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PurchasesService</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Transactional</span><span class="o">(</span><span class="n">transactionManager</span> <span class="o">=</span> <span class="n">AppConfiguration</span><span class="o">.</span><span class="na">PURCHASES_TXM</span><span class="o">,</span> <span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Long</span> <span class="nf">count</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">PurchaseRecord</span> <span class="nf">create</span><span class="o">(</span><span class="n">ItemRecord</span> <span class="n">item</span><span class="o">,</span> <span class="kt">long</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoStockException</span><span class="o">;</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>PurchasesService.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.records.ItemRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.purchases.Tables</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.purchases.tables.records.PurchaseRecord</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultPurchasesService</span> <span class="kd">implements</span> <span class="n">PurchasesService</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">InventoryService</span> <span class="n">inventory</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="nf">DefaultPurchasesService</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">InventoryService</span> <span class="n">inventory</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="o">.</span><span class="na">inventory</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">Long</span> <span class="nf">count</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">PURCHASE</span><span class="o">).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">PurchaseRecord</span> <span class="nf">create</span><span class="o">(</span><span class="n">ItemRecord</span> <span class="n">item</span><span class="o">,</span> <span class="kt">long</span> <span class="n">quantity</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoStockException</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">inventory</span><span class="o">.</span><span class="na">changeStock</span><span class="o">(</span><span class="n">item</span><span class="o">,</span> <span class="o">-</span><span class="n">quantity</span><span class="o">);</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">PurchaseRecord</span> <span class="n">record</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">Tables</span><span class="o">.</span><span class="na">PURCHASE</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">setCreationdate</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">setQuantity</span><span class="o">(</span><span class="n">quantity</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">setItemId</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">record</span><span class="o">.</span><span class="na">insert</span><span class="o">();</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">record</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>DefaultPurchasesService.java</span>
    </div>
</div>
<p>Al realizarse una compra a través del servicio <em>PurchasesService</em> se ha de modificar el inventario del producto cosa que no se hace en el propio servicio de compras sino que se llama al servicio <em>InventoryService</em> para que haga lo que deba, en el ejemplo modificar el inventario pero en un futuro podría ser enviar además una notificación o correo electrónico indicando que el <em>stock</em> es bajo si cae por debajo de determinado número, el servicio de compras no debe conocer nada de esto ya que el inventario no forma parte de su nicho de información. En el ejemplo es una llamada usando un método de una clase pero podría ser una llamada a una <abbr title="Application Programming Interface">API</abbr> <abbr title="Representational State Transfer">REST</abbr> o <abbr title="Remote Procedure Call">RPC</abbr> si realmente fueran microservicios.</p>
<p>Las sencillas clases <em>Item</em> y <em>Purchase</em> generadas con jOOQ implementan las siguientes interfaces:</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ&#10;</span><span class="cm"> */</span>&#10;<span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.interfaces</span><span class="o">;</span>&#10;&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.annotation.Generated</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.validation.constraints.Size</span><span class="o">;</span>&#10;&#10;&#10;<span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ.&#10;</span><span class="cm"> */</span>&#10;<span class="nd">@Generated</span><span class="o">(</span>&#10;	<span class="n">value</span> <span class="o">=</span> <span class="o">{</span>&#10;		<span class="s">&#34;http://www.jooq.org&#34;</span><span class="o">,</span>&#10;		<span class="s">&#34;jOOQ version:3.7.0&#34;</span>&#10;	<span class="o">},</span>&#10;	<span class="n">comments</span> <span class="o">=</span> <span class="s">&#34;This class is generated by jOOQ&#34;</span>&#10;<span class="o">)</span>&#10;<span class="nd">@SuppressWarnings</span><span class="o">({</span> <span class="s">&#34;all&#34;</span><span class="o">,</span> <span class="s">&#34;unchecked&#34;</span><span class="o">,</span> <span class="s">&#34;rawtypes&#34;</span> <span class="o">})</span>&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IItem</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@NotNull</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.CREATIONDATE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreationdate</span><span class="o">(</span><span class="n">LocalDateTime</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.CREATIONDATE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">LocalDateTime</span> <span class="nf">getCreationdate</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.NAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.NAME&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@Size</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="n">256</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.DESCRIPTION&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.DESCRIPTION&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@Size</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="n">2147483647</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.STOCK&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStock</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.STOCK&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getStock</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;INVENTORY.ITEM.PRICE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="n">BigDecimal</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;INVENTORY.ITEM.PRICE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">BigDecimal</span> <span class="nf">getPrice</span><span class="o">();</span>&#10;&#10;	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>	<span class="c1">// FROM and INTO&#10;</span><span class="c1"></span>	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Load data from another generated Record/POJO implementing the common interface IItem&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">from</span><span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">multidatabase</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">inventory</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IItem</span> <span class="n">from</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Copy data into another generated Record/POJO implementing the common interface IItem&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">multidatabase</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">inventory</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IItem</span><span class="o">&gt;</span> <span class="n">E</span> <span class="nf">into</span><span class="o">(</span><span class="n">E</span> <span class="n">into</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>IItem.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span><span class="lnt">71&#10;</span><span class="lnt">72&#10;</span><span class="lnt">73&#10;</span><span class="lnt">74&#10;</span><span class="lnt">75&#10;</span><span class="lnt">76&#10;</span><span class="lnt">77&#10;</span><span class="lnt">78&#10;</span><span class="lnt">79&#10;</span><span class="lnt">80&#10;</span><span class="lnt">81&#10;</span><span class="lnt">82&#10;</span><span class="lnt">83&#10;</span><span class="lnt">84&#10;</span><span class="lnt">85&#10;</span><span class="lnt">86&#10;</span><span class="lnt">87&#10;</span><span class="lnt">88&#10;</span><span class="lnt">89&#10;</span><span class="lnt">90&#10;</span><span class="lnt">91&#10;</span><span class="lnt">92&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ&#10;</span><span class="cm"> */</span>&#10;<span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.purchases.tables.interfaces</span><span class="o">;</span>&#10;&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.annotation.Generated</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>&#10;&#10;&#10;<span class="cm">/**&#10;</span><span class="cm"> * This class is generated by jOOQ.&#10;</span><span class="cm"> */</span>&#10;<span class="nd">@Generated</span><span class="o">(</span>&#10;	<span class="n">value</span> <span class="o">=</span> <span class="o">{</span>&#10;		<span class="s">&#34;http://www.jooq.org&#34;</span><span class="o">,</span>&#10;		<span class="s">&#34;jOOQ version:3.7.0&#34;</span>&#10;	<span class="o">},</span>&#10;	<span class="n">comments</span> <span class="o">=</span> <span class="s">&#34;This class is generated by jOOQ&#34;</span>&#10;<span class="o">)</span>&#10;<span class="nd">@SuppressWarnings</span><span class="o">({</span> <span class="s">&#34;all&#34;</span><span class="o">,</span> <span class="s">&#34;unchecked&#34;</span><span class="o">,</span> <span class="s">&#34;rawtypes&#34;</span> <span class="o">})</span>&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IPurchase</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;PURCHASES.PURCHASE.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;PURCHASES.PURCHASE.ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="nd">@NotNull</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;PURCHASES.PURCHASE.CREATIONDATE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreationdate</span><span class="o">(</span><span class="n">LocalDateTime</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;PURCHASES.PURCHASE.CREATIONDATE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">LocalDateTime</span> <span class="nf">getCreationdate</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;PURCHASES.PURCHASE.QUANTITY&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuantity</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;PURCHASES.PURCHASE.QUANTITY&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getQuantity</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;PURCHASES.PURCHASE.PRICE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="n">BigDecimal</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;PURCHASES.PURCHASE.PRICE&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">BigDecimal</span> <span class="nf">getPrice</span><span class="o">();</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Setter for &lt;code&gt;PURCHASES.PURCHASE.ITEM_ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItemId</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Getter for &lt;code&gt;PURCHASES.PURCHASE.ITEM_ID&lt;/code&gt;.&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getItemId</span><span class="o">();</span>&#10;&#10;	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>	<span class="c1">// FROM and INTO&#10;</span><span class="c1"></span>	<span class="c1">// -------------------------------------------------------------------------&#10;</span><span class="c1"></span>&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Load data from another generated Record/POJO implementing the common interface IPurchase&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">from</span><span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">multidatabase</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">purchases</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IPurchase</span> <span class="n">from</span><span class="o">);</span>&#10;&#10;	<span class="cm">/**&#10;</span><span class="cm">	 * Copy data into another generated Record/POJO implementing the common interface IPurchase&#10;</span><span class="cm">	 */</span>&#10;	<span class="kd">public</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">picodotdev</span><span class="o">.</span><span class="na">blogbitix</span><span class="o">.</span><span class="na">multidatabase</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">purchases</span><span class="o">.</span><span class="na">tables</span><span class="o">.</span><span class="na">interfaces</span><span class="o">.</span><span class="na">IPurchase</span><span class="o">&gt;</span> <span class="n">E</span> <span class="nf">into</span><span class="o">(</span><span class="n">E</span> <span class="n">into</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>IPurchase.java</span>
    </div>
</div>
<p>El acceso a una base de datos usando jOOQ se consigue a través de la clase <a href="http://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html">DSLContext</a>, cada servicio recibe uno diferente que debemos definir en el contenedor de dependencias de Spring. Si fuesen dos bases de datos diferentes realmente debería haber definidos dos <em>bean</em> <em>DataSource</em> uno para cada servicio pero solo hay uno porque en el ejemplo se usa la base de datos <a href="https://www.h2database.com/html/main.html">H2</a> y se accede no con un servidor sino al fichero directamente. También en el ejemplo realmente no son necesarios dos (uno para cada servicio) <em>TransactionManager</em>, <em>TransactionAwareDataSourceProxy</em>, <em>ConnectionProvider</em>, <em>Config</em> y <em>DSLContext</em> pues solo hay una base de datos pero por mostrar más fielmente como sería el caso siendo dos bases de datos completamente diferentes lo he puesto así.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.spring</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp.BasicDataSource</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.ConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.SQLDialect</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DSL</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DataSourceConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DefaultConfiguration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Primary</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.support.ResourceTransactionManager</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.InventoryService</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.DefaultInventoryService</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.PurchasesService</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.DefaultPurchasesService</span><span class="o">;</span>&#10;&#10;<span class="nd">@Configuration</span>&#10;<span class="nd">@ComponentScan</span><span class="o">({</span> <span class="s">&#34;io.github.picodotdev.blogbitix.jooq&#34;</span> <span class="o">})</span>&#10;<span class="nd">@EnableTransactionManagement</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfiguration</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">INVENTORY_TXM</span> <span class="o">=</span> <span class="s">&#34;inventoryTransactionManager&#34;</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PURCHASES_TXM</span> <span class="o">=</span> <span class="s">&#34;purchasesTransactionManager&#34;</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;dataSource&#34;</span><span class="o">,</span> <span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&#34;close&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Primary</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;datasource.primary&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">BasicDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setDriverClassName(&#34;org.postgresql.Driver&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setUrl(&#34;jdbc:postgresql://localhost:5432/app&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setUsername(&#34;sa&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setPassword(&#34;sa&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setDriverClassName(&#34;com.mysql.jdbc.Driver&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setUrl(&#34;jdbc:mysql://localhost:3306/app&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setUsername(&#34;root&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ds.setPassword(&#34;&#34;);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">&#34;org.h2.Driver&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&#34;jdbc:h2:./misc/database/app&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ds</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">ds</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">INVENTORY_TXM</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ResourceTransactionManager</span> <span class="nf">inventoryTransactionManager</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">PURCHASES_TXM</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ResourceTransactionManager</span> <span class="nf">purchasesTransactionManager</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;inventoryTransactionAwareDataSourceProxy&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">TransactionAwareDataSourceProxy</span> <span class="nf">inventoryTransactionAwareDataSourceProxy</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">TransactionAwareDataSourceProxy</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;purchasesTransactionAwareDataSourceProxy&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">TransactionAwareDataSourceProxy</span> <span class="nf">purchasesTransactionAwareDataSourceProxy</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">TransactionAwareDataSourceProxy</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;inventoryConnectionProvider&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ConnectionProvider</span> <span class="nf">inventoryConnectionProvider</span><span class="o">(</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;inventoryTransactionAwareDataSourceProxy&#34;</span><span class="o">)</span> <span class="n">TransactionAwareDataSourceProxy</span> <span class="n">transactionAwareDataSourceProxy</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceConnectionProvider</span><span class="o">(</span><span class="n">transactionAwareDataSourceProxy</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;purchasesConnectionProvider&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">ConnectionProvider</span> <span class="nf">purchasesConnectionProvider</span><span class="o">(</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;purchasesTransactionAwareDataSourceProxy&#34;</span><span class="o">)</span> <span class="n">TransactionAwareDataSourceProxy</span> <span class="n">transactionAwareDataSourceProxy</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceConnectionProvider</span><span class="o">(</span><span class="n">transactionAwareDataSourceProxy</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;inventoryConfig&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="nf">inventoryConfig</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;inventoryConnectionProvider&#34;</span><span class="o">)</span> <span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">DefaultConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConfiguration</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// config.set(SQLDialect.POSTGRES_9_4);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// config.set(SQLDialect.MYSQL);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SQLDialect</span><span class="o">.</span><span class="na">H2</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">config</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;purchasesConfig&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="nf">purchasesConfig</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;purchasesConnectionProvider&#34;</span><span class="o">)</span> <span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">DefaultConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConfiguration</span><span class="o">();</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// config.set(SQLDialect.POSTGRES_9_4);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// config.set(SQLDialect.MYSQL);&#10;</span><span class="c1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SQLDialect</span><span class="o">.</span><span class="na">H2</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">config</span><span class="o">;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;inventoryDSLContext&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">DSLContext</span> <span class="nf">inventoryDSLContext</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;inventoryConfig&#34;</span><span class="o">)</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">DSL</span><span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;purchasesDSLContext&#34;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">DSLContext</span> <span class="nf">purchasesDSLContext</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;purchasesConfig&#34;</span><span class="o">)</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">DSL</span><span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">InventoryService</span> <span class="nf">inventoryService</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;inventoryDSLContext&#34;</span><span class="o">)</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DefaultInventoryService</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Bean</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="n">PurchasesService</span> <span class="nf">purchasesService</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;purchasesDSLContext&#34;</span><span class="o">)</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">InventoryService</span> <span class="n">inventory</span><span class="o">)</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="n">DefaultPurchasesService</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">inventory</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppConfiguration.java</span>
    </div>
</div>
<p>Podemos crear la base de datos y los dos esquemas con una tarea de <a href="https://gradle.org/">Gradle</a> y con <a href="https://www.liquibase.org/">Liquibase</a>, con el comando <code>./gradlew updateDatabase</code>, a continuación solo una parte del <a href="https://github.com/picodotdev/blog-ejemplos/blob/master/Multidatabase/build.gradle">archivo <em>build.gradle</em> completo</a> y los archivos XML de actualización de los esquemas.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">task</span> <span class="nf">updateDatabase</span><span class="o">()</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>&#10;	<span class="n">tasks</span><span class="o">.</span><span class="na">updateDatabaseInventory</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>&#10;	<span class="n">tasks</span><span class="o">.</span><span class="na">updateDatabasePurchases</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>&#10;<span class="o">}</span>&#10;&#10;<span class="n">task</span> <span class="nf">updateDatabaseInventory</span><span class="o">(</span><span class="nl">type:</span><span class="n">Exec</span><span class="o">)</span> <span class="o">{</span>&#10;	<span class="n">commandLine</span> <span class="s2">&#34;misc/liquibase-3.4.1/liquibase&#34;</span><span class="o">,</span> <span class="s1">&#39;--classpath=misc/libs/h2-1.4.189.jar&#39;</span><span class="o">,</span> <span class="s1">&#39;--driver=org.h2.Driver&#39;</span><span class="o">,</span>&#10;		<span class="s1">&#39;--changeLogFile=misc/database/inventory-changelog.xml&#39;</span><span class="o">,</span> <span class="s1">&#39;--url=jdbc:h2:./misc/database/app&#39;</span><span class="o">,</span> <span class="s1">&#39;--username=sa&#39;</span><span class="o">,</span> <span class="s1">&#39;--password=sa&#39;</span><span class="o">,</span> <span class="s1">&#39;update&#39;</span>&#10;<span class="o">}</span>&#10;&#10;<span class="n">task</span> <span class="nf">updateDatabasePurchases</span><span class="o">(</span><span class="nl">type:</span><span class="n">Exec</span><span class="o">)</span> <span class="o">{</span>&#10;	<span class="n">commandLine</span> <span class="s2">&#34;misc/liquibase-3.4.1/liquibase&#34;</span><span class="o">,</span> <span class="s1">&#39;--classpath=misc/libs/h2-1.4.189.jar&#39;</span><span class="o">,</span> <span class="s1">&#39;--driver=org.h2.Driver&#39;</span><span class="o">,</span>&#10;		<span class="s1">&#39;--changeLogFile=misc/database/purchases-changelog.xml&#39;</span><span class="o">,</span> <span class="s1">&#39;--url=jdbc:h2:./misc/database/app&#39;</span><span class="o">,</span> <span class="s1">&#39;--username=sa&#39;</span><span class="o">,</span> <span class="s1">&#39;--password=sa&#39;</span><span class="o">,</span> <span class="s1">&#39;update&#39;</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>build-liquibase.gradle</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-XML" data-lang="XML"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt;</span>&#10;<span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.liquibase.org/xml/ns/dbchangelog&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;schema&#34;</span> <span class="na">value=</span><span class="s">&#34;inventory&#34;</span><span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&#34;1&#34;</span> <span class="na">author=</span><span class="s">&#34;picodotdev&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;comment&gt;</span>Creación de la base de datos<span class="nt">&lt;/comment&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;sql&gt;</span>create schema ${schema}<span class="nt">&lt;/sql&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">&#34;item&#34;</span> <span class="na">schemaName=</span><span class="s">&#34;${schema}&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">autoIncrement=</span><span class="s">&#34;true&#34;</span> <span class="na">name=</span><span class="s">&#34;id&#34;</span> <span class="na">type=</span><span class="s">&#34;BIGINT&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">&#34;false&#34;</span> <span class="na">primaryKey=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/column&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;creationDate&#34;</span> <span class="na">type=</span><span class="s">&#34;TIMESTAMP&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;name&#34;</span> <span class="na">type=</span><span class="s">&#34;VARCHAR(256)&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;description&#34;</span> <span class="na">type=</span><span class="s">&#34;TEXT&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;stock&#34;</span> <span class="na">type=</span><span class="s">&#34;BIGINT&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;price&#34;</span> <span class="na">type=</span><span class="s">&#34;DECIMAL(7,2)&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/createTable&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/changeSet&gt;</span>&#10;<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>inventory-changelog.xml</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-XML" data-lang="XML"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt;</span>&#10;<span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.liquibase.org/xml/ns/dbchangelog&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;schema&#34;</span> <span class="na">value=</span><span class="s">&#34;purchases&#34;</span><span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;inventorySchema&#34;</span> <span class="na">value=</span><span class="s">&#34;inventory&#34;</span><span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&#34;1&#34;</span> <span class="na">author=</span><span class="s">&#34;picodotdev&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;comment&gt;</span>Creación de la base de datos<span class="nt">&lt;/comment&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;sql&gt;</span>create schema ${schema}<span class="nt">&lt;/sql&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">&#34;purchase&#34;</span> <span class="na">schemaName=</span><span class="s">&#34;${schema}&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">autoIncrement=</span><span class="s">&#34;true&#34;</span> <span class="na">name=</span><span class="s">&#34;id&#34;</span> <span class="na">type=</span><span class="s">&#34;BIGINT&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">&#34;false&#34;</span> <span class="na">primaryKey=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/column&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;creationDate&#34;</span> <span class="na">type=</span><span class="s">&#34;TIMESTAMP&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;quantity&#34;</span> <span class="na">type=</span><span class="s">&#34;BIGINT&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;price&#34;</span> <span class="na">type=</span><span class="s">&#34;DECIMAL(7,2)&#34;</span> <span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&#34;item_id&#34;</span> <span class="na">type=</span><span class="s">&#34;BIGINT&#34;</span><span class="nt">&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;constraints</span> <span class="na">references=</span><span class="s">&#34;${inventorySchema}.item(id)&#34;</span> <span class="na">foreignKeyName=</span><span class="s">&#34;item_id&#34;</span><span class="nt">/&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/column&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/createTable&gt;</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nt">&lt;/changeSet&gt;</span>&#10;<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>purchases-changelog.xml</span>
    </div>
</div>
<div class="media">
<figure>
<p>
<a href="https://picodotdev.github.io/blog-bitix/2015/10/multiples-esquemas-o-bases-de-datos-con-jooq-y-spring-en-java/images/basededatos_hu8b418a2f026ee7f795586d6f35f56014_41684_2560x1440_fit_box_3.png" data-gallery="data-gallery" title="Base de datos con varios esquemas"><img src="https://picodotdev.github.io/blog-bitix/2015/10/multiples-esquemas-o-bases-de-datos-con-jooq-y-spring-en-java/images/basededatos_hu8b418a2f026ee7f795586d6f35f56014_41684_300x200_fit_box_3.png" width="102" height="200" alt="Base de datos con varios esquemas" title="Base de datos con varios esquemas"  class="lozad "></a></p>
<figcaption>Base de datos con varios esquemas, inventory y purchases</figcaption>
</figure>
</div>
<p>Como en jOOQ la fuente de la verdad es la base de datos los modelos se generan a partir de ella usando otra tarea de Gradle, generará las clases con las que trabajaremos en la aplicación con el comando <code>./gradlew generateModels</code>. Las clases son las del paquete <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/Multidatabase/src/main/java/io/github/picodotdev/blogbitix/multidatabase/jooq">io.github.picodotdev.blogbitix.multidatabase.jooq</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="n">task</span> <span class="n">generateModels</span> <span class="o">&lt;&lt;</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Configuration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withJdbc</span><span class="o">(</span><span class="k">new</span> <span class="n">Jdbc</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withDriver</span><span class="o">(</span><span class="s1">&#39;org.h2.Driver&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withUrl</span><span class="o">(</span><span class="s1">&#39;jdbc:h2:./misc/database/app&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withPassword</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withGenerator</span><span class="o">(</span><span class="k">new</span> <span class="n">Generator</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withGenerate</span><span class="o">(</span><span class="k">new</span> <span class="n">Generate</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withInterfaces</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withPojos</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withRelations</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withValidationAnnotations</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.DefaultGenerator&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">Database</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withCustomTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">new</span> <span class="nf">CustomType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;java.time.LocalDateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withConverter</span><span class="o">(</span><span class="s1">&#39;io.github.picodotdev.blogbitix.multidatabase.misc.TimestampConverter&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withForcedTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">new</span> <span class="nf">ForcedType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;java.time.LocalDateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withTypes</span><span class="o">(</span><span class="s1">&#39;TIMESTAMP&#39;</span><span class="o">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.h2.H2Database&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withIncludes</span><span class="o">(</span><span class="s1">&#39;.*&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withExcludes</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withSchemata</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">new</span> <span class="nf">Schema</span><span class="o">().</span><span class="na">withInputSchema</span><span class="o">(</span><span class="s1">&#39;INVENTORY&#39;</span><span class="o">),</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">new</span> <span class="nf">Schema</span><span class="o">().</span><span class="na">withInputSchema</span><span class="o">(</span><span class="s1">&#39;PURCHASES&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">]))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withTarget</span><span class="o">(</span><span class="k">new</span> <span class="n">Target</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withPackageName</span><span class="o">(</span><span class="s1">&#39;io.github.picodotdev.blogbitix.multidatabase.jooq&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">.</span><span class="na">withDirectory</span><span class="o">(</span><span class="s1">&#39;src/main/java&#39;</span><span class="o">)))</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">GenerationTool</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">configuration</span><span class="o">)</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>build-jooq.gradle</span>
    </div>
</div>
<p>Este sería el programa de ejemplo iniciado con <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> que usa ambos servicios, el de inventario y el de compras, creando un producto y haciendo una compra junto con su salida en la terminal. Ejecutándolo repetidamente con <code>./gradlew run</code> veremos aumenta el número de productos y compras guardados en cada tabla de los dos esquemas.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.pojos.Item</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.inventory.tables.records.ItemRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.jooq.purchases.tables.records.PurchaseRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.InventoryService</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">io.github.picodotdev.blogbitix.multidatabase.service.PurchasesService</span><span class="o">;</span>&#10;&#10;<span class="nd">@SpringBootApplication</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="o">{</span> <span class="n">DataSourceAutoConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">DataSourceTransactionManagerAutoConfiguration</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Autowired</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">InventoryService</span> <span class="n">inventoryService</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Autowired</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">private</span> <span class="n">PurchasesService</span> <span class="n">purchasesService</span><span class="o">;</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nd">@Override</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Insertando datos...&#34;</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ItemRecord</span> <span class="n">item</span> <span class="o">=</span> <span class="n">inventoryService</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="n">Item</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(),</span> <span class="s">&#34;Libro&#34;</span><span class="o">,</span> <span class="s">&#34;Un gran libro&#34;</span><span class="o">,</span> <span class="n">10l</span><span class="o">,</span> <span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="s">&#34;7.99&#34;</span><span class="o">)));</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">PurchaseRecord</span> <span class="n">purchase</span> <span class="o">=</span> <span class="n">purchasesService</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">item</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Número productos: %d%n&#34;</span><span class="o">,</span> <span class="n">inventoryService</span><span class="o">.</span><span class="na">count</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&#34;Número compras: %d%n&#34;</span><span class="o">,</span> <span class="n">purchasesService</span><span class="o">.</span><span class="na">count</span><span class="o">());</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">SpringApplication</span> <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">application</span><span class="o">.</span><span class="na">setApplicationContextClass</span><span class="o">(</span><span class="n">AnnotationConfigApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Main.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext">Número productos: 2&#10;Número compras: 2&#10;</code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>System.out</span>
    </div>
</div>
<div class="media">
<a href="https://asciinema.org/a/28856" target="_blank"><amp-img src="https://asciinema.org/a/28856.png" width="650" height="563" class="lozad"></amp-img></a>
</div>
<p>Si quieres obtener más información sobre varias de las herramientas como jOOQ, Liquibase, Gradle o Spring Boot que forman en el momento de escribir este artículo el actual estado del arte en Java puedes leer los diferentes artículos que he he escrito sobre ellos de forma específica:</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/">jOOQ</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2013/05/modificar-la-base-de-datos-con-liquibase.html">Liquibase</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2012/03/herramienta-de-construccion-gradle.html">Gradle</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2015/10/aplicacion-java-autocontenida-con-spring-boot/">Spring Boot</a></li>
</ul>
<p>El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/Multidatabase">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos alojado en <a href="https://github.com/">GitHub</a>.</p>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="planeta-codigo"/>
            
                <category term="programacion"/>
            
        
    </entry>
    <entry>
        <id>https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/</id>
        <title>Alternativa a Hibernate u ORM y ejemplo de jOOQ</title>
        <updated>2017-06-18T12:00:00+02:00</updated>
        <published>2015-05-29T20:00:00+02:00</published>
        <link rel="alternate" type="text/html" href="https://picodotdev.github.io/blog-bitix/2015/05/alternativa-a-hibernate-u-orm-y-ejemplo-de-jooq/"/>
        <author><name>picodotdev</name></author>
        <content type="html">
        <![CDATA[<p><strong>Los ORMs nos han facilitado el acceso a los datos de una base de datos relacional. Han solucionado algunos problemas pero traído consigo otros nuevos como el problema N+1 o la pérdida de control del modelo relacional. jOOQ forma parte de una nueva generación de herramientas que puede sustituir o complementar a otras como Hibernate. Y después de haberlo usado considero que puede ser factible.</strong></p>]]>
        <![CDATA[<div class="logotypes"> 
<p>
<img src="https://picodotdev.github.io/blog-bitix/assets/images/logotypes/jooq.png" width="200" height="200" alt="jOOQ" title="jOOQ"  class=""></p>
</div>
<p>Con el auge de los lenguajes de programación orientados a objetos han surgido varias herramientas que intentan hacer que el trabajo de unir el mundo orientado a objetos del lenguaje que empleemos y el modelo relacional de las bases de datos sea más transparente, estas herramientas son conocidas como <a href="https://es.wikipedia.org/wiki/Mapeo_objeto-relacional">Object Realtional Mapping</a> (ORM). Una de las más conocidas y usada en la plataforma Java es <a href="https://hibernate.org/">Hibernate</a>. Sin embargo, aunque facilitan el acceso a los datos no están exentas de problemas y están surgiendo nuevas alternativas para tratar de solventar algunos de ellos, una de ellas es <a href="https://www.jooq.org/">jOOQ</a>.</p>
<p>Si hemos usado Hibernate sabremos que aunque este ampliamente usado facilitando la conversión entre el modelo relacional en base de datos y el modelo orientado a objetos del lenguaje Java también presenta problemas. Uno de los problemas es que al abstraer el acceso a base de datos no somos tan conscientes de las sentencias SQL que se envían a la base de datos provocando los problemas <a href="https://picodotdev.github.io/blog-bitix/2014/05/detectar-problema-n-plus-1-y-obtener-estadisticas-de-hibernate-con-grails/">N+1</a> y que la aplicación sea lenta, poco eficiente y sobrecargar la base de datos en el caso de realizar demasiadas consultas SQL. Otro problema es que cuando necesitamos realizar una consulta compleja o avanzada el <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql">lenguaje HQL</a> no nos ofrezca todo lo que necesitamos haciendo que tengamos que escribir directamente la consulta en lenguaje SQL con lo que perdemos la validación del compilador y si usamos una funcionalidad específica de un motor de base de datos la independencia del mismo. También puede ocurrirnos que diseñamos los modelos para complacer al <em>framework</em> de persistencia ORM.</p>
<p>jOOQ es una herramienta que facilita el acceso a la base de datos usando un enfoque diferente de los ORM, no trata de crear una abstracción sobre la base de datos relacional sino que pone el modelo relacional como elemento central de la aplicación en cuanto a la persistencia. Algunas de las características destacables de jOOQ son:</p>
<ul>
<li>La base de datos primero: los datos son probablemente lo más importante de una aplicación. En los ORM los modelos de objetos dirigen el modelo de base de datos, no siempre es sencillo (más) en bases de datos heredadas que no tienen la estructura necesaria usable por los ORMs. En jOOQ el modelo relacional dirige el modelo de objetos, para jOOQ el modelo relacional es más importante que el modelo de objetos.</li>
<li>jOOQ usa SQL como elemento central: en jOOQ se pueden construir las SQLs usando una API fluida con la que el compilador puede validar la sintaxis, metadatos y tipos de datos. Se evitan y se detectan rápidamente los errores de sintaxis con la ayuda del compilador y con la ayuda de un IDE se ofrece asistencia de código que facilita el uso de la API. Está a un nivel bastante cercano al lenguaje SQL.</li>
<li>SQL con tipado seguro: las sentencias se pueden construir usando código Java con la que el compilador validará el código y que los tipos de los datos usados sean los correctos, los errores los encontraremos en tiempo de compilación en vez de en tiempo de ejecución. jOOQ proporciona un DSL y una API fluida de fácil uso y lectura.</li>
<li>Generación de código: jOOQ genera clases a partir de los metadatos (el modelo relacional) de la base de datos. Cuando se renombre una tabla o campo en base de datos generados los modelos el compilador indicará los errores de compilación. Si en algún momento hay que renombrar una columna de la base de datos deberemos modificar los modelos, jOOQ permite regenerar las clases Java de acceso a la base de datos y el compilador nos avisará de aquello que no esté sincronizado entre la base de datos y el código Java.</li>
<li><em>Multi-Tenancy</em>: permite configurar la base de datos a la que se accederá en desarrollo, pruebas y producción.</li>
<li><em>Active Records</em>: jOOQ puede generar el código de acceso a la base de datos a partir del esquema, estas clases emplean el <a href="https://en.wikipedia.org/wiki/Active_record_pattern">patrón Active Record</a>. La implementación de este patrón ya proporciona las operaciones CRUD (uno de los avances de Hibernate) con lo que no tendremos que escribirlas para cada uno de los modelos de la aplicación, nos ahorraremos mucho código. Este código que se genera es opcional, jOOQ puede usarse simplemente para generar las sentencias SQL y usar JDBC sin la abstracción de los <em>Active Records</em>.</li>
<li>Estandarización: las bases de datos tienen diferencias en los dialectos SQL. jOOQ realiza transformaciones de expresiones SQL comunes a la correspondencia de la base de datos de forma que las SQLs escritas funcionen en todas las bases de datos de forma transparente, esto permite migrar de un sistema de datos sin cambiar el código de la aplicación. Este también era un avance proporcionado por los ORM, incluido Hibernate.</li>
<li>Ciclo de vida de las consultas: proporciona llamadas o <em>hooks</em> de forma que se puedan añadir comportamientos, por ejemplo para <em>logging</em>, manejo de transacciones, generación de identificadores, transformación de SQLs y más cosas.</li>
<li>Procedimientos almacenados: los procedimientos almacenados son ciudadanos de primera clase y pueden usarse de forma simple al contrario de lo que sucede en los ORM. Para algunas tareas los procedimientos almacenados son muy útiles y más eficientes.</li>
</ul>
<p>Los ORMs ofrecen como ventajas sobre el uso directo de JDBC la implementación de las operaciones CRUD, construir las SQLs con una API en vez de concatenando <em>Strings</em> propensos a errores al modificarlos y la independencia del motor de base de datos usado pudiendo cambiar a otro sin afectar al código de la aplicación. La navegación de las relaciones es más explícita que en Hibernate y <a href="https://picodotdev.github.io/blog-bitix/2015/11/obtener-datos-de-multiples-tablas-con-jooq/">obtener datos de múltiples tablas con jOOQ</a> diferente.</p>
<p>Si nos convencen estas características y propiedades de jOOQ podemos empezar leyendo la <a href="http://www.jooq.org/doc/3.6/manual/getting-started/tutorials/jooq-in-7-steps/">guía de inicio</a> donde se comenta los primeros pasos para usarlo. La <a href="http://www.jooq.org/doc/3.6/manual-single-page/">documentación de jOOQ</a> está bastante bien explicada pero no se comentan algunas cosas que al usarlo en un proyecto tendremos que buscar.</p>
<p>En el siguiente ejemplo mostraré como usar jOOQ y la configuración necesaria para emplearlo junto con <a href="https://spring.io/">Spring</a>. En la siguiente configuración de Spring usando únicamente código Java se construye un <em>DataSource</em>, un <em>Datasource</em> con soporte de transacciones para el acceso a la base de datos, un <a href="http://www.jooq.org/javadoc/latest/org/jooq/ConnectionProvider.html"><em>ConnectionProvider</em></a> de jOOQ que usará el <em>DataSource</em> para obtener las conexiones a la base de datos, con la clase <a href="http://www.jooq.org/javadoc/latest/org/jooq/Configuration.html"><em>Configuration</em></a> realizamos la configuración de jOOQ y finalmente <a href="http://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html"><em>DSLContext</em></a> es el objeto que usaremos para construir las sentencias SQL.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.services.spring</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.AdsenseDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.AdsenseDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.ImportSourceDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.ImportSourceDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.IndexationDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.IndexationDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.LabelDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.LabelDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.NewsletterDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.NewsletterDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsIndexationsDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsIndexationsDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsLabelsDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.PostsLabelsDAOImpl</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.SourceDAO</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.daos.SourceDAOImpl</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp.BasicDataSource</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.ConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.SQLDialect</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DSL</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DataSourceConnectionProvider</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DefaultConfiguration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.springframework.transaction.support.ResourceTransactionManager</span><span class="o">;</span>&#10;&#10;<span class="nd">@Configuration</span>&#10;<span class="nd">@ComponentScan</span><span class="o">({</span> <span class="s">&#34;info.blogstack&#34;</span> <span class="o">})</span>&#10;<span class="nd">@EnableTransactionManagement</span>&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfiguration</span> <span class="o">{</span>&#10;&#10;	<span class="nd">@Bean</span><span class="o">(</span><span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&#34;close&#34;</span><span class="o">)</span>&#10;	<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">BasicDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">&#34;org.h2.Driver&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&#34;jdbc:h2:./misc/database/app&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;		<span class="n">ds</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;sa&#34;</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">ds</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">transactionAwareDataSource</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">TransactionAwareDataSourceProxy</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ResourceTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ConnectionProvider</span> <span class="nf">connectionProvider</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">DataSourceConnectionProvider</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="nf">config</span><span class="o">(</span><span class="n">ConnectionProvider</span> <span class="n">connectionProvider</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">DefaultConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultConfiguration</span><span class="o">();</span>&#10;		<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">connectionProvider</span><span class="o">);</span>&#10;		<span class="n">config</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SQLDialect</span><span class="o">.</span><span class="na">H2</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">config</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">DSLContext</span> <span class="nf">dsl</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">jooq</span><span class="o">.</span><span class="na">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">DSL</span><span class="o">.</span><span class="na">using</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">AdsenseDAO</span> <span class="nf">adsenseDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">AdsenseDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">ImportSourceDAO</span> <span class="nf">importSourceDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">ImportSourceDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">IndexationDAO</span> <span class="nf">indexationDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">IndexationDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">LabelDAO</span> <span class="nf">labelDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">LabelDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostDAO</span> <span class="nf">postDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostsIndexationsDAO</span> <span class="nf">postsIndexationsDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostsIndexationsDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">PostsLabelsDAO</span> <span class="nf">postsLabelsDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">PostsLabelsDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">SourceDAO</span> <span class="nf">sourceDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">SourceDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Bean</span>&#10;	<span class="kd">public</span> <span class="n">NewsletterDAO</span> <span class="nf">newsletterDAO</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="k">new</span> <span class="n">NewsletterDAOImpl</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppConfiguration.java</span>
    </div>
</div>
<p>Una de las cosas que tendremos que resolver es que al generar código y usar el patrón <em>Active Record</em>, si lo usamos ya que podemos usar jOOQ para generar únicamente las sentencias SQL o en los casos que lo hagamos pudiendo combiar <em>Active Records</em> para unos casos y sentencias SQL con JDBC para otros, puede que necesitemos incluir campos adicionales a los presentes en la base de datos que manejen cierta lógica en la aplicación, también puede que necesitemos incluir métodos de lógica de negocio adicionales. Para incluir estos datos y métodos tendremos que extender la clase <em>Active Record</em> que genera jOOQ. En aquellos sitios de la aplicación que necesitemos usar esas propiedades y métodos adicionales deberemos transformar la instancia de la clase que usa jOOQ (<em>PostRecord</em>) por la clase que tenga esos datos adicionales (<em>AppPostRecord</em>). Para ello la API de la clase <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html">Record</a> ofrece el método <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html#into-java.lang.Class-"><em>into</em></a> o <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html#from-java.lang.Object-"><em>from</em></a> como muestro en el código de <em>AppPostRecord</em> a continuación. Esta es la solución que he usado en <a href="https://twitter.com/blogstackinfo">Blog Stack</a>.</p>
<p>jOOQ genera automáticamente las clases que implementa el patrón <em>Active Record</em> y dispondremos de los métodos CRUD heredados de la clase <a href="http://www.jooq.org/javadoc/3.6.x/org/jooq/Record.html">Record</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.records</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.misc.Globals</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.misc.Utils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.Keys</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.interfaces.IPost</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.io.ByteArrayInputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.ByteArrayOutputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.StringReader</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.io.StringWriter</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.zip.GZIPInputStream</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.zip.GZIPOutputStream</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.joda.time.DateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppPostRecord</span> <span class="kd">extends</span> <span class="n">PostRecord</span> <span class="o">{</span>&#10;&#10;	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">2075090879800194733L</span><span class="o">;</span>&#10;&#10;	<span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>&#10;&#10;	<span class="kd">private</span> <span class="n">Boolean</span> <span class="n">fresh</span><span class="o">;</span>&#10;&#10;	<span class="kd">public</span> <span class="nf">AppPostRecord</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">fresh</span> <span class="o">=</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">FALSE</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">content</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">getContentcompressed</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">try</span> <span class="o">{</span>&#10;				<span class="n">GZIPInputStream</span> <span class="n">zis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">getContentcompressed</span><span class="o">()));</span>&#10;				<span class="n">StringWriter</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">();</span>&#10;				<span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">zis</span><span class="o">,</span> <span class="n">sw</span><span class="o">);</span>&#10;				<span class="n">zis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;				<span class="n">sw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;&#10;				<span class="n">content</span> <span class="o">=</span> <span class="n">sw</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>&#10;			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;				<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>&#10;			<span class="o">}</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>&#10;		<span class="k">try</span> <span class="o">{</span>&#10;			<span class="n">String</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">content</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="n">content</span><span class="o">;</span>&#10;			<span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>&#10;			<span class="n">GZIPOutputStream</span> <span class="n">zos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>&#10;			<span class="n">StringReader</span> <span class="n">sr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>&#10;			<span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">sr</span><span class="o">,</span> <span class="n">zos</span><span class="o">);</span>&#10;			<span class="n">sr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;			<span class="n">zos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>&#10;&#10;			<span class="n">setContentcompressed</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>&#10;		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentExcerpt</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">getContent</span><span class="o">());</span>&#10;		<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">text</span><span class="o">();</span>&#10;		&#10;		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">Globals</span><span class="o">.</span><span class="na">POST_EXCERPT_LENGHT</span><span class="o">);</span>&#10;		<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">isFresh</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">fresh</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFresh</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">fresh</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">fresh</span> <span class="o">=</span> <span class="n">fresh</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateHash</span><span class="o">()</span> <span class="o">{</span>		&#10;		<span class="n">setHash</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">getHash</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">fetchParent</span><span class="o">(</span><span class="n">Keys</span><span class="o">.</span><span class="na">POST_SOURCE_ID</span><span class="o">)));</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getConsolidatedUpdateDate</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">getUpdatedate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getUpdatedate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">getPublishdate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getPublishdate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getCreationdate</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getConsolidatedPublishDate</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">getPublishdate</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getPublishdate</span><span class="o">();</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">getCreationdate</span><span class="o">();</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreationdate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">creationDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setCreationdate</span><span class="o">(</span><span class="n">creationDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUpdatedate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">updateDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setUpdatedate</span><span class="o">(</span><span class="n">updateDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPublishdate</span><span class="o">(</span><span class="n">DateTime</span> <span class="n">publishDate</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">setPublishdate</span><span class="o">(</span><span class="n">publishDate</span><span class="o">);</span>&#10;		<span class="n">setDate</span><span class="o">(</span><span class="n">getConsolidatedUpdateDate</span><span class="o">());</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">from</span><span class="o">(</span><span class="n">IPost</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="kd">super</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">from</span><span class="o">);</span>&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">from</span> <span class="k">instanceof</span> <span class="n">AppPostRecord</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">AppPostRecord</span> <span class="n">afrom</span> <span class="o">=</span> <span class="o">(</span><span class="n">AppPostRecord</span><span class="o">)</span> <span class="n">from</span><span class="o">;</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">setFresh</span><span class="o">(</span><span class="n">afrom</span><span class="o">.</span><span class="na">isFresh</span><span class="o">());</span>&#10;			<span class="k">this</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">afrom</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>&#10;		<span class="o">}</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>AppPostRecord.java</span>
    </div>
</div>
<p><a href="https://blog.jooq.org/2014/09/12/why-you-should-not-implement-layered-architecture/">Los desarrolladores de jOOQ abogan por la eliminación de capas</a> en la arquitectura de la aplicación pero puede que aún preferimos desarrollar una capa que contenga las consultas a la base de datos que sea usada y compartida por el resto la aplicación para el acceso los datos, quizá más que una capa en este caso es una forma de organizar el código. Los <em>Active Records</em> proporcionan algunos métodos de consulta pero probablemente necesitaremos más. En el siguiente ejemplo podemos ver como son las consultas con jOOQ. Si necesitamos métodos de búsqueda adicionales a los que por defecto jOOQ proporciona en Blog Stack he creado una clase <a href="https://es.wikipedia.org/wiki/Data_Access_Object">DAO</a> por cada entidad de la base de datos. En el siguiente ejemplo se puede ver como se construyen las sentencias SQL con jOOQ usando su API fluida.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.daos</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.LabelRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.NewsletterRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.SourceRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostDAO</span> <span class="o">{</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllBySource</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByYearMonth</span><span class="o">(</span><span class="n">Integer</span> <span class="n">year</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">month</span><span class="o">);</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByLabel</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">);</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByShared</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">shared</span><span class="o">);</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findNewsletter</span><span class="o">();</span>&#10;&#10;	<span class="n">PostRecord</span> <span class="nf">findByURL</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">);</span>&#10;&#10;	<span class="n">PostRecord</span> <span class="nf">findByHash</span><span class="o">(</span><span class="n">String</span> <span class="n">hash</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countAll</span><span class="o">();</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">);</span>&#10;	&#10;	<span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">);</span>&#10;&#10;	<span class="n">Long</span> <span class="nf">countAuthors</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByDates</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByLabels</span><span class="o">();</span>&#10;&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveBySources</span><span class="o">();</span>&#10;	&#10;	<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByNewsletter</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">);</span>&#10;	&#10;	<span class="kt">int</span> <span class="nf">updateNewsletter</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="n">posts</span><span class="o">,</span> <span class="n">NewsletterRecord</span> <span class="n">newslettter</span><span class="o">);</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>PostDAO.java</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">info.blogstack.persistence.daos</span><span class="o">;</span>&#10;&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.LABEL</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.POST</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.POSTS_LABELS</span><span class="o">;</span>&#10;<span class="kn">import static</span> <span class="nn">info.blogstack.persistence.jooq.Tables.SOURCE</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.Post</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.LabelRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.NewsletterRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.PostRecord</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">info.blogstack.persistence.jooq.tables.records.SourceRecord</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>&#10;&#10;<span class="kn">import</span> <span class="nn">org.joda.time.DateTime</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.DSLContext</span><span class="o">;</span>&#10;<span class="kn">import</span> <span class="nn">org.jooq.impl.DSL</span><span class="o">;</span>&#10;&#10;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostDAOImpl</span> <span class="kd">implements</span> <span class="n">PostDAO</span> <span class="o">{</span>&#10;&#10;	<span class="kd">private</span> <span class="n">DSLContext</span> <span class="n">context</span><span class="o">;</span>&#10;&#10;	<span class="kd">public</span> <span class="nf">PostDAOImpl</span><span class="o">(</span><span class="n">DSLContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">()).</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllBySource</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">source</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByYearMonth</span><span class="o">(</span><span class="n">Integer</span> <span class="n">year</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">month</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">Post</span> <span class="n">p</span> <span class="o">=</span> <span class="n">POST</span><span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="s">&#34;p&#34;</span><span class="o">);</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="s">&#34;year(\&#34;p\&#34;.publishDate) = ?&#34;</span><span class="o">,</span> <span class="n">year</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="s">&#34;month(\&#34;p\&#34;.publishDate) = ?&#34;</span><span class="o">,</span> <span class="n">month</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">DATE</span><span class="o">.</span><span class="na">desc</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByLabel</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">,</span> <span class="n">Pagination</span> <span class="n">pagination</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">POST_ID</span><span class="o">)).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">LABEL_ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">label</span><span class="o">.</span><span class="na">getId</span><span class="o">())))</span>&#10;				<span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getFields</span><span class="o">()).</span><span class="na">limit</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">pagination</span><span class="o">.</span><span class="na">getNumberOfRows</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findAllByShared</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">shared</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SHARED</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">shared</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">asc</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="nf">findNewsletter</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">DateTime</span> <span class="n">friday</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="o">().</span><span class="na">withDayOfWeek</span><span class="o">(</span><span class="n">5</span><span class="o">).</span><span class="na">withHourOfDay</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>&#10;		<span class="n">DateTime</span> <span class="n">tuesday</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="o">().</span><span class="na">withDayOfWeek</span><span class="o">(</span><span class="n">2</span><span class="o">).</span><span class="na">withHourOfDay</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>&#10;		<span class="n">DateTime</span> <span class="n">date</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#10;&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">friday</span><span class="o">.</span><span class="na">isBeforeNow</span><span class="o">())</span> <span class="o">{</span>&#10;		&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">date</span> <span class="o">=</span> <span class="n">friday</span><span class="o">;</span>&#10;		<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">tuesday</span><span class="o">.</span><span class="na">isBeforeNow</span><span class="o">())</span> <span class="o">{</span>&#10;			<span class="n">date</span> <span class="o">=</span> <span class="n">tuesday</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;&#10;		<span class="k">if</span> <span class="o">(</span><span class="n">date</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">EMPTY_LIST</span><span class="o">;</span>&#10;		<span class="o">}</span>&#10;		&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">.</span><span class="na">isNull</span><span class="o">()).</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">lt</span><span class="o">(</span><span class="n">date</span><span class="o">)).</span><span class="na">orderBy</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">CREATIONDATE</span><span class="o">.</span><span class="na">asc</span><span class="o">()).</span><span class="na">fetchInto</span><span class="o">(</span><span class="n">POST</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">PostRecord</span> <span class="nf">findByURL</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">URL</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">url</span><span class="o">)).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">PostRecord</span> <span class="nf">findByHash</span><span class="o">(</span><span class="n">String</span> <span class="n">hash</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">HASH</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">hash</span><span class="o">)).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countAll</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">SourceRecord</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">source</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">LabelRecord</span> <span class="n">label</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">POST_ID</span><span class="o">))</span>&#10;				<span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">.</span><span class="na">isTrue</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">POSTS_LABELS</span><span class="o">.</span><span class="na">LABEL_ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">label</span><span class="o">.</span><span class="na">getId</span><span class="o">()))).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countBy</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">selectCount</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">newsletter</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">countAuthors</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">DSL</span><span class="o">.</span><span class="na">countDistinct</span><span class="o">(</span><span class="n">DSL</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">SOURCE_ID</span><span class="o">,</span> <span class="n">POST</span><span class="o">.</span><span class="na">AUTHOR</span><span class="o">))).</span><span class="na">from</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">fetchOne</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByDates</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="k">return</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select year(p.publishDate) as year, month(p.publishDate) as month, count(*) as posts from BLOGSTACK.POST as p where p.visible = true group by year(p.publishDate), month(p.publishDate) order by year(p.publishDate) desc, month(p.publishDate) desc&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByLabels</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select l.id as id, count(*) as posts from BLOGSTACK.LABEL as l inner join BLOGSTACK.POSTS_LABELS as pl on l.id = pl.label_id inner join BLOGSTACK.POST as p on pl.post_id = p.id where l.enabled = true and p.visible = true group by l.id order by l.name&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">LabelRecord</span> <span class="n">label</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">LABEL</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">LABEL</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;LABEL&#34;</span><span class="o">,</span> <span class="n">label</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveBySources</span><span class="o">()</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select s.id as id, count(*) as posts from BLOGSTACK.SOURCE as s inner join BLOGSTACK.POST as p on s.id = p.source_id where p.visible = true group by s.id order by s.name&#34;</span><span class="o">)</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">SourceRecord</span> <span class="n">source</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">SOURCE</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">SOURCE</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;SOURCE&#34;</span><span class="o">,</span> <span class="n">source</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getArchiveByNewsletter</span><span class="o">(</span><span class="n">NewsletterRecord</span> <span class="n">newsletter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">context</span>&#10;				<span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&#34;select l.id as id, count(*) as posts from BLOGSTACK.LABEL as l inner join BLOGSTACK.POSTS_LABELS as pl on l.id = pl.label_id inner join BLOGSTACK.POST as p on pl.post_id = p.id where l.enabled = true and p.visible = true and p.newsletter_id = ? group by l.id order by l.name&#34;</span><span class="o">,</span> <span class="n">newsletter</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span>&#10;				<span class="o">.</span><span class="na">intoMaps</span><span class="o">();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">LabelRecord</span> <span class="n">label</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">selectFrom</span><span class="o">(</span><span class="n">LABEL</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">LABEL</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">eq</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;ID&#34;</span><span class="o">))).</span><span class="na">fetchOne</span><span class="o">();</span>&#10;			<span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;LABEL&#34;</span><span class="o">,</span> <span class="n">label</span><span class="o">);</span>&#10;		<span class="o">}</span>&#10;		<span class="k">return</span> <span class="n">d</span><span class="o">;</span>&#10;	<span class="o">}</span>&#10;	&#10;	<span class="nd">@Override</span>&#10;	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">updateNewsletter</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">PostRecord</span><span class="o">&gt;</span> <span class="n">posts</span><span class="o">,</span> <span class="n">NewsletterRecord</span> <span class="n">newslettter</span><span class="o">)</span> <span class="o">{</span>&#10;		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>&#10;		<span class="k">for</span> <span class="o">(</span><span class="n">PostRecord</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">)</span> <span class="o">{</span>&#10;			<span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>&#10;		<span class="o">}</span> &#10;		<span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">POST</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">NEWSLETTER_ID</span><span class="o">,</span> <span class="n">newslettter</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">where</span><span class="o">(</span><span class="n">POST</span><span class="o">.</span><span class="na">ID</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">ids</span><span class="o">)).</span><span class="na">execute</span><span class="o">();</span>&#10;	<span class="o">}</span>&#10;<span class="o">}</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>PostDAOImpl.java</span>
    </div>
</div>
<p>Para usar el generador de código de jOOQ con <a href="https://gradle.org/">Gradle</a> debemos añadir la siguiente configuración al archivo de construcción del proyecto, este generador se conectará a la base de datos, obtendrá los datos de esquema y generará todas las clases del paquete <a href="https://github.com/picodotdev/blog-stack/tree/master/src/main/java/info/blogstack/persistence/jooq">info.blogstack.persistence.jooq</a>. Por ejemplo, puede que queramos usar <a href="https://www.joda.org/joda-time/">JodaTime</a> en vez de las clases <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html">Date</a> y <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Timestamp.html">Timesptamp</a> de la API de Java al menos si no usamos aún <a href="https://picodotdev.github.io/blog-bitix/2014/03/novedades-y-nuevas-caracteristicas-de-java-8/">Java 8 y sus novedades</a>.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="o">...</span>&#10;&#10;<span class="n">task</span> <span class="n">generateJooq</span> <span class="o">{</span>&#10;	<span class="n">Configuration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withJdbc</span><span class="o">(</span><span class="k">new</span> <span class="n">Jdbc</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDriver</span><span class="o">(</span><span class="s1">&#39;org.h2.Driver&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withUrl</span><span class="o">(</span><span class="s1">&#39;jdbc:h2:./misc/database/app&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withPassword</span><span class="o">(</span><span class="s1">&#39;sa&#39;</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withGenerator</span><span class="o">(</span><span class="k">new</span> <span class="n">Generator</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withGenerate</span><span class="o">(</span><span class="k">new</span> <span class="n">Generate</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="o">.</span><span class="na">withInterfaces</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="o">.</span><span class="na">withRelations</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.DefaultGenerator&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">Database</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withCustomTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="k">new</span> <span class="nf">CustomType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.joda.time.DateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withConverter</span><span class="o">(</span><span class="s1">&#39;info.blogstack.persistence.records.DateTimeConverter&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">.</span><span class="na">withForcedTypes</span><span class="o">([</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			<span class="k">new</span> <span class="nf">ForcedType</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.joda.time.DateTime&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				<span class="o">.</span><span class="na">withTypes</span><span class="o">(</span><span class="s1">&#39;TIMESTAMP&#39;</span><span class="o">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;				&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="o">])</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withName</span><span class="o">(</span><span class="s1">&#39;org.jooq.util.h2.H2Database&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withIncludes</span><span class="o">(</span><span class="s1">&#39;.*&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withExcludes</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withInputSchema</span><span class="o">(</span><span class="s1">&#39;BLOGSTACK&#39;</span><span class="o">))</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withTarget</span><span class="o">(</span><span class="k">new</span> <span class="n">Target</span><span class="o">()</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withPackageName</span><span class="o">(</span><span class="s1">&#39;info.blogstack.persistence.jooq&#39;</span><span class="o">)</span>&#10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="o">.</span><span class="na">withDirectory</span><span class="o">(</span><span class="s1">&#39;src/main/java&#39;</span><span class="o">)));</span>&#10;&#10;	<span class="n">GenerationTool</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">configuration</span><span class="o">)</span>&#10;<span class="o">}</span>&#10;&#10;<span class="o">...</span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>build.gradle</span>
    </div>
</div>
<p>Otra alternativa con algunas similitudes a jOOQ es <a href="https://jdbi.org/">JDBI</a> pero en esta las consultas no tienen el soporte del compilador que ofrece jOOQ, otra es <a href="https://scala-slick.org/">Slick</a> para <a href="https://www.scala-lang.org/">Scala</a>. También tiene cierta similitud con <a href="https://mybatis.org/mybatis-3/es/">MyBatis</a> que existe desde hace bastante tiempo aunque jOOQ ofrece más posibilidades.</p>
<p>En el <a href="https://github.com/picodotdev/blog-stack/tree/master">código fuente de Blog Stack</a> está el código completo de uso de jOOQ, en el paquete <a href="https://github.com/picodotdev/blog-stack/tree/master/src/main/java/info/blogstack/persistence">info.blogstack.persistence</a> están las clases relacionadas con la persistencia en una base de datos <a href="https://www.h2database.com/html/main.html">H2</a>, usa Spring para los servicios y la transaccionalidad, en la clase <a href="https://github.com/picodotdev/blog-stack/blob/master/src/main/java/info/blogstack/services/spring/AppConfiguration.java">AppConfiguration</a> se encuentra la definición de ambas cosas y la integración con jOOQ. En  la <a href="https://github.com/picodotdev/blog-stack/releases/tag/0.1">versión 0.1</a> está la misma aplicación pero usando Hibernate.</p>
<p>Como comentan en su propio blog <a href="https://blog.jooq.org/2013/08/06/use-modelmapper-and-jooq-to-regain-control-of-your-domain-model/">usa ModelMapper y jOOQ para recuperar el control de tu modelo de dominio</a> que probablemente no es nada menos que lo más importante de tu aplicación o negocio. Herramientas como jOOQ contribuyen a que haya <a href="https://picodotdev.github.io/blog-bitix/2015/05/10-razones-para-seguir-usando-java/">razones para seguir usando Java</a>.</p>
<p>jOOQ está <a href="http://www.jooq.org/legal/licensing">licenciado</a> de forma dual, <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL</a> para la versión <em>community</em> que ofrece soporte para las bases de datos <a href="https://www.mysql.com/">MySQL</a>, <a href="https://www.postgresql.org/">PostgreSQL</a>, SQLite, H2 y alguna más y una licencia comercial que ofrece soporte para bases de datos como <a href="https://products.office.com/es-ES/access">Microsoft Access</a>, <a href="https://www.oracle.com/database/">Oracle</a> y <a href="https://www.microsoft.com/en-us/sql-server/sql-server-2016">Microsoft SQL Server</a>.</p>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://www.jooq.org/">jOOQ</a></li>
<li><a href="http://modelmapper.org/">ModelMapper</a></li>
<li><a href="http://modelmapper.org/user-manual/jooq-integration/">Integración entre jOOQ y ModelMapper</a></li>
<li><a href="http://teonos.com/blog/java/development/2014/11/10/experiences-with-jOOQ.html">Experiences with jOOQ</a></li>
<li><a href="https://hibernate.org/">Hibernate</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2012/03/herramienta-de-construccion-gradle.html">Introducción a Gradle</a></li>
<li><a href="https://elblogdepicodev.blogspot.com.es/2012/08/jodatime-y-como-integrarlo-con-hibernate.html">Usar DateTime en Hibernate</a></li>
</ul>
</div>
]]>
        </content>
        
            
                <category term="java"/>
            
                <category term="programacion"/>
            
                <category term="planeta-codigo"/>
            
        
    </entry>
    
</feed>