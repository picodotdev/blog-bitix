<!DOCTYPE html>
<html amp lang="es">
<head>
  <meta charset="utf-8">
  <meta name="base" content="/blog-bitix/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="picodotdev">
  <meta name="keywords" content="java, programacion, software, hardware, tapestry, software libre, gnu, linux, gnu/linux, unix, arch, arch linux, web, html, css, javascript, tutorial, guía, básico, avanzado, análisis, tecnología, juegos, productos">
  <meta name="description" content="HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox. &hellip;">
  <meta name="theme-color" content="#FFFFFF"/>
  

  <title>Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos</title>

  <link rel="shortcut icon" href="/blog-bitix/assets/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog-bitix/assets/apple-touch-icon-144-precomposed.png">
  <link rel="alternate" href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html" hreflang="es" title="Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos">
  
  <link rel="canonical" type="text/html" href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/" hreflang="es">
  
  <link rel="humans" type="text/plain" href="/blog-bitix/humans.txt">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" as="style">
  <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&display=swap" rel="stylesheet">

  <!-- Social -->
<meta property="og:title" content="Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos">
<meta property="og:url" content="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html">
<meta property="og:image" content="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_750x750_fit_box_3.png">

<meta property="og:site_name" content="Blog Bitix">
<meta property="og:description" content="HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox. &hellip;">
<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_750x750_fit_box_3.png">

<meta name="twitter:site" content="@picodotdev">
<meta name="twitter:title" content="Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos">
<meta name="twitter:description" content="HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox. &hellip;">
<meta name="twitter:creator" content="@picodotdev">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html"
    },
    "headline": "Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos",
    "image": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_750x750_fit_box_3.png"
        
      },
    "datePublished": "2020-08-14T16:00:00+02:00",
    "dateModified": "2020-08-14T16:00:00+02:00",
    "inLanguage": "es",
    
    "wordCount": "6241",
    "license": "https://creativecommons.org/licenses/by-sa/4.0/",
    "author": {
        "@type": "Person",
        "name": "picodotdev",
        "description": "Ingeniero de software. I ♥ Java, GNU/Linux and libre software.",
        "url": "https://twitter.com/picodotdev/"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Blog Bitix",
        "logo": {
            "@type": "ImageObject",
            "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
        }
    },
    "description": "HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox."
}
  </script>
  

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Blog Bitix",
    "description": "Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.",
    "url": "https://picodotdev.github.io/blog-bitix/",
    "logo": {
        "@type": "ImageObject",
        "url": "https://picodotdev.github.io/blog-bitix/assets/images/blog-bitix.svg"
    }
}
  </script>

  <!-- boilerplate -->
  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>

  <!-- css -->
  <!-- theme -->
  <style amp-custom> 
  *,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none}:root{--bs-blue:#0d6efd;--bs-indigo:#6610f2;--bs-purple:#6f42c1;--bs-pink:#d63384;--bs-red:#dc3545;--bs-orange:#fd7e14;--bs-yellow:#ffc107;--bs-green:#198754;--bs-teal:#20c997;--bs-cyan:#0dcaf0;--bs-white:#fff;--bs-gray:#6c757d;--bs-gray-dark:#343a40;--bs-primary:#0d6efd;--bs-secondary:#6c757d;--bs-success:#198754;--bs-info:#0dcaf0;--bs-warning:#ffc107;--bs-danger:#dc3545;--bs-light:#f8f9fa;--bs-dark:#212529;--bs-font-sans-serif:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0))}*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:var(--bs-font-sans-serif);font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}.h1,h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){.h1,h1{font-size:2.5rem}}.h2,h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){.h2,h2{font-size:2rem}}.h3,h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){.h3,h3{font-size:1.75rem}}.h4,h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){.h4,h4{font-size:1.5rem}}.h5,h5{font-size:1.25rem}.h6,h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}.small,small{font-size:.875em}.mark,mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:var(--bs-font-monospace);font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none}.lead{font-size:1.25rem;font-weight:300}.display-1{font-size:calc(1.625rem + 4.5vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-1{font-size:5rem}}.display-2{font-size:calc(1.575rem + 3.9vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-2{font-size:4.5rem}}.display-3{font-size:calc(1.525rem + 3.3vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-3{font-size:4rem}}.display-4{font-size:calc(1.475rem + 2.7vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-4{font-size:3.5rem}}.display-5{font-size:calc(1.425rem + 2.1vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-5{font-size:3rem}}.display-6{font-size:calc(1.375rem + 1.5vw);font-weight:300;line-height:1.2}@media (min-width:1200px){.display-6{font-size:2.5rem}}.list-unstyled{padding-left:0;list-style:none}.list-inline{padding-left:0;list-style:none}.list-inline-item{display:inline-block}.list-inline-item:not(:last-child){margin-right:.5rem}.initialism{font-size:.875em;text-transform:uppercase}.blockquote{margin-bottom:1rem;font-size:1.25rem}.blockquote>:last-child{margin-bottom:0}.blockquote-footer{margin-top:-1rem;margin-bottom:1rem;font-size:.875em;color:#6c757d}.blockquote-footer::before{content:"— "}.img-fluid{max-width:100%;height:auto}.img-thumbnail{padding:.25rem;background-color:#fff;border:1px solid #dee2e6;border-radius:.25rem;max-width:100%;height:auto}.figure{display:inline-block}.figure-img{margin-bottom:.5rem;line-height:1}.figure-caption{font-size:.875em;color:#6c757d}.container,.container-fluid,.container-lg,.container-md,.container-sm,.container-xl,.container-xxl{width:100%;padding-right:var(--bs-gutter-x,.75rem);padding-left:var(--bs-gutter-x,.75rem);margin-right:auto;margin-left:auto}@media (min-width:576px){.container,.container-sm{max-width:540px}}@media (min-width:768px){.container,.container-md,.container-sm{max-width:720px}}@media (min-width:992px){.container,.container-lg,.container-md,.container-sm{max-width:960px}}@media (min-width:1200px){.container,.container-lg,.container-md,.container-sm,.container-xl{max-width:1140px}}@media (min-width:1400px){.container,.container-lg,.container-md,.container-sm,.container-xl,.container-xxl{max-width:1320px}}.row{--bs-gutter-x:1.5rem;--bs-gutter-y:0;display:flex;flex-wrap:wrap;margin-top:calc(var(--bs-gutter-y) * -1);margin-right:calc(var(--bs-gutter-x)/ -2);margin-left:calc(var(--bs-gutter-x)/ -2)}.row>*{flex-shrink:0;width:100%;max-width:100%;padding-right:calc(var(--bs-gutter-x)/ 2);padding-left:calc(var(--bs-gutter-x)/ 2);margin-top:var(--bs-gutter-y)}.col{flex:1 0 0%}.row-cols-auto>*{flex:0 0 auto;width:auto}.row-cols-1>*{flex:0 0 auto;width:100%}.row-cols-2>*{flex:0 0 auto;width:50%}.row-cols-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-4>*{flex:0 0 auto;width:25%}.row-cols-5>*{flex:0 0 auto;width:20%}.row-cols-6>*{flex:0 0 auto;width:16.6666666667%}.col-auto{flex:0 0 auto;width:auto}.col-1{flex:0 0 auto;width:8.3333333333%}.col-2{flex:0 0 auto;width:16.6666666667%}.col-3{flex:0 0 auto;width:25%}.col-4{flex:0 0 auto;width:33.3333333333%}.col-5{flex:0 0 auto;width:41.6666666667%}.col-6{flex:0 0 auto;width:50%}.col-7{flex:0 0 auto;width:58.3333333333%}.col-8{flex:0 0 auto;width:66.6666666667%}.col-9{flex:0 0 auto;width:75%}.col-10{flex:0 0 auto;width:83.3333333333%}.col-11{flex:0 0 auto;width:91.6666666667%}.col-12{flex:0 0 auto;width:100%}.offset-1{margin-left:8.3333333333%}.offset-2{margin-left:16.6666666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.3333333333%}.offset-5{margin-left:41.6666666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.3333333333%}.offset-8{margin-left:66.6666666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.3333333333%}.offset-11{margin-left:91.6666666667%}.g-0,.gx-0{--bs-gutter-x:0}.g-0,.gy-0{--bs-gutter-y:0}.g-1,.gx-1{--bs-gutter-x:0.25rem}.g-1,.gy-1{--bs-gutter-y:0.25rem}.g-2,.gx-2{--bs-gutter-x:0.5rem}.g-2,.gy-2{--bs-gutter-y:0.5rem}.g-3,.gx-3{--bs-gutter-x:1rem}.g-3,.gy-3{--bs-gutter-y:1rem}.g-4,.gx-4{--bs-gutter-x:1.5rem}.g-4,.gy-4{--bs-gutter-y:1.5rem}.g-5,.gx-5{--bs-gutter-x:3rem}.g-5,.gy-5{--bs-gutter-y:3rem}@media (min-width:576px){.col-sm{flex:1 0 0%}.row-cols-sm-auto>*{flex:0 0 auto;width:auto}.row-cols-sm-1>*{flex:0 0 auto;width:100%}.row-cols-sm-2>*{flex:0 0 auto;width:50%}.row-cols-sm-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-sm-4>*{flex:0 0 auto;width:25%}.row-cols-sm-5>*{flex:0 0 auto;width:20%}.row-cols-sm-6>*{flex:0 0 auto;width:16.6666666667%}.col-sm-auto{flex:0 0 auto;width:auto}.col-sm-1{flex:0 0 auto;width:8.3333333333%}.col-sm-2{flex:0 0 auto;width:16.6666666667%}.col-sm-3{flex:0 0 auto;width:25%}.col-sm-4{flex:0 0 auto;width:33.3333333333%}.col-sm-5{flex:0 0 auto;width:41.6666666667%}.col-sm-6{flex:0 0 auto;width:50%}.col-sm-7{flex:0 0 auto;width:58.3333333333%}.col-sm-8{flex:0 0 auto;width:66.6666666667%}.col-sm-9{flex:0 0 auto;width:75%}.col-sm-10{flex:0 0 auto;width:83.3333333333%}.col-sm-11{flex:0 0 auto;width:91.6666666667%}.col-sm-12{flex:0 0 auto;width:100%}.offset-sm-0{margin-left:0}.offset-sm-1{margin-left:8.3333333333%}.offset-sm-2{margin-left:16.6666666667%}.offset-sm-3{margin-left:25%}.offset-sm-4{margin-left:33.3333333333%}.offset-sm-5{margin-left:41.6666666667%}.offset-sm-6{margin-left:50%}.offset-sm-7{margin-left:58.3333333333%}.offset-sm-8{margin-left:66.6666666667%}.offset-sm-9{margin-left:75%}.offset-sm-10{margin-left:83.3333333333%}.offset-sm-11{margin-left:91.6666666667%}.g-sm-0,.gx-sm-0{--bs-gutter-x:0}.g-sm-0,.gy-sm-0{--bs-gutter-y:0}.g-sm-1,.gx-sm-1{--bs-gutter-x:0.25rem}.g-sm-1,.gy-sm-1{--bs-gutter-y:0.25rem}.g-sm-2,.gx-sm-2{--bs-gutter-x:0.5rem}.g-sm-2,.gy-sm-2{--bs-gutter-y:0.5rem}.g-sm-3,.gx-sm-3{--bs-gutter-x:1rem}.g-sm-3,.gy-sm-3{--bs-gutter-y:1rem}.g-sm-4,.gx-sm-4{--bs-gutter-x:1.5rem}.g-sm-4,.gy-sm-4{--bs-gutter-y:1.5rem}.g-sm-5,.gx-sm-5{--bs-gutter-x:3rem}.g-sm-5,.gy-sm-5{--bs-gutter-y:3rem}}@media (min-width:768px){.col-md{flex:1 0 0%}.row-cols-md-auto>*{flex:0 0 auto;width:auto}.row-cols-md-1>*{flex:0 0 auto;width:100%}.row-cols-md-2>*{flex:0 0 auto;width:50%}.row-cols-md-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-md-4>*{flex:0 0 auto;width:25%}.row-cols-md-5>*{flex:0 0 auto;width:20%}.row-cols-md-6>*{flex:0 0 auto;width:16.6666666667%}.col-md-auto{flex:0 0 auto;width:auto}.col-md-1{flex:0 0 auto;width:8.3333333333%}.col-md-2{flex:0 0 auto;width:16.6666666667%}.col-md-3{flex:0 0 auto;width:25%}.col-md-4{flex:0 0 auto;width:33.3333333333%}.col-md-5{flex:0 0 auto;width:41.6666666667%}.col-md-6{flex:0 0 auto;width:50%}.col-md-7{flex:0 0 auto;width:58.3333333333%}.col-md-8{flex:0 0 auto;width:66.6666666667%}.col-md-9{flex:0 0 auto;width:75%}.col-md-10{flex:0 0 auto;width:83.3333333333%}.col-md-11{flex:0 0 auto;width:91.6666666667%}.col-md-12{flex:0 0 auto;width:100%}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.3333333333%}.offset-md-2{margin-left:16.6666666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.3333333333%}.offset-md-5{margin-left:41.6666666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.3333333333%}.offset-md-8{margin-left:66.6666666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.3333333333%}.offset-md-11{margin-left:91.6666666667%}.g-md-0,.gx-md-0{--bs-gutter-x:0}.g-md-0,.gy-md-0{--bs-gutter-y:0}.g-md-1,.gx-md-1{--bs-gutter-x:0.25rem}.g-md-1,.gy-md-1{--bs-gutter-y:0.25rem}.g-md-2,.gx-md-2{--bs-gutter-x:0.5rem}.g-md-2,.gy-md-2{--bs-gutter-y:0.5rem}.g-md-3,.gx-md-3{--bs-gutter-x:1rem}.g-md-3,.gy-md-3{--bs-gutter-y:1rem}.g-md-4,.gx-md-4{--bs-gutter-x:1.5rem}.g-md-4,.gy-md-4{--bs-gutter-y:1.5rem}.g-md-5,.gx-md-5{--bs-gutter-x:3rem}.g-md-5,.gy-md-5{--bs-gutter-y:3rem}}@media (min-width:992px){.col-lg{flex:1 0 0%}.row-cols-lg-auto>*{flex:0 0 auto;width:auto}.row-cols-lg-1>*{flex:0 0 auto;width:100%}.row-cols-lg-2>*{flex:0 0 auto;width:50%}.row-cols-lg-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-lg-4>*{flex:0 0 auto;width:25%}.row-cols-lg-5>*{flex:0 0 auto;width:20%}.row-cols-lg-6>*{flex:0 0 auto;width:16.6666666667%}.col-lg-auto{flex:0 0 auto;width:auto}.col-lg-1{flex:0 0 auto;width:8.3333333333%}.col-lg-2{flex:0 0 auto;width:16.6666666667%}.col-lg-3{flex:0 0 auto;width:25%}.col-lg-4{flex:0 0 auto;width:33.3333333333%}.col-lg-5{flex:0 0 auto;width:41.6666666667%}.col-lg-6{flex:0 0 auto;width:50%}.col-lg-7{flex:0 0 auto;width:58.3333333333%}.col-lg-8{flex:0 0 auto;width:66.6666666667%}.col-lg-9{flex:0 0 auto;width:75%}.col-lg-10{flex:0 0 auto;width:83.3333333333%}.col-lg-11{flex:0 0 auto;width:91.6666666667%}.col-lg-12{flex:0 0 auto;width:100%}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.3333333333%}.offset-lg-2{margin-left:16.6666666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.3333333333%}.offset-lg-5{margin-left:41.6666666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.3333333333%}.offset-lg-8{margin-left:66.6666666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.3333333333%}.offset-lg-11{margin-left:91.6666666667%}.g-lg-0,.gx-lg-0{--bs-gutter-x:0}.g-lg-0,.gy-lg-0{--bs-gutter-y:0}.g-lg-1,.gx-lg-1{--bs-gutter-x:0.25rem}.g-lg-1,.gy-lg-1{--bs-gutter-y:0.25rem}.g-lg-2,.gx-lg-2{--bs-gutter-x:0.5rem}.g-lg-2,.gy-lg-2{--bs-gutter-y:0.5rem}.g-lg-3,.gx-lg-3{--bs-gutter-x:1rem}.g-lg-3,.gy-lg-3{--bs-gutter-y:1rem}.g-lg-4,.gx-lg-4{--bs-gutter-x:1.5rem}.g-lg-4,.gy-lg-4{--bs-gutter-y:1.5rem}.g-lg-5,.gx-lg-5{--bs-gutter-x:3rem}.g-lg-5,.gy-lg-5{--bs-gutter-y:3rem}}@media (min-width:1200px){.col-xl{flex:1 0 0%}.row-cols-xl-auto>*{flex:0 0 auto;width:auto}.row-cols-xl-1>*{flex:0 0 auto;width:100%}.row-cols-xl-2>*{flex:0 0 auto;width:50%}.row-cols-xl-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-xl-4>*{flex:0 0 auto;width:25%}.row-cols-xl-5>*{flex:0 0 auto;width:20%}.row-cols-xl-6>*{flex:0 0 auto;width:16.6666666667%}.col-xl-auto{flex:0 0 auto;width:auto}.col-xl-1{flex:0 0 auto;width:8.3333333333%}.col-xl-2{flex:0 0 auto;width:16.6666666667%}.col-xl-3{flex:0 0 auto;width:25%}.col-xl-4{flex:0 0 auto;width:33.3333333333%}.col-xl-5{flex:0 0 auto;width:41.6666666667%}.col-xl-6{flex:0 0 auto;width:50%}.col-xl-7{flex:0 0 auto;width:58.3333333333%}.col-xl-8{flex:0 0 auto;width:66.6666666667%}.col-xl-9{flex:0 0 auto;width:75%}.col-xl-10{flex:0 0 auto;width:83.3333333333%}.col-xl-11{flex:0 0 auto;width:91.6666666667%}.col-xl-12{flex:0 0 auto;width:100%}.offset-xl-0{margin-left:0}.offset-xl-1{margin-left:8.3333333333%}.offset-xl-2{margin-left:16.6666666667%}.offset-xl-3{margin-left:25%}.offset-xl-4{margin-left:33.3333333333%}.offset-xl-5{margin-left:41.6666666667%}.offset-xl-6{margin-left:50%}.offset-xl-7{margin-left:58.3333333333%}.offset-xl-8{margin-left:66.6666666667%}.offset-xl-9{margin-left:75%}.offset-xl-10{margin-left:83.3333333333%}.offset-xl-11{margin-left:91.6666666667%}.g-xl-0,.gx-xl-0{--bs-gutter-x:0}.g-xl-0,.gy-xl-0{--bs-gutter-y:0}.g-xl-1,.gx-xl-1{--bs-gutter-x:0.25rem}.g-xl-1,.gy-xl-1{--bs-gutter-y:0.25rem}.g-xl-2,.gx-xl-2{--bs-gutter-x:0.5rem}.g-xl-2,.gy-xl-2{--bs-gutter-y:0.5rem}.g-xl-3,.gx-xl-3{--bs-gutter-x:1rem}.g-xl-3,.gy-xl-3{--bs-gutter-y:1rem}.g-xl-4,.gx-xl-4{--bs-gutter-x:1.5rem}.g-xl-4,.gy-xl-4{--bs-gutter-y:1.5rem}.g-xl-5,.gx-xl-5{--bs-gutter-x:3rem}.g-xl-5,.gy-xl-5{--bs-gutter-y:3rem}}@media (min-width:1400px){.col-xxl{flex:1 0 0%}.row-cols-xxl-auto>*{flex:0 0 auto;width:auto}.row-cols-xxl-1>*{flex:0 0 auto;width:100%}.row-cols-xxl-2>*{flex:0 0 auto;width:50%}.row-cols-xxl-3>*{flex:0 0 auto;width:33.3333333333%}.row-cols-xxl-4>*{flex:0 0 auto;width:25%}.row-cols-xxl-5>*{flex:0 0 auto;width:20%}.row-cols-xxl-6>*{flex:0 0 auto;width:16.6666666667%}.col-xxl-auto{flex:0 0 auto;width:auto}.col-xxl-1{flex:0 0 auto;width:8.3333333333%}.col-xxl-2{flex:0 0 auto;width:16.6666666667%}.col-xxl-3{flex:0 0 auto;width:25%}.col-xxl-4{flex:0 0 auto;width:33.3333333333%}.col-xxl-5{flex:0 0 auto;width:41.6666666667%}.col-xxl-6{flex:0 0 auto;width:50%}.col-xxl-7{flex:0 0 auto;width:58.3333333333%}.col-xxl-8{flex:0 0 auto;width:66.6666666667%}.col-xxl-9{flex:0 0 auto;width:75%}.col-xxl-10{flex:0 0 auto;width:83.3333333333%}.col-xxl-11{flex:0 0 auto;width:91.6666666667%}.col-xxl-12{flex:0 0 auto;width:100%}.offset-xxl-0{margin-left:0}.offset-xxl-1{margin-left:8.3333333333%}.offset-xxl-2{margin-left:16.6666666667%}.offset-xxl-3{margin-left:25%}.offset-xxl-4{margin-left:33.3333333333%}.offset-xxl-5{margin-left:41.6666666667%}.offset-xxl-6{margin-left:50%}.offset-xxl-7{margin-left:58.3333333333%}.offset-xxl-8{margin-left:66.6666666667%}.offset-xxl-9{margin-left:75%}.offset-xxl-10{margin-left:83.3333333333%}.offset-xxl-11{margin-left:91.6666666667%}.g-xxl-0,.gx-xxl-0{--bs-gutter-x:0}.g-xxl-0,.gy-xxl-0{--bs-gutter-y:0}.g-xxl-1,.gx-xxl-1{--bs-gutter-x:0.25rem}.g-xxl-1,.gy-xxl-1{--bs-gutter-y:0.25rem}.g-xxl-2,.gx-xxl-2{--bs-gutter-x:0.5rem}.g-xxl-2,.gy-xxl-2{--bs-gutter-y:0.5rem}.g-xxl-3,.gx-xxl-3{--bs-gutter-x:1rem}.g-xxl-3,.gy-xxl-3{--bs-gutter-y:1rem}.g-xxl-4,.gx-xxl-4{--bs-gutter-x:1.5rem}.g-xxl-4,.gy-xxl-4{--bs-gutter-y:1.5rem}.g-xxl-5,.gx-xxl-5{--bs-gutter-x:3rem}.g-xxl-5,.gy-xxl-5{--bs-gutter-y:3rem}}.table{--bs-table-bg:transparent;--bs-table-accent-bg:transparent;--bs-table-striped-color:#212529;--bs-table-striped-bg:rgba(0, 0, 0, 0.05);--bs-table-active-color:#212529;--bs-table-active-bg:rgba(0, 0, 0, 0.1);--bs-table-hover-color:#212529;--bs-table-hover-bg:rgba(0, 0, 0, 0.075);width:100%;margin-bottom:1rem;color:#212529;vertical-align:top;border-color:#dee2e6}.table>:not(caption)>*>*{padding:.5rem .5rem;background-color:var(--bs-table-bg);border-bottom-width:1px;box-shadow:inset 0 0 0 9999px var(--bs-table-accent-bg)}.table>tbody{vertical-align:inherit}.table>thead{vertical-align:bottom}.table>:not(:last-child)>:last-child>*{border-bottom-color:currentColor}.caption-top{caption-side:top}.table-sm>:not(caption)>*>*{padding:.25rem .25rem}.table-bordered>:not(caption)>*{border-width:1px 0}.table-bordered>:not(caption)>*>*{border-width:0 1px}.table-borderless>:not(caption)>*>*{border-bottom-width:0}.table-striped>tbody>tr:nth-of-type(odd){--bs-table-accent-bg:var(--bs-table-striped-bg);color:var(--bs-table-striped-color)}.table-active{--bs-table-accent-bg:var(--bs-table-active-bg);color:var(--bs-table-active-color)}.table-hover>tbody>tr:hover{--bs-table-accent-bg:var(--bs-table-hover-bg);color:var(--bs-table-hover-color)}.table-primary{--bs-table-bg:#cfe2ff;--bs-table-striped-bg:#c5d7f2;--bs-table-striped-color:#000;--bs-table-active-bg:#bacbe6;--bs-table-active-color:#000;--bs-table-hover-bg:#bfd1ec;--bs-table-hover-color:#000;color:#000;border-color:#bacbe6}.table-secondary{--bs-table-bg:#e2e3e5;--bs-table-striped-bg:#d7d8da;--bs-table-striped-color:#000;--bs-table-active-bg:#cbccce;--bs-table-active-color:#000;--bs-table-hover-bg:#d1d2d4;--bs-table-hover-color:#000;color:#000;border-color:#cbccce}.table-success{--bs-table-bg:#d1e7dd;--bs-table-striped-bg:#c7dbd2;--bs-table-striped-color:#000;--bs-table-active-bg:#bcd0c7;--bs-table-active-color:#000;--bs-table-hover-bg:#c1d6cc;--bs-table-hover-color:#000;color:#000;border-color:#bcd0c7}.table-info{--bs-table-bg:#cff4fc;--bs-table-striped-bg:#c5e8ef;--bs-table-striped-color:#000;--bs-table-active-bg:#badce3;--bs-table-active-color:#000;--bs-table-hover-bg:#bfe2e9;--bs-table-hover-color:#000;color:#000;border-color:#badce3}.table-warning{--bs-table-bg:#fff3cd;--bs-table-striped-bg:#f2e7c3;--bs-table-striped-color:#000;--bs-table-active-bg:#e6dbb9;--bs-table-active-color:#000;--bs-table-hover-bg:#ece1be;--bs-table-hover-color:#000;color:#000;border-color:#e6dbb9}.table-danger{--bs-table-bg:#f8d7da;--bs-table-striped-bg:#eccccf;--bs-table-striped-color:#000;--bs-table-active-bg:#dfc2c4;--bs-table-active-color:#000;--bs-table-hover-bg:#e5c7ca;--bs-table-hover-color:#000;color:#000;border-color:#dfc2c4}.table-light{--bs-table-bg:#f8f9fa;--bs-table-striped-bg:#ecedee;--bs-table-striped-color:#000;--bs-table-active-bg:#dfe0e1;--bs-table-active-color:#000;--bs-table-hover-bg:#e5e6e7;--bs-table-hover-color:#000;color:#000;border-color:#dfe0e1}.table-dark{--bs-table-bg:#212529;--bs-table-striped-bg:#2c3034;--bs-table-striped-color:#fff;--bs-table-active-bg:#373b3e;--bs-table-active-color:#fff;--bs-table-hover-bg:#323539;--bs-table-hover-color:#fff;color:#fff;border-color:#373b3e}.table-responsive{overflow-x:auto;-webkit-overflow-scrolling:touch}@media (max-width:575.98px){.table-responsive-sm{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width:767.98px){.table-responsive-md{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width:991.98px){.table-responsive-lg{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width:1199.98px){.table-responsive-xl{overflow-x:auto;-webkit-overflow-scrolling:touch}}@media (max-width:1399.98px){.table-responsive-xxl{overflow-x:auto;-webkit-overflow-scrolling:touch}}.btn{display:inline-block;font-weight:400;line-height:1.5;color:#212529;text-align:center;text-decoration:none;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;border-radius:.25rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529}.btn-check:focus+.btn,.btn:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.btn.disabled,.btn:disabled,fieldset:disabled .btn{pointer-events:none;opacity:.65}.btn-primary{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-primary:hover{color:#fff;background-color:#0b5ed7;border-color:#0a58ca}.btn-check:focus+.btn-primary,.btn-primary:focus{color:#fff;background-color:#0b5ed7;border-color:#0a58ca;box-shadow:0 0 0 .25rem rgba(49,132,253,.5)}.btn-check:active+.btn-primary,.btn-check:checked+.btn-primary,.btn-primary.active,.btn-primary:active,.show>.btn-primary.dropdown-toggle{color:#fff;background-color:#0a58ca;border-color:#0a53be}.btn-check:active+.btn-primary:focus,.btn-check:checked+.btn-primary:focus,.btn-primary.active:focus,.btn-primary:active:focus,.show>.btn-primary.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(49,132,253,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-secondary{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-secondary:hover{color:#fff;background-color:#5c636a;border-color:#565e64}.btn-check:focus+.btn-secondary,.btn-secondary:focus{color:#fff;background-color:#5c636a;border-color:#565e64;box-shadow:0 0 0 .25rem rgba(130,138,145,.5)}.btn-check:active+.btn-secondary,.btn-check:checked+.btn-secondary,.btn-secondary.active,.btn-secondary:active,.show>.btn-secondary.dropdown-toggle{color:#fff;background-color:#565e64;border-color:#51585e}.btn-check:active+.btn-secondary:focus,.btn-check:checked+.btn-secondary:focus,.btn-secondary.active:focus,.btn-secondary:active:focus,.show>.btn-secondary.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(130,138,145,.5)}.btn-secondary.disabled,.btn-secondary:disabled{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-success{color:#fff;background-color:#198754;border-color:#198754}.btn-success:hover{color:#fff;background-color:#157347;border-color:#146c43}.btn-check:focus+.btn-success,.btn-success:focus{color:#fff;background-color:#157347;border-color:#146c43;box-shadow:0 0 0 .25rem rgba(60,153,110,.5)}.btn-check:active+.btn-success,.btn-check:checked+.btn-success,.btn-success.active,.btn-success:active,.show>.btn-success.dropdown-toggle{color:#fff;background-color:#146c43;border-color:#13653f}.btn-check:active+.btn-success:focus,.btn-check:checked+.btn-success:focus,.btn-success.active:focus,.btn-success:active:focus,.show>.btn-success.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(60,153,110,.5)}.btn-success.disabled,.btn-success:disabled{color:#fff;background-color:#198754;border-color:#198754}.btn-info{color:#000;background-color:#0dcaf0;border-color:#0dcaf0}.btn-info:hover{color:#000;background-color:#31d2f2;border-color:#25cff2}.btn-check:focus+.btn-info,.btn-info:focus{color:#000;background-color:#31d2f2;border-color:#25cff2;box-shadow:0 0 0 .25rem rgba(11,172,204,.5)}.btn-check:active+.btn-info,.btn-check:checked+.btn-info,.btn-info.active,.btn-info:active,.show>.btn-info.dropdown-toggle{color:#000;background-color:#3dd5f3;border-color:#25cff2}.btn-check:active+.btn-info:focus,.btn-check:checked+.btn-info:focus,.btn-info.active:focus,.btn-info:active:focus,.show>.btn-info.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(11,172,204,.5)}.btn-info.disabled,.btn-info:disabled{color:#000;background-color:#0dcaf0;border-color:#0dcaf0}.btn-warning{color:#000;background-color:#ffc107;border-color:#ffc107}.btn-warning:hover{color:#000;background-color:#ffca2c;border-color:#ffc720}.btn-check:focus+.btn-warning,.btn-warning:focus{color:#000;background-color:#ffca2c;border-color:#ffc720;box-shadow:0 0 0 .25rem rgba(217,164,6,.5)}.btn-check:active+.btn-warning,.btn-check:checked+.btn-warning,.btn-warning.active,.btn-warning:active,.show>.btn-warning.dropdown-toggle{color:#000;background-color:#ffcd39;border-color:#ffc720}.btn-check:active+.btn-warning:focus,.btn-check:checked+.btn-warning:focus,.btn-warning.active:focus,.btn-warning:active:focus,.show>.btn-warning.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(217,164,6,.5)}.btn-warning.disabled,.btn-warning:disabled{color:#000;background-color:#ffc107;border-color:#ffc107}.btn-danger{color:#fff;background-color:#dc3545;border-color:#dc3545}.btn-danger:hover{color:#fff;background-color:#bb2d3b;border-color:#b02a37}.btn-check:focus+.btn-danger,.btn-danger:focus{color:#fff;background-color:#bb2d3b;border-color:#b02a37;box-shadow:0 0 0 .25rem rgba(225,83,97,.5)}.btn-check:active+.btn-danger,.btn-check:checked+.btn-danger,.btn-danger.active,.btn-danger:active,.show>.btn-danger.dropdown-toggle{color:#fff;background-color:#b02a37;border-color:#a52834}.btn-check:active+.btn-danger:focus,.btn-check:checked+.btn-danger:focus,.btn-danger.active:focus,.btn-danger:active:focus,.show>.btn-danger.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(225,83,97,.5)}.btn-danger.disabled,.btn-danger:disabled{color:#fff;background-color:#dc3545;border-color:#dc3545}.btn-light{color:#000;background-color:#f8f9fa;border-color:#f8f9fa}.btn-light:hover{color:#000;background-color:#f9fafb;border-color:#f9fafb}.btn-check:focus+.btn-light,.btn-light:focus{color:#000;background-color:#f9fafb;border-color:#f9fafb;box-shadow:0 0 0 .25rem rgba(211,212,213,.5)}.btn-check:active+.btn-light,.btn-check:checked+.btn-light,.btn-light.active,.btn-light:active,.show>.btn-light.dropdown-toggle{color:#000;background-color:#f9fafb;border-color:#f9fafb}.btn-check:active+.btn-light:focus,.btn-check:checked+.btn-light:focus,.btn-light.active:focus,.btn-light:active:focus,.show>.btn-light.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(211,212,213,.5)}.btn-light.disabled,.btn-light:disabled{color:#000;background-color:#f8f9fa;border-color:#f8f9fa}.btn-dark{color:#fff;background-color:#212529;border-color:#212529}.btn-dark:hover{color:#fff;background-color:#1c1f23;border-color:#1a1e21}.btn-check:focus+.btn-dark,.btn-dark:focus{color:#fff;background-color:#1c1f23;border-color:#1a1e21;box-shadow:0 0 0 .25rem rgba(66,70,73,.5)}.btn-check:active+.btn-dark,.btn-check:checked+.btn-dark,.btn-dark.active,.btn-dark:active,.show>.btn-dark.dropdown-toggle{color:#fff;background-color:#1a1e21;border-color:#191c1f}.btn-check:active+.btn-dark:focus,.btn-check:checked+.btn-dark:focus,.btn-dark.active:focus,.btn-dark:active:focus,.show>.btn-dark.dropdown-toggle:focus{box-shadow:0 0 0 .25rem rgba(66,70,73,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-primary{color:#0d6efd;border-color:#0d6efd}.btn-outline-primary:hover{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-check:focus+.btn-outline-primary,.btn-outline-primary:focus{box-shadow:0 0 0 .25rem rgba(13,110,253,.5)}.btn-check:active+.btn-outline-primary,.btn-check:checked+.btn-outline-primary,.btn-outline-primary.active,.btn-outline-primary.dropdown-toggle.show,.btn-outline-primary:active{color:#fff;background-color:#0d6efd;border-color:#0d6efd}.btn-check:active+.btn-outline-primary:focus,.btn-check:checked+.btn-outline-primary:focus,.btn-outline-primary.active:focus,.btn-outline-primary.dropdown-toggle.show:focus,.btn-outline-primary:active:focus{box-shadow:0 0 0 .25rem rgba(13,110,253,.5)}.btn-outline-primary.disabled,.btn-outline-primary:disabled{color:#0d6efd;background-color:transparent}.btn-outline-secondary{color:#6c757d;border-color:#6c757d}.btn-outline-secondary:hover{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-check:focus+.btn-outline-secondary,.btn-outline-secondary:focus{box-shadow:0 0 0 .25rem rgba(108,117,125,.5)}.btn-check:active+.btn-outline-secondary,.btn-check:checked+.btn-outline-secondary,.btn-outline-secondary.active,.btn-outline-secondary.dropdown-toggle.show,.btn-outline-secondary:active{color:#fff;background-color:#6c757d;border-color:#6c757d}.btn-check:active+.btn-outline-secondary:focus,.btn-check:checked+.btn-outline-secondary:focus,.btn-outline-secondary.active:focus,.btn-outline-secondary.dropdown-toggle.show:focus,.btn-outline-secondary:active:focus{box-shadow:0 0 0 .25rem rgba(108,117,125,.5)}.btn-outline-secondary.disabled,.btn-outline-secondary:disabled{color:#6c757d;background-color:transparent}.btn-outline-success{color:#198754;border-color:#198754}.btn-outline-success:hover{color:#fff;background-color:#198754;border-color:#198754}.btn-check:focus+.btn-outline-success,.btn-outline-success:focus{box-shadow:0 0 0 .25rem rgba(25,135,84,.5)}.btn-check:active+.btn-outline-success,.btn-check:checked+.btn-outline-success,.btn-outline-success.active,.btn-outline-success.dropdown-toggle.show,.btn-outline-success:active{color:#fff;background-color:#198754;border-color:#198754}.btn-check:active+.btn-outline-success:focus,.btn-check:checked+.btn-outline-success:focus,.btn-outline-success.active:focus,.btn-outline-success.dropdown-toggle.show:focus,.btn-outline-success:active:focus{box-shadow:0 0 0 .25rem rgba(25,135,84,.5)}.btn-outline-success.disabled,.btn-outline-success:disabled{color:#198754;background-color:transparent}.btn-outline-info{color:#0dcaf0;border-color:#0dcaf0}.btn-outline-info:hover{color:#000;background-color:#0dcaf0;border-color:#0dcaf0}.btn-check:focus+.btn-outline-info,.btn-outline-info:focus{box-shadow:0 0 0 .25rem rgba(13,202,240,.5)}.btn-check:active+.btn-outline-info,.btn-check:checked+.btn-outline-info,.btn-outline-info.active,.btn-outline-info.dropdown-toggle.show,.btn-outline-info:active{color:#000;background-color:#0dcaf0;border-color:#0dcaf0}.btn-check:active+.btn-outline-info:focus,.btn-check:checked+.btn-outline-info:focus,.btn-outline-info.active:focus,.btn-outline-info.dropdown-toggle.show:focus,.btn-outline-info:active:focus{box-shadow:0 0 0 .25rem rgba(13,202,240,.5)}.btn-outline-info.disabled,.btn-outline-info:disabled{color:#0dcaf0;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#000;background-color:#ffc107;border-color:#ffc107}.btn-check:focus+.btn-outline-warning,.btn-outline-warning:focus{box-shadow:0 0 0 .25rem rgba(255,193,7,.5)}.btn-check:active+.btn-outline-warning,.btn-check:checked+.btn-outline-warning,.btn-outline-warning.active,.btn-outline-warning.dropdown-toggle.show,.btn-outline-warning:active{color:#000;background-color:#ffc107;border-color:#ffc107}.btn-check:active+.btn-outline-warning:focus,.btn-check:checked+.btn-outline-warning:focus,.btn-outline-warning.active:focus,.btn-outline-warning.dropdown-toggle.show:focus,.btn-outline-warning:active:focus{box-shadow:0 0 0 .25rem rgba(255,193,7,.5)}.btn-outline-warning.disabled,.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-danger{color:#dc3545;border-color:#dc3545}.btn-outline-danger:hover{color:#fff;background-color:#dc3545;border-color:#dc3545}.btn-check:focus+.btn-outline-danger,.btn-outline-danger:focus{box-shadow:0 0 0 .25rem rgba(220,53,69,.5)}.btn-check:active+.btn-outline-danger,.btn-check:checked+.btn-outline-danger,.btn-outline-danger.active,.btn-outline-danger.dropdown-toggle.show,.btn-outline-danger:active{color:#fff;background-color:#dc3545;border-color:#dc3545}.btn-check:active+.btn-outline-danger:focus,.btn-check:checked+.btn-outline-danger:focus,.btn-outline-danger.active:focus,.btn-outline-danger.dropdown-toggle.show:focus,.btn-outline-danger:active:focus{box-shadow:0 0 0 .25rem rgba(220,53,69,.5)}.btn-outline-danger.disabled,.btn-outline-danger:disabled{color:#dc3545;background-color:transparent}.btn-outline-light{color:#f8f9fa;border-color:#f8f9fa}.btn-outline-light:hover{color:#000;background-color:#f8f9fa;border-color:#f8f9fa}.btn-check:focus+.btn-outline-light,.btn-outline-light:focus{box-shadow:0 0 0 .25rem rgba(248,249,250,.5)}.btn-check:active+.btn-outline-light,.btn-check:checked+.btn-outline-light,.btn-outline-light.active,.btn-outline-light.dropdown-toggle.show,.btn-outline-light:active{color:#000;background-color:#f8f9fa;border-color:#f8f9fa}.btn-check:active+.btn-outline-light:focus,.btn-check:checked+.btn-outline-light:focus,.btn-outline-light.active:focus,.btn-outline-light.dropdown-toggle.show:focus,.btn-outline-light:active:focus{box-shadow:0 0 0 .25rem rgba(248,249,250,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#f8f9fa;background-color:transparent}.btn-outline-dark{color:#212529;border-color:#212529}.btn-outline-dark:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-check:focus+.btn-outline-dark,.btn-outline-dark:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-check:active+.btn-outline-dark,.btn-check:checked+.btn-outline-dark,.btn-outline-dark.active,.btn-outline-dark.dropdown-toggle.show,.btn-outline-dark:active{color:#fff;background-color:#212529;border-color:#212529}.btn-check:active+.btn-outline-dark:focus,.btn-check:checked+.btn-outline-dark:focus,.btn-outline-dark.active:focus,.btn-outline-dark.dropdown-toggle.show:focus,.btn-outline-dark:active:focus{box-shadow:0 0 0 .25rem rgba(33,37,41,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#212529;background-color:transparent}.btn-link{font-weight:400;color:#0d6efd;text-decoration:underline}.btn-link:hover{color:#0a58ca}.btn-link.disabled,.btn-link:disabled{color:#6c757d}.btn-group-lg>.btn,.btn-lg{padding:.5rem 1rem;font-size:1.25rem;border-radius:.3rem}.btn-group-sm>.btn,.btn-sm{padding:.25rem .5rem;font-size:.875rem;border-radius:.2rem}.fade{transition:opacity .15s linear}@media (prefers-reduced-motion:reduce){.fade{transition:none}}.fade:not(.show){opacity:0}.collapse:not(.show){display:none}.collapsing{height:0;overflow:hidden;transition:height .35s ease}@media (prefers-reduced-motion:reduce){.collapsing{transition:none}}.btn-group,.btn-group-vertical{position:relative;display:inline-flex;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group-vertical>.btn-check:checked+.btn,.btn-group-vertical>.btn-check:focus+.btn,.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group-vertical>.btn:hover,.btn-group>.btn-check:checked+.btn,.btn-group>.btn-check:focus+.btn,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-toolbar{display:flex;flex-wrap:wrap;justify-content:flex-start}.btn-toolbar .input-group{width:auto}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn,.btn-group>.btn:not(:last-child):not(.dropdown-toggle){border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:nth-child(n+3),.btn-group>:not(.btn-check)+.btn{border-top-left-radius:0;border-bottom-left-radius:0}.dropdown-toggle-split{padding-right:.5625rem;padding-left:.5625rem}.dropdown-toggle-split::after,.dropend .dropdown-toggle-split::after,.dropup .dropdown-toggle-split::after{margin-left:0}.dropstart .dropdown-toggle-split::before{margin-right:0}.btn-group-sm>.btn+.dropdown-toggle-split,.btn-sm+.dropdown-toggle-split{padding-right:.375rem;padding-left:.375rem}.btn-group-lg>.btn+.dropdown-toggle-split,.btn-lg+.dropdown-toggle-split{padding-right:.75rem;padding-left:.75rem}.btn-group-vertical{flex-direction:column;align-items:flex-start;justify-content:center}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group{width:100%}.btn-group-vertical>.btn-group:not(:first-child),.btn-group-vertical>.btn:not(:first-child){margin-top:-1px}.btn-group-vertical>.btn-group:not(:last-child)>.btn,.btn-group-vertical>.btn:not(:last-child):not(.dropdown-toggle){border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn~.btn{border-top-left-radius:0;border-top-right-radius:0}.nav{display:flex;flex-wrap:wrap;padding-left:0;margin-bottom:0;list-style:none}.nav-link{display:block;padding:.5rem 1rem;color:#0d6efd;text-decoration:none;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}@media (prefers-reduced-motion:reduce){.nav-link{transition:none}}.nav-link:focus,.nav-link:hover{color:#0a58ca}.nav-link.disabled{color:#6c757d;pointer-events:none;cursor:default}.nav-tabs{border-bottom:1px solid #dee2e6}.nav-tabs .nav-link{margin-bottom:-1px;background:0 0;border:1px solid transparent;border-top-left-radius:.25rem;border-top-right-radius:.25rem}.nav-tabs .nav-link:focus,.nav-tabs .nav-link:hover{border-color:#e9ecef #e9ecef #dee2e6;isolation:isolate}.nav-tabs .nav-link.disabled{color:#6c757d;background-color:transparent;border-color:transparent}.nav-tabs .nav-item.show .nav-link,.nav-tabs .nav-link.active{color:#495057;background-color:#fff;border-color:#dee2e6 #dee2e6 #fff}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-left-radius:0;border-top-right-radius:0}.nav-pills .nav-link{background:0 0;border:0;border-radius:.25rem}.nav-pills .nav-link.active,.nav-pills .show>.nav-link{color:#fff;background-color:#0d6efd}.nav-fill .nav-item,.nav-fill>.nav-link{flex:1 1 auto;text-align:center}.nav-justified .nav-item,.nav-justified>.nav-link{flex-basis:0;flex-grow:1;text-align:center}.nav-fill .nav-item .nav-link,.nav-justified .nav-item .nav-link{width:100%}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.navbar{position:relative;display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding-top:.5rem;padding-bottom:.5rem}.navbar>.container,.navbar>.container-fluid,.navbar>.container-lg,.navbar>.container-md,.navbar>.container-sm,.navbar>.container-xl,.navbar>.container-xxl{display:flex;flex-wrap:inherit;align-items:center;justify-content:space-between}.navbar-brand{padding-top:.3125rem;padding-bottom:.3125rem;margin-right:1rem;font-size:1.25rem;text-decoration:none;white-space:nowrap}.navbar-nav{display:flex;flex-direction:column;padding-left:0;margin-bottom:0;list-style:none}.navbar-nav .nav-link{padding-right:0;padding-left:0}.navbar-nav .dropdown-menu{position:static}.navbar-text{padding-top:.5rem;padding-bottom:.5rem}.navbar-collapse{flex-basis:100%;flex-grow:1;align-items:center}.navbar-toggler{padding:.25rem .75rem;font-size:1.25rem;line-height:1;background-color:transparent;border:1px solid transparent;border-radius:.25rem;transition:box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.navbar-toggler{transition:none}}.navbar-toggler:hover{text-decoration:none}.navbar-toggler:focus{text-decoration:none;outline:0;box-shadow:0 0 0 .25rem}.navbar-toggler-icon{display:inline-block;width:1.5em;height:1.5em;vertical-align:middle;background-repeat:no-repeat;background-position:center;background-size:100%}.navbar-nav-scroll{max-height:var(--bs-scroll-height,75vh);overflow-y:auto}@media (min-width:576px){.navbar-expand-sm{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand-sm .navbar-nav{flex-direction:row}.navbar-expand-sm .navbar-nav .dropdown-menu{position:absolute}.navbar-expand-sm .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand-sm .navbar-nav-scroll{overflow:visible}.navbar-expand-sm .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand-sm .navbar-toggler{display:none}}@media (min-width:768px){.navbar-expand-md{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand-md .navbar-nav{flex-direction:row}.navbar-expand-md .navbar-nav .dropdown-menu{position:absolute}.navbar-expand-md .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand-md .navbar-nav-scroll{overflow:visible}.navbar-expand-md .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand-md .navbar-toggler{display:none}}@media (min-width:992px){.navbar-expand-lg{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand-lg .navbar-nav{flex-direction:row}.navbar-expand-lg .navbar-nav .dropdown-menu{position:absolute}.navbar-expand-lg .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand-lg .navbar-nav-scroll{overflow:visible}.navbar-expand-lg .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand-lg .navbar-toggler{display:none}}@media (min-width:1200px){.navbar-expand-xl{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand-xl .navbar-nav{flex-direction:row}.navbar-expand-xl .navbar-nav .dropdown-menu{position:absolute}.navbar-expand-xl .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand-xl .navbar-nav-scroll{overflow:visible}.navbar-expand-xl .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand-xl .navbar-toggler{display:none}}@media (min-width:1400px){.navbar-expand-xxl{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand-xxl .navbar-nav{flex-direction:row}.navbar-expand-xxl .navbar-nav .dropdown-menu{position:absolute}.navbar-expand-xxl .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand-xxl .navbar-nav-scroll{overflow:visible}.navbar-expand-xxl .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand-xxl .navbar-toggler{display:none}}.navbar-expand{flex-wrap:nowrap;justify-content:flex-start}.navbar-expand .navbar-nav{flex-direction:row}.navbar-expand .navbar-nav .dropdown-menu{position:absolute}.navbar-expand .navbar-nav .nav-link{padding-right:.5rem;padding-left:.5rem}.navbar-expand .navbar-nav-scroll{overflow:visible}.navbar-expand .navbar-collapse{display:flex;flex-basis:auto}.navbar-expand .navbar-toggler{display:none}.navbar-light .navbar-brand{color:rgba(0,0,0,.9)}.navbar-light .navbar-brand:focus,.navbar-light .navbar-brand:hover{color:rgba(0,0,0,.9)}.navbar-light .navbar-nav .nav-link{color:rgba(0,0,0,.55)}.navbar-light .navbar-nav .nav-link:focus,.navbar-light .navbar-nav .nav-link:hover{color:rgba(0,0,0,.7)}.navbar-light .navbar-nav .nav-link.disabled{color:rgba(0,0,0,.3)}.navbar-light .navbar-nav .nav-link.active,.navbar-light .navbar-nav .show>.nav-link{color:rgba(0,0,0,.9)}.navbar-light .navbar-toggler{color:rgba(0,0,0,.55);border-color:rgba(0,0,0,.1)}.navbar-light .navbar-toggler-icon{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.55%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e")}.navbar-light .navbar-text{color:rgba(0,0,0,.55)}.navbar-light .navbar-text a,.navbar-light .navbar-text a:focus,.navbar-light .navbar-text a:hover{color:rgba(0,0,0,.9)}.navbar-dark .navbar-brand{color:#fff}.navbar-dark .navbar-brand:focus,.navbar-dark .navbar-brand:hover{color:#fff}.navbar-dark .navbar-nav .nav-link{color:rgba(255,255,255,.55)}.navbar-dark .navbar-nav .nav-link:focus,.navbar-dark .navbar-nav .nav-link:hover{color:rgba(255,255,255,.75)}.navbar-dark .navbar-nav .nav-link.disabled{color:rgba(255,255,255,.25)}.navbar-dark .navbar-nav .nav-link.active,.navbar-dark .navbar-nav .show>.nav-link{color:#fff}.navbar-dark .navbar-toggler{color:rgba(255,255,255,.55);border-color:rgba(255,255,255,.1)}.navbar-dark .navbar-toggler-icon{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.55%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e")}.navbar-dark .navbar-text{color:rgba(255,255,255,.55)}.navbar-dark .navbar-text a,.navbar-dark .navbar-text a:focus,.navbar-dark .navbar-text a:hover{color:#fff}.pagination{display:flex;padding-left:0;list-style:none}.page-link{position:relative;display:block;color:#0d6efd;text-decoration:none;background-color:#fff;border:1px solid #dee2e6;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media (prefers-reduced-motion:reduce){.page-link{transition:none}}.page-link:hover{z-index:2;color:#0a58ca;background-color:#e9ecef;border-color:#dee2e6}.page-link:focus{z-index:3;color:#0a58ca;background-color:#e9ecef;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.page-item:not(:first-child) .page-link{margin-left:-1px}.page-item.active .page-link{z-index:3;color:#fff;background-color:#0d6efd;border-color:#0d6efd}.page-item.disabled .page-link{color:#6c757d;pointer-events:none;background-color:#fff;border-color:#dee2e6}.page-link{padding:.375rem .75rem}.page-item:first-child .page-link{border-top-left-radius:.25rem;border-bottom-left-radius:.25rem}.page-item:last-child .page-link{border-top-right-radius:.25rem;border-bottom-right-radius:.25rem}.pagination-lg .page-link{padding:.75rem 1.5rem;font-size:1.25rem}.pagination-lg .page-item:first-child .page-link{border-top-left-radius:.3rem;border-bottom-left-radius:.3rem}.pagination-lg .page-item:last-child .page-link{border-top-right-radius:.3rem;border-bottom-right-radius:.3rem}.pagination-sm .page-link{padding:.25rem .5rem;font-size:.875rem}.pagination-sm .page-item:first-child .page-link{border-top-left-radius:.2rem;border-bottom-left-radius:.2rem}.pagination-sm .page-item:last-child .page-link{border-top-right-radius:.2rem;border-bottom-right-radius:.2rem}.badge{display:inline-block;padding:.35em .65em;font-size:.75em;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25rem}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-close{box-sizing:content-box;width:1em;height:1em;padding:.25em .25em;color:#000;background:transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;border:0;border-radius:.25rem;opacity:.5}.btn-close:hover{color:#000;text-decoration:none;opacity:.75}.btn-close:focus{outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25);opacity:1}.btn-close.disabled,.btn-close:disabled{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.25}.btn-close-white{filter:invert(1) grayscale(100%) brightness(200%)}.tooltip{position:absolute;z-index:1080;display:block;margin:0;font-family:var(--bs-font-sans-serif);font-style:normal;font-weight:400;line-height:1.5;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;letter-spacing:normal;word-break:normal;word-spacing:normal;white-space:normal;line-break:auto;font-size:.875rem;word-wrap:break-word;opacity:0}.tooltip.show{opacity:.9}.tooltip .tooltip-arrow{position:absolute;display:block;width:.8rem;height:.4rem}.tooltip .tooltip-arrow::before{position:absolute;content:"";border-color:transparent;border-style:solid}.bs-tooltip-auto[data-popper-placement^=top],.bs-tooltip-top{padding:.4rem 0}.bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow,.bs-tooltip-top .tooltip-arrow{bottom:0}.bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow::before,.bs-tooltip-top .tooltip-arrow::before{top:-1px;border-width:.4rem .4rem 0;border-top-color:#000}.bs-tooltip-auto[data-popper-placement^=right],.bs-tooltip-end{padding:0 .4rem}.bs-tooltip-auto[data-popper-placement^=right] .tooltip-arrow,.bs-tooltip-end .tooltip-arrow{left:0;width:.4rem;height:.8rem}.bs-tooltip-auto[data-popper-placement^=right] .tooltip-arrow::before,.bs-tooltip-end .tooltip-arrow::before{right:-1px;border-width:.4rem .4rem .4rem 0;border-right-color:#000}.bs-tooltip-auto[data-popper-placement^=bottom],.bs-tooltip-bottom{padding:.4rem 0}.bs-tooltip-auto[data-popper-placement^=bottom] .tooltip-arrow,.bs-tooltip-bottom .tooltip-arrow{top:0}.bs-tooltip-auto[data-popper-placement^=bottom] .tooltip-arrow::before,.bs-tooltip-bottom .tooltip-arrow::before{bottom:-1px;border-width:0 .4rem .4rem;border-bottom-color:#000}.bs-tooltip-auto[data-popper-placement^=left],.bs-tooltip-start{padding:0 .4rem}.bs-tooltip-auto[data-popper-placement^=left] .tooltip-arrow,.bs-tooltip-start .tooltip-arrow{right:0;width:.4rem;height:.8rem}.bs-tooltip-auto[data-popper-placement^=left] .tooltip-arrow::before,.bs-tooltip-start .tooltip-arrow::before{left:-1px;border-width:.4rem 0 .4rem .4rem;border-left-color:#000}.tooltip-inner{max-width:200px;padding:.25rem .5rem;color:#fff;text-align:center;background-color:#000;border-radius:.25rem}.carousel{position:relative}.carousel.pointer-event{touch-action:pan-y}.carousel-inner{position:relative;width:100%;overflow:hidden}.carousel-inner::after{display:block;clear:both;content:""}.carousel-item{position:relative;display:none;float:left;width:100%;margin-right:-100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transition:transform .6s ease-in-out}@media (prefers-reduced-motion:reduce){.carousel-item{transition:none}}.carousel-item-next,.carousel-item-prev,.carousel-item.active{display:block}.active.carousel-item-end,.carousel-item-next:not(.carousel-item-start){transform:translateX(100%)}.active.carousel-item-start,.carousel-item-prev:not(.carousel-item-end){transform:translateX(-100%)}.carousel-fade .carousel-item{opacity:0;transition-property:opacity;transform:none}.carousel-fade .carousel-item-next.carousel-item-start,.carousel-fade .carousel-item-prev.carousel-item-end,.carousel-fade .carousel-item.active{z-index:1;opacity:1}.carousel-fade .active.carousel-item-end,.carousel-fade .active.carousel-item-start{z-index:0;opacity:0;transition:opacity 0s .6s}@media (prefers-reduced-motion:reduce){.carousel-fade .active.carousel-item-end,.carousel-fade .active.carousel-item-start{transition:none}}.carousel-control-next,.carousel-control-prev{position:absolute;top:0;bottom:0;z-index:1;display:flex;align-items:center;justify-content:center;width:15%;padding:0;color:#fff;text-align:center;background:0 0;border:0;opacity:.5;transition:opacity .15s ease}@media (prefers-reduced-motion:reduce){.carousel-control-next,.carousel-control-prev{transition:none}}.carousel-control-next:focus,.carousel-control-next:hover,.carousel-control-prev:focus,.carousel-control-prev:hover{color:#fff;text-decoration:none;outline:0;opacity:.9}.carousel-control-prev{left:0}.carousel-control-next{right:0}.carousel-control-next-icon,.carousel-control-prev-icon{display:inline-block;width:2rem;height:2rem;background-repeat:no-repeat;background-position:50%;background-size:100% 100%}.carousel-control-prev-icon{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath d='M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z'/%3e%3c/svg%3e")}.carousel-control-next-icon{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath d='M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e")}.carousel-indicators{position:absolute;right:0;bottom:0;left:0;z-index:2;display:flex;justify-content:center;padding:0;margin-right:15%;margin-bottom:1rem;margin-left:15%;list-style:none}.carousel-indicators [data-bs-target]{box-sizing:content-box;flex:0 1 auto;width:30px;height:3px;padding:0;margin-right:3px;margin-left:3px;text-indent:-999px;cursor:pointer;background-color:#fff;background-clip:padding-box;border:0;border-top:10px solid transparent;border-bottom:10px solid transparent;opacity:.5;transition:opacity .6s ease}@media (prefers-reduced-motion:reduce){.carousel-indicators [data-bs-target]{transition:none}}.carousel-indicators .active{opacity:1}.carousel-caption{position:absolute;right:15%;bottom:1.25rem;left:15%;padding-top:1.25rem;padding-bottom:1.25rem;color:#fff;text-align:center}.carousel-dark .carousel-control-next-icon,.carousel-dark .carousel-control-prev-icon{filter:invert(1) grayscale(100)}.carousel-dark .carousel-indicators [data-bs-target]{background-color:#000}.carousel-dark .carousel-caption{color:#000}@-webkit-keyframes spinner-border{to{transform:rotate(360deg)}}@keyframes spinner-border{to{transform:rotate(360deg)}}.clearfix::after{display:block;clear:both;content:""}.link-primary{color:#0d6efd}.link-primary:focus,.link-primary:hover{color:#0a58ca}.link-secondary{color:#6c757d}.link-secondary:focus,.link-secondary:hover{color:#565e64}.link-success{color:#198754}.link-success:focus,.link-success:hover{color:#146c43}.link-info{color:#0dcaf0}.link-info:focus,.link-info:hover{color:#3dd5f3}.link-warning{color:#ffc107}.link-warning:focus,.link-warning:hover{color:#ffcd39}.link-danger{color:#dc3545}.link-danger:focus,.link-danger:hover{color:#b02a37}.link-light{color:#f8f9fa}.link-light:focus,.link-light:hover{color:#f9fafb}.link-dark{color:#212529}.link-dark:focus,.link-dark:hover{color:#1a1e21}.ratio{position:relative;width:100%}.ratio::before{display:block;padding-top:var(--bs-aspect-ratio);content:""}.ratio>*{position:absolute;top:0;left:0;width:100%;height:100%}.ratio-1x1{--bs-aspect-ratio:100%}.ratio-4x3{--bs-aspect-ratio:calc(3 / 4 * 100%)}.ratio-16x9{--bs-aspect-ratio:calc(9 / 16 * 100%)}.ratio-21x9{--bs-aspect-ratio:calc(9 / 21 * 100%)}.fixed-top{position:fixed;top:0;right:0;left:0;z-index:1030}.fixed-bottom{position:fixed;right:0;bottom:0;left:0;z-index:1030}.sticky-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}.mt-0{margin-top:0!important}.mt-1{margin-top:.25rem!important}.mt-2{margin-top:.5rem!important}.mt-3{margin-top:1rem!important}.mt-4{margin-top:1.5rem!important}.mt-5{margin-top:3rem!important}.mt-auto{margin-top:auto!important}.mb-0{margin-bottom:0!important}.mb-1{margin-bottom:.25rem!important}.mb-2{margin-bottom:.5rem!important}.mb-3{margin-bottom:1rem!important}.mb-4{margin-bottom:1.5rem!important}.mb-5{margin-bottom:3rem!important}.mb-auto{margin-bottom:auto!important}.p-0{padding:0!important}.p-1{padding:.25rem!important}.p-2{padding:.5rem!important}.p-3{padding:1rem!important}.p-4{padding:1.5rem!important}.p-5{padding:3rem!important}@media (min-width:576px){.sticky-sm-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}}@media (min-width:768px){.sticky-md-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}}@media (min-width:992px){.sticky-lg-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}}@media (min-width:1200px){.sticky-xl-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}}@media (min-width:1400px){.sticky-xxl-top{position:-webkit-sticky;position:sticky;top:0;z-index:1020}}

  .bg{background-color:#fff}.chroma{background-color:#fff}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0}.chroma .hl{background-color:#ffc}.chroma .lnt{white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em 0 .4em;color:#7f7f7f}.chroma .ln{white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em 0 .4em;color:#7f7f7f}.chroma .line{display:flex}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}

  html{font-size:16px}body{color:#222;font-family:'PT Serif','Times New Roman',Times,serif;font-size:1.2em;font-weight:400;margin-bottom:50px;background-color:#f8f8f8;background-image:url(/blog-bitix/assets/images/backgrounds/grey.png)}::-moz-selection{background-color:#61b135;color:#fff}::selection{background-color:#61b135;color:#fff}a{color:#569d2f;text-decoration:none}a:visited{color:#7aca4e}a:hover{color:#4b8929;text-decoration:underline}a:active{color:#569d2f}h1,h2,h3,h4,h5,h6{margin-top:20px;margin-bottom:10px;font-weight:700;clear:both}hr{background-color:#fff;border-top:3px dotted #000;margin:auto;margin-top:20px;margin-bottom:20px;width:60%}abbr[title]{border-bottom:1px dotted}pre{margin-bottom:0}ul.recents{font-size:.9em}ul.recents hr{margin-top:10px;margin-bottom:10px;border-top:1px dotted #ccc}ul.series,ul.tags{columns:5 8em;column-gap:1em}ul.library{columns:4 12em;column-gap:1em}ul.list-columns{columns:4 12em;column-gap:1em}div.container{background-color:#fff;border-left:1px solid #f8f8f8;border-right:1px solid #f8f8f8;padding:0 1em;max-width:1080px}div.blueimp-gallery-container{position:absolute}div.blueimp-gallery div.modal{overflow:hidden}div.blueimp-gallery img.slide-content{background-color:#fff}div.menu ul li{margin-bottom:3px}header{text-align:center;margin-bottom:10px}header span.title{font-size:2.6em;font-weight:700}header span.title a,header span.title a:active,header span.title a:hover,header span.title a:visited{color:#222}header nav{font-weight:700;margin-top:10px}header nav.nav-pills a{color:#569d2f}header nav.nav-pills a:hover{color:#569d2f;background-color:#e2f3d8}header nav.nav-pills a.active,header nav.nav-pills a.active:hover{color:#fff;background-color:#569d2f}header form.search{margin-top:20px;display:inline-block}article h1{font-size:2.6em}article h2{font-size:1.75rem}@media (max-width:576px){article h1{font-size:1.8em}}article p.information,article span.information{font-size:.9em}article p.summary{font-weight:700}article ul.columns{columns:4 12em;column-gap:1em}article table{margin-bottom:20px}article blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}article div.logotypes{margin-left:1.5em;text-align:right;float:right;clear:right;max-width:400px;min-width:150px}@media (max-width:576px){article div.logotypes{width:125px}}article div.logotypes amp-img,article div.logotypes img{background-color:#fff;border:.5em solid #fff;border-radius:.3em;box-shadow:0 1px 4px rgba(0,0,0,.15);box-sizing:border-box}@media (max-width:576px){article div.logotypes amp-img,article div.logotypes img{width:125px}}article div.code{border:1px solid #ddd;border-radius:3px;margin-bottom:1em}article div.code div.highlight{font-size:.8em;border-bottom:1px solid #ddd;overflow-x:auto}article div.code div.highlight table td:nth-child(2){width:100%}article div.code div.highlight-meta{font-size:.8em;background-color:#f7f7f7;padding:6px}article div.code div.highlight-meta span.raw{float:right}article div.code div.highlight-meta a,article div.code div.highlight-meta span{color:#666;font-weight:600;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:.8em}article div.media{display:block;text-align:center;margin-bottom:1em}article div.media amp-iframe[id^=asciicast-iframe],article div.media iframe[id^=asciicast-iframe]{border:0 solid #fff;box-shadow:0 0 0 rgba(0,0,0,.15)}article div.media amp-ad,article div.media amp-iframe,article div.media amp-img,article div.media amp-video,article div.media iframe,article div.media img,article div.media video{background-color:#fff;border:.5em solid #fff;border-radius:.3em;box-shadow:0 1px 4px rgba(0,0,0,.15);box-sizing:content-box;max-width:100%;max-height:100%;object-fit:contain;vertical-align:middle}article div.media amp-ad.white-background,article div.media amp-iframe.white-background,article div.media amp-img.white-background,article div.media amp-video.white-background,article div.media iframe.white-background,article div.media img.white-background,article div.media video.white-background{background-color:#fff}article div.media amp-ad.black-background,article div.media amp-iframe.black-background,article div.media amp-img.black-background,article div.media amp-video.black-background,article div.media iframe.black-background,article div.media img.black-background,article div.media video.black-background{background-color:#000}article div.media figure{clear:both}article div.media figure p a{display:inline-block}article div.media figure figcaption{font-size:.8em}article div.media-amazon.float-right{margin-left:20px}article div.media-twitter{text-align:left}article div.buttons{text-align:center;margin-bottom:20px}article div.buttons a.btn{color:#fff}article div.alert h1,article div.alert h2,article div.alert h3,article div.alert h4,article div.alert h5,article div.alert h6{clear:none}article div.tableofcontents{display:inline-block}article div.reference{font-size:.9em}div.page-header{min-height:300px;max-height:300px;margin-bottom:20px;overflow:hidden;display:flex;justify-content:center;align-items:center}div.page-header img{min-width:100%;max-width:100%;object-fit:cover}div.sharethis-inline-share-buttons{margin-top:1em;margin-bottom:1em}div.related,div.serie,div.sharethis-text{font-size:.9em}div.related h3,div.serie h3,div.sharethis-text h3{font-size:1em;font-weight:400;margin-top:10px}div.related img,div.serie img,div.sharethis-text img{height:125px;margin-top:10px;max-width:100%;object-fit:cover;width:100%;padding:0 0;margin:0 0}div.related div.col-sm-4,div.serie div.col-sm-4,div.sharethis-text div.col-sm-4{margin-bottom:15px}div.videoo{width:500px;height:282px;max-width:100%;margin:0 auto;margin-bottom:30px}div.videoo .videootv{margin-top:0}footer{font-size:.8em;padding-top:10px;padding-bottom:30px}footer span.copyleft{transform:rotate(180deg);display:inline-block}div.banner{margin-bottom:10px}div.featured{background-color:#fff;text-align:center;font-size:.9em;font-weight:700;margin-bottom:10px;width:150px;border-radius:.3em;box-shadow:0 1px 4px rgba(0,0,0,.15);border:.3em solid #fff}div.featured img{width:100%}div.featured a{color:#222}div.sourcecode amp-img.sourcecode-icon,div.sourcecode img.sourcecode-icon{float:left;width:64px}div.sourcecode>div,div.sourcecode>p{margin-left:84px}div.adblock-container{left:0;right:0;margin-left:auto;margin-right:auto}div.adblock{background-color:#eee;border:1px solid gray;font-size:.9em;padding:15px}div.adblock-container-sidebar{position:sticky;position:-webkit-sticky;top:15px;height:0;display:none;overflow:visible}div.adblock-container-sidebar-left{max-height:600px;max-width:300px;min-height:600px;min-width:300px;display:block;text-align:right;overflow:hidden}div.adblock-container-sidebar-right{max-height:600px;max-width:300px;min-height:600px;min-width:300px;display:block;text-align:left;overflow:hidden}amp-ad,ins.adsbygoogle{line-height:0;width:100%;height:100%}div.adblock-container-billboard{text-align:center;max-height:280px;max-width:100%;min-height:280px;display:block;margin:auto}div.adblock-container-leaderboard{text-align:left;max-height:90px;max-width:100%;min-height:90px;display:block;overflow:hidden}i.archive-icon{display:inline-block;font-size:32px;line-height:32px}@media (min-width:375px){div.adblock-container-billboard{max-height:280px;max-width:336px;min-height:280px;min-width:336px}div.adblock-container-leaderboard{max-height:90px;max-width:336px;min-height:90px;min-width:336px}}@media (min-width:770px){div.adblock-container-billboard{max-height:280px;max-width:728px;min-height:280px;min-width:728px}div.adblock-container-leaderboard{max-height:90px;max-width:728px;min-height:90px;min-width:728px}}@media (min-width:1025px){div.adblock-container-billboard{max-height:280px;max-width:970px;min-height:280px;min-width:970px}}@media (min-width:1366px){div.adblock-container-sidebar{display:flex;justify-content:space-between}div.adblock-container-sidebar-left{transform:translateX(-155px);max-width:120px;min-width:120px}div.adblock-container-sidebar-right{transform:translateX(155px);max-width:120px;min-width:120px}}@media (min-width:1440px){div.adblock-container-sidebar-left{transform:translateX(-195px);max-width:160px;min-width:160px}div.adblock-container-sidebar-right{transform:translateX(195px);max-width:160px;min-width:160px}}@media (min-width:1750px){div.adblock-container-sidebar-left{transform:translateX(-335px);max-width:300px;min-width:300px}div.adblock-container-sidebar-right{transform:translateX(335px);max-width:300px;min-width:300px}}

  </style>

  <!-- scripts -->
  <script async src="https://cdn.ampproject.org/v0.js"></script>
  <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
  <script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>
  <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
  <script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script>
  <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  <script async custom-element="amp-audio" src="https://cdn.ampproject.org/v0/amp-audio-0.1.js"></script>
  <script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script>
  
  

  
  
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-12">
        





<header>
  <div class="row">
    <div class="col-12 col-lg-4"></div>
    <div class="col-12 col-lg-4">
      <span class="title"><a href="https://picodotdev.github.io/blog-bitix/index-amp.html">Blog Bitix</a></span>
      <div class="links">
        
          <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><amp-img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></amp-img></a>
        
        
          <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><amp-img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></amp-img></a>
        
        
          <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><amp-img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></amp-img></a>
        
        
        
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      
<nav class="nav nav-pills nav-fill">
  <a href="/blog-bitix/tags/java/index-amp.html" class="nav-item nav-link">Java</a>
  <a href="/blog-bitix/tags/gnu-linux/index-amp.html" class="nav-item nav-link">GNU/Linux</a>
  <a href="/blog-bitix/tags/javascript/index-amp.html" class="nav-item nav-link">JavaScript</a>
  <a href="/blog-bitix/tags/tapestry/index-amp.html" class="nav-item nav-link">Tapestry</a>
  <a href="/blog-bitix/archive/index-amp.html" class="nav-item nav-link">Archivo y hemeroteca</a>
  <a href="/blog-bitix/pages/links/index-amp.html" class="nav-item nav-link">Enlaces</a>
  <a href="/blog-bitix/pages/about/index-amp.html" class="nav-item nav-link">Acerca de...</a>
  
</nav>

    </div>
  </div>
</header>
      </div>
    </div>
    <div class="row">
      <div class="col-12 adblock-container-billboard mt-3 mb-3 p-0">
        <amp-ad width="100vw" height="280"
    type="adsense"
    data-ad-client="ca-pub-3533636310991304"
    data-ad-slot="4052324337"
    data-auto-format="rspv"
    data-full-width="">
    <div overflow=""></div>
</amp-ad>

      </div>
    </div>
    
    <div class="row page-header">
      <div class="col-12">
        <amp-img src="/blog-bitix/assets/images/logotypes/hashicorp-text.svg" width="1040" height="300" alt="Cabecera" title="Cabecera"  class=""></amp-img>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        


<article>
    <h1>Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos</h1>
    <p class="information">
      
        Escrito por
       
      <span>picodotdev</span> el <time>14/08/2020</time>.
      
        <br>
        
          <a href="/blog-bitix/tags/gnu-linux/index-amp.html">gnu-linux</a>
        
          <a href="/blog-bitix/tags/planeta-codigo/index-amp.html">planeta-codigo</a>
        
      
      <br>
      <a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html">Enlace permanente</a>
      
        <a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html#comments">Comentarios</a>
      
    </p>

    
      <p class="summary">HashiCorp proporciona una buena documentación de sus productos con tutoriales, documentación de las herramientas y vídeos de formación en su canal de Youtube. Aunque en la documentación está todo explicado para poner en práctica una arquitectura para un caso más real y con cierto grado de producción requiere leer múltiples artículos para aplicar y aglutinar todo lo descrito. En este artículo muestro una arquitectura de referencia de varios productos de HashiCorp como Consul, Vault y Nomad que forman un centro de datos o entorno de ejecución para servicios en un ejemplo aprovisionado con Vagrant en máquinas virtuales de VirtualBox.</p>
    
    

    
      <div class="adblock-container-leaderboard mt-3 mb-3 p-0">
        <amp-ad width="100vw" height="90"
    type="adsense"
    data-ad-client="ca-pub-3533636310991304"
    data-ad-slot="8238629013"
    data-auto-format="rspv"
    data-full-width="">
    <div overflow=""></div>
</amp-ad>
      </div>
    

    <div class="content">
      


      
        
        
      
      <div class="logotypes" style="min-width: 200px;">
<p><amp-img src="/blog-bitix/assets/images/logotypes/hashicorp-consul.svg" width="0.717054264" height="1" alt="HashiCorp Consul" title="HashiCorp Consul" layout="responsive"  class=""></amp-img></p>
</div>
<div class="logotypes" style="min-width: 200px;">
<p><amp-img src="/blog-bitix/assets/images/logotypes/hashicorp-vault.svg" width="0.697674419" height="1" alt="HashiCorp Vault" title="HashiCorp Vault" layout="responsive"  class=""></amp-img></p>
</div>
<div class="logotypes" style="min-width: 200px;">
<p><amp-img src="/blog-bitix/assets/images/logotypes/hashicorp-nomad.svg" width="0.76744186" height="1" alt="HashiCorp Nomad" title="HashiCorp Nomad" layout="responsive"  class=""></amp-img></p>
</div>
<p>La empresa <a href="https://www.hashicorp.com/">HashiCorp</a> cataloga las necesidades de las aplicaciones basadas en la computación en la nube u orientadas a microservicios en cuatro aspectos que necesitan: aprovisionamiento, registro y conexión, seguridad y ejecución. HashiCorp en base a estos cuatro aspectos de las aplicaciones ha desarrollado para cada una de ellas una aplicación específica integrable con las otras pero también con la posibilidad de usar cada una de forma individual e independiente que permiten disponer de un centro de datos y cubre varias de las necesidades computacionales de una empresa en entornos modernos basados en nube que son dinámicos y requieren elasticidad.</p>
<p>En muchas organizaciones los desarrolladores solo se encargan del desarrollo de la aplicación o servicio, del despliegue y administración se encargan los administradores de sistemas. Los centros de datos se operan en base a peticiones entre los desarrolladores y los administradores de sistemas, este modelo organización es lento y propenso a ineficiencias, para evitarlo hay que tratar que los desarrolladores sean lo más autosuficientes posible para operar el entorno de ejecución de sus servicios haciendo que estos no solo desarrollen sus aplicaciones sino que también tengan capacidad de desplegarlas y monitorizarlas.</p>
<p>En este artículo muestro un ejemplo usando tres de estos mismos productos que se usarían en un entorno de producción <a href="https://www.consul.io/">Consul</a> para el registro de servicios y conexión de forma segura, <a href="https://www.vaultproject.io/">Vault</a> para seguridad y servicios de cifrado y <a href="https://www.nomadproject.io/">Nomad</a> para la ejecución de servicios con contenedores <a href="https://www.docker.com/">Docker</a>. Para el aprovisionamiento y ejecutar el ejemplo en la propia máquina el ejemplo usa <a href="https://www.vagrantup.com/">Vagrant</a> que permite crear y aprovisionar máquinas virtuales sobre <a href="https://www.virtualbox.org/">VirtualBox</a>, en un entorno basado en la nube se usaría <a href="https://www.terraform.io/">Terraform</a>. Consul, Vault y Nomad forman lo que sería un centro de datos de un entorno de ejecución para aplicaciones y servicios.</p>
<p><a href="https://github.com/servian/hashiqube/">HashiQube</a> proporciona un entorno para hacer pruebas de desarrollo con todas las herramientas de HashiCorp, pero no es utilizable en un entorno de producción. Para construir un entorno con grado de producción hay que leer mucha de la buena documentación que ofrece HashiCorp de sus productos. Los productos de HashiCorp tienen una buena documentación en formato guía y tutoriales divididos en secciones individuales sobre un tema en concreto.</p>
<ul>
<li><a href="https://learn.hashicorp.com/consul">Tutorial</a> y <a href="https://www.consul.io/docs/index.html">documentación</a> de Consul</li>
<li><a href="https://learn.hashicorp.com/vault">Tutorial</a> y <a href="https://www.vaultproject.io/docs">documentación</a>  de Vault</li>
<li><a href="https://learn.hashicorp.com/nomad">Tutorial</a> y <a href="https://www.nomadproject.io/docs/index.html">documentación</a> de Nomad</li>
<li><a href="https://learn.hashicorp.com/terraform">Totorial</a> y <a href="https://www.terraform.io/docs/index.html">documentación</a> de Terraform</li>
<li><a href="https://www.vagrantup.com/docs">Documentación de Vagrant</a> y <a href="https://www.packer.io/docs">documentación de Packer</a></li>
<li><a href="https://www.youtube.com/c/HashiCorp/">Canal de YouTube de HashiCorp</a></li>
</ul>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-static-dynamic_hu67ee66e9105feacc23ca157c69e694b7_274544_2560x1440_fit_box_3.png" data-gallery="" title="Diferencias entre entornos estáticos anteriores y dinámicos nuevos"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-static-dynamic_hu67ee66e9105feacc23ca157c69e694b7_274544_650x450_fit_box_3.png" width="650" height="285" alt="Diferencias entre entornos estáticos anteriores y dinámicos nuevos" title="Diferencias entre entornos estáticos anteriores y dinámicos nuevos"  class=""></amp-img></a></p>
<figcaption>Diferencias entre entornos estáticos anteriores y dinámicos nuevos</figcaption>
</figure>
</div>
<p>Este artículo hace uso, está relacionado y se complementa con otros artículos que muestran varias de las funcionalidades individuales utilizadas en el ejemplo.</p>
<ul>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/05/crear-de-forma-sencilla-y-rapida-maquinas-virtuales-de-virtualbox-con-vagrant/index-amp.html">Crear de forma sencilla y rápida máquinas virtuales de VirtualBox con Vagrant</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2014/02/configurar-ssl-en-un-servidor-tomcat-jboss-wildfly-lighttpd-nginx-apache/index-amp.html">Configurar SSL/TLS en un servidor Tomcat, JBoss, WildFly, Lighttpd, Nginx o Apache</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/02/configurar-http-2-en-nginx-apache-httpd-wildfly-o-jetty/index-amp.html">Configurar HTTP/2 en Nginx, Apache HTTPD, WildFly o Jetty</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/08/configurar-autenticacion-basica-en-los-servidores-web-nginx-y-apache/index-amp.html">Configurar autenticación básica en los servidores web Nginx y Apache</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2016/07/como-crear-un-proxy-inverso-entre-el-servidor-web-nginx-y-un-servidor-de-aplicaciones-java/index-amp.html">Cómo crear un proxy inverso entre el servidor web Nginx y un servidor de aplicaciones Java</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/08/comandos-para-crear-una-autoridad-de-certificacion-ca-con-openssl/index-amp.html">Comandos para crear una autoridad de certificación (CA) con OpenSSL</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/index-amp.html">Comunicaciones seguras, autenticación mutua y autorizaciones con intenciones entre servicios usando Consul Connect y Nomad</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/10/microservicios-con-spring-cloud-consul-nomad-y-traefik/index-amp.html">Microservicios con Spring Cloud, Consul, Nomad y Traefik</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2020/07/obtener-un-nombre-de-dominio-para-una-direccion-ip-privada/index-amp.html">Obtener un nombre de dominio para una dirección IP privada</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/index-amp.html">Introducción a Nomad para gestionar aplicaciones y microservicios</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/index-amp.html">Estrategias de despliegue para microservicios con Nomad</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/07/administrar-secretos-y-proteger-datos-sensibles-con-vault/index-amp.html">Administrar secretos y proteger datos sensibles con Vault</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/08/generar-credenciales-de-conexion-a-base-de-datos-bajo-demanda-con-vault/index-amp.html">Generar credenciales de conexión a base de datos bajo demanda con Vault</a></li>
<li><a href="https://picodotdev.github.io/blog-bitix/2019/08/utilizar-credenciales-de-conexion-a-la-base-de-datos-generadas-por-vault-en-una-aplicacion-de-spring/index-amp.html">Utilizar credenciales de conexión a la base de datos generadas por Vault en una aplicación de Spring</a></li>
</ul>
<div class="videoo">
    <script defer id="videoo-library" data-id="7f85ad782c7554f1b30d1496af3608d5e0484ccc25f7450c72c0c1412bf140e0" src="https://static.videoo.tv/7f85ad782c7554f1b30d1496af3608d5e0484ccc25f7450c72c0c1412bf140e0.js"></script>
</div><div class="alert alert-warning pt-0 pb-0 tableofcontents"><h2>Contenido del artículo</h2><nav id="TableOfContents">
  <ul>
    <li><a href="#servicios-de-hashicorp">Servicios de HashiCorp</a>
      <ul>
        <li><a href="#consul">Consul</a></li>
        <li><a href="#vault">Vault</a></li>
        <li><a href="#nomad">Nomad</a></li>
        <li><a href="#vagrant-y-terraform">Vagrant y Terraform</a></li>
        <li><a href="#packer">Packer</a></li>
      </ul>
    </li>
    <li><a href="#comparación-con-kubernetes">Comparación con Kubernetes</a></li>
    <li><a href="#arquitectura-de-referencia">Arquitectura de referencia</a>
      <ul>
        <li><a href="#precio">Precio</a></li>
      </ul>
    </li>
    <li><a href="#ejemplo-de-la-arquitectura-de-referencia-con-vagrant">Ejemplo de la arquitectura de referencia con Vagrant</a>
      <ul>
        <li><a href="#interfaz-web-para-consul-vault-y-nomad">Interfaz web para Consul, Vault y Nomad</a></li>
        <li><a href="#interfaz-de-línea-de-comandos-para-consul-vault-y-nomad">Interfaz de línea de comandos para Consul, Vault y Nomad</a></li>
        <li><a href="#ejecución-de-un-servicio">Ejecución de un servicio</a></li>
      </ul>
    </li>
    <li><a href="#requerimientos-de-operaciones">Requerimientos de operaciones</a></li>
  </ul>
</nav></div> 
<h3 id="servicios-de-hashicorp">Servicios de HashiCorp</h3>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-1_hucb41f3f4a0c4e341c8fa5add26daf72f_433163_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-1_hucb41f3f4a0c4e341c8fa5add26daf72f_433163_200x150_fit_box_3.png" width="200" height="103" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_200x150_fit_box_3.png" width="200" height="117" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_2560x1440_fit_box_3.png" data-gallery="" title="Productos de HashiCorp"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-products-2_hu941b4f685cfa5efd43f26f6f6c4ba507_301964_200x150_fit_box_3.png" width="200" height="117" alt="Productos de HashiCorp" title="Productos de HashiCorp"  class=""></amp-img></a></p>
<figcaption>Productos de HashiCorp</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-consul-before-after_huda1232b206f99140993a7a4fc131887b_205943_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Consul"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-consul-before-after_huda1232b206f99140993a7a4fc131887b_205943_200x150_fit_box_3.png" width="200" height="135" alt="Antes y después con Consul" title="Antes y después con Consul"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-vault-before-after_hu4179baf61d235b37bc3c87f7b3fc2feb_126149_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Vault"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-vault-before-after_hu4179baf61d235b37bc3c87f7b3fc2feb_126149_200x150_fit_box_3.png" width="200" height="140" alt="Antes y después con Vault" title="Antes y después con Vault"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-nomad-before-after_hu6c36a4999c82fd8d966d5a10a753b488_178820_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-nomad-before-after_hu6c36a4999c82fd8d966d5a10a753b488_178820_200x150_fit_box_3.png" width="192" height="150" alt="Antes y después con Nomad" title="Antes y después con Nomad"  class=""></amp-img></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_2560x1440_fit_box_3.png" data-gallery="" title="Antes y después con Terraform"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_200x150_fit_box_3.png" width="164" height="150" alt="Antes y después con Terraform" title="Antes y después con Terraform"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_2560x1440_fit_box_3.png" data-gallery="" title="Ecosistema con Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/hashicorp-terraform-before-after_hu1a3e99fc282fe180d5fa3b2050b8cada_177982_200x150_fit_box_3.png" width="164" height="150" alt="Ecosistema con Nomad" title="Ecosistema con Nomad"  class=""></amp-img></a></p>
<figcaption>Ecosistema con Nomad</figcaption>
</figure>
</div>
<h4 id="consul">Consul</h4>
<p>En una aplicación basada en servicios a lo largo del tiempo estos se añaden y se eliminan, varía el número de instancias, cambian de ubicación, pueden dejar de estar accesibles de forma inesperada y los servicios necesitan comunicarse de forma segura.</p>
<p>La herramienta Consul proporciona proporcionan funcionalidades para todas estas necesidades con un registro de registro y descubrimiento que mantiene el catálogo de servicios e instancias con su ubicación, proporciona comprobaciones de estado o <em>health checks</em> para conocer en todo momento que las instancias están funcionado correctamente, proporciona comunicaciones seguras entre los servicios con <a href="https://www.consul.io/docs/connect">Consul Connect</a> y permite o deniega la comunicación con intenciones y basándose en la identidad de los servicios.</p>
<p>El catálogo de servicios es accesible mediante una API REST, también ofrece su catálogo de servicios a través de una interfaz DNS ya que incorpora la funcionalidad de servidor DNS. Consul además proporciona un almacén de clave/valor que los servicios pueden utilizar como valores de configuración que cambian de forma dinámica sin necesidad de reiniciar las instancias del servicio para que los nuevos valores surtan efecto.</p>
<h4 id="vault">Vault</h4>
<p>Vault proporciona servicios de seguridad. En vez de implementar las necesidades de seguridad en cada aplicación con el lenguaje de programación en el que esté desarrollado Vault permite delegar y centralizar en él los requerimientos y políticas de seguridad.</p>
<p>Proporciona funcionalidades de cifrado y descifrado, cifrado y descifrado conservando el formato y enmascaramiento basado en políticas. También permite generar certificados con un tiempo de expiración pequeño y generación de credenciales dinámicas, esto es, en vez de generar unas credenciales de conexión para cada aplicación a una base de datos la aplicación puede solicitar a Vault unas credenciales de conexión para la base de datos que únicamente son válidas mientras la aplicación necesita la conexión. Las credenciales dinámicas permiten aumentar la seguridad.</p>
<h4 id="nomad">Nomad</h4>
<p>Los servicios necesitan ejecutarse y crear instancias para proporcionar sus funcionalidades, Nomad hace las funciones de orquestador de servicios. Se encarga de planificar el nodo de entre los disponibles en los que se ejecutara cada instancia del servicio, de mantener el número de instancias indicadas en la descripción de cada servicio y de aplicar la estrategia de despliegue según la política definida para cada servicio, como <em>blue/green</em> o <em>canary</em>.</p>
<p>Nomad se integra con Consul y permite que al iniciar la instancia de un servicio se registre en Consul y configurar un <em>health check</em> para que Consul monitorice el estado de la instancia del servicio.</p>
<h4 id="vagrant-y-terraform">Vagrant y Terraform</h4>
<p>Para automatizar la creación de los entornos, crear los entornos como código y que estos queden descritos en archivos se utilizan herramientas de aprovisionamiento. HashiCorp proporciona dos, una es Vagrant para crear máquinas virtuales en local con VirtualBox para un entorno de desarrollo. Para un entorno de producción se usará un proveedor de computación en la nube como <a href="https://aws.amazon.com/es/">Amazon Web Services</a>, <a href="https://cloud.google.com/">Google Cloud Platform</a>, <a href="https://azure.microsoft.com/es-es/">Microsoft Azure</a> u otros como <a href="https://www.digitalocean.com/">Digital Ocean</a> o <a href="https://www.linode.com/">Linode</a>.</p>
<p>Cada uno de estos entornos de computación tiene sus peculiaridades, Terraform permite describir las necesidades de sistemas en cuanto a infraestructura del entorno de ejecución de forma independiente a cada uno de estos proveedores, automatizar el aprovisionamiento y definir la infraestructura como código lo que permite guardar en un repositorio de control de versiones los cambios que se realizan a la infraestructura.</p>
<h4 id="packer">Packer</h4>
<p>La herramienta Packer permite construir las imágenes base para los sistemas en la nube y de los contenedores. Es agnóstica de los diferentes sistemas en la nube permitiendo construir imágenes para cada una de ellas, esto permite no estar encadenado a un proveedor determinado.</p>
<h3 id="comparación-con-kubernetes">Comparación con Kubernetes</h3>
<p><a href="https://kubernetes.io/">Kubernetes</a> es otro sistema con la funcionalidad de orquestador de contenedores desarrollado originalmente por Google y al que ahora contribuyen numerosas empresas como  <a href="https://www.redhat.com/es">Red Hat</a>. Proporciona todas las características que necesitan las aplicaciones basadas en contenedores incluyendo gestión del clúster, planificación, descubrimiento de servicios, monitorización, gestión de secretos y otros más.</p>
<p>HashiCorp proporciona la mayoría de las funcionalidades de Kubernetes en cada una de las diferentes herramientas que tiene siguiendo la filosofía Unix de herramientas con un ámbito reducido y agregables, por ejemplo, Consul proporciona descubrimiento de servicios, Vault seguridad y Nomad está diseñado específicamente para proporcionar gestión del cluster y planificación.</p>
<p>Kubernetes se centra en Docker mientras que Nomad soporta aplicaciones de propósito general como pueden ser comandos del sistema, aplicaciones Java, Docker o <a href="https://podman.io/">Podman</a>. Kubernetes está diseñado como una colección de más de media docena de servicios que interoperan para proporcionar la funcionalidad completa. Soporta alta disponibilidad pero operacionalmente es complejo de configurar.</p>
<p>La arquitectura de las herramientas de HashiCorp  es más simple, cada  una de las herramientas es un único binario que sirve tanto para actuar como servidor como cliente y que se pueden utilizar sin requerir al resto, tanto es así que Consul se puede utilizar y algunos lo utilizan junto a Kubernetes. Los servidores son distribuidos, con alta disponibilidad y operacionalmente más fáciles. Los servidores soportan configuraciones multicentro de datos y multiregión llegando a tamaños que superan los 10K nodos en entornos de producción.</p>
<ul>
<li><a href="https://www.nomadproject.io/intro/vs/kubernetes.html">Nomad vs Kubernetes</a></li>
<li><a href="https://www.consul.io/intro/vs">Consul vs. Other Software</a></li>
</ul>
<h3 id="arquitectura-de-referencia">Arquitectura de referencia</h3>
<p>En una arquitectura de referencia para proporcionar alta disponibilidad y tolerancia a fallos es necesario crear varias instancias de cada servicio. Las diferentes instancias de Consul, Vault y Nomad forman un clúster algunas funcionando en modo servidor y otras funcionando en modo cliente. Para los servidores de Consul, Vault y Nomad se recomiendan al menos 3 instancias de cada uno de ellos, en total 9 instancias. En cada instancia de Vault y Nomad se crea un agente de Consul que actúa en modo cliente que atiende a las peticiones de forma local y realiza las comunicaciones con los servidores de Consul. De Nomad habrá varias instancias adicionales más actuando en modo cliente que serán donde se ejecuten las instancias de los servicios de aplicación como un un contenedor Docker con Nginx, una base de datos <a href="https://www.postgresql.org/">PostgresQL</a> o una aplicación Java con <a href="https://projects.spring.io/spring-boot/">Spring Boot</a>.</p>
<p>En total un centro de datos para un entorno puede estar compuesto como mínimo entre 9, 15 o 21 para el clúster con 3, 5, 7 servidores de Consul, Vault y Nomad según las necesidades de computación del centro de datos. De Nomad en modo cliente donde se ejecutan los servicios el número de instancias variará según las necesidades de computación y número de servicios que necesitan las aplicaciones, también puede ser un número significativo de entre 10 a 100 o más instancias. El número de máquinas e instancias es elevado por eso hay que tratarlas como ganado y no como animales de compañía que requieran administrarlas de forma individual.</p>
<ul>
<li><a href="https://learn.hashicorp.com/tutorials/consul/reference-architecture">Consul Reference Architecture</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/vault/reference-architecture">Vault Reference Architecture</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/nomad/production-reference-architecture-vm-with-consul">Nomad Reference Architecture</a></li>
</ul>
<p>Estos son los esquemas de las arquitecturas de referencia de Consul, Vault y Nomad para configuraciones de producción formado por varios servidores, clientes y regiones o centros de datos.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Consul"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-reference-architecture_hu44169003e1adff259ec31b6c8aa75355_115945_200x150_fit_box_3.png" width="145" height="150" alt="Arquitectura de referencia de Consul" title="Arquitectura de referencia de Consul"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-reference-architecture_hub96d9a47201c2cff1173d26e179d39dc_82391_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Vault"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-reference-architecture_hub96d9a47201c2cff1173d26e179d39dc_82391_200x150_fit_box_3.png" width="200" height="148" alt="Arquitectura de referencia de Vault" title="Arquitectura de referencia de Vault"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-reference-architecture_hue8f6b812b8cda77506103d14e4ef96ee_43308_2560x1440_fit_box_3.png" data-gallery="" title="Arquitectura de referencia de Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-reference-architecture_hue8f6b812b8cda77506103d14e4ef96ee_43308_200x150_fit_box_3.png" width="200" height="141" alt="Arquitectura de referencia de Nomad" title="Arquitectura de referencia de Nomad"  class=""></amp-img></a></p>
<figcaption>Arquitecturas de referencia de Consul, Vault y Nomad</figcaption>
</figure>
</div>
<h4 id="precio">Precio</h4>
<p>Dependiendo del tamaño de las máquinas de cómputo elegidas para cada instancia el coste de la infraestructura varia. En AWS una instancia <em>t3a.medium</em>, <em>t3a.large</em> y <em>t3a.xlarge</em> con 4, 8 y 16 GiB tienen un coste aproximado de $125, $250 y $400 al año si se paga por adelantado una reserva de 3 años. Multiplicado esto por el número de instancias el coste no es despreciable pero asequible para una empresa que llega a necesitar 100 instancias para sus servicios. La ventaja de la computación en la nube y estas herramientas de HashiCorp es que permiten adaptar el entorno del centro de datos a las necesidades suficientes para cada momento, si se necesitan más máquinas e instancias se añaden si dejan de necesitar se eliminan, esta la elasticidad ofrecida por la computación en la nube que los costes sean únicamente los necesarios.</p>
<p>Es difícil calcular el coste exacto de un centro de datos ya que tendrá una mezcla de diferentes tipos de instancias, instancias reservadas y bajo demanda aprovechando la elasticidad de la computación en la nube, también hay que tener en cuanta que una organización necesitará entornos de pruebas aún siendo de menor tamaño y número que el de producción. El mayor coste lo determina el número de nodos de Nomad, para 50 nodos estarán sobre los $20K y para 1000 los $400K anuales teniendo en cuenta que una empresa que necesita esas cantidades de nodos ya son muy grandes seguramente sean del tamaño multinacionales con facturaciones de varios cientos o miles de millones.</p>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="4">Coste anual por instancia reservada durante 3 años (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo instancia</th>
       <th width="100px">Cores</th>
       <th width="100px">Memoria (GiB)</th>
       <th width="200px">Precio/año (reserva 3 años)</th>
     </tr>
   </thead>
   <tbody>
       <tr>
           <td>t3a.medium</td>
           <td>2</td>
           <td>4</td>
           <td>$125</td>
       </tr>
       <tr>
           <td>t3a.large</td>
           <td>2</td>
           <td>8</td>
           <td>$250</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>4</td>
           <td>16</td>
           <td>$400</td>
       </tr>
   </tbody>
</table>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="4">Coste anual del clúster de servidores Consul, Nomad y Vault con diferente número de instancias (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo</th>
       <th width="100px">Número de instancias</th>
       <th width="200px">Precio/año (reserva 3 años)</th>
     </tr>
   </thead>
   <tbody>
       <tr>
           <td>t3a.xlarge</td>
           <td>3 (1x3)</td>
           <td>$1200</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>9 (3x3)</td>
           <td>$3600</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>15 (5x3)</td>
           <td>$6000</td>
       </tr>
   </tbody>
</table>
<table class="table">
   <thead class="table-light">
     <tr>
       <th colspan="7">Coste anual nodos Nomad con diferente número de instancias (aproximado)</th>
     </tr>
     <tr>
       <th width="100px">Tipo</th>
       <th width="100px">10</th>
       <th width="100px">50</th>
       <th width="100px">100</th>
       <th width="100px">300</th>
       <th width="100px">1000</th>
     </tr>
   </thead>
       <tr>
           <td>t3a.medium</td>
           <td>$1.25K</td>
           <td>$6.25K</td>
           <td>$12.5K</td>
           <td>$37.5K</td>
           <td>$125K</td>
       </tr>
       <tr>
           <td>t3a.large</td>
           <td>$2.5K</td>
           <td>$12.5K</td>
           <td>$25K</td>
           <td>$75K</td>
           <td>$250K</td>
       </tr>
       <tr>
           <td>t3a.xlarge</td>
           <td>$4K</td>
           <td>$20K</td>
           <td>$40K</td>
           <td>$120K</td>
           <td>$400K</td>
       </tr>
   </tbody>
</table>
<h3 id="ejemplo-de-la-arquitectura-de-referencia-con-vagrant">Ejemplo de la arquitectura de referencia con Vagrant</h3>
<p>Para ejecutar la arquitectura de referencia en vez de crear 3 o 5 instancias de Consul, Vault y Nomad en el siguiente ejemplo se utiliza solo 1 instancia de cada uno de ellos. Para ejecutarlos en local se usa Vagrant para crear y aprovisionar las máquinas virtuales de VirtualBox.</p>
<p>Vault se comunica con Consul para utilizar el almacén de clave-valor o KV en el que Vault almacena los datos cifrados, Nomad se comunica con Vault para proporcionar a las aplicaciones algunos requerimientos de seguridad y con Consul para obtener datos de su KV y proporcionarlos a las instancias de los servicios, también para registrar en Consul las instancias de los servicios y si lo utilizan proporcionales sus necesidades de comunicación con <em>Consul Connect</em>.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/virtualbox_hu7e0f4556887a85d7014492c191ac5a11_199415_2560x1440_fit_box_3.png" data-gallery="" title="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/virtualbox_hu7e0f4556887a85d7014492c191ac5a11_199415_300x250_fit_box_3.png" width="300" height="224" alt="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant" title="Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant"  class=""></amp-img></a></p>
<figcaption>Máquinas virtuales en VirtuaBox aprovisionadas con Vagrant</figcaption>
</figure>
</div>
<p>La comunicación entre Consul, Vault y Nomad se realiza utilizando diferentes protocolos y puertos de red, el entorno de computación como el que proporcionan los proveedores de computación en la nube no es confiable por ser compartido aún con las medidas de aislamiento de red que implementan. Para mayor seguridad Consul, Vault y Nomad permite utilizar comunicaciones cifradas para todo el tráfico de red entrante y saliente para lo que es necesario generar certificados que permitan cifrar las comunicaciones y permitan identificar tanto al servidor como al cliente con autenticación mutua basada en certificados.</p>
<p>Los certificados se generan con <a href="https://www.openssl.org/">OpenSSL</a> con una pequeña autoridad de certificación (CA) propia.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span>./ca.sh&#10;</span></span><span class="line"><span class="cl">./server-certs.sh</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>generate-certificates.sh</span>
    </div>
</div>
<p>Vault requiere una inicialización para generar un <em>token</em> raíz y hacer el <em>unseal</em>. El <em>unseal</em> es un proceso que permite desbloquear el almacén cifraddo de Vault en el que interviene una clave dividida en varias partes de las cuales un número igual o menor al total son necesarias para desbloquear Vault cuando se inicia el clúster de servidores Vault.</p>
<p>Las máquinas virtuales utilizan la distribución <a href="https://www.ubuntu.com/">Ubuntu</a> de <a href="https://www.gnu.org/">GNU</a>/<a href="https://www.linux.com/">Linux</a> en las que se instala las herramientas de HashiCorp para los servidores y adicionalmente Docker en las instancia cliente de Nomad. En la instancia que da acceso a las consolas web de administración se instala el servidor web Nginx que hace de <em>proxy</em> con el servidor de Consul, Vault y Nomad. El aprovisionamiento de las maquinas se realiza con varios <em>scripts</em> de <em>bash</em> que contienen los comandos necesarios para instalar los paquetes, realizar la misma configuración que se realizaría de forma manual desde una terminal y copiar los archivos de configuración y certificados desde la máquina anfitrión a las máquinas virtuales.</p>
<p>Dado que el ejemplo aún con el mínimo número de máquinas virtuales necesarias requiere varias es necesario una máquina <em>host</em> tenga entre 8 y 16 GiB de memoria RAM como mínimo, se puede ajustar la cantidad de memoria que usa cada máquina virtual en el archivo de configuración de Vagrant.</p>
<p>El ejemplo consta de las siguientes máquinas virtuales.</p>
<ul>
<li>1 máquina virtual servidor Consul, <em>nomad-server-1</em>.</li>
<li>1 máquina virtual servidor Vault, <em>vault-server-1</em>.</li>
<li>1 máquina virtual servidor Nomad, <em>nomad-server-1</em>.</li>
<li>1 máquina virtual cliente Nomad, <em>nomad-agent-1</em>.</li>
<li>1 máquina virtual con Nginx como <em>proxy</em> a consolas de administración web Consul, Vault, Nomad, <em>ui-server</em>.</li>
</ul>
<p>Estos son los <em>scripts</em> de aprovisionamiento con sus funciones:</p>
<ul>
<li><em>hashicorp_role_script</em>: instala los binarios de Consul, Vault, Nomad, Envoy para Consul Connect y los <em>cni-plugins</em>.</li>
<li><em>docker_role_script</em>: instala Docker.</li>
<li><em>nginx_role_script</em>: instala Nginx.</li>
<li><em>consul_dns_server_role_script</em>: redirige las consultas DNS del puerto 53 al puerto 8600 e instala <em>iptables-persistent</em>. Esto permite ejecutar Consul sin requerir permisos de administrador requeridos para abrir un puerto privilegiado como el 53.</li>
<li><em>create_provision_directories_script</em>: inicializa los directorios de aprovisionamiento en la máquina virtual.</li>
<li><em>consul_provision_script</em>, <em>vault_provision_script</em>, <em>nomad_provision_script</em>, <em>ui_server_provision_script</em>: aprovisionan los archivos de configuración de la máquina anfitrión a las máquinas virtuales en los directorios apropiados.</li>
<li><em>vault_configure_script</em>, <em>nomad_configure_script</em>: realizan la configuración de los servidores Vault y Nomad.</li>
<li><em>consul_services_script</em>, <em>vault_services_script</em>, <em>nomad_services_script</em>, <em>ui_server_services_script</em>, <em>docker_services_script</em>: inician los servicios de <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a>.</li>
</ul>
<p>Consul tiene la función de servidor DNS con el catálogo de servicios registrados. Para dar acceso a las máquinas virtuales al servidor de nombres DNS de Consul es necesario redirigir el tráfico del puerto 53 al puerto 8600 y modificar el archivo <em>resolv.conf</em>. Esto requiere un poco de configuración en Ubuntu modificando <em>iptables</em> y utilizar <em>iptables-persistent</em> para que los cambios sean permanentes entre reinicios.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-dns_huac6fb6b58138cf8f40ea6c567899a579_105867_2560x1440_fit_box_3.png" data-gallery="" title="Servicio DNS de Consul accedido desde el servidor de Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-dns_huac6fb6b58138cf8f40ea6c567899a579_105867_300x250_fit_box_3.png" width="300" height="216" alt="Servicio DNS de Consul accedido desde el servidor de Nomad" title="Servicio DNS de Consul accedido desde el servidor de Nomad"  class=""></amp-img></a></p>
<figcaption>Servicio DNS de Consul que expone el catálogo de servicios accedido desde el servidor de Nomad</figcaption>
</figure>
</div>
<p>Este es el archivo de aprovisionamiento de Vagrant para crear las máquinas virtuales en VirtualBox. En todos los servidores no son necesarias todas las herramienta pero por simplicidad en el ejemplo se instalan, por ejemplo, en el servidor de Nomad no es necesario instalar el binario de Vault.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">  1&#10;</span><span class="lnt">  2&#10;</span><span class="lnt">  3&#10;</span><span class="lnt">  4&#10;</span><span class="lnt">  5&#10;</span><span class="lnt">  6&#10;</span><span class="lnt">  7&#10;</span><span class="lnt">  8&#10;</span><span class="lnt">  9&#10;</span><span class="lnt"> 10&#10;</span><span class="lnt"> 11&#10;</span><span class="lnt"> 12&#10;</span><span class="lnt"> 13&#10;</span><span class="lnt"> 14&#10;</span><span class="lnt"> 15&#10;</span><span class="lnt"> 16&#10;</span><span class="lnt"> 17&#10;</span><span class="lnt"> 18&#10;</span><span class="lnt"> 19&#10;</span><span class="lnt"> 20&#10;</span><span class="lnt"> 21&#10;</span><span class="lnt"> 22&#10;</span><span class="lnt"> 23&#10;</span><span class="lnt"> 24&#10;</span><span class="lnt"> 25&#10;</span><span class="lnt"> 26&#10;</span><span class="lnt"> 27&#10;</span><span class="lnt"> 28&#10;</span><span class="lnt"> 29&#10;</span><span class="lnt"> 30&#10;</span><span class="lnt"> 31&#10;</span><span class="lnt"> 32&#10;</span><span class="lnt"> 33&#10;</span><span class="lnt"> 34&#10;</span><span class="lnt"> 35&#10;</span><span class="lnt"> 36&#10;</span><span class="lnt"> 37&#10;</span><span class="lnt"> 38&#10;</span><span class="lnt"> 39&#10;</span><span class="lnt"> 40&#10;</span><span class="lnt"> 41&#10;</span><span class="lnt"> 42&#10;</span><span class="lnt"> 43&#10;</span><span class="lnt"> 44&#10;</span><span class="lnt"> 45&#10;</span><span class="lnt"> 46&#10;</span><span class="lnt"> 47&#10;</span><span class="lnt"> 48&#10;</span><span class="lnt"> 49&#10;</span><span class="lnt"> 50&#10;</span><span class="lnt"> 51&#10;</span><span class="lnt"> 52&#10;</span><span class="lnt"> 53&#10;</span><span class="lnt"> 54&#10;</span><span class="lnt"> 55&#10;</span><span class="lnt"> 56&#10;</span><span class="lnt"> 57&#10;</span><span class="lnt"> 58&#10;</span><span class="lnt"> 59&#10;</span><span class="lnt"> 60&#10;</span><span class="lnt"> 61&#10;</span><span class="lnt"> 62&#10;</span><span class="lnt"> 63&#10;</span><span class="lnt"> 64&#10;</span><span class="lnt"> 65&#10;</span><span class="lnt"> 66&#10;</span><span class="lnt"> 67&#10;</span><span class="lnt"> 68&#10;</span><span class="lnt"> 69&#10;</span><span class="lnt"> 70&#10;</span><span class="lnt"> 71&#10;</span><span class="lnt"> 72&#10;</span><span class="lnt"> 73&#10;</span><span class="lnt"> 74&#10;</span><span class="lnt"> 75&#10;</span><span class="lnt"> 76&#10;</span><span class="lnt"> 77&#10;</span><span class="lnt"> 78&#10;</span><span class="lnt"> 79&#10;</span><span class="lnt"> 80&#10;</span><span class="lnt"> 81&#10;</span><span class="lnt"> 82&#10;</span><span class="lnt"> 83&#10;</span><span class="lnt"> 84&#10;</span><span class="lnt"> 85&#10;</span><span class="lnt"> 86&#10;</span><span class="lnt"> 87&#10;</span><span class="lnt"> 88&#10;</span><span class="lnt"> 89&#10;</span><span class="lnt"> 90&#10;</span><span class="lnt"> 91&#10;</span><span class="lnt"> 92&#10;</span><span class="lnt"> 93&#10;</span><span class="lnt"> 94&#10;</span><span class="lnt"> 95&#10;</span><span class="lnt"> 96&#10;</span><span class="lnt"> 97&#10;</span><span class="lnt"> 98&#10;</span><span class="lnt"> 99&#10;</span><span class="lnt">100&#10;</span><span class="lnt">101&#10;</span><span class="lnt">102&#10;</span><span class="lnt">103&#10;</span><span class="lnt">104&#10;</span><span class="lnt">105&#10;</span><span class="lnt">106&#10;</span><span class="lnt">107&#10;</span><span class="lnt">108&#10;</span><span class="lnt">109&#10;</span><span class="lnt">110&#10;</span><span class="lnt">111&#10;</span><span class="lnt">112&#10;</span><span class="lnt">113&#10;</span><span class="lnt">114&#10;</span><span class="lnt">115&#10;</span><span class="lnt">116&#10;</span><span class="lnt">117&#10;</span><span class="lnt">118&#10;</span><span class="lnt">119&#10;</span><span class="lnt">120&#10;</span><span class="lnt">121&#10;</span><span class="lnt">122&#10;</span><span class="lnt">123&#10;</span><span class="lnt">124&#10;</span><span class="lnt">125&#10;</span><span class="lnt">126&#10;</span><span class="lnt">127&#10;</span><span class="lnt">128&#10;</span><span class="lnt">129&#10;</span><span class="lnt">130&#10;</span><span class="lnt">131&#10;</span><span class="lnt">132&#10;</span><span class="lnt">133&#10;</span><span class="lnt">134&#10;</span><span class="lnt">135&#10;</span><span class="lnt">136&#10;</span><span class="lnt">137&#10;</span><span class="lnt">138&#10;</span><span class="lnt">139&#10;</span><span class="lnt">140&#10;</span><span class="lnt">141&#10;</span><span class="lnt">142&#10;</span><span class="lnt">143&#10;</span><span class="lnt">144&#10;</span><span class="lnt">145&#10;</span><span class="lnt">146&#10;</span><span class="lnt">147&#10;</span><span class="lnt">148&#10;</span><span class="lnt">149&#10;</span><span class="lnt">150&#10;</span><span class="lnt">151&#10;</span><span class="lnt">152&#10;</span><span class="lnt">153&#10;</span><span class="lnt">154&#10;</span><span class="lnt">155&#10;</span><span class="lnt">156&#10;</span><span class="lnt">157&#10;</span><span class="lnt">158&#10;</span><span class="lnt">159&#10;</span><span class="lnt">160&#10;</span><span class="lnt">161&#10;</span><span class="lnt">162&#10;</span><span class="lnt">163&#10;</span><span class="lnt">164&#10;</span><span class="lnt">165&#10;</span><span class="lnt">166&#10;</span><span class="lnt">167&#10;</span><span class="lnt">168&#10;</span><span class="lnt">169&#10;</span><span class="lnt">170&#10;</span><span class="lnt">171&#10;</span><span class="lnt">172&#10;</span><span class="lnt">173&#10;</span><span class="lnt">174&#10;</span><span class="lnt">175&#10;</span><span class="lnt">176&#10;</span><span class="lnt">177&#10;</span><span class="lnt">178&#10;</span><span class="lnt">179&#10;</span><span class="lnt">180&#10;</span><span class="lnt">181&#10;</span><span class="lnt">182&#10;</span><span class="lnt">183&#10;</span><span class="lnt">184&#10;</span><span class="lnt">185&#10;</span><span class="lnt">186&#10;</span><span class="lnt">187&#10;</span><span class="lnt">188&#10;</span><span class="lnt">189&#10;</span><span class="lnt">190&#10;</span><span class="lnt">191&#10;</span><span class="lnt">192&#10;</span><span class="lnt">193&#10;</span><span class="lnt">194&#10;</span><span class="lnt">195&#10;</span><span class="lnt">196&#10;</span><span class="lnt">197&#10;</span><span class="lnt">198&#10;</span><span class="lnt">199&#10;</span><span class="lnt">200&#10;</span><span class="lnt">201&#10;</span><span class="lnt">202&#10;</span><span class="lnt">203&#10;</span><span class="lnt">204&#10;</span><span class="lnt">205&#10;</span><span class="lnt">206&#10;</span><span class="lnt">207&#10;</span><span class="lnt">208&#10;</span><span class="lnt">209&#10;</span><span class="lnt">210&#10;</span><span class="lnt">211&#10;</span><span class="lnt">212&#10;</span><span class="lnt">213&#10;</span><span class="lnt">214&#10;</span><span class="lnt">215&#10;</span><span class="lnt">216&#10;</span><span class="lnt">217&#10;</span><span class="lnt">218&#10;</span><span class="lnt">219&#10;</span><span class="lnt">220&#10;</span><span class="lnt">221&#10;</span><span class="lnt">222&#10;</span><span class="lnt">223&#10;</span><span class="lnt">224&#10;</span><span class="lnt">225&#10;</span><span class="lnt">226&#10;</span><span class="lnt">227&#10;</span><span class="lnt">228&#10;</span><span class="lnt">229&#10;</span><span class="lnt">230&#10;</span><span class="lnt">231&#10;</span><span class="lnt">232&#10;</span><span class="lnt">233&#10;</span><span class="lnt">234&#10;</span><span class="lnt">235&#10;</span><span class="lnt">236&#10;</span><span class="lnt">237&#10;</span><span class="lnt">238&#10;</span><span class="lnt">239&#10;</span><span class="lnt">240&#10;</span><span class="lnt">241&#10;</span><span class="lnt">242&#10;</span><span class="lnt">243&#10;</span><span class="lnt">244&#10;</span><span class="lnt">245&#10;</span><span class="lnt">246&#10;</span><span class="lnt">247&#10;</span><span class="lnt">248&#10;</span><span class="lnt">249&#10;</span><span class="lnt">250&#10;</span><span class="lnt">251&#10;</span><span class="lnt">252&#10;</span><span class="lnt">253&#10;</span><span class="lnt">254&#10;</span><span class="lnt">255&#10;</span><span class="lnt">256&#10;</span><span class="lnt">257&#10;</span><span class="lnt">258&#10;</span><span class="lnt">259&#10;</span><span class="lnt">260&#10;</span><span class="lnt">261&#10;</span><span class="lnt">262&#10;</span><span class="lnt">263&#10;</span><span class="lnt">264&#10;</span><span class="lnt">265&#10;</span><span class="lnt">266&#10;</span><span class="lnt">267&#10;</span><span class="lnt">268&#10;</span><span class="lnt">269&#10;</span><span class="lnt">270&#10;</span><span class="lnt">271&#10;</span><span class="lnt">272&#10;</span><span class="lnt">273&#10;</span><span class="lnt">274&#10;</span><span class="lnt">275&#10;</span><span class="lnt">276&#10;</span><span class="lnt">277&#10;</span><span class="lnt">278&#10;</span><span class="lnt">279&#10;</span><span class="lnt">280&#10;</span><span class="lnt">281&#10;</span><span class="lnt">282&#10;</span><span class="lnt">283&#10;</span><span class="lnt">284&#10;</span><span class="lnt">285&#10;</span><span class="lnt">286&#10;</span><span class="lnt">287&#10;</span><span class="lnt">288&#10;</span><span class="lnt">289&#10;</span><span class="lnt">290&#10;</span><span class="lnt">291&#10;</span><span class="lnt">292&#10;</span><span class="lnt">293&#10;</span><span class="lnt">294&#10;</span><span class="lnt">295&#10;</span><span class="lnt">296&#10;</span><span class="lnt">297&#10;</span><span class="lnt">298&#10;</span><span class="lnt">299&#10;</span><span class="lnt">300&#10;</span><span class="lnt">301&#10;</span><span class="lnt">302&#10;</span><span class="lnt">303&#10;</span><span class="lnt">304&#10;</span><span class="lnt">305&#10;</span><span class="lnt">306&#10;</span><span class="lnt">307&#10;</span><span class="lnt">308&#10;</span><span class="lnt">309&#10;</span><span class="lnt">310&#10;</span><span class="lnt">311&#10;</span><span class="lnt">312&#10;</span><span class="lnt">313&#10;</span><span class="lnt">314&#10;</span><span class="lnt">315&#10;</span><span class="lnt">316&#10;</span><span class="lnt">317&#10;</span><span class="lnt">318&#10;</span><span class="lnt">319&#10;</span><span class="lnt">320&#10;</span><span class="lnt">321&#10;</span><span class="lnt">322&#10;</span><span class="lnt">323&#10;</span><span class="lnt">324&#10;</span><span class="lnt">325&#10;</span><span class="lnt">326&#10;</span><span class="lnt">327&#10;</span><span class="lnt">328&#10;</span><span class="lnt">329&#10;</span><span class="lnt">330&#10;</span><span class="lnt">331&#10;</span><span class="lnt">332&#10;</span><span class="lnt">333&#10;</span><span class="lnt">334&#10;</span><span class="lnt">335&#10;</span><span class="lnt">336&#10;</span><span class="lnt">337&#10;</span><span class="lnt">338&#10;</span><span class="lnt">339&#10;</span><span class="lnt">340&#10;</span><span class="lnt">341&#10;</span><span class="lnt">342&#10;</span><span class="lnt">343&#10;</span><span class="lnt">344&#10;</span><span class="lnt">345&#10;</span><span class="lnt">346&#10;</span><span class="lnt">347&#10;</span><span class="lnt">348&#10;</span><span class="lnt">349&#10;</span><span class="lnt">350&#10;</span><span class="lnt">351&#10;</span><span class="lnt">352&#10;</span><span class="lnt">353&#10;</span><span class="lnt">354&#10;</span><span class="lnt">355&#10;</span><span class="lnt">356&#10;</span><span class="lnt">357&#10;</span><span class="lnt">358&#10;</span><span class="lnt">359&#10;</span><span class="lnt">360&#10;</span><span class="lnt">361&#10;</span><span class="lnt">362&#10;</span><span class="lnt">363&#10;</span><span class="lnt">364&#10;</span><span class="lnt">365&#10;</span><span class="lnt">366&#10;</span><span class="lnt">367&#10;</span><span class="lnt">368&#10;</span><span class="lnt">369&#10;</span><span class="lnt">370&#10;</span><span class="lnt">371&#10;</span><span class="lnt">372&#10;</span><span class="lnt">373&#10;</span><span class="lnt">374&#10;</span><span class="lnt">375&#10;</span><span class="lnt">376&#10;</span><span class="lnt">377&#10;</span><span class="lnt">378&#10;</span><span class="lnt">379&#10;</span><span class="lnt">380&#10;</span><span class="lnt">381&#10;</span><span class="lnt">382&#10;</span><span class="lnt">383&#10;</span><span class="lnt">384&#10;</span><span class="lnt">385&#10;</span><span class="lnt">386&#10;</span><span class="lnt">387&#10;</span><span class="lnt">388&#10;</span><span class="lnt">389&#10;</span><span class="lnt">390&#10;</span><span class="lnt">391&#10;</span><span class="lnt">392&#10;</span><span class="lnt">393&#10;</span><span class="lnt">394&#10;</span><span class="lnt">395&#10;</span><span class="lnt">396&#10;</span><span class="lnt">397&#10;</span><span class="lnt">398&#10;</span><span class="lnt">399&#10;</span><span class="lnt">400&#10;</span><span class="lnt">401&#10;</span><span class="lnt">402&#10;</span><span class="lnt">403&#10;</span><span class="lnt">404&#10;</span><span class="lnt">405&#10;</span><span class="lnt">406&#10;</span><span class="lnt">407&#10;</span><span class="lnt">408&#10;</span><span class="lnt">409&#10;</span><span class="lnt">410&#10;</span><span class="lnt">411&#10;</span><span class="lnt">412&#10;</span><span class="lnt">413&#10;</span><span class="lnt">414&#10;</span><span class="lnt">415&#10;</span><span class="lnt">416&#10;</span><span class="lnt">417&#10;</span><span class="lnt">418&#10;</span><span class="lnt">419&#10;</span><span class="lnt">420&#10;</span><span class="lnt">421&#10;</span><span class="lnt">422&#10;</span><span class="lnt">423&#10;</span><span class="lnt">424&#10;</span><span class="lnt">425&#10;</span><span class="lnt">426&#10;</span><span class="lnt">427&#10;</span><span class="lnt">428&#10;</span><span class="lnt">429&#10;</span><span class="lnt">430&#10;</span><span class="lnt">431&#10;</span><span class="lnt">432&#10;</span><span class="lnt">433&#10;</span><span class="lnt">434&#10;</span><span class="lnt">435&#10;</span><span class="lnt">436&#10;</span><span class="lnt">437&#10;</span><span class="lnt">438&#10;</span><span class="lnt">439&#10;</span><span class="lnt">440&#10;</span><span class="lnt">441&#10;</span><span class="lnt">442&#10;</span><span class="lnt">443&#10;</span><span class="lnt">444&#10;</span><span class="lnt">445&#10;</span><span class="lnt">446&#10;</span><span class="lnt">447&#10;</span><span class="lnt">448&#10;</span><span class="lnt">449&#10;</span><span class="lnt">450&#10;</span><span class="lnt">451&#10;</span><span class="lnt">452&#10;</span><span class="lnt">453&#10;</span><span class="lnt">454&#10;</span><span class="lnt">455&#10;</span><span class="lnt">456&#10;</span><span class="lnt">457&#10;</span><span class="lnt">458&#10;</span><span class="lnt">459&#10;</span><span class="lnt">460&#10;</span><span class="lnt">461&#10;</span><span class="lnt">462&#10;</span><span class="lnt">463&#10;</span><span class="lnt">464&#10;</span><span class="lnt">465&#10;</span><span class="lnt">466&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="c1"># -*- mode: ruby -*-</span>&#10;</span></span><span class="line"><span class="cl"><span class="c1"># vi: set ft=ruby :</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_ROOT_TOKEN</span> <span class="o">=</span> <span class="s2">&#34;s.ltQXU2wZeWYNSEf946CefIuG&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_UNSEAL_KEY_1</span> <span class="o">=</span> <span class="s2">&#34;GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="no">VAULT_UNSEAL_KEY_2</span> <span class="o">=</span> <span class="s2">&#34;zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;consul-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.10&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Consul Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;consul-server/consul.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;vault-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.20&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Vault Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/vault.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/nomad-server-policy.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/nomad-server-policy.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;vault-server/nomad-cluster-role.json&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/nomad-cluster-role.json&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/vault/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$vault_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">,</span> <span class="s2">&#34;VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_UNSEAL_KEY_1</span><span class="p">,</span> <span class="s2">&#34;VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_UNSEAL_KEY_1</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;nomad-server-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Nomad Server 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;1024&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-server/nomad.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;nomad-agent-1&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Nomad Agent 1&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;2048&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$docker_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-agent/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;nomad-agent/nomad.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nomad/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_configure_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;VAULT_ROOT_TOKEN&#34;</span> <span class="o">=&gt;</span> <span class="no">VAULT_ROOT_TOKEN</span><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$docker_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nomad_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&#34;ui-server&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">instance</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;ubuntu/focal64&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&#34;private_network&#34;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&#34;192.168.33.50&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&#34;virtualbox&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;HashiCorp Web Server&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&#34;512&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uart1&#34;</span><span class="p">,</span> <span class="s2">&#34;0x3F8&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">&#34;modifyvm&#34;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&#34;--uartmode1&#34;</span><span class="p">,</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$hashicorp_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$nginx_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$create_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul-agent.hcl&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul.hcl&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/vault.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/nomad.conf&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad.conf&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/consul-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/vault-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;ui-server/nomad-htpasswd&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-htpasswd&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/consul/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/ui-server.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/ui-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/ui-server.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/ui-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span><span class="p">,</span> <span class="ss">destination</span><span class="p">:</span> <span class="s2">&#34;/home/vagrant/nginx/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$ui_server_provision_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$remove_provision_directories_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_server_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$consul_dns_agent_role_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">instance</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="vg">$ui_server_services_script</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">false</span>&#10;</span></span><span class="line"><span class="cl">  <span class="k">end</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$hashicorp_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">apt</span><span class="o">.</span><span class="n">releases</span><span class="o">.</span><span class="n">hashicorp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gpg</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">repository</span> <span class="s2">&#34;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">consul</span> <span class="n">vault</span> <span class="n">nomad</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&#34;/usr/local/bin/envoy&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">getenvoy</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">cli</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">bash</span> <span class="o">-</span><span class="n">s</span> <span class="o">--</span> <span class="o">-</span><span class="n">b</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span> &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">getenvoy</span> <span class="n">run</span> <span class="ss">standard</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">15</span><span class="o">.</span><span class="mi">0</span> <span class="o">--</span> <span class="o">--</span><span class="n">version</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/.</span><span class="n">getenvoy</span><span class="o">/</span><span class="n">builds</span><span class="o">/</span><span class="n">standard</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">15</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">linux_glibc</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">envoy</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;/opt/cni/bin&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">o</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">containernetworking</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">v0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/opt/</span><span class="n">cni</span><span class="o">/</span><span class="n">bin</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">tar</span> <span class="o">-</span><span class="n">C</span> <span class="sr">/opt/</span><span class="n">cni</span><span class="o">/</span><span class="n">bin</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="n">cni</span><span class="o">-</span><span class="n">plugins</span><span class="o">.</span><span class="n">tgz</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$docker_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">apt</span><span class="o">-</span><span class="n">transport</span><span class="o">-</span><span class="n">https</span> <span class="n">ca</span><span class="o">-</span><span class="n">certificates</span> <span class="n">curl</span> <span class="n">gnupg</span><span class="o">-</span><span class="n">agent</span> <span class="n">software</span><span class="o">-</span><span class="n">properties</span><span class="o">-</span><span class="n">common</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">curl</span> <span class="o">-</span><span class="n">fsSL</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">gpg</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="s2">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">aG</span> <span class="n">docker</span> <span class="n">vagrant</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">aG</span> <span class="n">docker</span> <span class="n">nomad</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nginx_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">update</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">nginx</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_dns_server_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">PREROUTING</span> <span class="o">-</span><span class="nb">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">PREROUTING</span> <span class="o">-</span><span class="nb">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">OUTPUT</span> <span class="o">-</span><span class="n">d</span> <span class="n">localhost</span> <span class="o">-</span><span class="nb">p</span> <span class="n">udp</span> <span class="o">-</span><span class="n">m</span> <span class="n">udp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="no">OUTPUT</span> <span class="o">-</span><span class="n">d</span> <span class="n">localhost</span> <span class="o">-</span><span class="nb">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">53</span> <span class="o">-</span><span class="n">j</span> <span class="no">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8600</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="no">DEBIAN_FRONTEND</span><span class="o">=</span><span class="n">noninteractive</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">iptables</span><span class="o">-</span><span class="n">persistent</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">iptables</span><span class="o">-</span><span class="n">save</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/etc/i</span><span class="n">ptables</span><span class="o">/</span><span class="n">rules</span><span class="o">.</span><span class="n">v4</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_dns_agent_role_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="err">$</span><span class="p">(</span><span class="n">grep</span> <span class="o">-</span><span class="n">q</span> <span class="s2">&#34;nameserver 127.0.0.1&#34;</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^$/</span><span class="se">\\</span><span class="s2">nnameserver 127.0.0.1/g&#34;</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">fi</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$create_provision_directories_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/*.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$remove_provision_directories_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/*.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">vault</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^StartLimitIntervalSec=*$//g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nomad</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="mi">2</span><span class="o">&gt;</span><span class="sr">/dev/nu</span><span class="n">ll</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^StartLimitIntervalSec=*$//g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^#Wants=consul.service$/Wants=consul.service/g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/^#After=consul.service$/After=consul.service/g&#34;</span> <span class="sr">/lib/s</span><span class="n">ystemd</span><span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">service</span> &#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$ui_server_provision_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">conf</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">htpasswd</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">consul</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">ui</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">consul</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">vault</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/home/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">444</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">hcl</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">chown</span> <span class="ss">root</span><span class="p">:</span><span class="n">root</span> <span class="sr">/etc/</span><span class="n">consul</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/*.</span><span class="n">conf</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">certs</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="kp">private</span><span class="o">/*</span> <span class="sr">/etc/n</span><span class="n">ginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*-</span><span class="n">htpasswd</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_configure_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CAPATH</span><span class="o">=</span><span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">operator</span> <span class="n">unseal</span> <span class="s2">&#34;$VAULT_UNSEAL_KEY_1&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">operator</span> <span class="n">unseal</span> <span class="s2">&#34;$VAULT_UNSEAL_KEY_2&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">login</span> <span class="s2">&#34;$VAULT_ROOT_TOKEN&#34;</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">policy</span> <span class="n">write</span> <span class="n">nomad</span><span class="o">-</span><span class="n">server</span> <span class="sr">/etc/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">hcl</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">write</span> <span class="n">auth</span><span class="o">/</span><span class="n">token</span><span class="o">/</span><span class="n">roles</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span> <span class="err">@</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vault</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">json</span> <span class="o">||</span> <span class="p">:</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_configure_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">export</span> <span class="no">VAULT_CAPATH</span><span class="o">=</span><span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"> &#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vault</span> <span class="n">login</span> <span class="s2">&#34;$VAULT_ROOT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="no">VAULT_TOKEN</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">vault</span> <span class="n">token</span> <span class="n">create</span> <span class="o">-</span><span class="n">policy</span> <span class="n">nomad</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">period</span> <span class="mi">72</span><span class="n">h</span> <span class="o">-</span><span class="n">orphan</span> <span class="o">-</span><span class="n">field</span> <span class="n">token</span><span class="p">)</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&#34;s/\$VAULT_TOKEN/$VAULT_TOKEN/g&#34;</span> <span class="sr">/etc/nom</span><span class="n">ad</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nomad</span><span class="o">.</span><span class="n">hcl</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$consul_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$vault_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">vault</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$nomad_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nomad</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">  &#10;</span></span><span class="line"><span class="cl">  <span class="vg">$ui_server_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">consul</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">nginx</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="vg">$docker_services_script</span> <span class="o">=</span> <span class="s">&lt;&lt;-SCRIPT&#10;</span></span></span><span class="line"><span class="cl"><span class="s"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">docker</span><span class="o">.</span><span class="n">service</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">sleep</span> <span class="mi">5</span>&#10;</span></span><span class="line"><span class="cl">  <span class="no">SCRIPT</span>&#10;</span></span><span class="line"><span class="cl"><span class="k">end</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>Vagrantfile</span>
    </div>
</div>
<p>El comando que permite crear y aprovisionar las máquinas es el siguiente.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span>vagrant up --provision&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up.sh</span>
    </div>
</div>
<p>En el primer inicio Vault requiere generar el <em>token root</em> que tiene los permisos de superusuario, también se divide una clave en varias partes de las cuales un número mínimo son necesarias para realizar la operación de <em>unseal</em>, las partes de la clave son distribuidas entre varias personas y son necesarias varias para realizar la operación <em>unseal</em>, para que la persona que genera las partes de las claves no conozca todas las partes de la clave y para transmitirlas de forma segura las partes de la clave se cifran con PGP. Para la creación del <em>token root</em> y las claves en la creación de más máquinas en vez de usar <em>vagrant-up.sh</em> hay que aprovisionar las máquinas en varios pasos.</p>
<p>Se inicializa la máquina virtual del servidor Consul, luego del servidor Vault y se genera el <em>token root</em>, se inicia sesión con el <em>token root</em> y se realiza la operación <em>unseal</em> con el número mínimo de claves necesarias para desbloquear los datos cifrados del servidor.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span><span class="lnt">47&#10;</span><span class="lnt">48&#10;</span><span class="lnt">49&#10;</span><span class="lnt">50&#10;</span><span class="lnt">51&#10;</span><span class="lnt">52&#10;</span><span class="lnt">53&#10;</span><span class="lnt">54&#10;</span><span class="lnt">55&#10;</span><span class="lnt">56&#10;</span><span class="lnt">57&#10;</span><span class="lnt">58&#10;</span><span class="lnt">59&#10;</span><span class="lnt">60&#10;</span><span class="lnt">61&#10;</span><span class="lnt">62&#10;</span><span class="lnt">63&#10;</span><span class="lnt">64&#10;</span><span class="lnt">65&#10;</span><span class="lnt">66&#10;</span><span class="lnt">67&#10;</span><span class="lnt">68&#10;</span><span class="lnt">69&#10;</span><span class="lnt">70&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vagrant up --provision consul-server-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision vault-server-1&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">VAULT_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault operator init -key-shares<span class="o">=</span><span class="m">5</span> -key-threshold<span class="o">=</span><span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Unseal Key 1: GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#10;</span></span><span class="line"><span class="cl">Unseal Key 2: zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL+B&#10;</span></span><span class="line"><span class="cl">Unseal Key 3: CZ4T0oqwLvniuufFimkpPLxSeo6nWAWpHrrJn+utDLlF&#10;</span></span><span class="line"><span class="cl">Unseal Key 4: aVkAonumA5ryLy7hpWDCG+bWb1RboxnhXfk7tvybmFpx&#10;</span></span><span class="line"><span class="cl">Unseal Key 5: a5mCVlK4E+wEtH2m7Tc+KMaXBYWVqSRv3HhmFs5yL93A&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Initial Root Token: s.ltQXU2wZeWYNSEf946CefIuG&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Vault initialized with <span class="m">5</span> key shares and a key threshold of 2. Please securely&#10;</span></span><span class="line"><span class="cl">distribute the key shares printed above. When the Vault is re-sealed,&#10;</span></span><span class="line"><span class="cl">restarted, or stopped, you must supply at least <span class="m">2</span> of these keys to unseal it&#10;</span></span><span class="line"><span class="cl">before it can start servicing requests.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Vault does not store the generated master key. Without at least <span class="m">2</span> key to&#10;</span></span><span class="line"><span class="cl">reconstruct the master key, Vault will remain permanently sealed!&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">It is possible to generate new unseal keys, provided you have a quorum of&#10;</span></span><span class="line"><span class="cl">existing unseal keys shares. See <span class="s2">&#34;vault operator rekey&#34;</span> <span class="k">for</span> more information.&#10;</span></span><span class="line"><span class="cl">$ vault status&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&#10;</span></span><span class="line"><span class="cl">Seal Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  shamir&#10;</span></span><span class="line"><span class="cl">Initialized&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Sealed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Total Shares&nbsp;&nbsp;&nbsp;&nbsp;   <span class="m">5</span>&#10;</span></span><span class="line"><span class="cl">Threshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Unseal Progress&nbsp;&nbsp;&nbsp;&nbsp;0/2&#10;</span></span><span class="line"><span class="cl">Unseal Nonce&nbsp;&nbsp;&nbsp;&nbsp;   n/a&#10;</span></span><span class="line"><span class="cl">Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.5.0&#10;</span></span><span class="line"><span class="cl">HA Enabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault operator unseal GmSsvWlRtimeVb4ikBYKGJeAWGgkB1h8NpLpGEu0oqTe&#10;</span></span><span class="line"><span class="cl">$ vault operator unseal zPBru7ivXOhOZmytYHN5gFhusX2kpNR5TOgvxrjxnL+B&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----&#10;</span></span><span class="line"><span class="cl">Seal Type&nbsp;&nbsp;&nbsp;&nbsp;   shamir&#10;</span></span><span class="line"><span class="cl">Initialized&nbsp;&nbsp;&nbsp;&nbsp; <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">Sealed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">Total Shares&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">5</span>&#10;</span></span><span class="line"><span class="cl">Threshold&nbsp;&nbsp;&nbsp;&nbsp;   <span class="m">2</span>&#10;</span></span><span class="line"><span class="cl">Version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.5.0&#10;</span></span><span class="line"><span class="cl">Cluster Name&nbsp;&nbsp;&nbsp;&nbsp;vault-cluster-28313ce3&#10;</span></span><span class="line"><span class="cl">Cluster ID&nbsp;&nbsp;&nbsp;&nbsp;  dcb97a2c-520c-2d41-9dc3-979b1cda5423&#10;</span></span><span class="line"><span class="cl">HA Enabled&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">HA Cluster&nbsp;&nbsp;&nbsp;&nbsp;  https://192.168.33.20:8201&#10;</span></span><span class="line"><span class="cl">HA Mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">$ vault login <span class="s2">&#34;s.ltQXU2wZeWYNSEf946CefIuG&#34;</span>&#10;</span></span><span class="line"><span class="cl">Success! You are now authenticated. The token information displayed below&#10;</span></span><span class="line"><span class="cl">is already stored in the token helper. You <span class="k">do</span> NOT need to run <span class="s2">&#34;vault login&#34;</span>&#10;</span></span><span class="line"><span class="cl">again. Future Vault requests will automatically use this token.&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Value&#10;</span></span><span class="line"><span class="cl">---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -----&#10;</span></span><span class="line"><span class="cl">token&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.ltQXU2wZeWYNSEf946CefIuG&#10;</span></span><span class="line"><span class="cl">token_accessor&nbsp;&nbsp;&nbsp;&nbsp;   l2YGtM1V4z3Sv0Gey0l646BX&#10;</span></span><span class="line"><span class="cl">token_duration&nbsp;&nbsp;&nbsp;&nbsp;   ∞&#10;</span></span><span class="line"><span class="cl">token_renewable&nbsp;&nbsp;&nbsp;&nbsp;  <span class="nb">false</span>&#10;</span></span><span class="line"><span class="cl">token_policies&nbsp;&nbsp;&nbsp;&nbsp;   <span class="o">[</span><span class="s2">&#34;root&#34;</span><span class="o">]</span>&#10;</span></span><span class="line"><span class="cl">identity_policies&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">[]</span>&#10;</span></span><span class="line"><span class="cl">policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">[</span><span class="s2">&#34;root&#34;</span><span class="o">]</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up-1.sh</span>
    </div>
</div>
<p>El <em>token</em> raíz devuelto en la inicialización de Vault es necesario ponerlo en la variable <em>VAULT_ROOT_TOKEN</em> del archivo <em>Vagranfile</em> junto con 2 de las 5 claves para desellar Vault en las variables <em>VAULT_UNSEAL_KEY_1</em> y <em>VAULT_UNSEAL_KEY_2</em>. Luegos se inician y aprovisionan el resto de máquinas virtuales.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vagrant up --provision nomad-server-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision nomad-agent-1&#10;</span></span><span class="line"><span class="cl">$ vagrant up --provision ui-server</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vagrant-up-2.sh</span>
    </div>
</div>
<p>Tanto Consul, Vault como Nomad necesitan un archivo de configuración, en él se describe las direcciones IP de los servidores en las máquinas virtuales, se usan las propiedades de configuración necesarias para que la comunicaciones estén cifradas y diferentes propiedades adicionales para configurar cada servicio servidor.</p>
<ul>
<li>El servidor Consul utiliza la dirección IP <em>192.168.33.10</em></li>
<li>El servidor Vault utiliza la dirección IP <em>192.168.33.20</em></li>
<li>El servidor Nomad utiliza la dirección IP <em>192.168.33.30</em></li>
<li>El cliente de Nomad utiliza la dirección IP <em>192.168.33.40</em></li>
<li>El servidor Nginx con las consolas de administración web utiliza la dirección IP <em>192.168.33.50</em></li>
</ul>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&#34;consul-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bootstrap_expect</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bind_addr</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.10&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/consul/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_incoming</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_outgoing</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">recursors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;8.8.8.8&#34;, &#34;8.8.4.4&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">retry_join</span> <span class="o">=</span> <span class="p">[]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">ui</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">client_addr</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">ports</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  grpc</span> <span class="o">=</span> <span class="m">8502</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="err">-</span><span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  https</span> <span class="o">=</span> <span class="m">8501</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">connect</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">auto_encrypt</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  allow_tls</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>consul-server/consul.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">ui</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">api_addr</span> <span class="o">=</span> <span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">service_registration</span> <span class="s2">&#34;consul&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  scheme</span> <span class="o">=</span> <span class="s2">&#34;https&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">storage</span> <span class="s2">&#34;consul&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  scheme</span> <span class="o">=</span> <span class="s2">&#34;https&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  path</span> <span class="o">=</span> <span class="s2">&#34;vault/&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">listener</span> <span class="s2">&#34;tcp&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/vault-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/vault-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_client_ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/vault.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls13&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-server/vault.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;nomad-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/nomad&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">advertise</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  serf</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.30&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  bootstrap_expect</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  encrypt</span> <span class="o">=</span><span class="n"> &#34;aUcxnl/42fcutmLyRO/TVg</span><span class="o">==</span><span class="err">&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">consul</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ssl</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  server_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  client_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">vault</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  token</span> <span class="o">=</span> <span class="s2">&#34;$VAULT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  create_from_role</span> <span class="o">=</span> <span class="s2">&#34;nomad-cluster&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>  &#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">tls</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-server.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-server.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls12&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_https_client</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-server/nomad.hcl</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span><span class="lnt">42&#10;</span><span class="lnt">43&#10;</span><span class="lnt">44&#10;</span><span class="lnt">45&#10;</span><span class="lnt">46&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;nomad-agent-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/nomad&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">advertise</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  serf</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.40&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">client</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  network_interface</span> <span class="o">=</span> <span class="s2">&#34;enp0s8&#34;</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">consul</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;127.0.0.1:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ssl</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  auto_advertise</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  server_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  client_auto_join</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">vault</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  enabled</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  address</span> <span class="o">=</span> <span class="s2">&#34;https://vault.service.consul:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  token</span> <span class="o">=</span> <span class="s2">&#34;$VAULT_TOKEN&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  create_from_role</span> <span class="o">=</span> <span class="s2">&#34;nomad-cluster&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>  &#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">tls</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  rpc</span>  <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/nomad.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls_min_version</span> <span class="o">=</span> <span class="s2">&#34;tls12&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_https_client</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-agent/nomad.hcl</span>
    </div>
</div>
<p>Como se muestra en los esquemas de de arquitectura de referencia Vault y Nomad no se comunican directamente con los servidores Consul sino que se comunica con un cliente de Consul en la propia máquina y es el cliente de Consul el que se comunica con los servidores de Consul. Consul se instala con la función de cliente en las máquinas servidor Vault, servidor Nomad y cliente de Nomad, el archivo de configuración de Consul en modo cliente son similares a este variando la dirección IP de la interfaz de red a la que se asocian.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&#34;vault-server-1&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="kt">false</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">bind_addr</span> <span class="o">=</span> <span class="s2">&#34;192.168.33.20&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&#34;/opt/consul/&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">cert_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">key_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">ca_file</span> <span class="o">=</span> <span class="s2">&#34;/etc/consul.d/ca.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_incoming</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_outgoing</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">verify_server_hostname</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">recursors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;8.8.8.8&#34;, &#34;8.8.4.4&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">retry_join</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;192.168.33.10&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">ports</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  grpc</span> <span class="o">=</span> <span class="m">8502</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  http</span> <span class="o">=</span> <span class="err">-</span><span class="m">1</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">  https</span> <span class="o">=</span> <span class="m">8501</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">auto_encrypt</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  tls</span> <span class="o">=</span> <span class="kt">true</span>&#10;</span></span><span class="line"><span class="cl">}&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>vault-server/consul-agent.hcl</span>
    </div>
</div>
<h4 id="interfaz-web-para-consul-vault-y-nomad">Interfaz web para Consul, Vault y Nomad</h4>
<p>Las consolas de administración web de Consul, Vault y Nomad están accesibles en estas direcciones URL que están protegidas por una autenticación básica, dado que el certificado de la CA no es de confianza para el navegador se muestra previamente un mensaje de advertencia. En la consola web de Consul se observan los servicios y nodos registrados registrados y su estado de salud.</p>
<ul>
<li>Dirección, usuario y contraseña de consola web Consul: <em>https://consul.192.168.33.50.xip.io</em>, <em>consul</em> y <em>consul</em>.</li>
<li>Dirección, usuario y contraseña de consola web Vault: <em>https://vault.192.168.33.50.xip.io</em>, <em>vault</em> y <em>vault</em>.</li>
<li>Dirección, usuario y contraseña de consola web Nomad: <em>https://nomad.192.168.33.50.xip.io</em>, <em>nomad</em> y <em>nomad</em>.</li>
</ul>
<p>Esta es la definición del servidor web virtual de la consola de Consul, los servidores web virtuales de Vault y Nomad son similares.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">consul.upstream</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server</span> <span class="n">192.168.33.10</span><span class="p">:</span><span class="mi">8501</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span> <span class="s">consul.192.168.33.50.xip.io</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span> <span class="s">http2</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">server_name</span> <span class="s">consul.192.168.33.50.xip.io</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;  <span class="s">certs/ui-server.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">ssl_certificate_key</span>  <span class="s">private/ui-server.key.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_certificate</span> <span class="s">certs/consul-agent.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_certificate_key</span> <span class="s">private/consul-agent.key.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_trusted_certificate</span> <span class="s">certs/ca.cert.pem</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_verify</span> <span class="no">off</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_ssl_protocols</span> <span class="s">TLSv1.3</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_pass</span> <span class="s">https://consul.upstream</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="s">https</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">auth_basic</span> <span class="s">&#34;Restricted</span> <span class="s">Area&#34;</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kn">auth_basic_user_file</span> <span class="s">conf.d/consul-htpasswd</span><span class="p">;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>&#10;</span></span><span class="line"><span class="cl"><span class="p">}</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>ui-server/consul.conf</span>
    </div>
</div>
<p>Las consolas de administración muestran el estado de centro de datos y con todos los servicios está disponibles.</p>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console_hucd5d737b76f12ee85ce465ae0112def7_63882_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Consul con los servicios registrados y su estado de salud"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console_hucd5d737b76f12ee85ce465ae0112def7_63882_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Consul con los servicios registrados y su estado de salud" title="Consola web de Consul con los servicios registrados y su estado de salud"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console-nodes_hu8a20f6ed6ab107f307a3ba354fd1a7b8_58226_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Consul con los nodos registrados y su estado de salud"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-console-nodes_hu8a20f6ed6ab107f307a3ba354fd1a7b8_58226_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Consul con los nodos registrados y su estado de salud" title="Consola web de Consul con los nodos registrados y su estado de salud"  class=""></amp-img></a></p>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-console_hu47fc894059bf643b5ee1841f3679b829_45849_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Vault"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/vault-console_hu47fc894059bf643b5ee1841f3679b829_45849_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Vault" title="Consola web de Vault"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-console_hu3baa982141d2bb7b569d1f3eab3dffb7_46853_2560x1440_fit_box_3.png" data-gallery="" title="Consola web de Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-console_hu3baa982141d2bb7b569d1f3eab3dffb7_46853_300x250_fit_box_3.png" width="300" height="209" alt="Consola web de Nomad" title="Consola web de Nomad"  class=""></amp-img></a></p>
<figcaption>Consolas web de Consul, Vault y Nomad y estados de salud de los servicios y nodos</figcaption>
</figure>
</div>
<h4 id="interfaz-de-línea-de-comandos-para-consul-vault-y-nomad">Interfaz de línea de comandos para Consul, Vault y Nomad</h4>
<p>Los mismos binarios de Consul, Vault y Nomad que tienen las funciones de servidor y cliente permiten utilizar su línea de comandos para realizar y automatizar con <em>scripts</em> las mismas acciones que se pueden hacer desde las consolas web pero la línea de comandos.</p>
<p>Dado que en el ejemplo los servidores requieren identificar al cliente es necesario configurar variables de entorno que indiquen la dirección IP del servidor y los certificados para el cifrado y autenticación. Una vez configuradas las variables de entorno se pueden lanzar comandos que permiten realizar tareas de administración para obtener información y para enviar <em>jobs</em> a Nomad.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash&#10;</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -e&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.10:8501&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/consul-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/consul-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_SSL</span><span class="o">=</span><span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONSUL_HTTP_SSL_VERIFY</span><span class="o">=</span><span class="nb">true</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.20:8200&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/vault-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/vault-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">VAULT_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_ADDR</span><span class="o">=</span><span class="s2">&#34;https://192.168.33.30:4646&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CLIENT_CERT</span><span class="o">=</span><span class="s2">&#34;server-certs/certs/nomad-agent.cert.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CLIENT_KEY</span><span class="o">=</span><span class="s2">&#34;server-certs/private/nomad-agent.key.pem&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">NOMAD_CACERT</span><span class="o">=</span><span class="s2">&#34;ca/intermediate/certs/ca-chain.cert.pem&#34;</span></span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>environment.sh</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ consul members&#10;</span></span><span class="line"><span class="cl">Node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Status  Type&nbsp;&nbsp;&nbsp;&nbsp;Build  Protocol  DC   Segment&#10;</span></span><span class="line"><span class="cl">consul-server-1  192.168.33.10:8301  alive   server  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;all&gt;&#10;</span></span><span class="line"><span class="cl">nomad-agent-1&nbsp;&nbsp;&nbsp;&nbsp;192.168.33.40:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">nomad-server-1   192.168.33.30:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">ui-server-1&nbsp;&nbsp;&nbsp;&nbsp;  192.168.33.50:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">vault-server-1   192.168.33.20:8301  alive   client  1.8.3  <span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dc1  &lt;default&gt;&#10;</span></span><span class="line"><span class="cl">$ consul catalog services&#10;</span></span><span class="line"><span class="cl">consul&#10;</span></span><span class="line"><span class="cl">nginx&#10;</span></span><span class="line"><span class="cl">nomad&#10;</span></span><span class="line"><span class="cl">nomad-client&#10;</span></span><span class="line"><span class="cl">vault&#10;</span></span><span class="line"><span class="cl">$ nomad server members&#10;</span></span><span class="line"><span class="cl">Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Port  Status  Leader  Protocol  Build   Datacenter  Region&#10;</span></span><span class="line"><span class="cl">nomad-server-1.global  192.168.33.30  <span class="m">4648</span>  alive   <span class="nb">true</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="m">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.12.2  dc1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; global&#10;</span></span><span class="line"><span class="cl">$ nomad node status&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DC   Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Class   Drain  Eligibility  Status&#10;</span></span><span class="line"><span class="cl">7469d6e5  dc1  nomad-agent-1  &lt;none&gt;  <span class="nb">false</span>  eligible&nbsp;&nbsp;&nbsp;&nbsp; ready&#10;</span></span><span class="line"><span class="cl">$ nomad job status&#10;</span></span><span class="line"><span class="cl">ID&nbsp;&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; Priority  Status   Submit Date&#10;</span></span><span class="line"><span class="cl">nginx  service  <span class="m">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running  2020-08-14T18:25:59+02:00</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>environment-status.sh</span>
    </div>
</div>
<h4 id="ejecución-de-un-servicio">Ejecución de un servicio</h4>
<p>El siguiente es la definición de un servicio o <em>job</em> para Nomad que define un servidor Nginx ejecutado en un contenedor de Docker. Una vez Nomad lo pone en ejecución se registra en Consul de forma automática de forma que pudiera ser encontrado por otros servicios que consulten el catálogo de servicios de Consul.</p>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt"> 1&#10;</span><span class="lnt"> 2&#10;</span><span class="lnt"> 3&#10;</span><span class="lnt"> 4&#10;</span><span class="lnt"> 5&#10;</span><span class="lnt"> 6&#10;</span><span class="lnt"> 7&#10;</span><span class="lnt"> 8&#10;</span><span class="lnt"> 9&#10;</span><span class="lnt">10&#10;</span><span class="lnt">11&#10;</span><span class="lnt">12&#10;</span><span class="lnt">13&#10;</span><span class="lnt">14&#10;</span><span class="lnt">15&#10;</span><span class="lnt">16&#10;</span><span class="lnt">17&#10;</span><span class="lnt">18&#10;</span><span class="lnt">19&#10;</span><span class="lnt">20&#10;</span><span class="lnt">21&#10;</span><span class="lnt">22&#10;</span><span class="lnt">23&#10;</span><span class="lnt">24&#10;</span><span class="lnt">25&#10;</span><span class="lnt">26&#10;</span><span class="lnt">27&#10;</span><span class="lnt">28&#10;</span><span class="lnt">29&#10;</span><span class="lnt">30&#10;</span><span class="lnt">31&#10;</span><span class="lnt">32&#10;</span><span class="lnt">33&#10;</span><span class="lnt">34&#10;</span><span class="lnt">35&#10;</span><span class="lnt">36&#10;</span><span class="lnt">37&#10;</span><span class="lnt">38&#10;</span><span class="lnt">39&#10;</span><span class="lnt">40&#10;</span><span class="lnt">41&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">job</span> <span class="s2">&#34;nginx&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">  datacenters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;dc1&#34;</span><span class="p">]</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">  <span class="k">group</span> <span class="s2">&#34;services&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;count</span> <span class="o">=</span> <span class="m">1</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">task</span> <span class="s2">&#34;nginx&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;  driver</span> <span class="o">=</span> <span class="s2">&#34;docker&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">config</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image</span> <span class="o">=</span> <span class="s2">&#34;nginx:alpine&#34;</span>&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; network_mode</span> <span class="o">=</span> <span class="s2">&#34;bridge&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="k">port_map</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   http</span> <span class="o">=</span> <span class="m">80</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">resources</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory</span> <span class="o">=</span> <span class="m">512</span><span class="c1"> # MB&#10;</span></span></span><span class="line"><span class="cl"><span class="c1"></span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">network</span> {&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">port</span> <span class="s2">&#34;http&#34;</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static</span> <span class="o">=</span> <span class="m">8080</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  <span class="k">service</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port</span> <span class="o">=</span> <span class="s2">&#34;http&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">check</span> {&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  name</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s2">&#34;nginx-check&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="o">=</span> <span class="s2">&#34;tcp&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  interval</span> <span class="o">=</span> <span class="s2">&#34;10s&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  timeout</span>  <span class="o">=</span> <span class="s2">&#34;2s&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;  }&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;}&#10;</span></span><span class="line"><span class="cl">  }&#10;</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-agent/nginx.nomad</span>
    </div>
</div>
<div class="code">
    <div class="highlight"><div class="chroma">&#10;<table class="lntable"><tr><td class="lntd">&#10;<pre tabindex="0" class="chroma"><code><span class="lnt">1&#10;</span><span class="lnt">2&#10;</span><span class="lnt">3&#10;</span><span class="lnt">4&#10;</span><span class="lnt">5&#10;</span><span class="lnt">6&#10;</span></code></pre></td>&#10;<td class="lntd">&#10;<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="n">$ nomad run nomad-agent/nginx.nomad</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="err">&gt;</span> <span class="k">Monitoring</span> <span class="k">evaluation</span> <span class="s2">&#34;6332818e&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">Evaluation</span> <span class="k">triggered</span> <span class="k">by</span> <span class="k">job</span> <span class="s2">&#34;nginx&#34;</span>&#10;</span></span><span class="line"><span class="cl">&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">Evaluation</span> <span class="k">within</span> <span class="k">deployment</span><span class="err">:</span> <span class="s2">&#34;c9a44a2d&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="n">&nbsp;&nbsp;&nbsp;&nbsp;Evaluation status changed: &#34;pending&#34; -&gt; &#34;complete&#34;</span>&#10;</span></span><span class="line"><span class="cl"><span class="o">==</span><span class="err">&gt;</span> <span class="k">Evaluation</span> <span class="s2">&#34;6332818e&#34; finished with status &#34;complete&#34;</span>&#10;</span></span></code></pre></td></tr></table>&#10;</div>&#10;</div>
    <div class="highlight-meta">
        <span>nomad-job.sh</span>
    </div>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-job-status_hub8d6050723820277433dddbe7b2cbc64_53726_2560x1440_fit_box_3.png" data-gallery="" title="Estado de un job en la consola web de Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nomad-job-status_hub8d6050723820277433dddbe7b2cbc64_53726_300x250_fit_box_3.png" width="300" height="209" alt="Estado de un job en la consola web de Nomad" title="Estado de un job en la consola web de Nomad"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nginx_hu18471b6e09c62b777f1265e24914b3e0_52377_2560x1440_fit_box_3.png" data-gallery="" title="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/nginx_hu18471b6e09c62b777f1265e24914b3e0_52377_300x250_fit_box_3.png" width="300" height="209" alt="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker" title="Servicio de Nginx ejecutado en Nomad como un contenedor de Docker"  class=""></amp-img></a></p>
<figcaption>Ejecución, estado de un job con un servicio de Nginx ejecutando en un contenedor de Docker en la consola web de Nomad</figcaption>
</figure>
</div>
<div class="media">
<figure>
<p><a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-services-web_hu550da182edc89129de2577701546a57e_69257_2560x1440_fit_box_3.png" data-gallery="" title="Servicios en consul con el servicio de Nginx registrado por Nomad"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/consul-services-web_hu550da182edc89129de2577701546a57e_69257_300x250_fit_box_3.png" width="300" height="209" alt="Servicios en consul con el servicio de Nginx registrado por Nomad" title="Servicios en consul con el servicio de Nginx registrado por Nomad"  class=""></amp-img></a>
<a href="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/datacenter-commandline-information_hub36b2b3205cc19448b0ebeb7c5c066eb_95694_2560x1440_fit_box_3.png" data-gallery="" title="Información de estado del centro de datos obtenido desde la línea de comandos"><amp-img src="/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/images/datacenter-commandline-information_hub36b2b3205cc19448b0ebeb7c5c066eb_95694_300x250_fit_box_3.png" width="300" height="216" alt="Información de estado del centro de datos obtenido desde la línea de comandos" title="Información de estado del centro de datos obtenido desde la línea de comandos"  class=""></amp-img></a></p>
<figcaption>Servicios en consul con el servicio de Nginx registrado por Nomad e información de estado del centro de datos obtenido desde la línea de comandos</figcaption>
</figure>
</div>
<h3 id="requerimientos-de-operaciones">Requerimientos de operaciones</h3>
<p>Este artículo solo tiene un ejemplo básico pero que sirve como base para crear un entorno de producción real basado en las herramientas de HashiCorp.</p>
<p>Hay otras funcionalidades que un entorno real de producción requeriría, como telemetría y monitorización, cual sería el proceso para actualizar el centro de datos a nuevas versiones, aprovisionamiento con Terraform para un centro de computación proporcionado por un proveedor en la nube, utilizar un sistema de autenticación como OAuth en vez autenticación básica en la consolas de administración, quizá <a href="https://github.com/hashicorp/consul-template">consul-template</a> en algunos servicios para actualizar de forma dinámica configuraciones que tomen datos de Vault o Consul o utilizar <a href="https://traefik.io/">Traefik</a> para que haga de <em>proxy</em> de los servicios que utilicen el protocolo HTTP.</p>
<div class="alert alert-secondary sourcecode fs-6">
    <amp-img src="/blog-bitix/assets/images/icons/terminal.svg" width="64" height="64" alt="Terminal" title="Terminal" class="lozad sourcecode-icon"></amp-img>
    <p>
            El <a href="https://github.com/picodotdev/blog-ejemplos/tree/master/ConsulVaultNomadDatacenter">código fuente completo del ejemplo</a> puedes descargarlo del repositorio de ejemplos de Blog Bitix alojado en GitHub y probarlo en tu equipo ejecutando siguiente comando:<br><code>./vagrant-up.sh</code></p>
</div>
<div class="reference">
    Referencia:<br>
<ul>
<li><a href="https://linuxconfig.org/how-to-make-iptables-rules-persistent-after-reboot-on-linux">How to make iptables rules persistent after reboot on Linux</a></li>
<li><a href="https://github.com/hashicorp/consul/issues/7150">Securing Consul Web UI</a></li>
<li><a href="https://github.com/hashicorp/consul/issues/1720">Consul Web UI: Need to make it password enabled</a></li>
<li><a href="https://bugs.launchpad.net/cloud-images/&#43;bug/1829625">Vagrant box startup timeout due to no serial port</a></li>
</ul>
</div>

    </div>

    
      <div class="videoo">
        
      </div>
    

    <p class="information">
      
    </p>

    
  </article>
        <div>
          <hr>
        </div>
        
  <div class="row serie">
    <div class="col-md-12">
      <h3>Este artículo forma parte de la serie <strong>hashicorp</strong>:</h3>
        
        <ol class="serie-articles">
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/04/introduccion-a-nomad-para-gestionar-aplicaciones-y-microservicios/index-amp.html">Introducción a Nomad para gestionar aplicaciones y microservicios</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/04/estrategias-de-despliegue-para-microservicios-con-nomad/index-amp.html">Estrategias de despliegue para microservicios con Nomad</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/04/servicios-con-persistencia-en-el-orquestador-de-microservicios-nomad/index-amp.html">Servicios con persistencia en el orquestador de microservicios Nomad</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/05/crear-de-forma-sencilla-y-rapida-maquinas-virtuales-de-virtualbox-con-vagrant/index-amp.html">Crear de forma sencilla y rápida máquinas virtuales de VirtualBox con Vagrant</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/05/registro-y-descubrimiento-de-servicios-en-contenedores-de-docker-con-consul-y-registrator/index-amp.html">Registro y descubrimiento de servicios en contenedores de Docker con Consul y Registrator</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/07/administrar-secretos-y-proteger-datos-sensibles-con-vault/index-amp.html">Administrar secretos y proteger datos sensibles con Vault</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/08/generar-credenciales-de-conexion-a-base-de-datos-bajo-demanda-con-vault/index-amp.html">Generar credenciales de conexión a base de datos bajo demanda con Vault</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/08/utilizar-credenciales-de-conexion-a-la-base-de-datos-generadas-por-vault-en-una-aplicacion-de-spring/index-amp.html">Utilizar credenciales de conexión a la base de datos generadas por Vault en una aplicación de Spring</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2019/10/microservicios-con-spring-cloud-consul-nomad-y-traefik/index-amp.html">Microservicios con Spring Cloud, Consul, Nomad y Traefik</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2020/07/comunicaciones-seguras-autenticacion-mutua-y-autorizaciones-con-intenciones-entre-servicios-usando-consul-connect-y-nomad/index-amp.html">Comunicaciones seguras, autenticación mutua y autorizaciones con intenciones entre servicios usando Consul Connect y Nomad</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2020/07/revertir-un-servicio-a-una-version-anterior-con-nomad/index-amp.html">Revertir un servicio a una versión anterior con Nomad</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2020/08/arquitectura-de-referencia-de-consul-vault-y-nomad-para-un-centro-de-datos/index-amp.html">Arquitectura de referencia de Consul, Vault y Nomad para un centro de datos</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2021/02/cifrado-y-descifrado-como-servicio-con-vault/index-amp.html">Cifrado y descifrado como servicio con Vault</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2021/03/acceso-simple-y-seguro-a-sistemas-remotos-con-boundary/index-amp.html">Acceso simple y seguro a sistemas remotos con Boundary</a>
            </li>
          <li>
              <a href="https://picodotdev.github.io/blog-bitix/2021/09/planificar-procesos-periodicos-y-scripts-con-nomad/index-amp.html">Planificar procesos periódicos y scripts con Nomad</a>
            </li>
          
        </ol>
      
    </div>
  </div>


        
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-text">
      Comparte el artículo:
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="sharethis sharethis-inline-share-buttons"></div>
  </div>
</div>


        
        
        <div class="row">
          <div class="col-12 adblock-container-billboard mt-3 mb-3 p-0">
            <span id="pageBottom"></span>
            <amp-ad width="100vw" height="280"
    type="adsense"
    data-ad-client="ca-pub-3533636310991304"
    data-ad-slot="4052324337"
    data-auto-format="rspv"
    data-full-width="">
    <div overflow=""></div>
</amp-ad>

          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <hr>
      </div>
    </div>
    





<footer>
  <div class="row">
    <div class="col-12 col-sm-4">
      <p><strong>Blog Bitix</strong></p>
      <p>Blog sobre al lenguaje de programación Java y la distribución GNU/Linux que uso habitualmente, Arch Linux, lo que aprendo sobre el software libre, la programación web y otros temas relacionados con la tecnología y la informática. El contenido puede contener trazas de asuntos fuera de tema.</p>
      <p>Publicando de uno a tres artículos únicos a la semana desde el año 2010.</p>
    </div>
    <div class="col-12 col-sm-4 text-center menu">
      <ul class="list-unstyled">
        <li><a href="/blog-bitix/tags/java/index-amp.html">Java</a></li>
        <li><a href="/blog-bitix/tags/gnu-linux/index-amp.html">GNU/Linux</a></li>
        <li><a href="/blog-bitix/tags/javascript/index-amp.html">JavaScript</a></li>
        <li><a href="/blog-bitix/tags/tapestry/index-amp.html">Tapestry</a></li>
        <li><a href="/blog-bitix/archive/index-amp.html">Archivo y hemeroteca</a></li>
        <li><a href="/blog-bitix/pages/links/index-amp.html">Enlaces</a></li>
        <li><a href="/blog-bitix/pages/advertising/index-amp.html">Advertising</a></li>
        <li><a href="/blog-bitix/pages/advertising/index-amp.html">Publicidad</a></li>
        <li><a href="/blog-bitix/pages/donate/index-amp.html">Donaciones</a></li>
        <li><a href="/blog-bitix/pages/about/index-amp.html">Acerca de...</a></li>
        
      </ul>
    </div>
    <div class="col-12 col-sm-4 text-center links">
      
        <a href="https://picodotdev.github.io/blog-bitix/index.xml" title="¡Suscríbete a Blog Bitix!"><amp-img src="/blog-bitix/assets/images/rss.svg" width="50" height="50" class="icon" alt="rss"></amp-img></a>
      
      
        <a href="https://twitter.com/picodotdev/" title="¡Sígueme en twitter!"><amp-img src="/blog-bitix/assets/images/twitter.svg" width="50" height="50" class="icon" alt="twitter"></amp-img></a>
      
      
      
        <a href="https://github.com/picodotdev/blog-ejemplos/" title="¡Obtén el código fuente de los ejemplos!"><amp-img src="/blog-bitix/assets/images/github.svg" width="50" height="50" class="icon" alt="github"></amp-img></a>
      
      
      
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      Copyleft <span class="copyleft">&copy;</span> 2022 - <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="nofollow"><amp-img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" width="80" height="15" alt="Creative Commons License" title="Creative Commons License"></amp-img></a><br />
      <a href="https://www.planetacodigo.com/" rel="nofollow"><amp-img src="/blog-bitix/assets/images/planeta-codigo.png" width="80" height="15" alt="Planeta código" title="Planeta código"></amp-img></a>
      <br/>
      <a href="https://picodotdev.github.io/blog-bitix/" rel="nofollow">Blog Bitix</a> by <a href="https://picodotdev.github.io/blog-bitix/">pico.dev</a> is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional License</a>.
      <br/>
      <span class="credit">Powered by <a href="https://gohugo.io/" rel="nofollow" title="A fast and modern static website engine">Hugo</a> and <a href="https://pages.github.com/" title="Websites for you and your projects">GitHub Pages</a>.</span>
      <span class="credit">Background patterns from <a href="https://www.toptal.com/designers/subtlepatterns/" rel="nofollow">Subtle Patterns</a>.</span>
    </div>
  </div>
</footer>

  </div>
  <amp-analytics type="gtag" data-credentials="include">
<script type="application/json">
{
    "vars" : {
        "gtag_id": "G-9R8XCRGSMY",
        "config" : {
            "G-9R8XCRGSMY": { "groups": "default" }
        }
    }
}
</script>
</amp-analytics>  
  
</body>
</html>